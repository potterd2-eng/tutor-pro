var d2=s=>{throw TypeError(s)};var xx=(s,e,t)=>e.has(s)||d2("Cannot "+t);var qs=(s,e,t)=>(xx(s,e,"read from private field"),t?t.call(s):e.get(s)),el=(s,e,t)=>e.has(s)?d2("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),na=(s,e,t,n)=>(xx(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t),tl=(s,e,t)=>(xx(s,e,"access private method"),t);var h2=(s,e,t,n)=>({set _(r){na(s,e,r,t)},get _(){return qs(s,e,n)}});function Y3(s,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in s)){const i=Object.getOwnPropertyDescriptor(n,r);i&&Object.defineProperty(s,r,i.get?i:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();var bx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ig(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function K3(s){if(Object.prototype.hasOwnProperty.call(s,"__esModule"))return s;var e=s.default;if(typeof e=="function"){var t=function n(){var r=!1;try{r=this instanceof n}catch{}return r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(n){var r=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return s[n]}})}),t}var yx={exports:{}},af={};var f2;function X3(){if(f2)return af;f2=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,r,i){var o=null;if(i!==void 0&&(o=""+i),r.key!==void 0&&(o=""+r.key),"key"in r){i={};for(var l in r)l!=="key"&&(i[l]=r[l])}else i=r;return r=i.ref,{$$typeof:s,type:n,key:o,ref:r!==void 0?r:null,props:i}}return af.Fragment=e,af.jsx=t,af.jsxs=t,af}var p2;function J3(){return p2||(p2=1,yx.exports=X3()),yx.exports}var u=J3(),vx={exports:{}},En={};var g2;function Z3(){if(g2)return En;g2=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),b=Symbol.iterator;function x(M){return M===null||typeof M!="object"?null:(M=b&&M[b]||M["@@iterator"],typeof M=="function"?M:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,_={};function N(M,L,U){this.props=M,this.context=L,this.refs=_,this.updater=U||w}N.prototype.isReactComponent={},N.prototype.setState=function(M,L){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,L,"setState")},N.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function E(){}E.prototype=N.prototype;function k(M,L,U){this.props=M,this.context=L,this.refs=_,this.updater=U||w}var T=k.prototype=new E;T.constructor=k,v(T,N.prototype),T.isPureReactComponent=!0;var P=Array.isArray;function O(){}var F={H:null,A:null,T:null,S:null},$=Object.prototype.hasOwnProperty;function z(M,L,U){var H=U.ref;return{$$typeof:s,type:M,key:L,ref:H!==void 0?H:null,props:U}}function G(M,L){return z(M.type,L,M.props)}function R(M){return typeof M=="object"&&M!==null&&M.$$typeof===s}function q(M){var L={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(U){return L[U]})}var J=/\/+/g;function Z(M,L){return typeof M=="object"&&M!==null&&M.key!=null?q(""+M.key):L.toString(36)}function le(M){switch(M.status){case"fulfilled":return M.value;case"rejected":throw M.reason;default:switch(typeof M.status=="string"?M.then(O,O):(M.status="pending",M.then(function(L){M.status==="pending"&&(M.status="fulfilled",M.value=L)},function(L){M.status==="pending"&&(M.status="rejected",M.reason=L)})),M.status){case"fulfilled":return M.value;case"rejected":throw M.reason}}throw M}function K(M,L,U,H,ae){var de=typeof M;(de==="undefined"||de==="boolean")&&(M=null);var xe=!1;if(M===null)xe=!0;else switch(de){case"bigint":case"string":case"number":xe=!0;break;case"object":switch(M.$$typeof){case s:case e:xe=!0;break;case p:return xe=M._init,K(xe(M._payload),L,U,H,ae)}}if(xe)return ae=ae(M),xe=H===""?"."+Z(M,0):H,P(ae)?(U="",xe!=null&&(U=xe.replace(J,"$&/")+"/"),K(ae,L,U,"",function(ve){return ve})):ae!=null&&(R(ae)&&(ae=G(ae,U+(ae.key==null||M&&M.key===ae.key?"":(""+ae.key).replace(J,"$&/")+"/")+xe)),L.push(ae)),1;xe=0;var he=H===""?".":H+":";if(P(M))for(var me=0;me<M.length;me++)H=M[me],de=he+Z(H,me),xe+=K(H,L,U,de,ae);else if(me=x(M),typeof me=="function")for(M=me.call(M),me=0;!(H=M.next()).done;)H=H.value,de=he+Z(H,me++),xe+=K(H,L,U,de,ae);else if(de==="object"){if(typeof M.then=="function")return K(le(M),L,U,H,ae);throw L=String(M),Error("Objects are not valid as a React child (found: "+(L==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":L)+"). If you meant to render a collection of children, use an array instead.")}return xe}function se(M,L,U){if(M==null)return M;var H=[],ae=0;return K(M,H,"","",function(de){return L.call(U,de,ae++)}),H}function ce(M){if(M._status===-1){var L=M._result;L=L(),L.then(function(U){(M._status===0||M._status===-1)&&(M._status=1,M._result=U)},function(U){(M._status===0||M._status===-1)&&(M._status=2,M._result=U)}),M._status===-1&&(M._status=0,M._result=L)}if(M._status===1)return M._result.default;throw M._result}var ye=typeof reportError=="function"?reportError:function(M){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var L=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof M=="object"&&M!==null&&typeof M.message=="string"?String(M.message):String(M),error:M});if(!window.dispatchEvent(L))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",M);return}console.error(M)},Ce={map:se,forEach:function(M,L,U){se(M,function(){L.apply(this,arguments)},U)},count:function(M){var L=0;return se(M,function(){L++}),L},toArray:function(M){return se(M,function(L){return L})||[]},only:function(M){if(!R(M))throw Error("React.Children.only expected to receive a single React element child.");return M}};return En.Activity=g,En.Children=Ce,En.Component=N,En.Fragment=t,En.Profiler=r,En.PureComponent=k,En.StrictMode=n,En.Suspense=d,En.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=F,En.__COMPILER_RUNTIME={__proto__:null,c:function(M){return F.H.useMemoCache(M)}},En.cache=function(M){return function(){return M.apply(null,arguments)}},En.cacheSignal=function(){return null},En.cloneElement=function(M,L,U){if(M==null)throw Error("The argument must be a React element, but you passed "+M+".");var H=v({},M.props),ae=M.key;if(L!=null)for(de in L.key!==void 0&&(ae=""+L.key),L)!$.call(L,de)||de==="key"||de==="__self"||de==="__source"||de==="ref"&&L.ref===void 0||(H[de]=L[de]);var de=arguments.length-2;if(de===1)H.children=U;else if(1<de){for(var xe=Array(de),he=0;he<de;he++)xe[he]=arguments[he+2];H.children=xe}return z(M.type,ae,H)},En.createContext=function(M){return M={$$typeof:o,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null},M.Provider=M,M.Consumer={$$typeof:i,_context:M},M},En.createElement=function(M,L,U){var H,ae={},de=null;if(L!=null)for(H in L.key!==void 0&&(de=""+L.key),L)$.call(L,H)&&H!=="key"&&H!=="__self"&&H!=="__source"&&(ae[H]=L[H]);var xe=arguments.length-2;if(xe===1)ae.children=U;else if(1<xe){for(var he=Array(xe),me=0;me<xe;me++)he[me]=arguments[me+2];ae.children=he}if(M&&M.defaultProps)for(H in xe=M.defaultProps,xe)ae[H]===void 0&&(ae[H]=xe[H]);return z(M,de,ae)},En.createRef=function(){return{current:null}},En.forwardRef=function(M){return{$$typeof:l,render:M}},En.isValidElement=R,En.lazy=function(M){return{$$typeof:p,_payload:{_status:-1,_result:M},_init:ce}},En.memo=function(M,L){return{$$typeof:h,type:M,compare:L===void 0?null:L}},En.startTransition=function(M){var L=F.T,U={};F.T=U;try{var H=M(),ae=F.S;ae!==null&&ae(U,H),typeof H=="object"&&H!==null&&typeof H.then=="function"&&H.then(O,ye)}catch(de){ye(de)}finally{L!==null&&U.types!==null&&(L.types=U.types),F.T=L}},En.unstable_useCacheRefresh=function(){return F.H.useCacheRefresh()},En.use=function(M){return F.H.use(M)},En.useActionState=function(M,L,U){return F.H.useActionState(M,L,U)},En.useCallback=function(M,L){return F.H.useCallback(M,L)},En.useContext=function(M){return F.H.useContext(M)},En.useDebugValue=function(){},En.useDeferredValue=function(M,L){return F.H.useDeferredValue(M,L)},En.useEffect=function(M,L){return F.H.useEffect(M,L)},En.useEffectEvent=function(M){return F.H.useEffectEvent(M)},En.useId=function(){return F.H.useId()},En.useImperativeHandle=function(M,L,U){return F.H.useImperativeHandle(M,L,U)},En.useInsertionEffect=function(M,L){return F.H.useInsertionEffect(M,L)},En.useLayoutEffect=function(M,L){return F.H.useLayoutEffect(M,L)},En.useMemo=function(M,L){return F.H.useMemo(M,L)},En.useOptimistic=function(M,L){return F.H.useOptimistic(M,L)},En.useReducer=function(M,L,U){return F.H.useReducer(M,L,U)},En.useRef=function(M){return F.H.useRef(M)},En.useState=function(M){return F.H.useState(M)},En.useSyncExternalStore=function(M,L,U){return F.H.useSyncExternalStore(M,L,U)},En.useTransition=function(){return F.H.useTransition()},En.version="19.2.4",En}var m2;function db(){return m2||(m2=1,vx.exports=Z3()),vx.exports}var Y=db();const ra=Ig(Y);var wx={exports:{}},of={},Sx={exports:{}},_x={};var x2;function Q3(){return x2||(x2=1,(function(s){function e(K,se){var ce=K.length;K.push(se);e:for(;0<ce;){var ye=ce-1>>>1,Ce=K[ye];if(0<r(Ce,se))K[ye]=se,K[ce]=Ce,ce=ye;else break e}}function t(K){return K.length===0?null:K[0]}function n(K){if(K.length===0)return null;var se=K[0],ce=K.pop();if(ce!==se){K[0]=ce;e:for(var ye=0,Ce=K.length,M=Ce>>>1;ye<M;){var L=2*(ye+1)-1,U=K[L],H=L+1,ae=K[H];if(0>r(U,ce))H<Ce&&0>r(ae,U)?(K[ye]=ae,K[H]=ce,ye=H):(K[ye]=U,K[L]=ce,ye=L);else if(H<Ce&&0>r(ae,ce))K[ye]=ae,K[H]=ce,ye=H;else break e}}return se}function r(K,se){var ce=K.sortIndex-se.sortIndex;return ce!==0?ce:K.id-se.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;s.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();s.unstable_now=function(){return o.now()-l}}var d=[],h=[],p=1,g=null,b=3,x=!1,w=!1,v=!1,_=!1,N=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;function T(K){for(var se=t(h);se!==null;){if(se.callback===null)n(h);else if(se.startTime<=K)n(h),se.sortIndex=se.expirationTime,e(d,se);else break;se=t(h)}}function P(K){if(v=!1,T(K),!w)if(t(d)!==null)w=!0,O||(O=!0,q());else{var se=t(h);se!==null&&le(P,se.startTime-K)}}var O=!1,F=-1,$=5,z=-1;function G(){return _?!0:!(s.unstable_now()-z<$)}function R(){if(_=!1,O){var K=s.unstable_now();z=K;var se=!0;try{e:{w=!1,v&&(v=!1,E(F),F=-1),x=!0;var ce=b;try{t:{for(T(K),g=t(d);g!==null&&!(g.expirationTime>K&&G());){var ye=g.callback;if(typeof ye=="function"){g.callback=null,b=g.priorityLevel;var Ce=ye(g.expirationTime<=K);if(K=s.unstable_now(),typeof Ce=="function"){g.callback=Ce,T(K),se=!0;break t}g===t(d)&&n(d),T(K)}else n(d);g=t(d)}if(g!==null)se=!0;else{var M=t(h);M!==null&&le(P,M.startTime-K),se=!1}}break e}finally{g=null,b=ce,x=!1}se=void 0}}finally{se?q():O=!1}}}var q;if(typeof k=="function")q=function(){k(R)};else if(typeof MessageChannel<"u"){var J=new MessageChannel,Z=J.port2;J.port1.onmessage=R,q=function(){Z.postMessage(null)}}else q=function(){N(R,0)};function le(K,se){F=N(function(){K(s.unstable_now())},se)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(K){K.callback=null},s.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<K?Math.floor(1e3/K):5},s.unstable_getCurrentPriorityLevel=function(){return b},s.unstable_next=function(K){switch(b){case 1:case 2:case 3:var se=3;break;default:se=b}var ce=b;b=se;try{return K()}finally{b=ce}},s.unstable_requestPaint=function(){_=!0},s.unstable_runWithPriority=function(K,se){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var ce=b;b=K;try{return se()}finally{b=ce}},s.unstable_scheduleCallback=function(K,se,ce){var ye=s.unstable_now();switch(typeof ce=="object"&&ce!==null?(ce=ce.delay,ce=typeof ce=="number"&&0<ce?ye+ce:ye):ce=ye,K){case 1:var Ce=-1;break;case 2:Ce=250;break;case 5:Ce=1073741823;break;case 4:Ce=1e4;break;default:Ce=5e3}return Ce=ce+Ce,K={id:p++,callback:se,priorityLevel:K,startTime:ce,expirationTime:Ce,sortIndex:-1},ce>ye?(K.sortIndex=ce,e(h,K),t(d)===null&&K===t(h)&&(v?(E(F),F=-1):v=!0,le(P,ce-ye))):(K.sortIndex=Ce,e(d,K),w||x||(w=!0,O||(O=!0,q()))),K},s.unstable_shouldYield=G,s.unstable_wrapCallback=function(K){var se=b;return function(){var ce=b;b=se;try{return K.apply(this,arguments)}finally{b=ce}}}})(_x)),_x}var b2;function eN(){return b2||(b2=1,Sx.exports=Q3()),Sx.exports}var Ax={exports:{}},yi={};var y2;function tN(){if(y2)return yi;y2=1;var s=db();function e(d){var h="https://react.dev/errors/"+d;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)h+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+d+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function i(d,h,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:g==null?null:""+g,children:d,containerInfo:h,implementation:p}}var o=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(d,h){if(d==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return yi.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,yi.createPortal=function(d,h){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return i(d,h,null,p)},yi.flushSync=function(d){var h=o.T,p=n.p;try{if(o.T=null,n.p=2,d)return d()}finally{o.T=h,n.p=p,n.d.f()}},yi.preconnect=function(d,h){typeof d=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,n.d.C(d,h))},yi.prefetchDNS=function(d){typeof d=="string"&&n.d.D(d)},yi.preinit=function(d,h){if(typeof d=="string"&&h&&typeof h.as=="string"){var p=h.as,g=l(p,h.crossOrigin),b=typeof h.integrity=="string"?h.integrity:void 0,x=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;p==="style"?n.d.S(d,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:g,integrity:b,fetchPriority:x}):p==="script"&&n.d.X(d,{crossOrigin:g,integrity:b,fetchPriority:x,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},yi.preinitModule=function(d,h){if(typeof d=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var p=l(h.as,h.crossOrigin);n.d.M(d,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&n.d.M(d)},yi.preload=function(d,h){if(typeof d=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var p=h.as,g=l(p,h.crossOrigin);n.d.L(d,p,{crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},yi.preloadModule=function(d,h){if(typeof d=="string")if(h){var p=l(h.as,h.crossOrigin);n.d.m(d,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else n.d.m(d)},yi.requestFormReset=function(d){n.d.r(d)},yi.unstable_batchedUpdates=function(d,h){return d(h)},yi.useFormState=function(d,h,p){return o.H.useFormState(d,h,p)},yi.useFormStatus=function(){return o.H.useHostTransitionStatus()},yi.version="19.2.4",yi}var v2;function nN(){if(v2)return Ax.exports;v2=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),Ax.exports=tN(),Ax.exports}var w2;function sN(){if(w2)return of;w2=1;var s=eN(),e=db(),t=nN();function n(a){var c="https://react.dev/errors/"+a;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)c+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function i(a){var c=a,f=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(f=c.return),a=c.return;while(a)}return c.tag===3?f:null}function o(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function l(a){if(a.tag===31){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function d(a){if(i(a)!==a)throw Error(n(188))}function h(a){var c=a.alternate;if(!c){if(c=i(a),c===null)throw Error(n(188));return c!==a?null:a}for(var f=a,m=c;;){var S=f.return;if(S===null)break;var C=S.alternate;if(C===null){if(m=S.return,m!==null){f=m;continue}break}if(S.child===C.child){for(C=S.child;C;){if(C===f)return d(S),a;if(C===m)return d(S),c;C=C.sibling}throw Error(n(188))}if(f.return!==m.return)f=S,m=C;else{for(var I=!1,ne=S.child;ne;){if(ne===f){I=!0,f=S,m=C;break}if(ne===m){I=!0,m=S,f=C;break}ne=ne.sibling}if(!I){for(ne=C.child;ne;){if(ne===f){I=!0,f=C,m=S;break}if(ne===m){I=!0,m=C,f=S;break}ne=ne.sibling}if(!I)throw Error(n(189))}}if(f.alternate!==m)throw Error(n(190))}if(f.tag!==3)throw Error(n(188));return f.stateNode.current===f?a:c}function p(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a;for(a=a.child;a!==null;){if(c=p(a),c!==null)return c;a=a.sibling}return null}var g=Object.assign,b=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),k=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),F=Symbol.for("react.memo"),$=Symbol.for("react.lazy"),z=Symbol.for("react.activity"),G=Symbol.for("react.memo_cache_sentinel"),R=Symbol.iterator;function q(a){return a===null||typeof a!="object"?null:(a=R&&a[R]||a["@@iterator"],typeof a=="function"?a:null)}var J=Symbol.for("react.client.reference");function Z(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===J?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case v:return"Fragment";case N:return"Profiler";case _:return"StrictMode";case P:return"Suspense";case O:return"SuspenseList";case z:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case w:return"Portal";case k:return a.displayName||"Context";case E:return(a._context.displayName||"Context")+".Consumer";case T:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case F:return c=a.displayName||null,c!==null?c:Z(a.type)||"Memo";case $:c=a._payload,a=a._init;try{return Z(a(c))}catch{}}return null}var le=Array.isArray,K=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ce={pending:!1,data:null,method:null,action:null},ye=[],Ce=-1;function M(a){return{current:a}}function L(a){0>Ce||(a.current=ye[Ce],ye[Ce]=null,Ce--)}function U(a,c){Ce++,ye[Ce]=a.current,a.current=c}var H=M(null),ae=M(null),de=M(null),xe=M(null);function he(a,c){switch(U(de,c),U(ae,a),U(H,null),c.nodeType){case 9:case 11:a=(a=c.documentElement)&&(a=a.namespaceURI)?Pv(a):0;break;default:if(a=c.tagName,c=c.namespaceURI)c=Pv(c),a=Bv(c,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}L(H),U(H,a)}function me(){L(H),L(ae),L(de)}function ve(a){a.memoizedState!==null&&U(xe,a);var c=H.current,f=Bv(c,a.type);c!==f&&(U(ae,a),U(H,f))}function Re(a){ae.current===a&&(L(H),L(ae)),xe.current===a&&(L(xe),tf._currentValue=ce)}var Ke,Ge;function ke(a){if(Ke===void 0)try{throw Error()}catch(f){var c=f.stack.trim().match(/\n( *(at )?)/);Ke=c&&c[1]||"",Ge=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ke+a+Ge}var X=!1;function Pe(a,c){if(!a||X)return"";X=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(c){var xt=function(){throw Error()};if(Object.defineProperty(xt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(xt,[])}catch(Je){var He=Je}Reflect.construct(a,[],xt)}else{try{xt.call()}catch(Je){He=Je}a.call(xt.prototype)}}else{try{throw Error()}catch(Je){He=Je}(xt=a())&&typeof xt.catch=="function"&&xt.catch(function(){})}}catch(Je){if(Je&&He&&typeof Je.stack=="string")return[Je.stack,He.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var S=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");S&&S.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var C=m.DetermineComponentFrameRoot(),I=C[0],ne=C[1];if(I&&ne){var be=I.split(`
`),qe=ne.split(`
`);for(S=m=0;m<be.length&&!be[m].includes("DetermineComponentFrameRoot");)m++;for(;S<qe.length&&!qe[S].includes("DetermineComponentFrameRoot");)S++;if(m===be.length||S===qe.length)for(m=be.length-1,S=qe.length-1;1<=m&&0<=S&&be[m]!==qe[S];)S--;for(;1<=m&&0<=S;m--,S--)if(be[m]!==qe[S]){if(m!==1||S!==1)do if(m--,S--,0>S||be[m]!==qe[S]){var rt=`
`+be[m].replace(" at new "," at ");return a.displayName&&rt.includes("<anonymous>")&&(rt=rt.replace("<anonymous>",a.displayName)),rt}while(1<=m&&0<=S);break}}}finally{X=!1,Error.prepareStackTrace=f}return(f=a?a.displayName||a.name:"")?ke(f):""}function gt(a,c){switch(a.tag){case 26:case 27:case 5:return ke(a.type);case 16:return ke("Lazy");case 13:return a.child!==c&&c!==null?ke("Suspense Fallback"):ke("Suspense");case 19:return ke("SuspenseList");case 0:case 15:return Pe(a.type,!1);case 11:return Pe(a.type.render,!1);case 1:return Pe(a.type,!0);case 31:return ke("Activity");default:return""}}function bt(a){try{var c="",f=null;do c+=gt(a,f),f=a,a=a.return;while(a);return c}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var Ye=Object.prototype.hasOwnProperty,Et=s.unstable_scheduleCallback,vt=s.unstable_cancelCallback,st=s.unstable_shouldYield,St=s.unstable_requestPaint,Pt=s.unstable_now,Ut=s.unstable_getCurrentPriorityLevel,je=s.unstable_ImmediatePriority,Me=s.unstable_UserBlockingPriority,Fe=s.unstable_NormalPriority,ue=s.unstable_LowPriority,Te=s.unstable_IdlePriority,Oe=s.log,ct=s.unstable_setDisableYieldValue,ft=null,wt=null;function it(a){if(typeof Oe=="function"&&ct(a),wt&&typeof wt.setStrictMode=="function")try{wt.setStrictMode(ft,a)}catch{}}var At=Math.clz32?Math.clz32:pt,We=Math.log,lt=Math.LN2;function pt(a){return a>>>=0,a===0?32:31-(We(a)/lt|0)|0}var It=256,en=262144,Mt=4194304;function Bt(a){var c=a&42;if(c!==0)return c;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Yt(a,c,f){var m=a.pendingLanes;if(m===0)return 0;var S=0,C=a.suspendedLanes,I=a.pingedLanes;a=a.warmLanes;var ne=m&134217727;return ne!==0?(m=ne&~C,m!==0?S=Bt(m):(I&=ne,I!==0?S=Bt(I):f||(f=ne&~a,f!==0&&(S=Bt(f))))):(ne=m&~C,ne!==0?S=Bt(ne):I!==0?S=Bt(I):f||(f=m&~a,f!==0&&(S=Bt(f)))),S===0?0:c!==0&&c!==S&&(c&C)===0&&(C=S&-S,f=c&-c,C>=f||C===32&&(f&4194048)!==0)?c:S}function On(a,c){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&c)===0}function an(a,c){switch(a){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function As(){var a=Mt;return Mt<<=1,(Mt&62914560)===0&&(Mt=4194304),a}function ut(a){for(var c=[],f=0;31>f;f++)c.push(a);return c}function re(a,c){a.pendingLanes|=c,c!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Qe(a,c,f,m,S,C){var I=a.pendingLanes;a.pendingLanes=f,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=f,a.entangledLanes&=f,a.errorRecoveryDisabledLanes&=f,a.shellSuspendCounter=0;var ne=a.entanglements,be=a.expirationTimes,qe=a.hiddenUpdates;for(f=I&~f;0<f;){var rt=31-At(f),xt=1<<rt;ne[rt]=0,be[rt]=-1;var He=qe[rt];if(He!==null)for(qe[rt]=null,rt=0;rt<He.length;rt++){var Je=He[rt];Je!==null&&(Je.lane&=-536870913)}f&=~xt}m!==0&&mt(a,m,0),C!==0&&S===0&&a.tag!==0&&(a.suspendedLanes|=C&~(I&~c))}function mt(a,c,f){a.pendingLanes|=c,a.suspendedLanes&=~c;var m=31-At(c);a.entangledLanes|=c,a.entanglements[m]=a.entanglements[m]|1073741824|f&261930}function Xe(a,c){var f=a.entangledLanes|=c;for(a=a.entanglements;f;){var m=31-At(f),S=1<<m;S&c|a[m]&c&&(a[m]|=c),f&=~S}}function et(a,c){var f=c&-c;return f=(f&42)!==0?1:kt(f),(f&(a.suspendedLanes|c))!==0?0:f}function kt(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Tt(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function Rt(){var a=se.p;return a!==0?a:(a=window.event,a===void 0?32:r2(a.type))}function An(a,c){var f=se.p;try{return se.p=a,c()}finally{se.p=f}}var Pn=Math.random().toString(36).slice(2),wn="__reactFiber$"+Pn,jt="__reactProps$"+Pn,dt="__reactContainer$"+Pn,sn="__reactEvents$"+Pn,Un="__reactListeners$"+Pn,er="__reactHandles$"+Pn,tr="__reactResources$"+Pn,Ns="__reactMarker$"+Pn;function Hr(a){delete a[wn],delete a[jt],delete a[sn],delete a[Un],delete a[er]}function Tr(a){var c=a[wn];if(c)return c;for(var f=a.parentNode;f;){if(c=f[dt]||f[wn]){if(f=c.alternate,c.child!==null||f!==null&&f.child!==null)for(a=$v(a);a!==null;){if(f=a[wn])return f;a=$v(a)}return c}a=f,f=a.parentNode}return null}function Ci(a){if(a=a[wn]||a[dt]){var c=a.tag;if(c===5||c===6||c===13||c===31||c===26||c===27||c===3)return a}return null}function Za(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a.stateNode;throw Error(n(33))}function Ei(a){var c=a[tr];return c||(c=a[tr]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function Ds(a){a[Ns]=!0}var pl=new Set,ni={};function ki(a,c){gi(a,c),gi(a+"Capture",c)}function gi(a,c){for(ni[a]=c,a=0;a<c.length;a++)pl.add(c[a])}var Bo=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),gl={},ml={};function tc(a){return Ye.call(ml,a)?!0:Ye.call(gl,a)?!1:Bo.test(a)?ml[a]=!0:(gl[a]=!0,!1)}function si(a,c,f){if(tc(c))if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":a.removeAttribute(c);return;case"boolean":var m=c.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){a.removeAttribute(c);return}}a.setAttribute(c,""+f)}}function la(a,c,f){if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttribute(c,""+f)}}function ji(a,c,f,m){if(m===null)a.removeAttribute(f);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(f);return}a.setAttributeNS(c,f,""+m)}}function zn(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function te(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Se(a,c,f){var m=Object.getOwnPropertyDescriptor(a.constructor.prototype,c);if(!a.hasOwnProperty(c)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var S=m.get,C=m.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return S.call(this)},set:function(I){f=""+I,C.call(this,I)}}),Object.defineProperty(a,c,{enumerable:m.enumerable}),{getValue:function(){return f},setValue:function(I){f=""+I},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function Ve(a){if(!a._valueTracker){var c=te(a)?"checked":"value";a._valueTracker=Se(a,c,""+a[c])}}function Ae(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var f=c.getValue(),m="";return a&&(m=te(a)?a.checked?"true":"false":a.value),a=m,a!==f?(c.setValue(a),!0):!1}function Ie(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Ze=/[\n"\\]/g;function Ct(a){return a.replace(Ze,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function Lt(a,c,f,m,S,C,I,ne){a.name="",I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"?a.type=I:a.removeAttribute("type"),c!=null?I==="number"?(c===0&&a.value===""||a.value!=c)&&(a.value=""+zn(c)):a.value!==""+zn(c)&&(a.value=""+zn(c)):I!=="submit"&&I!=="reset"||a.removeAttribute("value"),c!=null?Dn(a,I,zn(c)):f!=null?Dn(a,I,zn(f)):m!=null&&a.removeAttribute("value"),S==null&&C!=null&&(a.defaultChecked=!!C),S!=null&&(a.checked=S&&typeof S!="function"&&typeof S!="symbol"),ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"?a.name=""+zn(ne):a.removeAttribute("name")}function fn(a,c,f,m,S,C,I,ne){if(C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(a.type=C),c!=null||f!=null){if(!(C!=="submit"&&C!=="reset"||c!=null)){Ve(a);return}f=f!=null?""+zn(f):"",c=c!=null?""+zn(c):f,ne||c===a.value||(a.value=c),a.defaultValue=c}m=m??S,m=typeof m!="function"&&typeof m!="symbol"&&!!m,a.checked=ne?a.checked:!!m,a.defaultChecked=!!m,I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"&&(a.name=I),Ve(a)}function Dn(a,c,f){c==="number"&&Ie(a.ownerDocument)===a||a.defaultValue===""+f||(a.defaultValue=""+f)}function Ot(a,c,f,m){if(a=a.options,c){c={};for(var S=0;S<f.length;S++)c["$"+f[S]]=!0;for(f=0;f<a.length;f++)S=c.hasOwnProperty("$"+a[f].value),a[f].selected!==S&&(a[f].selected=S),S&&m&&(a[f].defaultSelected=!0)}else{for(f=""+zn(f),c=null,S=0;S<a.length;S++){if(a[S].value===f){a[S].selected=!0,m&&(a[S].defaultSelected=!0);return}c!==null||a[S].disabled||(c=a[S])}c!==null&&(c.selected=!0)}}function Ft(a,c,f){if(c!=null&&(c=""+zn(c),c!==a.value&&(a.value=c),f==null)){a.defaultValue!==c&&(a.defaultValue=c);return}a.defaultValue=f!=null?""+zn(f):""}function ms(a,c,f,m){if(c==null){if(m!=null){if(f!=null)throw Error(n(92));if(le(m)){if(1<m.length)throw Error(n(93));m=m[0]}f=m}f==null&&(f=""),c=f}f=zn(c),a.defaultValue=f,m=a.textContent,m===f&&m!==""&&m!==null&&(a.value=m),Ve(a)}function bn(a,c){if(c){var f=a.firstChild;if(f&&f===a.lastChild&&f.nodeType===3){f.nodeValue=c;return}}a.textContent=c}var us=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function nr(a,c,f){var m=c.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?m?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="":m?a.setProperty(c,f):typeof f!="number"||f===0||us.has(c)?c==="float"?a.cssFloat=f:a[c]=(""+f).trim():a[c]=f+"px"}function ja(a,c,f){if(c!=null&&typeof c!="object")throw Error(n(62));if(a=a.style,f!=null){for(var m in f)!f.hasOwnProperty(m)||c!=null&&c.hasOwnProperty(m)||(m.indexOf("--")===0?a.setProperty(m,""):m==="float"?a.cssFloat="":a[m]="");for(var S in c)m=c[S],c.hasOwnProperty(S)&&f[S]!==m&&nr(a,S,m)}else for(var C in c)c.hasOwnProperty(C)&&nr(a,C,c[C])}function Oo(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Kc=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ku=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function mi(a){return Ku.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function ca(){}var Qa=null;function xl(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Io=null,un=null;function Xu(a){var c=Ci(a);if(c&&(a=c.stateNode)){var f=a[jt]||null;e:switch(a=c.stateNode,c.type){case"input":if(Lt(a,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),c=f.name,f.type==="radio"&&c!=null){for(f=a;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+Ct(""+c)+'"][type="radio"]'),c=0;c<f.length;c++){var m=f[c];if(m!==a&&m.form===a.form){var S=m[jt]||null;if(!S)throw Error(n(90));Lt(m,S.value,S.defaultValue,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name)}}for(c=0;c<f.length;c++)m=f[c],m.form===a.form&&Ae(m)}break e;case"textarea":Ft(a,f.value,f.defaultValue);break e;case"select":c=f.value,c!=null&&Ot(a,!!f.multiple,c,!1)}}}var Xc=!1;function Ju(a,c,f){if(Xc)return a(c,f);Xc=!0;try{var m=a(c);return m}finally{if(Xc=!1,(Io!==null||un!==null)&&(k0(),Io&&(c=Io,a=un,un=Io=null,Xu(c),a)))for(c=0;c<a.length;c++)Xu(a[c])}}function Ti(a,c){var f=a.stateNode;if(f===null)return null;var m=f[jt]||null;if(m===null)return null;f=m[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(a=a.type,m=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!m;break e;default:a=!1}if(a)return null;if(f&&typeof f!="function")throw Error(n(231,c,typeof f));return f}var Dr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Jc=!1;if(Dr)try{var bl={};Object.defineProperty(bl,"passive",{get:function(){Jc=!0}}),window.addEventListener("test",bl,bl),window.removeEventListener("test",bl,bl)}catch{Jc=!1}var Di=null,yl=null,Ta=null;function Zu(){if(Ta)return Ta;var a,c=yl,f=c.length,m,S="value"in Di?Di.value:Di.textContent,C=S.length;for(a=0;a<f&&c[a]===S[a];a++);var I=f-a;for(m=1;m<=I&&c[f-m]===S[C-m];m++);return Ta=S.slice(a,1<m?1-m:void 0)}function Fi(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function nc(){return!0}function sc(){return!1}function wr(a){function c(f,m,S,C,I){this._reactName=f,this._targetInst=S,this.type=m,this.nativeEvent=C,this.target=I,this.currentTarget=null;for(var ne in a)a.hasOwnProperty(ne)&&(f=a[ne],this[ne]=f?f(C):C[ne]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?nc:sc,this.isPropagationStopped=sc,this}return g(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=nc)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=nc)},persist:function(){},isPersistent:nc}),c}var Da={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ui=wr(Da),eo=g({},Da,{view:0,detail:0}),rc=wr(eo),vl,to,no,wl=g({},eo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gn,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==no&&(no&&a.type==="mousemove"?(vl=a.screenX-no.screenX,to=a.screenY-no.screenY):to=vl=0,no=a),vl)},movementY:function(a){return"movementY"in a?a.movementY:to}}),Zc=wr(wl),so=g({},wl,{dataTransfer:0}),ro=wr(so),Qu=g({},eo,{relatedTarget:0}),io=wr(Qu),ed=g({},Da,{animationName:0,elapsedTime:0,pseudoElement:0}),j=wr(ed),V=g({},Da,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),ge=wr(V),we=g({},Da,{data:0}),De=wr(we),at={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_t={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Vt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Zt(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=Vt[a])?!!c[a]:!1}function gn(){return Zt}var Nn=g({},eo,{key:function(a){if(a.key){var c=at[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=Fi(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?_t[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gn,charCode:function(a){return a.type==="keypress"?Fi(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Fi(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Hn=wr(Nn),Ls=g({},wl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ws=wr(Ls),xs=g({},eo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gn}),fr=wr(xs),sr=g({},Da,{propertyName:0,elapsedTime:0,pseudoElement:0}),Lr=wr(sr),ao=g({},wl,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),ua=wr(ao),oo=g({},Da,{newState:0,oldState:0}),Qc=wr(oo),ic=[9,13,27,32],La=Dr&&"CompositionEvent"in window,da=null;Dr&&"documentMode"in document&&(da=document.documentMode);var Sl=Dr&&"TextEvent"in window&&!da,lo=Dr&&(!La||da&&8<da&&11>=da),Sr=" ",Mo=!1;function Fo(a,c){switch(a){case"keyup":return ic.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ac(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Ra=!1;function ri(a,c){switch(a){case"compositionend":return ac(c);case"keypress":return c.which!==32?null:(Mo=!0,Sr);case"textInput":return a=c.data,a===Sr&&Mo?null:a;default:return null}}function co(a,c){if(Ra)return a==="compositionend"||!La&&Fo(a,c)?(a=Zu(),Ta=yl=Di=null,Ra=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return lo&&c.locale!=="ko"?null:c.data;default:return null}}var oc={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function eu(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!oc[a.type]:c==="textarea"}function Li(a,c,f,m){Io?un?un.push(m):un=[m]:Io=m,c=B0(c,"onChange"),0<c.length&&(f=new Ui("onChange","change",null,f,m),a.push({event:f,listeners:c}))}var ha=null,uo=null;function tu(a){kv(a,0)}function fa(a){var c=Za(a);if(Ae(c))return a}function Uo(a,c){if(a==="change")return c}var xi=!1;if(Dr){var ii;if(Dr){var Pa="oninput"in document;if(!Pa){var Ba=document.createElement("div");Ba.setAttribute("oninput","return;"),Pa=typeof Ba.oninput=="function"}ii=Pa}else ii=!1;xi=ii&&(!document.documentMode||9<document.documentMode)}function ho(){ha&&(ha.detachEvent("onpropertychange",lc),uo=ha=null)}function lc(a){if(a.propertyName==="value"&&fa(uo)){var c=[];Li(c,uo,a,xl(a)),Ju(tu,c)}}function cc(a,c,f){a==="focusin"?(ho(),ha=c,uo=f,ha.attachEvent("onpropertychange",lc)):a==="focusout"&&ho()}function Ys(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return fa(uo)}function td(a,c){if(a==="click")return fa(c)}function Oa(a,c){if(a==="input"||a==="change")return fa(c)}function Ia(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var Rr=typeof Object.is=="function"?Object.is:Ia;function fo(a,c){if(Rr(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var f=Object.keys(a),m=Object.keys(c);if(f.length!==m.length)return!1;for(m=0;m<f.length;m++){var S=f[m];if(!Ye.call(c,S)||!Rr(a[S],c[S]))return!1}return!0}function uc(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function dc(a,c){var f=uc(a);a=0;for(var m;f;){if(f.nodeType===3){if(m=a+f.textContent.length,a<=c&&m>=c)return{node:f,offset:c-a};a=m}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=uc(f)}}function po(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?po(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function go(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var c=Ie(a.document);c instanceof a.HTMLIFrameElement;){try{var f=typeof c.contentWindow.location.href=="string"}catch{f=!1}if(f)a=c.contentWindow;else break;c=Ie(a.document)}return c}function Ma(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}var _l=Dr&&"documentMode"in document&&11>=document.documentMode,Ri=null,mo=null,Gr=null,zi=!1;function Zn(a,c,f){var m=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;zi||Ri==null||Ri!==Ie(m)||(m=Ri,"selectionStart"in m&&Ma(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Gr&&fo(Gr,m)||(Gr=m,m=B0(mo,"onSelect"),0<m.length&&(c=new Ui("onSelect","select",null,c,f),a.push({event:c,listeners:m}),c.target=Ri)))}function Gn(a,c){var f={};return f[a.toLowerCase()]=c.toLowerCase(),f["Webkit"+a]="webkit"+c,f["Moz"+a]="moz"+c,f}var bs={animationend:Gn("Animation","AnimationEnd"),animationiteration:Gn("Animation","AnimationIteration"),animationstart:Gn("Animation","AnimationStart"),transitionrun:Gn("Transition","TransitionRun"),transitionstart:Gn("Transition","TransitionStart"),transitioncancel:Gn("Transition","TransitionCancel"),transitionend:Gn("Transition","TransitionEnd")},Ks={},Fa={};Dr&&(Fa=document.createElement("div").style,"AnimationEvent"in window||(delete bs.animationend.animation,delete bs.animationiteration.animation,delete bs.animationstart.animation),"TransitionEvent"in window||delete bs.transitionend.transition);function pa(a){if(Ks[a])return Ks[a];if(!bs[a])return a;var c=bs[a],f;for(f in c)if(c.hasOwnProperty(f)&&f in Fa)return Ks[a]=c[f];return a}var Al=pa("animationend"),nu=pa("animationiteration"),Ah=pa("animationstart"),r0=pa("transitionrun"),i0=pa("transitionstart"),a0=pa("transitioncancel"),Nh=pa("transitionend"),Ch=new Map,Nl="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Nl.push("scrollEnd");function $i(a,c){Ch.set(a,c),ki(c,[a])}var su=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},Pi=[],Cl=0,nd=0;function ru(){for(var a=Cl,c=nd=Cl=0;c<a;){var f=Pi[c];Pi[c++]=null;var m=Pi[c];Pi[c++]=null;var S=Pi[c];Pi[c++]=null;var C=Pi[c];if(Pi[c++]=null,m!==null&&S!==null){var I=m.pending;I===null?S.next=S:(S.next=I.next,I.next=S),m.pending=S}C!==0&&au(f,S,C)}}function iu(a,c,f,m){Pi[Cl++]=a,Pi[Cl++]=c,Pi[Cl++]=f,Pi[Cl++]=m,nd|=m,a.lanes|=m,a=a.alternate,a!==null&&(a.lanes|=m)}function sd(a,c,f,m){return iu(a,c,f,m),Vr(a)}function xo(a,c){return iu(a,null,null,c),Vr(a)}function au(a,c,f){a.lanes|=f;var m=a.alternate;m!==null&&(m.lanes|=f);for(var S=!1,C=a.return;C!==null;)C.childLanes|=f,m=C.alternate,m!==null&&(m.childLanes|=f),C.tag===22&&(a=C.stateNode,a===null||a._visibility&1||(S=!0)),a=C,C=C.return;return a.tag===3?(C=a.stateNode,S&&c!==null&&(S=31-At(f),a=C.hiddenUpdates,m=a[S],m===null?a[S]=[c]:m.push(c),c.lane=f|536870912),C):null}function Vr(a){if(50<Yh)throw Yh=0,zm=null,Error(n(185));for(var c=a.return;c!==null;)a=c,c=a.return;return a.tag===3?a.stateNode:null}var Pr={};function rd(a,c,f,m){this.tag=a,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wr(a,c,f,m){return new rd(a,c,f,m)}function id(a){return a=a.prototype,!(!a||!a.isReactComponent)}function qi(a,c){var f=a.alternate;return f===null?(f=Wr(a.tag,c,a.key,a.mode),f.elementType=a.elementType,f.type=a.type,f.stateNode=a.stateNode,f.alternate=a,a.alternate=f):(f.pendingProps=c,f.type=a.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=a.flags&65011712,f.childLanes=a.childLanes,f.lanes=a.lanes,f.child=a.child,f.memoizedProps=a.memoizedProps,f.memoizedState=a.memoizedState,f.updateQueue=a.updateQueue,c=a.dependencies,f.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},f.sibling=a.sibling,f.index=a.index,f.ref=a.ref,f.refCleanup=a.refCleanup,f}function ou(a,c){a.flags&=65011714;var f=a.alternate;return f===null?(a.childLanes=0,a.lanes=c,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=f.childLanes,a.lanes=f.lanes,a.child=f.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=f.memoizedProps,a.memoizedState=f.memoizedState,a.updateQueue=f.updateQueue,a.type=f.type,c=f.dependencies,a.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),a}function hc(a,c,f,m,S,C){var I=0;if(m=a,typeof a=="function")id(a)&&(I=1);else if(typeof a=="string")I=O3(a,f,H.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case z:return a=Wr(31,f,c,S),a.elementType=z,a.lanes=C,a;case v:return zo(f.children,S,C,c);case _:I=8,S|=24;break;case N:return a=Wr(12,f,c,S|2),a.elementType=N,a.lanes=C,a;case P:return a=Wr(13,f,c,S),a.elementType=P,a.lanes=C,a;case O:return a=Wr(19,f,c,S),a.elementType=O,a.lanes=C,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case k:I=10;break e;case E:I=9;break e;case T:I=11;break e;case F:I=14;break e;case $:I=16,m=null;break e}I=29,f=Error(n(130,a===null?"null":typeof a,"")),m=null}return c=Wr(I,f,c,S),c.elementType=a,c.type=m,c.lanes=C,c}function zo(a,c,f,m){return a=Wr(7,a,m,c),a.lanes=f,a}function lu(a,c,f){return a=Wr(6,a,null,c),a.lanes=f,a}function ad(a){var c=Wr(18,null,null,0);return c.stateNode=a,c}function fc(a,c,f){return c=Wr(4,a.children!==null?a.children:[],a.key,c),c.lanes=f,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}var od=new WeakMap;function Hi(a,c){if(typeof a=="object"&&a!==null){var f=od.get(a);return f!==void 0?f:(c={value:a,source:c,stack:bt(c)},od.set(a,c),c)}return{value:a,source:c,stack:bt(c)}}var pc=[],El=0,ld=null,cu=0,Gi=[],Vi=0,$o=null,Wi=1,Yi="";function Bi(a,c){pc[El++]=cu,pc[El++]=ld,ld=a,cu=c}function o0(a,c,f){Gi[Vi++]=Wi,Gi[Vi++]=Yi,Gi[Vi++]=$o,$o=a;var m=Wi;a=Yi;var S=32-At(m)-1;m&=~(1<<S),f+=1;var C=32-At(c)+S;if(30<C){var I=S-S%5;C=(m&(1<<I)-1).toString(32),m>>=I,S-=I,Wi=1<<32-At(c)+S|f<<S|m,Yi=C+a}else Wi=1<<C|f<<S|m,Yi=a}function Eh(a){a.return!==null&&(Bi(a,1),o0(a,1,0))}function cd(a){for(;a===ld;)ld=pc[--El],pc[El]=null,cu=pc[--El],pc[El]=null;for(;a===$o;)$o=Gi[--Vi],Gi[Vi]=null,Yi=Gi[--Vi],Gi[Vi]=null,Wi=Gi[--Vi],Gi[Vi]=null}function l0(a,c){Gi[Vi++]=Wi,Gi[Vi++]=Yi,Gi[Vi++]=$o,Wi=c.id,Yi=c.overflow,$o=a}var Br=null,Cs=null,In=!1,ai=null,Fs=!1,ga=Error(n(519));function qo(a){var c=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw gc(Hi(c,a)),ga}function kh(a){var c=a.stateNode,f=a.type,m=a.memoizedProps;switch(c[wn]=a,c[jt]=m,f){case"dialog":Fn("cancel",c),Fn("close",c);break;case"iframe":case"object":case"embed":Fn("load",c);break;case"video":case"audio":for(f=0;f<Xh.length;f++)Fn(Xh[f],c);break;case"source":Fn("error",c);break;case"img":case"image":case"link":Fn("error",c),Fn("load",c);break;case"details":Fn("toggle",c);break;case"input":Fn("invalid",c),fn(c,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":Fn("invalid",c);break;case"textarea":Fn("invalid",c),ms(c,m.value,m.defaultValue,m.children)}f=m.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||c.textContent===""+f||m.suppressHydrationWarning===!0||Lv(c.textContent,f)?(m.popover!=null&&(Fn("beforetoggle",c),Fn("toggle",c)),m.onScroll!=null&&Fn("scroll",c),m.onScrollEnd!=null&&Fn("scrollend",c),m.onClick!=null&&(c.onclick=ca),c=!0):c=!1,c||qo(a,!0)}function bo(a){for(Br=a.return;Br;)switch(Br.tag){case 5:case 31:case 13:Fs=!1;return;case 27:case 3:Fs=!0;return;default:Br=Br.return}}function Or(a){if(a!==Br)return!1;if(!In)return bo(a),In=!0,!1;var c=a.tag,f;if((f=c!==3&&c!==27)&&((f=c===5)&&(f=a.type,f=!(f!=="form"&&f!=="button")||nx(a.type,a.memoizedProps)),f=!f),f&&Cs&&qo(a),bo(a),c===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));Cs=zv(a)}else if(c===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));Cs=zv(a)}else c===27?(c=Cs,jc(a.type)?(a=ox,ox=null,Cs=a):Cs=c):Cs=Br?qa(a.stateNode.nextSibling):null;return!0}function kl(){Cs=Br=null,In=!1}function jh(){var a=ai;return a!==null&&(ea===null?ea=a:ea.push.apply(ea,a),ai=null),a}function gc(a){ai===null?ai=[a]:ai.push(a)}var ud=M(null),Ho=null,Ua=null;function Go(a,c,f){U(ud,c._currentValue),c._currentValue=f}function Ki(a){a._currentValue=ud.current,L(ud)}function mc(a,c,f){for(;a!==null;){var m=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,m!==null&&(m.childLanes|=c)):m!==null&&(m.childLanes&c)!==c&&(m.childLanes|=c),a===f)break;a=a.return}}function jl(a,c,f,m){var S=a.child;for(S!==null&&(S.return=a);S!==null;){var C=S.dependencies;if(C!==null){var I=S.child;C=C.firstContext;e:for(;C!==null;){var ne=C;C=S;for(var be=0;be<c.length;be++)if(ne.context===c[be]){C.lanes|=f,ne=C.alternate,ne!==null&&(ne.lanes|=f),mc(C.return,f,a),m||(I=null);break e}C=ne.next}}else if(S.tag===18){if(I=S.return,I===null)throw Error(n(341));I.lanes|=f,C=I.alternate,C!==null&&(C.lanes|=f),mc(I,f,a),I=null}else I=S.child;if(I!==null)I.return=S;else for(I=S;I!==null;){if(I===a){I=null;break}if(S=I.sibling,S!==null){S.return=I.return,I=S;break}I=I.return}S=I}}function Vo(a,c,f,m){a=null;for(var S=c,C=!1;S!==null;){if(!C){if((S.flags&524288)!==0)C=!0;else if((S.flags&262144)!==0)break}if(S.tag===10){var I=S.alternate;if(I===null)throw Error(n(387));if(I=I.memoizedProps,I!==null){var ne=S.type;Rr(S.pendingProps.value,I.value)||(a!==null?a.push(ne):a=[ne])}}else if(S===xe.current){if(I=S.alternate,I===null)throw Error(n(387));I.memoizedState.memoizedState!==S.memoizedState.memoizedState&&(a!==null?a.push(tf):a=[tf])}S=S.return}a!==null&&jl(c,a,f,m),c.flags|=262144}function dd(a){for(a=a.firstContext;a!==null;){if(!Rr(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Wo(a){Ho=a,Ua=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Ir(a){return c0(Ho,a)}function hd(a,c){return Ho===null&&Wo(a),c0(a,c)}function c0(a,c){var f=c._currentValue;if(c={context:c,memoizedValue:f,next:null},Ua===null){if(a===null)throw Error(n(308));Ua=c,a.dependencies={lanes:0,firstContext:c},a.flags|=524288}else Ua=Ua.next=c;return f}var am=typeof AbortController<"u"?AbortController:function(){var a=[],c=this.signal={aborted:!1,addEventListener:function(f,m){a.push(m)}};this.abort=function(){c.aborted=!0,a.forEach(function(f){return f()})}},om=s.unstable_scheduleCallback,lm=s.unstable_NormalPriority,Xs={$$typeof:k,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function xc(){return{controller:new am,data:new Map,refCount:0}}function uu(a){a.refCount--,a.refCount===0&&om(lm,function(){a.controller.abort()})}var du=null,fd=0,y=0,A=null;function D(a,c){if(du===null){var f=du=[];fd=0,y=Wm(),A={status:"pending",value:void 0,then:function(m){f.push(m)}}}return fd++,c.then(B,B),c}function B(){if(--fd===0&&du!==null){A!==null&&(A.status="fulfilled");var a=du;du=null,y=0,A=null;for(var c=0;c<a.length;c++)(0,a[c])()}}function W(a,c){var f=[],m={status:"pending",value:null,reason:null,then:function(S){f.push(S)}};return a.then(function(){m.status="fulfilled",m.value=c;for(var S=0;S<f.length;S++)(0,f[S])(c)},function(S){for(m.status="rejected",m.reason=S,S=0;S<f.length;S++)(0,f[S])(void 0)}),m}var Q=K.S;K.S=function(a,c){nv=Pt(),typeof c=="object"&&c!==null&&typeof c.then=="function"&&D(a,c),Q!==null&&Q(a,c)};var ee=M(null);function ie(){var a=ee.current;return a!==null?a:ks.pooledCache}function oe(a,c){c===null?U(ee,ee.current):U(ee,c.pool)}function pe(){var a=ie();return a===null?null:{parent:Xs._currentValue,pool:a}}var _e=Error(n(460)),ze=Error(n(474)),fe=Error(n(542)),Ee={then:function(){}};function Be(a){return a=a.status,a==="fulfilled"||a==="rejected"}function nt(a,c,f){switch(f=a[f],f===void 0?a.push(c):f!==c&&(c.then(ca,ca),c=f),c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,Nt(a),a;default:if(typeof c.status=="string")c.then(ca,ca);else{if(a=ks,a!==null&&100<a.shellSuspendCounter)throw Error(n(482));a=c,a.status="pending",a.then(function(m){if(c.status==="pending"){var S=c;S.status="fulfilled",S.value=m}},function(m){if(c.status==="pending"){var S=c;S.status="rejected",S.reason=m}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,Nt(a),a}throw tt=c,_e}}function Ue(a){try{var c=a._init;return c(a._payload)}catch(f){throw f!==null&&typeof f=="object"&&typeof f.then=="function"?(tt=f,_e):f}}var tt=null;function ot(){if(tt===null)throw Error(n(459));var a=tt;return tt=null,a}function Nt(a){if(a===_e||a===fe)throw Error(n(483))}var yt=null,Kt=0;function zt(a){var c=Kt;return Kt+=1,yt===null&&(yt=[]),nt(yt,a,c)}function yn(a,c){c=c.props.ref,a.ref=c!==void 0?c:null}function Ht(a,c){throw c.$$typeof===b?Error(n(525)):(a=Object.prototype.toString.call(c),Error(n(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a)))}function Bn(a){function c(Le,Ne){if(a){var $e=Le.deletions;$e===null?(Le.deletions=[Ne],Le.flags|=16):$e.push(Ne)}}function f(Le,Ne){if(!a)return null;for(;Ne!==null;)c(Le,Ne),Ne=Ne.sibling;return null}function m(Le){for(var Ne=new Map;Le!==null;)Le.key!==null?Ne.set(Le.key,Le):Ne.set(Le.index,Le),Le=Le.sibling;return Ne}function S(Le,Ne){return Le=qi(Le,Ne),Le.index=0,Le.sibling=null,Le}function C(Le,Ne,$e){return Le.index=$e,a?($e=Le.alternate,$e!==null?($e=$e.index,$e<Ne?(Le.flags|=67108866,Ne):$e):(Le.flags|=67108866,Ne)):(Le.flags|=1048576,Ne)}function I(Le){return a&&Le.alternate===null&&(Le.flags|=67108866),Le}function ne(Le,Ne,$e,ht){return Ne===null||Ne.tag!==6?(Ne=lu($e,Le.mode,ht),Ne.return=Le,Ne):(Ne=S(Ne,$e),Ne.return=Le,Ne)}function be(Le,Ne,$e,ht){var ln=$e.type;return ln===v?rt(Le,Ne,$e.props.children,ht,$e.key):Ne!==null&&(Ne.elementType===ln||typeof ln=="object"&&ln!==null&&ln.$$typeof===$&&Ue(ln)===Ne.type)?(Ne=S(Ne,$e.props),yn(Ne,$e),Ne.return=Le,Ne):(Ne=hc($e.type,$e.key,$e.props,null,Le.mode,ht),yn(Ne,$e),Ne.return=Le,Ne)}function qe(Le,Ne,$e,ht){return Ne===null||Ne.tag!==4||Ne.stateNode.containerInfo!==$e.containerInfo||Ne.stateNode.implementation!==$e.implementation?(Ne=fc($e,Le.mode,ht),Ne.return=Le,Ne):(Ne=S(Ne,$e.children||[]),Ne.return=Le,Ne)}function rt(Le,Ne,$e,ht,ln){return Ne===null||Ne.tag!==7?(Ne=zo($e,Le.mode,ht,ln),Ne.return=Le,Ne):(Ne=S(Ne,$e),Ne.return=Le,Ne)}function xt(Le,Ne,$e){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number"||typeof Ne=="bigint")return Ne=lu(""+Ne,Le.mode,$e),Ne.return=Le,Ne;if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case x:return $e=hc(Ne.type,Ne.key,Ne.props,null,Le.mode,$e),yn($e,Ne),$e.return=Le,$e;case w:return Ne=fc(Ne,Le.mode,$e),Ne.return=Le,Ne;case $:return Ne=Ue(Ne),xt(Le,Ne,$e)}if(le(Ne)||q(Ne))return Ne=zo(Ne,Le.mode,$e,null),Ne.return=Le,Ne;if(typeof Ne.then=="function")return xt(Le,zt(Ne),$e);if(Ne.$$typeof===k)return xt(Le,hd(Le,Ne),$e);Ht(Le,Ne)}return null}function He(Le,Ne,$e,ht){var ln=Ne!==null?Ne.key:null;if(typeof $e=="string"&&$e!==""||typeof $e=="number"||typeof $e=="bigint")return ln!==null?null:ne(Le,Ne,""+$e,ht);if(typeof $e=="object"&&$e!==null){switch($e.$$typeof){case x:return $e.key===ln?be(Le,Ne,$e,ht):null;case w:return $e.key===ln?qe(Le,Ne,$e,ht):null;case $:return $e=Ue($e),He(Le,Ne,$e,ht)}if(le($e)||q($e))return ln!==null?null:rt(Le,Ne,$e,ht,null);if(typeof $e.then=="function")return He(Le,Ne,zt($e),ht);if($e.$$typeof===k)return He(Le,Ne,hd(Le,$e),ht);Ht(Le,$e)}return null}function Je(Le,Ne,$e,ht,ln){if(typeof ht=="string"&&ht!==""||typeof ht=="number"||typeof ht=="bigint")return Le=Le.get($e)||null,ne(Ne,Le,""+ht,ln);if(typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case x:return Le=Le.get(ht.key===null?$e:ht.key)||null,be(Ne,Le,ht,ln);case w:return Le=Le.get(ht.key===null?$e:ht.key)||null,qe(Ne,Le,ht,ln);case $:return ht=Ue(ht),Je(Le,Ne,$e,ht,ln)}if(le(ht)||q(ht))return Le=Le.get($e)||null,rt(Ne,Le,ht,ln,null);if(typeof ht.then=="function")return Je(Le,Ne,$e,zt(ht),ln);if(ht.$$typeof===k)return Je(Le,Ne,$e,hd(Ne,ht),ln);Ht(Ne,ht)}return null}function Wt(Le,Ne,$e,ht){for(var ln=null,es=null,Qt=Ne,Ln=Ne=0,qn=null;Qt!==null&&Ln<$e.length;Ln++){Qt.index>Ln?(qn=Qt,Qt=null):qn=Qt.sibling;var ts=He(Le,Qt,$e[Ln],ht);if(ts===null){Qt===null&&(Qt=qn);break}a&&Qt&&ts.alternate===null&&c(Le,Qt),Ne=C(ts,Ne,Ln),es===null?ln=ts:es.sibling=ts,es=ts,Qt=qn}if(Ln===$e.length)return f(Le,Qt),In&&Bi(Le,Ln),ln;if(Qt===null){for(;Ln<$e.length;Ln++)Qt=xt(Le,$e[Ln],ht),Qt!==null&&(Ne=C(Qt,Ne,Ln),es===null?ln=Qt:es.sibling=Qt,es=Qt);return In&&Bi(Le,Ln),ln}for(Qt=m(Qt);Ln<$e.length;Ln++)qn=Je(Qt,Le,Ln,$e[Ln],ht),qn!==null&&(a&&qn.alternate!==null&&Qt.delete(qn.key===null?Ln:qn.key),Ne=C(qn,Ne,Ln),es===null?ln=qn:es.sibling=qn,es=qn);return a&&Qt.forEach(function(Pc){return c(Le,Pc)}),In&&Bi(Le,Ln),ln}function pn(Le,Ne,$e,ht){if($e==null)throw Error(n(151));for(var ln=null,es=null,Qt=Ne,Ln=Ne=0,qn=null,ts=$e.next();Qt!==null&&!ts.done;Ln++,ts=$e.next()){Qt.index>Ln?(qn=Qt,Qt=null):qn=Qt.sibling;var Pc=He(Le,Qt,ts.value,ht);if(Pc===null){Qt===null&&(Qt=qn);break}a&&Qt&&Pc.alternate===null&&c(Le,Qt),Ne=C(Pc,Ne,Ln),es===null?ln=Pc:es.sibling=Pc,es=Pc,Qt=qn}if(ts.done)return f(Le,Qt),In&&Bi(Le,Ln),ln;if(Qt===null){for(;!ts.done;Ln++,ts=$e.next())ts=xt(Le,ts.value,ht),ts!==null&&(Ne=C(ts,Ne,Ln),es===null?ln=ts:es.sibling=ts,es=ts);return In&&Bi(Le,Ln),ln}for(Qt=m(Qt);!ts.done;Ln++,ts=$e.next())ts=Je(Qt,Le,Ln,ts.value,ht),ts!==null&&(a&&ts.alternate!==null&&Qt.delete(ts.key===null?Ln:ts.key),Ne=C(ts,Ne,Ln),es===null?ln=ts:es.sibling=ts,es=ts);return a&&Qt.forEach(function(W3){return c(Le,W3)}),In&&Bi(Le,Ln),ln}function Ss(Le,Ne,$e,ht){if(typeof $e=="object"&&$e!==null&&$e.type===v&&$e.key===null&&($e=$e.props.children),typeof $e=="object"&&$e!==null){switch($e.$$typeof){case x:e:{for(var ln=$e.key;Ne!==null;){if(Ne.key===ln){if(ln=$e.type,ln===v){if(Ne.tag===7){f(Le,Ne.sibling),ht=S(Ne,$e.props.children),ht.return=Le,Le=ht;break e}}else if(Ne.elementType===ln||typeof ln=="object"&&ln!==null&&ln.$$typeof===$&&Ue(ln)===Ne.type){f(Le,Ne.sibling),ht=S(Ne,$e.props),yn(ht,$e),ht.return=Le,Le=ht;break e}f(Le,Ne);break}else c(Le,Ne);Ne=Ne.sibling}$e.type===v?(ht=zo($e.props.children,Le.mode,ht,$e.key),ht.return=Le,Le=ht):(ht=hc($e.type,$e.key,$e.props,null,Le.mode,ht),yn(ht,$e),ht.return=Le,Le=ht)}return I(Le);case w:e:{for(ln=$e.key;Ne!==null;){if(Ne.key===ln)if(Ne.tag===4&&Ne.stateNode.containerInfo===$e.containerInfo&&Ne.stateNode.implementation===$e.implementation){f(Le,Ne.sibling),ht=S(Ne,$e.children||[]),ht.return=Le,Le=ht;break e}else{f(Le,Ne);break}else c(Le,Ne);Ne=Ne.sibling}ht=fc($e,Le.mode,ht),ht.return=Le,Le=ht}return I(Le);case $:return $e=Ue($e),Ss(Le,Ne,$e,ht)}if(le($e))return Wt(Le,Ne,$e,ht);if(q($e)){if(ln=q($e),typeof ln!="function")throw Error(n(150));return $e=ln.call($e),pn(Le,Ne,$e,ht)}if(typeof $e.then=="function")return Ss(Le,Ne,zt($e),ht);if($e.$$typeof===k)return Ss(Le,Ne,hd(Le,$e),ht);Ht(Le,$e)}return typeof $e=="string"&&$e!==""||typeof $e=="number"||typeof $e=="bigint"?($e=""+$e,Ne!==null&&Ne.tag===6?(f(Le,Ne.sibling),ht=S(Ne,$e),ht.return=Le,Le=ht):(f(Le,Ne),ht=lu($e,Le.mode,ht),ht.return=Le,Le=ht),I(Le)):f(Le,Ne)}return function(Le,Ne,$e,ht){try{Kt=0;var ln=Ss(Le,Ne,$e,ht);return yt=null,ln}catch(Qt){if(Qt===_e||Qt===fe)throw Qt;var es=Wr(29,Qt,null,Le.mode);return es.lanes=ht,es.return=Le,es}}}var Es=Bn(!0),Cn=Bn(!1),$t=!1;function Dt(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Rs(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function dn(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function jn(a,c,f){var m=a.updateQueue;if(m===null)return null;if(m=m.shared,(rs&2)!==0){var S=m.pending;return S===null?c.next=c:(c.next=S.next,S.next=c),m.pending=c,c=Vr(a),au(a,null,f),c}return iu(a,m,c,f),Vr(a)}function ns(a,c,f){if(c=c.updateQueue,c!==null&&(c=c.shared,(f&4194048)!==0)){var m=c.lanes;m&=a.pendingLanes,f|=m,c.lanes=f,Xe(a,f)}}function pr(a,c){var f=a.updateQueue,m=a.alternate;if(m!==null&&(m=m.updateQueue,f===m)){var S=null,C=null;if(f=f.firstBaseUpdate,f!==null){do{var I={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};C===null?S=C=I:C=C.next=I,f=f.next}while(f!==null);C===null?S=C=c:C=C.next=c}else S=C=c;f={baseState:m.baseState,firstBaseUpdate:S,lastBaseUpdate:C,shared:m.shared,callbacks:m.callbacks},a.updateQueue=f;return}a=f.lastBaseUpdate,a===null?f.firstBaseUpdate=c:a.next=c,f.lastBaseUpdate=c}var Mr=!1;function ys(){if(Mr){var a=A;if(a!==null)throw a}}function rr(a,c,f,m){Mr=!1;var S=a.updateQueue;$t=!1;var C=S.firstBaseUpdate,I=S.lastBaseUpdate,ne=S.shared.pending;if(ne!==null){S.shared.pending=null;var be=ne,qe=be.next;be.next=null,I===null?C=qe:I.next=qe,I=be;var rt=a.alternate;rt!==null&&(rt=rt.updateQueue,ne=rt.lastBaseUpdate,ne!==I&&(ne===null?rt.firstBaseUpdate=qe:ne.next=qe,rt.lastBaseUpdate=be))}if(C!==null){var xt=S.baseState;I=0,rt=qe=be=null,ne=C;do{var He=ne.lane&-536870913,Je=He!==ne.lane;if(Je?($n&He)===He:(m&He)===He){He!==0&&He===y&&(Mr=!0),rt!==null&&(rt=rt.next={lane:0,tag:ne.tag,payload:ne.payload,callback:null,next:null});e:{var Wt=a,pn=ne;He=c;var Ss=f;switch(pn.tag){case 1:if(Wt=pn.payload,typeof Wt=="function"){xt=Wt.call(Ss,xt,He);break e}xt=Wt;break e;case 3:Wt.flags=Wt.flags&-65537|128;case 0:if(Wt=pn.payload,He=typeof Wt=="function"?Wt.call(Ss,xt,He):Wt,He==null)break e;xt=g({},xt,He);break e;case 2:$t=!0}}He=ne.callback,He!==null&&(a.flags|=64,Je&&(a.flags|=8192),Je=S.callbacks,Je===null?S.callbacks=[He]:Je.push(He))}else Je={lane:He,tag:ne.tag,payload:ne.payload,callback:ne.callback,next:null},rt===null?(qe=rt=Je,be=xt):rt=rt.next=Je,I|=He;if(ne=ne.next,ne===null){if(ne=S.shared.pending,ne===null)break;Je=ne,ne=Je.next,Je.next=null,S.lastBaseUpdate=Je,S.shared.pending=null}}while(!0);rt===null&&(be=xt),S.baseState=be,S.firstBaseUpdate=qe,S.lastBaseUpdate=rt,C===null&&(S.shared.lanes=0),Ac|=I,a.lanes=I,a.memoizedState=xt}}function Yr(a,c){if(typeof a!="function")throw Error(n(191,a));a.call(c)}function ir(a,c){var f=a.callbacks;if(f!==null)for(a.callbacks=null,a=0;a<f.length;a++)Yr(f[a],c)}var Rn=M(null),Kn=M(0);function Ps(a,c){a=Fl,U(Kn,a),U(Rn,c),Fl=a|c.baseLanes}function Qn(){U(Kn,Fl),U(Rn,Rn.current)}function gr(){Fl=Kn.current,L(Rn),L(Kn)}var Bs=M(null),Xn=null;function Js(a){var c=a.alternate;U(Vn,Vn.current&1),U(Bs,a),Xn===null&&(c===null||Rn.current!==null||c.memoizedState!==null)&&(Xn=a)}function ss(a){U(Vn,Vn.current),U(Bs,a),Xn===null&&(Xn=a)}function ar(a){a.tag===22?(U(Vn,Vn.current),U(Bs,a),Xn===null&&(Xn=a)):or()}function or(){U(Vn,Vn.current),U(Bs,Bs.current)}function hs(a){L(Bs),Xn===a&&(Xn=null),L(Vn)}var Vn=M(0);function Kr(a){for(var c=a;c!==null;){if(c.tag===13){var f=c.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||ix(f)||ax(f)))return c}else if(c.tag===19&&(c.memoizedProps.revealOrder==="forwards"||c.memoizedProps.revealOrder==="backwards"||c.memoizedProps.revealOrder==="unstable_legacy-backwards"||c.memoizedProps.revealOrder==="together")){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var Us=0,rn=null,on=null,Jn=null,bi=!1,Xi=!1,oi=!1,lr=0,Yo=0,Ko=null,pd=0;function vs(){throw Error(n(321))}function Th(a,c){if(c===null)return!1;for(var f=0;f<c.length&&f<a.length;f++)if(!Rr(a[f],c[f]))return!1;return!0}function Dh(a,c,f,m,S,C){return Us=C,rn=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,K.H=a===null||a.memoizedState===null?fy:mm,oi=!1,C=f(m,S),oi=!1,Xi&&(C=yo(c,f,m,S)),gd(a),C}function gd(a){K.H=Fh;var c=on!==null&&on.next!==null;if(Us=0,Jn=on=rn=null,bi=!1,Yo=0,Ko=null,c)throw Error(n(300));a===null||Ar||(a=a.dependencies,a!==null&&dd(a)&&(Ar=!0))}function yo(a,c,f,m){rn=a;var S=0;do{if(Xi&&(Ko=null),Yo=0,Xi=!1,25<=S)throw Error(n(301));if(S+=1,Jn=on=null,a.updateQueue!=null){var C=a.updateQueue;C.lastEffect=null,C.events=null,C.stores=null,C.memoCache!=null&&(C.memoCache.index=0)}K.H=py,C=c(f,m)}while(Xi);return C}function cm(){var a=K.H,c=a.useState()[0];return c=typeof c.then=="function"?Xo(c):c,a=a.useState()[0],(on!==null?on.memoizedState:null)!==a&&(rn.flags|=1024),c}function Lh(){var a=lr!==0;return lr=0,a}function Rh(a,c,f){c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~f}function md(a){if(bi){for(a=a.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}bi=!1}Us=0,Jn=on=rn=null,Xi=!1,Yo=lr=0,Ko=null}function _r(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Jn===null?rn.memoizedState=Jn=a:Jn=Jn.next=a,Jn}function zs(){if(on===null){var a=rn.alternate;a=a!==null?a.memoizedState:null}else a=on.next;var c=Jn===null?rn.memoizedState:Jn.next;if(c!==null)Jn=c,on=a;else{if(a===null)throw rn.alternate===null?Error(n(467)):Error(n(310));on=a,a={memoizedState:on.memoizedState,baseState:on.baseState,baseQueue:on.baseQueue,queue:on.queue,next:null},Jn===null?rn.memoizedState=Jn=a:Jn=Jn.next=a}return Jn}function hu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Xo(a){var c=Yo;return Yo+=1,Ko===null&&(Ko=[]),a=nt(Ko,a,c),c=rn,(Jn===null?c.memoizedState:Jn.next)===null&&(c=c.alternate,K.H=c===null||c.memoizedState===null?fy:mm),a}function bc(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Xo(a);if(a.$$typeof===k)return Ir(a)}throw Error(n(438,String(a)))}function Tl(a){var c=null,f=rn.updateQueue;if(f!==null&&(c=f.memoCache),c==null){var m=rn.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(c={data:m.data.map(function(S){return S.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),f===null&&(f=hu(),rn.updateQueue=f),f.memoCache=c,f=c.data[c.index],f===void 0)for(f=c.data[c.index]=Array(a),m=0;m<a;m++)f[m]=G;return c.index++,f}function za(a,c){return typeof c=="function"?c(a):c}function xd(a){var c=zs();return yc(c,on,a)}function yc(a,c,f){var m=a.queue;if(m===null)throw Error(n(311));m.lastRenderedReducer=f;var S=a.baseQueue,C=m.pending;if(C!==null){if(S!==null){var I=S.next;S.next=C.next,C.next=I}c.baseQueue=S=C,m.pending=null}if(C=a.baseState,S===null)a.memoizedState=C;else{c=S.next;var ne=I=null,be=null,qe=c,rt=!1;do{var xt=qe.lane&-536870913;if(xt!==qe.lane?($n&xt)===xt:(Us&xt)===xt){var He=qe.revertLane;if(He===0)be!==null&&(be=be.next={lane:0,revertLane:0,gesture:null,action:qe.action,hasEagerState:qe.hasEagerState,eagerState:qe.eagerState,next:null}),xt===y&&(rt=!0);else if((Us&He)===He){qe=qe.next,He===y&&(rt=!0);continue}else xt={lane:0,revertLane:qe.revertLane,gesture:null,action:qe.action,hasEagerState:qe.hasEagerState,eagerState:qe.eagerState,next:null},be===null?(ne=be=xt,I=C):be=be.next=xt,rn.lanes|=He,Ac|=He;xt=qe.action,oi&&f(C,xt),C=qe.hasEagerState?qe.eagerState:f(C,xt)}else He={lane:xt,revertLane:qe.revertLane,gesture:qe.gesture,action:qe.action,hasEagerState:qe.hasEagerState,eagerState:qe.eagerState,next:null},be===null?(ne=be=He,I=C):be=be.next=He,rn.lanes|=xt,Ac|=xt;qe=qe.next}while(qe!==null&&qe!==c);if(be===null?I=C:be.next=ne,!Rr(C,a.memoizedState)&&(Ar=!0,rt&&(f=A,f!==null)))throw f;a.memoizedState=C,a.baseState=I,a.baseQueue=be,m.lastRenderedState=C}return S===null&&(m.lanes=0),[a.memoizedState,m.dispatch]}function bd(a){var c=zs(),f=c.queue;if(f===null)throw Error(n(311));f.lastRenderedReducer=a;var m=f.dispatch,S=f.pending,C=c.memoizedState;if(S!==null){f.pending=null;var I=S=S.next;do C=a(C,I.action),I=I.next;while(I!==S);Rr(C,c.memoizedState)||(Ar=!0),c.memoizedState=C,c.baseQueue===null&&(c.baseState=C),f.lastRenderedState=C}return[C,m]}function yd(a,c,f){var m=rn,S=zs(),C=In;if(C){if(f===void 0)throw Error(n(407));f=f()}else f=c();var I=!Rr((on||S).memoizedState,f);if(I&&(S.memoizedState=f,Ar=!0),S=S.queue,um(Bh.bind(null,m,S,a),[a]),S.getSnapshot!==c||I||Jn!==null&&Jn.memoizedState.tag&1){if(m.flags|=2048,Ll(9,{destroy:void 0},Ph.bind(null,m,S,f,c),null),ks===null)throw Error(n(349));C||(Us&127)!==0||vo(m,c,f)}return f}function vo(a,c,f){a.flags|=16384,a={getSnapshot:c,value:f},c=rn.updateQueue,c===null?(c=hu(),rn.updateQueue=c,c.stores=[a]):(f=c.stores,f===null?c.stores=[a]:f.push(a))}function Ph(a,c,f,m){c.value=f,c.getSnapshot=m,u0(c)&&Oh(a)}function Bh(a,c,f){return f(function(){u0(c)&&Oh(a)})}function u0(a){var c=a.getSnapshot;a=a.value;try{var f=c();return!Rr(a,f)}catch{return!0}}function Oh(a){var c=xo(a,2);c!==null&&ta(c,a,2)}function Jo(a){var c=_r();if(typeof a=="function"){var f=a;if(a=f(),oi){it(!0);try{f()}finally{it(!1)}}}return c.memoizedState=c.baseState=a,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:za,lastRenderedState:a},c}function d0(a,c,f,m){return a.baseState=f,yc(a,on,typeof m=="function"?m:za)}function h0(a,c,f,m,S){if(m0(a))throw Error(n(485));if(a=c.action,a!==null){var C={payload:S,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(I){C.listeners.push(I)}};K.T!==null?f(!0):C.isTransition=!1,m(C),f=c.pending,f===null?(C.next=c.pending=C,f0(c,C)):(C.next=f.next,c.pending=f.next=C)}}function f0(a,c){var f=c.action,m=c.payload,S=a.state;if(c.isTransition){var C=K.T,I={};K.T=I;try{var ne=f(S,m),be=K.S;be!==null&&be(I,ne),Ih(a,c,ne)}catch(qe){Dl(a,c,qe)}finally{C!==null&&I.types!==null&&(C.types=I.types),K.T=C}}else try{C=f(S,m),Ih(a,c,C)}catch(qe){Dl(a,c,qe)}}function Ih(a,c,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(m){p0(a,c,m)},function(m){return Dl(a,c,m)}):p0(a,c,f)}function p0(a,c,f){c.status="fulfilled",c.value=f,vd(c),a.state=f,c=a.pending,c!==null&&(f=c.next,f===c?a.pending=null:(f=f.next,c.next=f,f0(a,f)))}function Dl(a,c,f){var m=a.pending;if(a.pending=null,m!==null){m=m.next;do c.status="rejected",c.reason=f,vd(c),c=c.next;while(c!==m)}a.action=null}function vd(a){a=a.listeners;for(var c=0;c<a.length;c++)(0,a[c])()}function fu(a,c){return c}function $a(a,c){if(In){var f=ks.formState;if(f!==null){e:{var m=rn;if(In){if(Cs){t:{for(var S=Cs,C=Fs;S.nodeType!==8;){if(!C){S=null;break t}if(S=qa(S.nextSibling),S===null){S=null;break t}}C=S.data,S=C==="F!"||C==="F"?S:null}if(S){Cs=qa(S.nextSibling),m=S.data==="F!";break e}}qo(m)}m=!1}m&&(c=f[0])}}return f=_r(),f.memoizedState=f.baseState=c,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fu,lastRenderedState:c},f.queue=m,f=uy.bind(null,rn,m),m.dispatch=f,m=Jo(!1),C=gm.bind(null,rn,!1,m.queue),m=_r(),S={state:c,dispatch:null,action:a,pending:null},m.queue=S,f=h0.bind(null,rn,S,C,f),S.dispatch=f,m.memoizedState=a,[c,f,!1]}function wo(a){var c=zs();return So(c,on,a)}function So(a,c,f){if(c=yc(a,c,fu)[0],a=xd(za)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var m=Xo(c)}catch(I){throw I===_e?fe:I}else m=c;c=zs();var S=c.queue,C=S.dispatch;return f!==c.memoizedState&&(rn.flags|=2048,Ll(9,{destroy:void 0},wd.bind(null,S,f),null)),[m,C,a]}function wd(a,c){a.action=c}function Sd(a){var c=zs(),f=on;if(f!==null)return So(c,f,a);zs(),c=c.memoizedState,f=zs();var m=f.queue.dispatch;return f.memoizedState=a,[c,m,!1]}function Ll(a,c,f,m){return a={tag:a,create:f,deps:m,inst:c,next:null},c=rn.updateQueue,c===null&&(c=hu(),rn.updateQueue=c),f=c.lastEffect,f===null?c.lastEffect=a.next=a:(m=f.next,f.next=a,a.next=m,c.lastEffect=a),a}function g0(){return zs().memoizedState}function vc(a,c,f,m){var S=_r();rn.flags|=a,S.memoizedState=Ll(1|c,{destroy:void 0},f,m===void 0?null:m)}function wc(a,c,f,m){var S=zs();m=m===void 0?null:m;var C=S.memoizedState.inst;on!==null&&m!==null&&Th(m,on.memoizedState.deps)?S.memoizedState=Ll(c,C,f,m):(rn.flags|=a,S.memoizedState=Ll(1|c,C,f,m))}function Xb(a,c){vc(8390656,8,a,c)}function um(a,c){wc(2048,8,a,c)}function zA(a){rn.flags|=4;var c=rn.updateQueue;if(c===null)c=hu(),rn.updateQueue=c,c.events=[a];else{var f=c.events;f===null?c.events=[a]:f.push(a)}}function Jb(a){var c=zs().memoizedState;return zA({ref:c,nextImpl:a}),function(){if((rs&2)!==0)throw Error(n(440));return c.impl.apply(void 0,arguments)}}function Zb(a,c){return wc(4,2,a,c)}function Qb(a,c){return wc(4,4,a,c)}function ey(a,c){if(typeof c=="function"){a=a();var f=c(a);return function(){typeof f=="function"?f():c(null)}}if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function ty(a,c,f){f=f!=null?f.concat([a]):null,wc(4,4,ey.bind(null,c,a),f)}function dm(){}function ny(a,c){var f=zs();c=c===void 0?null:c;var m=f.memoizedState;return c!==null&&Th(c,m[1])?m[0]:(f.memoizedState=[a,c],a)}function sy(a,c){var f=zs();c=c===void 0?null:c;var m=f.memoizedState;if(c!==null&&Th(c,m[1]))return m[0];if(m=a(),oi){it(!0);try{a()}finally{it(!1)}}return f.memoizedState=[m,c],m}function hm(a,c,f){return f===void 0||(Us&1073741824)!==0&&($n&261930)===0?a.memoizedState=c:(a.memoizedState=f,a=rv(),rn.lanes|=a,Ac|=a,f)}function ry(a,c,f,m){return Rr(f,c)?f:Rn.current!==null?(a=hm(a,f,m),Rr(a,c)||(Ar=!0),a):(Us&42)===0||(Us&1073741824)!==0&&($n&261930)===0?(Ar=!0,a.memoizedState=f):(a=rv(),rn.lanes|=a,Ac|=a,c)}function iy(a,c,f,m,S){var C=se.p;se.p=C!==0&&8>C?C:8;var I=K.T,ne={};K.T=ne,gm(a,!1,c,f);try{var be=S(),qe=K.S;if(qe!==null&&qe(ne,be),be!==null&&typeof be=="object"&&typeof be.then=="function"){var rt=W(be,m);Mh(a,c,rt,ba(a))}else Mh(a,c,m,ba(a))}catch(xt){Mh(a,c,{then:function(){},status:"rejected",reason:xt},ba())}finally{se.p=C,I!==null&&ne.types!==null&&(I.types=ne.types),K.T=I}}function $A(){}function fm(a,c,f,m){if(a.tag!==5)throw Error(n(476));var S=ay(a).queue;iy(a,S,c,ce,f===null?$A:function(){return oy(a),f(m)})}function ay(a){var c=a.memoizedState;if(c!==null)return c;c={memoizedState:ce,baseState:ce,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:za,lastRenderedState:ce},next:null};var f={};return c.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:za,lastRenderedState:f},next:null},a.memoizedState=c,a=a.alternate,a!==null&&(a.memoizedState=c),c}function oy(a){var c=ay(a);c.next===null&&(c=a.alternate.memoizedState),Mh(a,c.next.queue,{},ba())}function pm(){return Ir(tf)}function ly(){return zs().memoizedState}function cy(){return zs().memoizedState}function qA(a){for(var c=a.return;c!==null;){switch(c.tag){case 24:case 3:var f=ba();a=dn(f);var m=jn(c,a,f);m!==null&&(ta(m,c,f),ns(m,c,f)),c={cache:xc()},a.payload=c;return}c=c.return}}function HA(a,c,f){var m=ba();f={lane:m,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},m0(a)?dy(c,f):(f=sd(a,c,f,m),f!==null&&(ta(f,a,m),hy(f,c,m)))}function uy(a,c,f){var m=ba();Mh(a,c,f,m)}function Mh(a,c,f,m){var S={lane:m,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null};if(m0(a))dy(c,S);else{var C=a.alternate;if(a.lanes===0&&(C===null||C.lanes===0)&&(C=c.lastRenderedReducer,C!==null))try{var I=c.lastRenderedState,ne=C(I,f);if(S.hasEagerState=!0,S.eagerState=ne,Rr(ne,I))return iu(a,c,S,0),ks===null&&ru(),!1}catch{}if(f=sd(a,c,S,m),f!==null)return ta(f,a,m),hy(f,c,m),!0}return!1}function gm(a,c,f,m){if(m={lane:2,revertLane:Wm(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},m0(a)){if(c)throw Error(n(479))}else c=sd(a,f,m,2),c!==null&&ta(c,a,2)}function m0(a){var c=a.alternate;return a===rn||c!==null&&c===rn}function dy(a,c){Xi=bi=!0;var f=a.pending;f===null?c.next=c:(c.next=f.next,f.next=c),a.pending=c}function hy(a,c,f){if((f&4194048)!==0){var m=c.lanes;m&=a.pendingLanes,f|=m,c.lanes=f,Xe(a,f)}}var Fh={readContext:Ir,use:bc,useCallback:vs,useContext:vs,useEffect:vs,useImperativeHandle:vs,useLayoutEffect:vs,useInsertionEffect:vs,useMemo:vs,useReducer:vs,useRef:vs,useState:vs,useDebugValue:vs,useDeferredValue:vs,useTransition:vs,useSyncExternalStore:vs,useId:vs,useHostTransitionStatus:vs,useFormState:vs,useActionState:vs,useOptimistic:vs,useMemoCache:vs,useCacheRefresh:vs};Fh.useEffectEvent=vs;var fy={readContext:Ir,use:bc,useCallback:function(a,c){return _r().memoizedState=[a,c===void 0?null:c],a},useContext:Ir,useEffect:Xb,useImperativeHandle:function(a,c,f){f=f!=null?f.concat([a]):null,vc(4194308,4,ey.bind(null,c,a),f)},useLayoutEffect:function(a,c){return vc(4194308,4,a,c)},useInsertionEffect:function(a,c){vc(4,2,a,c)},useMemo:function(a,c){var f=_r();c=c===void 0?null:c;var m=a();if(oi){it(!0);try{a()}finally{it(!1)}}return f.memoizedState=[m,c],m},useReducer:function(a,c,f){var m=_r();if(f!==void 0){var S=f(c);if(oi){it(!0);try{f(c)}finally{it(!1)}}}else S=c;return m.memoizedState=m.baseState=S,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:S},m.queue=a,a=a.dispatch=HA.bind(null,rn,a),[m.memoizedState,a]},useRef:function(a){var c=_r();return a={current:a},c.memoizedState=a},useState:function(a){a=Jo(a);var c=a.queue,f=uy.bind(null,rn,c);return c.dispatch=f,[a.memoizedState,f]},useDebugValue:dm,useDeferredValue:function(a,c){var f=_r();return hm(f,a,c)},useTransition:function(){var a=Jo(!1);return a=iy.bind(null,rn,a.queue,!0,!1),_r().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,c,f){var m=rn,S=_r();if(In){if(f===void 0)throw Error(n(407));f=f()}else{if(f=c(),ks===null)throw Error(n(349));($n&127)!==0||vo(m,c,f)}S.memoizedState=f;var C={value:f,getSnapshot:c};return S.queue=C,Xb(Bh.bind(null,m,C,a),[a]),m.flags|=2048,Ll(9,{destroy:void 0},Ph.bind(null,m,C,f,c),null),f},useId:function(){var a=_r(),c=ks.identifierPrefix;if(In){var f=Yi,m=Wi;f=(m&~(1<<32-At(m)-1)).toString(32)+f,c="_"+c+"R_"+f,f=lr++,0<f&&(c+="H"+f.toString(32)),c+="_"}else f=pd++,c="_"+c+"r_"+f.toString(32)+"_";return a.memoizedState=c},useHostTransitionStatus:pm,useFormState:$a,useActionState:$a,useOptimistic:function(a){var c=_r();c.memoizedState=c.baseState=a;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=f,c=gm.bind(null,rn,!0,f),f.dispatch=c,[a,c]},useMemoCache:Tl,useCacheRefresh:function(){return _r().memoizedState=qA.bind(null,rn)},useEffectEvent:function(a){var c=_r(),f={impl:a};return c.memoizedState=f,function(){if((rs&2)!==0)throw Error(n(440));return f.impl.apply(void 0,arguments)}}},mm={readContext:Ir,use:bc,useCallback:ny,useContext:Ir,useEffect:um,useImperativeHandle:ty,useInsertionEffect:Zb,useLayoutEffect:Qb,useMemo:sy,useReducer:xd,useRef:g0,useState:function(){return xd(za)},useDebugValue:dm,useDeferredValue:function(a,c){var f=zs();return ry(f,on.memoizedState,a,c)},useTransition:function(){var a=xd(za)[0],c=zs().memoizedState;return[typeof a=="boolean"?a:Xo(a),c]},useSyncExternalStore:yd,useId:ly,useHostTransitionStatus:pm,useFormState:wo,useActionState:wo,useOptimistic:function(a,c){var f=zs();return d0(f,on,a,c)},useMemoCache:Tl,useCacheRefresh:cy};mm.useEffectEvent=Jb;var py={readContext:Ir,use:bc,useCallback:ny,useContext:Ir,useEffect:um,useImperativeHandle:ty,useInsertionEffect:Zb,useLayoutEffect:Qb,useMemo:sy,useReducer:bd,useRef:g0,useState:function(){return bd(za)},useDebugValue:dm,useDeferredValue:function(a,c){var f=zs();return on===null?hm(f,a,c):ry(f,on.memoizedState,a,c)},useTransition:function(){var a=bd(za)[0],c=zs().memoizedState;return[typeof a=="boolean"?a:Xo(a),c]},useSyncExternalStore:yd,useId:ly,useHostTransitionStatus:pm,useFormState:Sd,useActionState:Sd,useOptimistic:function(a,c){var f=zs();return on!==null?d0(f,on,a,c):(f.baseState=a,[a,f.queue.dispatch])},useMemoCache:Tl,useCacheRefresh:cy};py.useEffectEvent=Jb;function xm(a,c,f,m){c=a.memoizedState,f=f(m,c),f=f==null?c:g({},c,f),a.memoizedState=f,a.lanes===0&&(a.updateQueue.baseState=f)}var bm={enqueueSetState:function(a,c,f){a=a._reactInternals;var m=ba(),S=dn(m);S.payload=c,f!=null&&(S.callback=f),c=jn(a,S,m),c!==null&&(ta(c,a,m),ns(c,a,m))},enqueueReplaceState:function(a,c,f){a=a._reactInternals;var m=ba(),S=dn(m);S.tag=1,S.payload=c,f!=null&&(S.callback=f),c=jn(a,S,m),c!==null&&(ta(c,a,m),ns(c,a,m))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var f=ba(),m=dn(f);m.tag=2,c!=null&&(m.callback=c),c=jn(a,m,f),c!==null&&(ta(c,a,f),ns(c,a,f))}};function gy(a,c,f,m,S,C,I){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(m,C,I):c.prototype&&c.prototype.isPureReactComponent?!fo(f,m)||!fo(S,C):!0}function my(a,c,f,m){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(f,m),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(f,m),c.state!==a&&bm.enqueueReplaceState(c,c.state,null)}function pu(a,c){var f=c;if("ref"in c){f={};for(var m in c)m!=="ref"&&(f[m]=c[m])}if(a=a.defaultProps){f===c&&(f=g({},f));for(var S in a)f[S]===void 0&&(f[S]=a[S])}return f}function xy(a){su(a)}function by(a){console.error(a)}function yy(a){su(a)}function x0(a,c){try{var f=a.onUncaughtError;f(c.value,{componentStack:c.stack})}catch(m){setTimeout(function(){throw m})}}function vy(a,c,f){try{var m=a.onCaughtError;m(f.value,{componentStack:f.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(S){setTimeout(function(){throw S})}}function ym(a,c,f){return f=dn(f),f.tag=3,f.payload={element:null},f.callback=function(){x0(a,c)},f}function wy(a){return a=dn(a),a.tag=3,a}function Sy(a,c,f,m){var S=f.type.getDerivedStateFromError;if(typeof S=="function"){var C=m.value;a.payload=function(){return S(C)},a.callback=function(){vy(c,f,m)}}var I=f.stateNode;I!==null&&typeof I.componentDidCatch=="function"&&(a.callback=function(){vy(c,f,m),typeof S!="function"&&(Nc===null?Nc=new Set([this]):Nc.add(this));var ne=m.stack;this.componentDidCatch(m.value,{componentStack:ne!==null?ne:""})})}function GA(a,c,f,m,S){if(f.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(c=f.alternate,c!==null&&Vo(c,f,S,!0),f=Bs.current,f!==null){switch(f.tag){case 31:case 13:return Xn===null?j0():f.alternate===null&&cr===0&&(cr=3),f.flags&=-257,f.flags|=65536,f.lanes=S,m===Ee?f.flags|=16384:(c=f.updateQueue,c===null?f.updateQueue=new Set([m]):c.add(m),Hm(a,m,S)),!1;case 22:return f.flags|=65536,m===Ee?f.flags|=16384:(c=f.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([m])},f.updateQueue=c):(f=c.retryQueue,f===null?c.retryQueue=new Set([m]):f.add(m)),Hm(a,m,S)),!1}throw Error(n(435,f.tag))}return Hm(a,m,S),j0(),!1}if(In)return c=Bs.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=S,m!==ga&&(a=Error(n(422),{cause:m}),gc(Hi(a,f)))):(m!==ga&&(c=Error(n(423),{cause:m}),gc(Hi(c,f))),a=a.current.alternate,a.flags|=65536,S&=-S,a.lanes|=S,m=Hi(m,f),S=ym(a.stateNode,m,S),pr(a,S),cr!==4&&(cr=2)),!1;var C=Error(n(520),{cause:m});if(C=Hi(C,f),Wh===null?Wh=[C]:Wh.push(C),cr!==4&&(cr=2),c===null)return!0;m=Hi(m,f),f=c;do{switch(f.tag){case 3:return f.flags|=65536,a=S&-S,f.lanes|=a,a=ym(f.stateNode,m,a),pr(f,a),!1;case 1:if(c=f.type,C=f.stateNode,(f.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(Nc===null||!Nc.has(C))))return f.flags|=65536,S&=-S,f.lanes|=S,S=wy(S),Sy(S,a,f,m),pr(f,S),!1}f=f.return}while(f!==null);return!1}var vm=Error(n(461)),Ar=!1;function li(a,c,f,m){c.child=a===null?Cn(c,null,f,m):Es(c,a.child,f,m)}function _y(a,c,f,m,S){f=f.render;var C=c.ref;if("ref"in m){var I={};for(var ne in m)ne!=="ref"&&(I[ne]=m[ne])}else I=m;return Wo(c),m=Dh(a,c,f,I,C,S),ne=Lh(),a!==null&&!Ar?(Rh(a,c,S),Rl(a,c,S)):(In&&ne&&Eh(c),c.flags|=1,li(a,c,m,S),c.child)}function Ay(a,c,f,m,S){if(a===null){var C=f.type;return typeof C=="function"&&!id(C)&&C.defaultProps===void 0&&f.compare===null?(c.tag=15,c.type=C,Ny(a,c,C,m,S)):(a=hc(f.type,null,m,c,c.mode,S),a.ref=c.ref,a.return=c,c.child=a)}if(C=a.child,!km(a,S)){var I=C.memoizedProps;if(f=f.compare,f=f!==null?f:fo,f(I,m)&&a.ref===c.ref)return Rl(a,c,S)}return c.flags|=1,a=qi(C,m),a.ref=c.ref,a.return=c,c.child=a}function Ny(a,c,f,m,S){if(a!==null){var C=a.memoizedProps;if(fo(C,m)&&a.ref===c.ref)if(Ar=!1,c.pendingProps=m=C,km(a,S))(a.flags&131072)!==0&&(Ar=!0);else return c.lanes=a.lanes,Rl(a,c,S)}return wm(a,c,f,m,S)}function Cy(a,c,f,m){var S=m.children,C=a!==null?a.memoizedState:null;if(a===null&&c.stateNode===null&&(c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((c.flags&128)!==0){if(C=C!==null?C.baseLanes|f:f,a!==null){for(m=c.child=a.child,S=0;m!==null;)S=S|m.lanes|m.childLanes,m=m.sibling;m=S&~C}else m=0,c.child=null;return Ey(a,c,C,f,m)}if((f&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},a!==null&&oe(c,C!==null?C.cachePool:null),C!==null?Ps(c,C):Qn(),ar(c);else return m=c.lanes=536870912,Ey(a,c,C!==null?C.baseLanes|f:f,f,m)}else C!==null?(oe(c,C.cachePool),Ps(c,C),or(),c.memoizedState=null):(a!==null&&oe(c,null),Qn(),or());return li(a,c,S,f),c.child}function Uh(a,c){return a!==null&&a.tag===22||c.stateNode!==null||(c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.sibling}function Ey(a,c,f,m,S){var C=ie();return C=C===null?null:{parent:Xs._currentValue,pool:C},c.memoizedState={baseLanes:f,cachePool:C},a!==null&&oe(c,null),Qn(),ar(c),a!==null&&Vo(a,c,m,!0),c.childLanes=S,null}function b0(a,c){return c=v0({mode:c.mode,children:c.children},a.mode),c.ref=a.ref,a.child=c,c.return=a,c}function ky(a,c,f){return Es(c,a.child,null,f),a=b0(c,c.pendingProps),a.flags|=2,hs(c),c.memoizedState=null,a}function VA(a,c,f){var m=c.pendingProps,S=(c.flags&128)!==0;if(c.flags&=-129,a===null){if(In){if(m.mode==="hidden")return a=b0(c,m),c.lanes=536870912,Uh(null,a);if(ss(c),(a=Cs)?(a=Uv(a,Fs),a=a!==null&&a.data==="&"?a:null,a!==null&&(c.memoizedState={dehydrated:a,treeContext:$o!==null?{id:Wi,overflow:Yi}:null,retryLane:536870912,hydrationErrors:null},f=ad(a),f.return=c,c.child=f,Br=c,Cs=null)):a=null,a===null)throw qo(c);return c.lanes=536870912,null}return b0(c,m)}var C=a.memoizedState;if(C!==null){var I=C.dehydrated;if(ss(c),S)if(c.flags&256)c.flags&=-257,c=ky(a,c,f);else if(c.memoizedState!==null)c.child=a.child,c.flags|=128,c=null;else throw Error(n(558));else if(Ar||Vo(a,c,f,!1),S=(f&a.childLanes)!==0,Ar||S){if(m=ks,m!==null&&(I=et(m,f),I!==0&&I!==C.retryLane))throw C.retryLane=I,xo(a,I),ta(m,a,I),vm;j0(),c=ky(a,c,f)}else a=C.treeContext,Cs=qa(I.nextSibling),Br=c,In=!0,ai=null,Fs=!1,a!==null&&l0(c,a),c=b0(c,m),c.flags|=4096;return c}return a=qi(a.child,{mode:m.mode,children:m.children}),a.ref=c.ref,c.child=a,a.return=c,a}function y0(a,c){var f=c.ref;if(f===null)a!==null&&a.ref!==null&&(c.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(n(284));(a===null||a.ref!==f)&&(c.flags|=4194816)}}function wm(a,c,f,m,S){return Wo(c),f=Dh(a,c,f,m,void 0,S),m=Lh(),a!==null&&!Ar?(Rh(a,c,S),Rl(a,c,S)):(In&&m&&Eh(c),c.flags|=1,li(a,c,f,S),c.child)}function jy(a,c,f,m,S,C){return Wo(c),c.updateQueue=null,f=yo(c,m,f,S),gd(a),m=Lh(),a!==null&&!Ar?(Rh(a,c,C),Rl(a,c,C)):(In&&m&&Eh(c),c.flags|=1,li(a,c,f,C),c.child)}function Ty(a,c,f,m,S){if(Wo(c),c.stateNode===null){var C=Pr,I=f.contextType;typeof I=="object"&&I!==null&&(C=Ir(I)),C=new f(m,C),c.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,C.updater=bm,c.stateNode=C,C._reactInternals=c,C=c.stateNode,C.props=m,C.state=c.memoizedState,C.refs={},Dt(c),I=f.contextType,C.context=typeof I=="object"&&I!==null?Ir(I):Pr,C.state=c.memoizedState,I=f.getDerivedStateFromProps,typeof I=="function"&&(xm(c,f,I,m),C.state=c.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(I=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),I!==C.state&&bm.enqueueReplaceState(C,C.state,null),rr(c,m,C,S),ys(),C.state=c.memoizedState),typeof C.componentDidMount=="function"&&(c.flags|=4194308),m=!0}else if(a===null){C=c.stateNode;var ne=c.memoizedProps,be=pu(f,ne);C.props=be;var qe=C.context,rt=f.contextType;I=Pr,typeof rt=="object"&&rt!==null&&(I=Ir(rt));var xt=f.getDerivedStateFromProps;rt=typeof xt=="function"||typeof C.getSnapshotBeforeUpdate=="function",ne=c.pendingProps!==ne,rt||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(ne||qe!==I)&&my(c,C,m,I),$t=!1;var He=c.memoizedState;C.state=He,rr(c,m,C,S),ys(),qe=c.memoizedState,ne||He!==qe||$t?(typeof xt=="function"&&(xm(c,f,xt,m),qe=c.memoizedState),(be=$t||gy(c,f,be,m,He,qe,I))?(rt||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(c.flags|=4194308)):(typeof C.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=m,c.memoizedState=qe),C.props=m,C.state=qe,C.context=I,m=be):(typeof C.componentDidMount=="function"&&(c.flags|=4194308),m=!1)}else{C=c.stateNode,Rs(a,c),I=c.memoizedProps,rt=pu(f,I),C.props=rt,xt=c.pendingProps,He=C.context,qe=f.contextType,be=Pr,typeof qe=="object"&&qe!==null&&(be=Ir(qe)),ne=f.getDerivedStateFromProps,(qe=typeof ne=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(I!==xt||He!==be)&&my(c,C,m,be),$t=!1,He=c.memoizedState,C.state=He,rr(c,m,C,S),ys();var Je=c.memoizedState;I!==xt||He!==Je||$t||a!==null&&a.dependencies!==null&&dd(a.dependencies)?(typeof ne=="function"&&(xm(c,f,ne,m),Je=c.memoizedState),(rt=$t||gy(c,f,rt,m,He,Je,be)||a!==null&&a.dependencies!==null&&dd(a.dependencies))?(qe||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(m,Je,be),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(m,Je,be)),typeof C.componentDidUpdate=="function"&&(c.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof C.componentDidUpdate!="function"||I===a.memoizedProps&&He===a.memoizedState||(c.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||I===a.memoizedProps&&He===a.memoizedState||(c.flags|=1024),c.memoizedProps=m,c.memoizedState=Je),C.props=m,C.state=Je,C.context=be,m=rt):(typeof C.componentDidUpdate!="function"||I===a.memoizedProps&&He===a.memoizedState||(c.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||I===a.memoizedProps&&He===a.memoizedState||(c.flags|=1024),m=!1)}return C=m,y0(a,c),m=(c.flags&128)!==0,C||m?(C=c.stateNode,f=m&&typeof f.getDerivedStateFromError!="function"?null:C.render(),c.flags|=1,a!==null&&m?(c.child=Es(c,a.child,null,S),c.child=Es(c,null,f,S)):li(a,c,f,S),c.memoizedState=C.state,a=c.child):a=Rl(a,c,S),a}function Dy(a,c,f,m){return kl(),c.flags|=256,li(a,c,f,m),c.child}var Sm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function _m(a){return{baseLanes:a,cachePool:pe()}}function Am(a,c,f){return a=a!==null?a.childLanes&~f:0,c&&(a|=xa),a}function Ly(a,c,f){var m=c.pendingProps,S=!1,C=(c.flags&128)!==0,I;if((I=C)||(I=a!==null&&a.memoizedState===null?!1:(Vn.current&2)!==0),I&&(S=!0,c.flags&=-129),I=(c.flags&32)!==0,c.flags&=-33,a===null){if(In){if(S?Js(c):or(),(a=Cs)?(a=Uv(a,Fs),a=a!==null&&a.data!=="&"?a:null,a!==null&&(c.memoizedState={dehydrated:a,treeContext:$o!==null?{id:Wi,overflow:Yi}:null,retryLane:536870912,hydrationErrors:null},f=ad(a),f.return=c,c.child=f,Br=c,Cs=null)):a=null,a===null)throw qo(c);return ax(a)?c.lanes=32:c.lanes=536870912,null}var ne=m.children;return m=m.fallback,S?(or(),S=c.mode,ne=v0({mode:"hidden",children:ne},S),m=zo(m,S,f,null),ne.return=c,m.return=c,ne.sibling=m,c.child=ne,m=c.child,m.memoizedState=_m(f),m.childLanes=Am(a,I,f),c.memoizedState=Sm,Uh(null,m)):(Js(c),Nm(c,ne))}var be=a.memoizedState;if(be!==null&&(ne=be.dehydrated,ne!==null)){if(C)c.flags&256?(Js(c),c.flags&=-257,c=Cm(a,c,f)):c.memoizedState!==null?(or(),c.child=a.child,c.flags|=128,c=null):(or(),ne=m.fallback,S=c.mode,m=v0({mode:"visible",children:m.children},S),ne=zo(ne,S,f,null),ne.flags|=2,m.return=c,ne.return=c,m.sibling=ne,c.child=m,Es(c,a.child,null,f),m=c.child,m.memoizedState=_m(f),m.childLanes=Am(a,I,f),c.memoizedState=Sm,c=Uh(null,m));else if(Js(c),ax(ne)){if(I=ne.nextSibling&&ne.nextSibling.dataset,I)var qe=I.dgst;I=qe,m=Error(n(419)),m.stack="",m.digest=I,gc({value:m,source:null,stack:null}),c=Cm(a,c,f)}else if(Ar||Vo(a,c,f,!1),I=(f&a.childLanes)!==0,Ar||I){if(I=ks,I!==null&&(m=et(I,f),m!==0&&m!==be.retryLane))throw be.retryLane=m,xo(a,m),ta(I,a,m),vm;ix(ne)||j0(),c=Cm(a,c,f)}else ix(ne)?(c.flags|=192,c.child=a.child,c=null):(a=be.treeContext,Cs=qa(ne.nextSibling),Br=c,In=!0,ai=null,Fs=!1,a!==null&&l0(c,a),c=Nm(c,m.children),c.flags|=4096);return c}return S?(or(),ne=m.fallback,S=c.mode,be=a.child,qe=be.sibling,m=qi(be,{mode:"hidden",children:m.children}),m.subtreeFlags=be.subtreeFlags&65011712,qe!==null?ne=qi(qe,ne):(ne=zo(ne,S,f,null),ne.flags|=2),ne.return=c,m.return=c,m.sibling=ne,c.child=m,Uh(null,m),m=c.child,ne=a.child.memoizedState,ne===null?ne=_m(f):(S=ne.cachePool,S!==null?(be=Xs._currentValue,S=S.parent!==be?{parent:be,pool:be}:S):S=pe(),ne={baseLanes:ne.baseLanes|f,cachePool:S}),m.memoizedState=ne,m.childLanes=Am(a,I,f),c.memoizedState=Sm,Uh(a.child,m)):(Js(c),f=a.child,a=f.sibling,f=qi(f,{mode:"visible",children:m.children}),f.return=c,f.sibling=null,a!==null&&(I=c.deletions,I===null?(c.deletions=[a],c.flags|=16):I.push(a)),c.child=f,c.memoizedState=null,f)}function Nm(a,c){return c=v0({mode:"visible",children:c},a.mode),c.return=a,a.child=c}function v0(a,c){return a=Wr(22,a,null,c),a.lanes=0,a}function Cm(a,c,f){return Es(c,a.child,null,f),a=Nm(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function Ry(a,c,f){a.lanes|=c;var m=a.alternate;m!==null&&(m.lanes|=c),mc(a.return,c,f)}function Em(a,c,f,m,S,C){var I=a.memoizedState;I===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:m,tail:f,tailMode:S,treeForkCount:C}:(I.isBackwards=c,I.rendering=null,I.renderingStartTime=0,I.last=m,I.tail=f,I.tailMode=S,I.treeForkCount=C)}function Py(a,c,f){var m=c.pendingProps,S=m.revealOrder,C=m.tail;m=m.children;var I=Vn.current,ne=(I&2)!==0;if(ne?(I=I&1|2,c.flags|=128):I&=1,U(Vn,I),li(a,c,m,f),m=In?cu:0,!ne&&a!==null&&(a.flags&128)!==0)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Ry(a,f,c);else if(a.tag===19)Ry(a,f,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(S){case"forwards":for(f=c.child,S=null;f!==null;)a=f.alternate,a!==null&&Kr(a)===null&&(S=f),f=f.sibling;f=S,f===null?(S=c.child,c.child=null):(S=f.sibling,f.sibling=null),Em(c,!1,S,f,C,m);break;case"backwards":case"unstable_legacy-backwards":for(f=null,S=c.child,c.child=null;S!==null;){if(a=S.alternate,a!==null&&Kr(a)===null){c.child=S;break}a=S.sibling,S.sibling=f,f=S,S=a}Em(c,!0,f,null,C,m);break;case"together":Em(c,!1,null,null,void 0,m);break;default:c.memoizedState=null}return c.child}function Rl(a,c,f){if(a!==null&&(c.dependencies=a.dependencies),Ac|=c.lanes,(f&c.childLanes)===0)if(a!==null){if(Vo(a,c,f,!1),(f&c.childLanes)===0)return null}else return null;if(a!==null&&c.child!==a.child)throw Error(n(153));if(c.child!==null){for(a=c.child,f=qi(a,a.pendingProps),c.child=f,f.return=c;a.sibling!==null;)a=a.sibling,f=f.sibling=qi(a,a.pendingProps),f.return=c;f.sibling=null}return c.child}function km(a,c){return(a.lanes&c)!==0?!0:(a=a.dependencies,!!(a!==null&&dd(a)))}function WA(a,c,f){switch(c.tag){case 3:he(c,c.stateNode.containerInfo),Go(c,Xs,a.memoizedState.cache),kl();break;case 27:case 5:ve(c);break;case 4:he(c,c.stateNode.containerInfo);break;case 10:Go(c,c.type,c.memoizedProps.value);break;case 31:if(c.memoizedState!==null)return c.flags|=128,ss(c),null;break;case 13:var m=c.memoizedState;if(m!==null)return m.dehydrated!==null?(Js(c),c.flags|=128,null):(f&c.child.childLanes)!==0?Ly(a,c,f):(Js(c),a=Rl(a,c,f),a!==null?a.sibling:null);Js(c);break;case 19:var S=(a.flags&128)!==0;if(m=(f&c.childLanes)!==0,m||(Vo(a,c,f,!1),m=(f&c.childLanes)!==0),S){if(m)return Py(a,c,f);c.flags|=128}if(S=c.memoizedState,S!==null&&(S.rendering=null,S.tail=null,S.lastEffect=null),U(Vn,Vn.current),m)break;return null;case 22:return c.lanes=0,Cy(a,c,f,c.pendingProps);case 24:Go(c,Xs,a.memoizedState.cache)}return Rl(a,c,f)}function By(a,c,f){if(a!==null)if(a.memoizedProps!==c.pendingProps)Ar=!0;else{if(!km(a,f)&&(c.flags&128)===0)return Ar=!1,WA(a,c,f);Ar=(a.flags&131072)!==0}else Ar=!1,In&&(c.flags&1048576)!==0&&o0(c,cu,c.index);switch(c.lanes=0,c.tag){case 16:e:{var m=c.pendingProps;if(a=Ue(c.elementType),c.type=a,typeof a=="function")id(a)?(m=pu(a,m),c.tag=1,c=Ty(null,c,a,m,f)):(c.tag=0,c=wm(null,c,a,m,f));else{if(a!=null){var S=a.$$typeof;if(S===T){c.tag=11,c=_y(null,c,a,m,f);break e}else if(S===F){c.tag=14,c=Ay(null,c,a,m,f);break e}}throw c=Z(a)||a,Error(n(306,c,""))}}return c;case 0:return wm(a,c,c.type,c.pendingProps,f);case 1:return m=c.type,S=pu(m,c.pendingProps),Ty(a,c,m,S,f);case 3:e:{if(he(c,c.stateNode.containerInfo),a===null)throw Error(n(387));m=c.pendingProps;var C=c.memoizedState;S=C.element,Rs(a,c),rr(c,m,null,f);var I=c.memoizedState;if(m=I.cache,Go(c,Xs,m),m!==C.cache&&jl(c,[Xs],f,!0),ys(),m=I.element,C.isDehydrated)if(C={element:m,isDehydrated:!1,cache:I.cache},c.updateQueue.baseState=C,c.memoizedState=C,c.flags&256){c=Dy(a,c,m,f);break e}else if(m!==S){S=Hi(Error(n(424)),c),gc(S),c=Dy(a,c,m,f);break e}else for(a=c.stateNode.containerInfo,a.nodeType===9?a=a.body:a=a.nodeName==="HTML"?a.ownerDocument.body:a,Cs=qa(a.firstChild),Br=c,In=!0,ai=null,Fs=!0,f=Cn(c,null,m,f),c.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling;else{if(kl(),m===S){c=Rl(a,c,f);break e}li(a,c,m,f)}c=c.child}return c;case 26:return y0(a,c),a===null?(f=Vv(c.type,null,c.pendingProps,null))?c.memoizedState=f:In||(f=c.type,a=c.pendingProps,m=O0(de.current).createElement(f),m[wn]=c,m[jt]=a,ci(m,f,a),Ds(m),c.stateNode=m):c.memoizedState=Vv(c.type,a.memoizedProps,c.pendingProps,a.memoizedState),null;case 27:return ve(c),a===null&&In&&(m=c.stateNode=qv(c.type,c.pendingProps,de.current),Br=c,Fs=!0,S=Cs,jc(c.type)?(ox=S,Cs=qa(m.firstChild)):Cs=S),li(a,c,c.pendingProps.children,f),y0(a,c),a===null&&(c.flags|=4194304),c.child;case 5:return a===null&&In&&((S=m=Cs)&&(m=_3(m,c.type,c.pendingProps,Fs),m!==null?(c.stateNode=m,Br=c,Cs=qa(m.firstChild),Fs=!1,S=!0):S=!1),S||qo(c)),ve(c),S=c.type,C=c.pendingProps,I=a!==null?a.memoizedProps:null,m=C.children,nx(S,C)?m=null:I!==null&&nx(S,I)&&(c.flags|=32),c.memoizedState!==null&&(S=Dh(a,c,cm,null,null,f),tf._currentValue=S),y0(a,c),li(a,c,m,f),c.child;case 6:return a===null&&In&&((a=f=Cs)&&(f=A3(f,c.pendingProps,Fs),f!==null?(c.stateNode=f,Br=c,Cs=null,a=!0):a=!1),a||qo(c)),null;case 13:return Ly(a,c,f);case 4:return he(c,c.stateNode.containerInfo),m=c.pendingProps,a===null?c.child=Es(c,null,m,f):li(a,c,m,f),c.child;case 11:return _y(a,c,c.type,c.pendingProps,f);case 7:return li(a,c,c.pendingProps,f),c.child;case 8:return li(a,c,c.pendingProps.children,f),c.child;case 12:return li(a,c,c.pendingProps.children,f),c.child;case 10:return m=c.pendingProps,Go(c,c.type,m.value),li(a,c,m.children,f),c.child;case 9:return S=c.type._context,m=c.pendingProps.children,Wo(c),S=Ir(S),m=m(S),c.flags|=1,li(a,c,m,f),c.child;case 14:return Ay(a,c,c.type,c.pendingProps,f);case 15:return Ny(a,c,c.type,c.pendingProps,f);case 19:return Py(a,c,f);case 31:return VA(a,c,f);case 22:return Cy(a,c,f,c.pendingProps);case 24:return Wo(c),m=Ir(Xs),a===null?(S=ie(),S===null&&(S=ks,C=xc(),S.pooledCache=C,C.refCount++,C!==null&&(S.pooledCacheLanes|=f),S=C),c.memoizedState={parent:m,cache:S},Dt(c),Go(c,Xs,S)):((a.lanes&f)!==0&&(Rs(a,c),rr(c,null,null,f),ys()),S=a.memoizedState,C=c.memoizedState,S.parent!==m?(S={parent:m,cache:m},c.memoizedState=S,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=S),Go(c,Xs,m)):(m=C.cache,Go(c,Xs,m),m!==S.cache&&jl(c,[Xs],f,!0))),li(a,c,c.pendingProps.children,f),c.child;case 29:throw c.pendingProps}throw Error(n(156,c.tag))}function Pl(a){a.flags|=4}function jm(a,c,f,m,S){if((c=(a.mode&32)!==0)&&(c=!1),c){if(a.flags|=16777216,(S&335544128)===S)if(a.stateNode.complete)a.flags|=8192;else if(lv())a.flags|=8192;else throw tt=Ee,ze}else a.flags&=-16777217}function Oy(a,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!Jv(c))if(lv())a.flags|=8192;else throw tt=Ee,ze}function w0(a,c){c!==null&&(a.flags|=4),a.flags&16384&&(c=a.tag!==22?As():536870912,a.lanes|=c,Cd|=c)}function zh(a,c){if(!In)switch(a.tailMode){case"hidden":c=a.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?a.tail=null:f.sibling=null;break;case"collapsed":f=a.tail;for(var m=null;f!==null;)f.alternate!==null&&(m=f),f=f.sibling;m===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:m.sibling=null}}function Os(a){var c=a.alternate!==null&&a.alternate.child===a.child,f=0,m=0;if(c)for(var S=a.child;S!==null;)f|=S.lanes|S.childLanes,m|=S.subtreeFlags&65011712,m|=S.flags&65011712,S.return=a,S=S.sibling;else for(S=a.child;S!==null;)f|=S.lanes|S.childLanes,m|=S.subtreeFlags,m|=S.flags,S.return=a,S=S.sibling;return a.subtreeFlags|=m,a.childLanes=f,c}function YA(a,c,f){var m=c.pendingProps;switch(cd(c),c.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Os(c),null;case 1:return Os(c),null;case 3:return f=c.stateNode,m=null,a!==null&&(m=a.memoizedState.cache),c.memoizedState.cache!==m&&(c.flags|=2048),Ki(Xs),me(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(a===null||a.child===null)&&(Or(c)?Pl(c):a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,jh())),Os(c),null;case 26:var S=c.type,C=c.memoizedState;return a===null?(Pl(c),C!==null?(Os(c),Oy(c,C)):(Os(c),jm(c,S,null,m,f))):C?C!==a.memoizedState?(Pl(c),Os(c),Oy(c,C)):(Os(c),c.flags&=-16777217):(a=a.memoizedProps,a!==m&&Pl(c),Os(c),jm(c,S,a,m,f)),null;case 27:if(Re(c),f=de.current,S=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==m&&Pl(c);else{if(!m){if(c.stateNode===null)throw Error(n(166));return Os(c),null}a=H.current,Or(c)?kh(c):(a=qv(S,m,f),c.stateNode=a,Pl(c))}return Os(c),null;case 5:if(Re(c),S=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==m&&Pl(c);else{if(!m){if(c.stateNode===null)throw Error(n(166));return Os(c),null}if(C=H.current,Or(c))kh(c);else{var I=O0(de.current);switch(C){case 1:C=I.createElementNS("http://www.w3.org/2000/svg",S);break;case 2:C=I.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;default:switch(S){case"svg":C=I.createElementNS("http://www.w3.org/2000/svg",S);break;case"math":C=I.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;case"script":C=I.createElement("div"),C.innerHTML="<script><\/script>",C=C.removeChild(C.firstChild);break;case"select":C=typeof m.is=="string"?I.createElement("select",{is:m.is}):I.createElement("select"),m.multiple?C.multiple=!0:m.size&&(C.size=m.size);break;default:C=typeof m.is=="string"?I.createElement(S,{is:m.is}):I.createElement(S)}}C[wn]=c,C[jt]=m;e:for(I=c.child;I!==null;){if(I.tag===5||I.tag===6)C.appendChild(I.stateNode);else if(I.tag!==4&&I.tag!==27&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===c)break e;for(;I.sibling===null;){if(I.return===null||I.return===c)break e;I=I.return}I.sibling.return=I.return,I=I.sibling}c.stateNode=C;e:switch(ci(C,S,m),S){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&Pl(c)}}return Os(c),jm(c,c.type,a===null?null:a.memoizedProps,c.pendingProps,f),null;case 6:if(a&&c.stateNode!=null)a.memoizedProps!==m&&Pl(c);else{if(typeof m!="string"&&c.stateNode===null)throw Error(n(166));if(a=de.current,Or(c)){if(a=c.stateNode,f=c.memoizedProps,m=null,S=Br,S!==null)switch(S.tag){case 27:case 5:m=S.memoizedProps}a[wn]=c,a=!!(a.nodeValue===f||m!==null&&m.suppressHydrationWarning===!0||Lv(a.nodeValue,f)),a||qo(c,!0)}else a=O0(a).createTextNode(m),a[wn]=c,c.stateNode=a}return Os(c),null;case 31:if(f=c.memoizedState,a===null||a.memoizedState!==null){if(m=Or(c),f!==null){if(a===null){if(!m)throw Error(n(318));if(a=c.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(557));a[wn]=c}else kl(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Os(c),a=!1}else f=jh(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=f),a=!0;if(!a)return c.flags&256?(hs(c),c):(hs(c),null);if((c.flags&128)!==0)throw Error(n(558))}return Os(c),null;case 13:if(m=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(S=Or(c),m!==null&&m.dehydrated!==null){if(a===null){if(!S)throw Error(n(318));if(S=c.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(n(317));S[wn]=c}else kl(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Os(c),S=!1}else S=jh(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=S),S=!0;if(!S)return c.flags&256?(hs(c),c):(hs(c),null)}return hs(c),(c.flags&128)!==0?(c.lanes=f,c):(f=m!==null,a=a!==null&&a.memoizedState!==null,f&&(m=c.child,S=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(S=m.alternate.memoizedState.cachePool.pool),C=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(C=m.memoizedState.cachePool.pool),C!==S&&(m.flags|=2048)),f!==a&&f&&(c.child.flags|=8192),w0(c,c.updateQueue),Os(c),null);case 4:return me(),a===null&&Jm(c.stateNode.containerInfo),Os(c),null;case 10:return Ki(c.type),Os(c),null;case 19:if(L(Vn),m=c.memoizedState,m===null)return Os(c),null;if(S=(c.flags&128)!==0,C=m.rendering,C===null)if(S)zh(m,!1);else{if(cr!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(C=Kr(a),C!==null){for(c.flags|=128,zh(m,!1),a=C.updateQueue,c.updateQueue=a,w0(c,a),c.subtreeFlags=0,a=f,f=c.child;f!==null;)ou(f,a),f=f.sibling;return U(Vn,Vn.current&1|2),In&&Bi(c,m.treeForkCount),c.child}a=a.sibling}m.tail!==null&&Pt()>C0&&(c.flags|=128,S=!0,zh(m,!1),c.lanes=4194304)}else{if(!S)if(a=Kr(C),a!==null){if(c.flags|=128,S=!0,a=a.updateQueue,c.updateQueue=a,w0(c,a),zh(m,!0),m.tail===null&&m.tailMode==="hidden"&&!C.alternate&&!In)return Os(c),null}else 2*Pt()-m.renderingStartTime>C0&&f!==536870912&&(c.flags|=128,S=!0,zh(m,!1),c.lanes=4194304);m.isBackwards?(C.sibling=c.child,c.child=C):(a=m.last,a!==null?a.sibling=C:c.child=C,m.last=C)}return m.tail!==null?(a=m.tail,m.rendering=a,m.tail=a.sibling,m.renderingStartTime=Pt(),a.sibling=null,f=Vn.current,U(Vn,S?f&1|2:f&1),In&&Bi(c,m.treeForkCount),a):(Os(c),null);case 22:case 23:return hs(c),gr(),m=c.memoizedState!==null,a!==null?a.memoizedState!==null!==m&&(c.flags|=8192):m&&(c.flags|=8192),m?(f&536870912)!==0&&(c.flags&128)===0&&(Os(c),c.subtreeFlags&6&&(c.flags|=8192)):Os(c),f=c.updateQueue,f!==null&&w0(c,f.retryQueue),f=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),m=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(m=c.memoizedState.cachePool.pool),m!==f&&(c.flags|=2048),a!==null&&L(ee),null;case 24:return f=null,a!==null&&(f=a.memoizedState.cache),c.memoizedState.cache!==f&&(c.flags|=2048),Ki(Xs),Os(c),null;case 25:return null;case 30:return null}throw Error(n(156,c.tag))}function KA(a,c){switch(cd(c),c.tag){case 1:return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return Ki(Xs),me(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 26:case 27:case 5:return Re(c),null;case 31:if(c.memoizedState!==null){if(hs(c),c.alternate===null)throw Error(n(340));kl()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 13:if(hs(c),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(n(340));kl()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return L(Vn),null;case 4:return me(),null;case 10:return Ki(c.type),null;case 22:case 23:return hs(c),gr(),a!==null&&L(ee),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 24:return Ki(Xs),null;case 25:return null;default:return null}}function Iy(a,c){switch(cd(c),c.tag){case 3:Ki(Xs),me();break;case 26:case 27:case 5:Re(c);break;case 4:me();break;case 31:c.memoizedState!==null&&hs(c);break;case 13:hs(c);break;case 19:L(Vn);break;case 10:Ki(c.type);break;case 22:case 23:hs(c),gr(),a!==null&&L(ee);break;case 24:Ki(Xs)}}function $h(a,c){try{var f=c.updateQueue,m=f!==null?f.lastEffect:null;if(m!==null){var S=m.next;f=S;do{if((f.tag&a)===a){m=void 0;var C=f.create,I=f.inst;m=C(),I.destroy=m}f=f.next}while(f!==S)}}catch(ne){ps(c,c.return,ne)}}function Sc(a,c,f){try{var m=c.updateQueue,S=m!==null?m.lastEffect:null;if(S!==null){var C=S.next;m=C;do{if((m.tag&a)===a){var I=m.inst,ne=I.destroy;if(ne!==void 0){I.destroy=void 0,S=c;var be=f,qe=ne;try{qe()}catch(rt){ps(S,be,rt)}}}m=m.next}while(m!==C)}}catch(rt){ps(c,c.return,rt)}}function My(a){var c=a.updateQueue;if(c!==null){var f=a.stateNode;try{ir(c,f)}catch(m){ps(a,a.return,m)}}}function Fy(a,c,f){f.props=pu(a.type,a.memoizedProps),f.state=a.memoizedState;try{f.componentWillUnmount()}catch(m){ps(a,c,m)}}function qh(a,c){try{var f=a.ref;if(f!==null){switch(a.tag){case 26:case 27:case 5:var m=a.stateNode;break;case 30:m=a.stateNode;break;default:m=a.stateNode}typeof f=="function"?a.refCleanup=f(m):f.current=m}}catch(S){ps(a,c,S)}}function Zo(a,c){var f=a.ref,m=a.refCleanup;if(f!==null)if(typeof m=="function")try{m()}catch(S){ps(a,c,S)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(S){ps(a,c,S)}else f.current=null}function Uy(a){var c=a.type,f=a.memoizedProps,m=a.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":f.autoFocus&&m.focus();break e;case"img":f.src?m.src=f.src:f.srcSet&&(m.srcset=f.srcSet)}}catch(S){ps(a,a.return,S)}}function Tm(a,c,f){try{var m=a.stateNode;x3(m,a.type,f,c),m[jt]=c}catch(S){ps(a,a.return,S)}}function zy(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&jc(a.type)||a.tag===4}function Dm(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||zy(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&jc(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Lm(a,c,f){var m=a.tag;if(m===5||m===6)a=a.stateNode,c?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(a,c):(c=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,c.appendChild(a),f=f._reactRootContainer,f!=null||c.onclick!==null||(c.onclick=ca));else if(m!==4&&(m===27&&jc(a.type)&&(f=a.stateNode,c=null),a=a.child,a!==null))for(Lm(a,c,f),a=a.sibling;a!==null;)Lm(a,c,f),a=a.sibling}function S0(a,c,f){var m=a.tag;if(m===5||m===6)a=a.stateNode,c?f.insertBefore(a,c):f.appendChild(a);else if(m!==4&&(m===27&&jc(a.type)&&(f=a.stateNode),a=a.child,a!==null))for(S0(a,c,f),a=a.sibling;a!==null;)S0(a,c,f),a=a.sibling}function $y(a){var c=a.stateNode,f=a.memoizedProps;try{for(var m=a.type,S=c.attributes;S.length;)c.removeAttributeNode(S[0]);ci(c,m,f),c[wn]=a,c[jt]=f}catch(C){ps(a,a.return,C)}}var Bl=!1,Nr=!1,Rm=!1,qy=typeof WeakSet=="function"?WeakSet:Set,Xr=null;function XA(a,c){if(a=a.containerInfo,ex=q0,a=go(a),Ma(a)){if("selectionStart"in a)var f={start:a.selectionStart,end:a.selectionEnd};else e:{f=(f=a.ownerDocument)&&f.defaultView||window;var m=f.getSelection&&f.getSelection();if(m&&m.rangeCount!==0){f=m.anchorNode;var S=m.anchorOffset,C=m.focusNode;m=m.focusOffset;try{f.nodeType,C.nodeType}catch{f=null;break e}var I=0,ne=-1,be=-1,qe=0,rt=0,xt=a,He=null;t:for(;;){for(var Je;xt!==f||S!==0&&xt.nodeType!==3||(ne=I+S),xt!==C||m!==0&&xt.nodeType!==3||(be=I+m),xt.nodeType===3&&(I+=xt.nodeValue.length),(Je=xt.firstChild)!==null;)He=xt,xt=Je;for(;;){if(xt===a)break t;if(He===f&&++qe===S&&(ne=I),He===C&&++rt===m&&(be=I),(Je=xt.nextSibling)!==null)break;xt=He,He=xt.parentNode}xt=Je}f=ne===-1||be===-1?null:{start:ne,end:be}}else f=null}f=f||{start:0,end:0}}else f=null;for(tx={focusedElem:a,selectionRange:f},q0=!1,Xr=c;Xr!==null;)if(c=Xr,a=c.child,(c.subtreeFlags&1028)!==0&&a!==null)a.return=c,Xr=a;else for(;Xr!==null;){switch(c=Xr,C=c.alternate,a=c.flags,c.tag){case 0:if((a&4)!==0&&(a=c.updateQueue,a=a!==null?a.events:null,a!==null))for(f=0;f<a.length;f++)S=a[f],S.ref.impl=S.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&C!==null){a=void 0,f=c,S=C.memoizedProps,C=C.memoizedState,m=f.stateNode;try{var Wt=pu(f.type,S);a=m.getSnapshotBeforeUpdate(Wt,C),m.__reactInternalSnapshotBeforeUpdate=a}catch(pn){ps(f,f.return,pn)}}break;case 3:if((a&1024)!==0){if(a=c.stateNode.containerInfo,f=a.nodeType,f===9)rx(a);else if(f===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":rx(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(n(163))}if(a=c.sibling,a!==null){a.return=c.return,Xr=a;break}Xr=c.return}}function Hy(a,c,f){var m=f.flags;switch(f.tag){case 0:case 11:case 15:Il(a,f),m&4&&$h(5,f);break;case 1:if(Il(a,f),m&4)if(a=f.stateNode,c===null)try{a.componentDidMount()}catch(I){ps(f,f.return,I)}else{var S=pu(f.type,c.memoizedProps);c=c.memoizedState;try{a.componentDidUpdate(S,c,a.__reactInternalSnapshotBeforeUpdate)}catch(I){ps(f,f.return,I)}}m&64&&My(f),m&512&&qh(f,f.return);break;case 3:if(Il(a,f),m&64&&(a=f.updateQueue,a!==null)){if(c=null,f.child!==null)switch(f.child.tag){case 27:case 5:c=f.child.stateNode;break;case 1:c=f.child.stateNode}try{ir(a,c)}catch(I){ps(f,f.return,I)}}break;case 27:c===null&&m&4&&$y(f);case 26:case 5:Il(a,f),c===null&&m&4&&Uy(f),m&512&&qh(f,f.return);break;case 12:Il(a,f);break;case 31:Il(a,f),m&4&&Wy(a,f);break;case 13:Il(a,f),m&4&&Yy(a,f),m&64&&(a=f.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(f=i3.bind(null,f),N3(a,f))));break;case 22:if(m=f.memoizedState!==null||Bl,!m){c=c!==null&&c.memoizedState!==null||Nr,S=Bl;var C=Nr;Bl=m,(Nr=c)&&!C?Ml(a,f,(f.subtreeFlags&8772)!==0):Il(a,f),Bl=S,Nr=C}break;case 30:break;default:Il(a,f)}}function Gy(a){var c=a.alternate;c!==null&&(a.alternate=null,Gy(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&Hr(c)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var $s=null,Ji=!1;function Ol(a,c,f){for(f=f.child;f!==null;)Vy(a,c,f),f=f.sibling}function Vy(a,c,f){if(wt&&typeof wt.onCommitFiberUnmount=="function")try{wt.onCommitFiberUnmount(ft,f)}catch{}switch(f.tag){case 26:Nr||Zo(f,c),Ol(a,c,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:Nr||Zo(f,c);var m=$s,S=Ji;jc(f.type)&&($s=f.stateNode,Ji=!1),Ol(a,c,f),Zh(f.stateNode),$s=m,Ji=S;break;case 5:Nr||Zo(f,c);case 6:if(m=$s,S=Ji,$s=null,Ol(a,c,f),$s=m,Ji=S,$s!==null)if(Ji)try{($s.nodeType===9?$s.body:$s.nodeName==="HTML"?$s.ownerDocument.body:$s).removeChild(f.stateNode)}catch(C){ps(f,c,C)}else try{$s.removeChild(f.stateNode)}catch(C){ps(f,c,C)}break;case 18:$s!==null&&(Ji?(a=$s,Mv(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,f.stateNode),Pd(a)):Mv($s,f.stateNode));break;case 4:m=$s,S=Ji,$s=f.stateNode.containerInfo,Ji=!0,Ol(a,c,f),$s=m,Ji=S;break;case 0:case 11:case 14:case 15:Sc(2,f,c),Nr||Sc(4,f,c),Ol(a,c,f);break;case 1:Nr||(Zo(f,c),m=f.stateNode,typeof m.componentWillUnmount=="function"&&Fy(f,c,m)),Ol(a,c,f);break;case 21:Ol(a,c,f);break;case 22:Nr=(m=Nr)||f.memoizedState!==null,Ol(a,c,f),Nr=m;break;default:Ol(a,c,f)}}function Wy(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{Pd(a)}catch(f){ps(c,c.return,f)}}}function Yy(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Pd(a)}catch(f){ps(c,c.return,f)}}function JA(a){switch(a.tag){case 31:case 13:case 19:var c=a.stateNode;return c===null&&(c=a.stateNode=new qy),c;case 22:return a=a.stateNode,c=a._retryCache,c===null&&(c=a._retryCache=new qy),c;default:throw Error(n(435,a.tag))}}function _0(a,c){var f=JA(a);c.forEach(function(m){if(!f.has(m)){f.add(m);var S=a3.bind(null,a,m);m.then(S,S)}})}function Zi(a,c){var f=c.deletions;if(f!==null)for(var m=0;m<f.length;m++){var S=f[m],C=a,I=c,ne=I;e:for(;ne!==null;){switch(ne.tag){case 27:if(jc(ne.type)){$s=ne.stateNode,Ji=!1;break e}break;case 5:$s=ne.stateNode,Ji=!1;break e;case 3:case 4:$s=ne.stateNode.containerInfo,Ji=!0;break e}ne=ne.return}if($s===null)throw Error(n(160));Vy(C,I,S),$s=null,Ji=!1,C=S.alternate,C!==null&&(C.return=null),S.return=null}if(c.subtreeFlags&13886)for(c=c.child;c!==null;)Ky(c,a),c=c.sibling}var _o=null;function Ky(a,c){var f=a.alternate,m=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Zi(c,a),Qi(a),m&4&&(Sc(3,a,a.return),$h(3,a),Sc(5,a,a.return));break;case 1:Zi(c,a),Qi(a),m&512&&(Nr||f===null||Zo(f,f.return)),m&64&&Bl&&(a=a.updateQueue,a!==null&&(m=a.callbacks,m!==null&&(f=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=f===null?m:f.concat(m))));break;case 26:var S=_o;if(Zi(c,a),Qi(a),m&512&&(Nr||f===null||Zo(f,f.return)),m&4){var C=f!==null?f.memoizedState:null;if(m=a.memoizedState,f===null)if(m===null)if(a.stateNode===null){e:{m=a.type,f=a.memoizedProps,S=S.ownerDocument||S;t:switch(m){case"title":C=S.getElementsByTagName("title")[0],(!C||C[Ns]||C[wn]||C.namespaceURI==="http://www.w3.org/2000/svg"||C.hasAttribute("itemprop"))&&(C=S.createElement(m),S.head.insertBefore(C,S.querySelector("head > title"))),ci(C,m,f),C[wn]=a,Ds(C),m=C;break e;case"link":var I=Kv("link","href",S).get(m+(f.href||""));if(I){for(var ne=0;ne<I.length;ne++)if(C=I[ne],C.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&C.getAttribute("rel")===(f.rel==null?null:f.rel)&&C.getAttribute("title")===(f.title==null?null:f.title)&&C.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){I.splice(ne,1);break t}}C=S.createElement(m),ci(C,m,f),S.head.appendChild(C);break;case"meta":if(I=Kv("meta","content",S).get(m+(f.content||""))){for(ne=0;ne<I.length;ne++)if(C=I[ne],C.getAttribute("content")===(f.content==null?null:""+f.content)&&C.getAttribute("name")===(f.name==null?null:f.name)&&C.getAttribute("property")===(f.property==null?null:f.property)&&C.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&C.getAttribute("charset")===(f.charSet==null?null:f.charSet)){I.splice(ne,1);break t}}C=S.createElement(m),ci(C,m,f),S.head.appendChild(C);break;default:throw Error(n(468,m))}C[wn]=a,Ds(C),m=C}a.stateNode=m}else Xv(S,a.type,a.stateNode);else a.stateNode=Yv(S,m,a.memoizedProps);else C!==m?(C===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):C.count--,m===null?Xv(S,a.type,a.stateNode):Yv(S,m,a.memoizedProps)):m===null&&a.stateNode!==null&&Tm(a,a.memoizedProps,f.memoizedProps)}break;case 27:Zi(c,a),Qi(a),m&512&&(Nr||f===null||Zo(f,f.return)),f!==null&&m&4&&Tm(a,a.memoizedProps,f.memoizedProps);break;case 5:if(Zi(c,a),Qi(a),m&512&&(Nr||f===null||Zo(f,f.return)),a.flags&32){S=a.stateNode;try{bn(S,"")}catch(Wt){ps(a,a.return,Wt)}}m&4&&a.stateNode!=null&&(S=a.memoizedProps,Tm(a,S,f!==null?f.memoizedProps:S)),m&1024&&(Rm=!0);break;case 6:if(Zi(c,a),Qi(a),m&4){if(a.stateNode===null)throw Error(n(162));m=a.memoizedProps,f=a.stateNode;try{f.nodeValue=m}catch(Wt){ps(a,a.return,Wt)}}break;case 3:if(F0=null,S=_o,_o=I0(c.containerInfo),Zi(c,a),_o=S,Qi(a),m&4&&f!==null&&f.memoizedState.isDehydrated)try{Pd(c.containerInfo)}catch(Wt){ps(a,a.return,Wt)}Rm&&(Rm=!1,Xy(a));break;case 4:m=_o,_o=I0(a.stateNode.containerInfo),Zi(c,a),Qi(a),_o=m;break;case 12:Zi(c,a),Qi(a);break;case 31:Zi(c,a),Qi(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,_0(a,m)));break;case 13:Zi(c,a),Qi(a),a.child.flags&8192&&a.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(N0=Pt()),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,_0(a,m)));break;case 22:S=a.memoizedState!==null;var be=f!==null&&f.memoizedState!==null,qe=Bl,rt=Nr;if(Bl=qe||S,Nr=rt||be,Zi(c,a),Nr=rt,Bl=qe,Qi(a),m&8192)e:for(c=a.stateNode,c._visibility=S?c._visibility&-2:c._visibility|1,S&&(f===null||be||Bl||Nr||gu(a)),f=null,c=a;;){if(c.tag===5||c.tag===26){if(f===null){be=f=c;try{if(C=be.stateNode,S)I=C.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none";else{ne=be.stateNode;var xt=be.memoizedProps.style,He=xt!=null&&xt.hasOwnProperty("display")?xt.display:null;ne.style.display=He==null||typeof He=="boolean"?"":(""+He).trim()}}catch(Wt){ps(be,be.return,Wt)}}}else if(c.tag===6){if(f===null){be=c;try{be.stateNode.nodeValue=S?"":be.memoizedProps}catch(Wt){ps(be,be.return,Wt)}}}else if(c.tag===18){if(f===null){be=c;try{var Je=be.stateNode;S?Fv(Je,!0):Fv(be.stateNode,!1)}catch(Wt){ps(be,be.return,Wt)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===a)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break e;for(;c.sibling===null;){if(c.return===null||c.return===a)break e;f===c&&(f=null),c=c.return}f===c&&(f=null),c.sibling.return=c.return,c=c.sibling}m&4&&(m=a.updateQueue,m!==null&&(f=m.retryQueue,f!==null&&(m.retryQueue=null,_0(a,f))));break;case 19:Zi(c,a),Qi(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,_0(a,m)));break;case 30:break;case 21:break;default:Zi(c,a),Qi(a)}}function Qi(a){var c=a.flags;if(c&2){try{for(var f,m=a.return;m!==null;){if(zy(m)){f=m;break}m=m.return}if(f==null)throw Error(n(160));switch(f.tag){case 27:var S=f.stateNode,C=Dm(a);S0(a,C,S);break;case 5:var I=f.stateNode;f.flags&32&&(bn(I,""),f.flags&=-33);var ne=Dm(a);S0(a,ne,I);break;case 3:case 4:var be=f.stateNode.containerInfo,qe=Dm(a);Lm(a,qe,be);break;default:throw Error(n(161))}}catch(rt){ps(a,a.return,rt)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function Xy(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var c=a;Xy(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),a=a.sibling}}function Il(a,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)Hy(a,c.alternate,c),c=c.sibling}function gu(a){for(a=a.child;a!==null;){var c=a;switch(c.tag){case 0:case 11:case 14:case 15:Sc(4,c,c.return),gu(c);break;case 1:Zo(c,c.return);var f=c.stateNode;typeof f.componentWillUnmount=="function"&&Fy(c,c.return,f),gu(c);break;case 27:Zh(c.stateNode);case 26:case 5:Zo(c,c.return),gu(c);break;case 22:c.memoizedState===null&&gu(c);break;case 30:gu(c);break;default:gu(c)}a=a.sibling}}function Ml(a,c,f){for(f=f&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var m=c.alternate,S=a,C=c,I=C.flags;switch(C.tag){case 0:case 11:case 15:Ml(S,C,f),$h(4,C);break;case 1:if(Ml(S,C,f),m=C,S=m.stateNode,typeof S.componentDidMount=="function")try{S.componentDidMount()}catch(qe){ps(m,m.return,qe)}if(m=C,S=m.updateQueue,S!==null){var ne=m.stateNode;try{var be=S.shared.hiddenCallbacks;if(be!==null)for(S.shared.hiddenCallbacks=null,S=0;S<be.length;S++)Yr(be[S],ne)}catch(qe){ps(m,m.return,qe)}}f&&I&64&&My(C),qh(C,C.return);break;case 27:$y(C);case 26:case 5:Ml(S,C,f),f&&m===null&&I&4&&Uy(C),qh(C,C.return);break;case 12:Ml(S,C,f);break;case 31:Ml(S,C,f),f&&I&4&&Wy(S,C);break;case 13:Ml(S,C,f),f&&I&4&&Yy(S,C);break;case 22:C.memoizedState===null&&Ml(S,C,f),qh(C,C.return);break;case 30:break;default:Ml(S,C,f)}c=c.sibling}}function Pm(a,c){var f=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),a=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(a=c.memoizedState.cachePool.pool),a!==f&&(a!=null&&a.refCount++,f!=null&&uu(f))}function Bm(a,c){a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&uu(a))}function Ao(a,c,f,m){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)Jy(a,c,f,m),c=c.sibling}function Jy(a,c,f,m){var S=c.flags;switch(c.tag){case 0:case 11:case 15:Ao(a,c,f,m),S&2048&&$h(9,c);break;case 1:Ao(a,c,f,m);break;case 3:Ao(a,c,f,m),S&2048&&(a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&uu(a)));break;case 12:if(S&2048){Ao(a,c,f,m),a=c.stateNode;try{var C=c.memoizedProps,I=C.id,ne=C.onPostCommit;typeof ne=="function"&&ne(I,c.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(be){ps(c,c.return,be)}}else Ao(a,c,f,m);break;case 31:Ao(a,c,f,m);break;case 13:Ao(a,c,f,m);break;case 23:break;case 22:C=c.stateNode,I=c.alternate,c.memoizedState!==null?C._visibility&2?Ao(a,c,f,m):Hh(a,c):C._visibility&2?Ao(a,c,f,m):(C._visibility|=2,_d(a,c,f,m,(c.subtreeFlags&10256)!==0||!1)),S&2048&&Pm(I,c);break;case 24:Ao(a,c,f,m),S&2048&&Bm(c.alternate,c);break;default:Ao(a,c,f,m)}}function _d(a,c,f,m,S){for(S=S&&((c.subtreeFlags&10256)!==0||!1),c=c.child;c!==null;){var C=a,I=c,ne=f,be=m,qe=I.flags;switch(I.tag){case 0:case 11:case 15:_d(C,I,ne,be,S),$h(8,I);break;case 23:break;case 22:var rt=I.stateNode;I.memoizedState!==null?rt._visibility&2?_d(C,I,ne,be,S):Hh(C,I):(rt._visibility|=2,_d(C,I,ne,be,S)),S&&qe&2048&&Pm(I.alternate,I);break;case 24:_d(C,I,ne,be,S),S&&qe&2048&&Bm(I.alternate,I);break;default:_d(C,I,ne,be,S)}c=c.sibling}}function Hh(a,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var f=a,m=c,S=m.flags;switch(m.tag){case 22:Hh(f,m),S&2048&&Pm(m.alternate,m);break;case 24:Hh(f,m),S&2048&&Bm(m.alternate,m);break;default:Hh(f,m)}c=c.sibling}}var Gh=8192;function Ad(a,c,f){if(a.subtreeFlags&Gh)for(a=a.child;a!==null;)Zy(a,c,f),a=a.sibling}function Zy(a,c,f){switch(a.tag){case 26:Ad(a,c,f),a.flags&Gh&&a.memoizedState!==null&&I3(f,_o,a.memoizedState,a.memoizedProps);break;case 5:Ad(a,c,f);break;case 3:case 4:var m=_o;_o=I0(a.stateNode.containerInfo),Ad(a,c,f),_o=m;break;case 22:a.memoizedState===null&&(m=a.alternate,m!==null&&m.memoizedState!==null?(m=Gh,Gh=16777216,Ad(a,c,f),Gh=m):Ad(a,c,f));break;default:Ad(a,c,f)}}function Qy(a){var c=a.alternate;if(c!==null&&(a=c.child,a!==null)){c.child=null;do c=a.sibling,a.sibling=null,a=c;while(a!==null)}}function Vh(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var m=c[f];Xr=m,tv(m,a)}Qy(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)ev(a),a=a.sibling}function ev(a){switch(a.tag){case 0:case 11:case 15:Vh(a),a.flags&2048&&Sc(9,a,a.return);break;case 3:Vh(a);break;case 12:Vh(a);break;case 22:var c=a.stateNode;a.memoizedState!==null&&c._visibility&2&&(a.return===null||a.return.tag!==13)?(c._visibility&=-3,A0(a)):Vh(a);break;default:Vh(a)}}function A0(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var m=c[f];Xr=m,tv(m,a)}Qy(a)}for(a=a.child;a!==null;){switch(c=a,c.tag){case 0:case 11:case 15:Sc(8,c,c.return),A0(c);break;case 22:f=c.stateNode,f._visibility&2&&(f._visibility&=-3,A0(c));break;default:A0(c)}a=a.sibling}}function tv(a,c){for(;Xr!==null;){var f=Xr;switch(f.tag){case 0:case 11:case 15:Sc(8,f,c);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var m=f.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:uu(f.memoizedState.cache)}if(m=f.child,m!==null)m.return=f,Xr=m;else e:for(f=a;Xr!==null;){m=Xr;var S=m.sibling,C=m.return;if(Gy(m),m===f){Xr=null;break e}if(S!==null){S.return=C,Xr=S;break e}Xr=C}}}var ZA={getCacheForType:function(a){var c=Ir(Xs),f=c.data.get(a);return f===void 0&&(f=a(),c.data.set(a,f)),f},cacheSignal:function(){return Ir(Xs).controller.signal}},QA=typeof WeakMap=="function"?WeakMap:Map,rs=0,ks=null,Mn=null,$n=0,fs=0,ma=null,_c=!1,Nd=!1,Om=!1,Fl=0,cr=0,Ac=0,mu=0,Im=0,xa=0,Cd=0,Wh=null,ea=null,Mm=!1,N0=0,nv=0,C0=1/0,E0=null,Nc=null,Fr=0,Cc=null,Ed=null,Ul=0,Fm=0,Um=null,sv=null,Yh=0,zm=null;function ba(){return(rs&2)!==0&&$n!==0?$n&-$n:K.T!==null?Wm():Rt()}function rv(){if(xa===0)if(($n&536870912)===0||In){var a=en;en<<=1,(en&3932160)===0&&(en=262144),xa=a}else xa=536870912;return a=Bs.current,a!==null&&(a.flags|=32),xa}function ta(a,c,f){(a===ks&&(fs===2||fs===9)||a.cancelPendingCommit!==null)&&(kd(a,0),Ec(a,$n,xa,!1)),re(a,f),((rs&2)===0||a!==ks)&&(a===ks&&((rs&2)===0&&(mu|=f),cr===4&&Ec(a,$n,xa,!1)),Qo(a))}function iv(a,c,f){if((rs&6)!==0)throw Error(n(327));var m=!f&&(c&127)===0&&(c&a.expiredLanes)===0||On(a,c),S=m?n3(a,c):qm(a,c,!0),C=m;do{if(S===0){Nd&&!m&&Ec(a,c,0,!1);break}else{if(f=a.current.alternate,C&&!e3(f)){S=qm(a,c,!1),C=!1;continue}if(S===2){if(C=c,a.errorRecoveryDisabledLanes&C)var I=0;else I=a.pendingLanes&-536870913,I=I!==0?I:I&536870912?536870912:0;if(I!==0){c=I;e:{var ne=a;S=Wh;var be=ne.current.memoizedState.isDehydrated;if(be&&(kd(ne,I).flags|=256),I=qm(ne,I,!1),I!==2){if(Om&&!be){ne.errorRecoveryDisabledLanes|=C,mu|=C,S=4;break e}C=ea,ea=S,C!==null&&(ea===null?ea=C:ea.push.apply(ea,C))}S=I}if(C=!1,S!==2)continue}}if(S===1){kd(a,0),Ec(a,c,0,!0);break}e:{switch(m=a,C=S,C){case 0:case 1:throw Error(n(345));case 4:if((c&4194048)!==c)break;case 6:Ec(m,c,xa,!_c);break e;case 2:ea=null;break;case 3:case 5:break;default:throw Error(n(329))}if((c&62914560)===c&&(S=N0+300-Pt(),10<S)){if(Ec(m,c,xa,!_c),Yt(m,0,!0)!==0)break e;Ul=c,m.timeoutHandle=Ov(av.bind(null,m,f,ea,E0,Mm,c,xa,mu,Cd,_c,C,"Throttled",-0,0),S);break e}av(m,f,ea,E0,Mm,c,xa,mu,Cd,_c,C,null,-0,0)}}break}while(!0);Qo(a)}function av(a,c,f,m,S,C,I,ne,be,qe,rt,xt,He,Je){if(a.timeoutHandle=-1,xt=c.subtreeFlags,xt&8192||(xt&16785408)===16785408){xt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ca},Zy(c,C,xt);var Wt=(C&62914560)===C?N0-Pt():(C&4194048)===C?nv-Pt():0;if(Wt=M3(xt,Wt),Wt!==null){Ul=C,a.cancelPendingCommit=Wt(pv.bind(null,a,c,C,f,m,S,I,ne,be,rt,xt,null,He,Je)),Ec(a,C,I,!qe);return}}pv(a,c,C,f,m,S,I,ne,be)}function e3(a){for(var c=a;;){var f=c.tag;if((f===0||f===11||f===15)&&c.flags&16384&&(f=c.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var m=0;m<f.length;m++){var S=f[m],C=S.getSnapshot;S=S.value;try{if(!Rr(C(),S))return!1}catch{return!1}}if(f=c.child,c.subtreeFlags&16384&&f!==null)f.return=c,c=f;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Ec(a,c,f,m){c&=~Im,c&=~mu,a.suspendedLanes|=c,a.pingedLanes&=~c,m&&(a.warmLanes|=c),m=a.expirationTimes;for(var S=c;0<S;){var C=31-At(S),I=1<<C;m[C]=-1,S&=~I}f!==0&&mt(a,f,c)}function k0(){return(rs&6)===0?(Kh(0),!1):!0}function $m(){if(Mn!==null){if(fs===0)var a=Mn.return;else a=Mn,Ua=Ho=null,md(a),yt=null,Kt=0,a=Mn;for(;a!==null;)Iy(a.alternate,a),a=a.return;Mn=null}}function kd(a,c){var f=a.timeoutHandle;f!==-1&&(a.timeoutHandle=-1,v3(f)),f=a.cancelPendingCommit,f!==null&&(a.cancelPendingCommit=null,f()),Ul=0,$m(),ks=a,Mn=f=qi(a.current,null),$n=c,fs=0,ma=null,_c=!1,Nd=On(a,c),Om=!1,Cd=xa=Im=mu=Ac=cr=0,ea=Wh=null,Mm=!1,(c&8)!==0&&(c|=c&32);var m=a.entangledLanes;if(m!==0)for(a=a.entanglements,m&=c;0<m;){var S=31-At(m),C=1<<S;c|=a[S],m&=~C}return Fl=c,ru(),f}function ov(a,c){rn=null,K.H=Fh,c===_e||c===fe?(c=ot(),fs=3):c===ze?(c=ot(),fs=4):fs=c===vm?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,ma=c,Mn===null&&(cr=1,x0(a,Hi(c,a.current)))}function lv(){var a=Bs.current;return a===null?!0:($n&4194048)===$n?Xn===null:($n&62914560)===$n||($n&536870912)!==0?a===Xn:!1}function cv(){var a=K.H;return K.H=Fh,a===null?Fh:a}function uv(){var a=K.A;return K.A=ZA,a}function j0(){cr=4,_c||($n&4194048)!==$n&&Bs.current!==null||(Nd=!0),(Ac&134217727)===0&&(mu&134217727)===0||ks===null||Ec(ks,$n,xa,!1)}function qm(a,c,f){var m=rs;rs|=2;var S=cv(),C=uv();(ks!==a||$n!==c)&&(E0=null,kd(a,c)),c=!1;var I=cr;e:do try{if(fs!==0&&Mn!==null){var ne=Mn,be=ma;switch(fs){case 8:$m(),I=6;break e;case 3:case 2:case 9:case 6:Bs.current===null&&(c=!0);var qe=fs;if(fs=0,ma=null,jd(a,ne,be,qe),f&&Nd){I=0;break e}break;default:qe=fs,fs=0,ma=null,jd(a,ne,be,qe)}}t3(),I=cr;break}catch(rt){ov(a,rt)}while(!0);return c&&a.shellSuspendCounter++,Ua=Ho=null,rs=m,K.H=S,K.A=C,Mn===null&&(ks=null,$n=0,ru()),I}function t3(){for(;Mn!==null;)dv(Mn)}function n3(a,c){var f=rs;rs|=2;var m=cv(),S=uv();ks!==a||$n!==c?(E0=null,C0=Pt()+500,kd(a,c)):Nd=On(a,c);e:do try{if(fs!==0&&Mn!==null){c=Mn;var C=ma;t:switch(fs){case 1:fs=0,ma=null,jd(a,c,C,1);break;case 2:case 9:if(Be(C)){fs=0,ma=null,hv(c);break}c=function(){fs!==2&&fs!==9||ks!==a||(fs=7),Qo(a)},C.then(c,c);break e;case 3:fs=7;break e;case 4:fs=5;break e;case 7:Be(C)?(fs=0,ma=null,hv(c)):(fs=0,ma=null,jd(a,c,C,7));break;case 5:var I=null;switch(Mn.tag){case 26:I=Mn.memoizedState;case 5:case 27:var ne=Mn;if(I?Jv(I):ne.stateNode.complete){fs=0,ma=null;var be=ne.sibling;if(be!==null)Mn=be;else{var qe=ne.return;qe!==null?(Mn=qe,T0(qe)):Mn=null}break t}}fs=0,ma=null,jd(a,c,C,5);break;case 6:fs=0,ma=null,jd(a,c,C,6);break;case 8:$m(),cr=6;break e;default:throw Error(n(462))}}s3();break}catch(rt){ov(a,rt)}while(!0);return Ua=Ho=null,K.H=m,K.A=S,rs=f,Mn!==null?0:(ks=null,$n=0,ru(),cr)}function s3(){for(;Mn!==null&&!st();)dv(Mn)}function dv(a){var c=By(a.alternate,a,Fl);a.memoizedProps=a.pendingProps,c===null?T0(a):Mn=c}function hv(a){var c=a,f=c.alternate;switch(c.tag){case 15:case 0:c=jy(f,c,c.pendingProps,c.type,void 0,$n);break;case 11:c=jy(f,c,c.pendingProps,c.type.render,c.ref,$n);break;case 5:md(c);default:Iy(f,c),c=Mn=ou(c,Fl),c=By(f,c,Fl)}a.memoizedProps=a.pendingProps,c===null?T0(a):Mn=c}function jd(a,c,f,m){Ua=Ho=null,md(c),yt=null,Kt=0;var S=c.return;try{if(GA(a,S,c,f,$n)){cr=1,x0(a,Hi(f,a.current)),Mn=null;return}}catch(C){if(S!==null)throw Mn=S,C;cr=1,x0(a,Hi(f,a.current)),Mn=null;return}c.flags&32768?(In||m===1?a=!0:Nd||($n&536870912)!==0?a=!1:(_c=a=!0,(m===2||m===9||m===3||m===6)&&(m=Bs.current,m!==null&&m.tag===13&&(m.flags|=16384))),fv(c,a)):T0(c)}function T0(a){var c=a;do{if((c.flags&32768)!==0){fv(c,_c);return}a=c.return;var f=YA(c.alternate,c,Fl);if(f!==null){Mn=f;return}if(c=c.sibling,c!==null){Mn=c;return}Mn=c=a}while(c!==null);cr===0&&(cr=5)}function fv(a,c){do{var f=KA(a.alternate,a);if(f!==null){f.flags&=32767,Mn=f;return}if(f=a.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!c&&(a=a.sibling,a!==null)){Mn=a;return}Mn=a=f}while(a!==null);cr=6,Mn=null}function pv(a,c,f,m,S,C,I,ne,be){a.cancelPendingCommit=null;do D0();while(Fr!==0);if((rs&6)!==0)throw Error(n(327));if(c!==null){if(c===a.current)throw Error(n(177));if(C=c.lanes|c.childLanes,C|=nd,Qe(a,f,C,I,ne,be),a===ks&&(Mn=ks=null,$n=0),Ed=c,Cc=a,Ul=f,Fm=C,Um=S,sv=m,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,o3(Fe,function(){return yv(),null})):(a.callbackNode=null,a.callbackPriority=0),m=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||m){m=K.T,K.T=null,S=se.p,se.p=2,I=rs,rs|=4;try{XA(a,c,f)}finally{rs=I,se.p=S,K.T=m}}Fr=1,gv(),mv(),xv()}}function gv(){if(Fr===1){Fr=0;var a=Cc,c=Ed,f=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||f){f=K.T,K.T=null;var m=se.p;se.p=2;var S=rs;rs|=4;try{Ky(c,a);var C=tx,I=go(a.containerInfo),ne=C.focusedElem,be=C.selectionRange;if(I!==ne&&ne&&ne.ownerDocument&&po(ne.ownerDocument.documentElement,ne)){if(be!==null&&Ma(ne)){var qe=be.start,rt=be.end;if(rt===void 0&&(rt=qe),"selectionStart"in ne)ne.selectionStart=qe,ne.selectionEnd=Math.min(rt,ne.value.length);else{var xt=ne.ownerDocument||document,He=xt&&xt.defaultView||window;if(He.getSelection){var Je=He.getSelection(),Wt=ne.textContent.length,pn=Math.min(be.start,Wt),Ss=be.end===void 0?pn:Math.min(be.end,Wt);!Je.extend&&pn>Ss&&(I=Ss,Ss=pn,pn=I);var Le=dc(ne,pn),Ne=dc(ne,Ss);if(Le&&Ne&&(Je.rangeCount!==1||Je.anchorNode!==Le.node||Je.anchorOffset!==Le.offset||Je.focusNode!==Ne.node||Je.focusOffset!==Ne.offset)){var $e=xt.createRange();$e.setStart(Le.node,Le.offset),Je.removeAllRanges(),pn>Ss?(Je.addRange($e),Je.extend(Ne.node,Ne.offset)):($e.setEnd(Ne.node,Ne.offset),Je.addRange($e))}}}}for(xt=[],Je=ne;Je=Je.parentNode;)Je.nodeType===1&&xt.push({element:Je,left:Je.scrollLeft,top:Je.scrollTop});for(typeof ne.focus=="function"&&ne.focus(),ne=0;ne<xt.length;ne++){var ht=xt[ne];ht.element.scrollLeft=ht.left,ht.element.scrollTop=ht.top}}q0=!!ex,tx=ex=null}finally{rs=S,se.p=m,K.T=f}}a.current=c,Fr=2}}function mv(){if(Fr===2){Fr=0;var a=Cc,c=Ed,f=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||f){f=K.T,K.T=null;var m=se.p;se.p=2;var S=rs;rs|=4;try{Hy(a,c.alternate,c)}finally{rs=S,se.p=m,K.T=f}}Fr=3}}function xv(){if(Fr===4||Fr===3){Fr=0,St();var a=Cc,c=Ed,f=Ul,m=sv;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?Fr=5:(Fr=0,Ed=Cc=null,bv(a,a.pendingLanes));var S=a.pendingLanes;if(S===0&&(Nc=null),Tt(f),c=c.stateNode,wt&&typeof wt.onCommitFiberRoot=="function")try{wt.onCommitFiberRoot(ft,c,void 0,(c.current.flags&128)===128)}catch{}if(m!==null){c=K.T,S=se.p,se.p=2,K.T=null;try{for(var C=a.onRecoverableError,I=0;I<m.length;I++){var ne=m[I];C(ne.value,{componentStack:ne.stack})}}finally{K.T=c,se.p=S}}(Ul&3)!==0&&D0(),Qo(a),S=a.pendingLanes,(f&261930)!==0&&(S&42)!==0?a===zm?Yh++:(Yh=0,zm=a):Yh=0,Kh(0)}}function bv(a,c){(a.pooledCacheLanes&=c)===0&&(c=a.pooledCache,c!=null&&(a.pooledCache=null,uu(c)))}function D0(){return gv(),mv(),xv(),yv()}function yv(){if(Fr!==5)return!1;var a=Cc,c=Fm;Fm=0;var f=Tt(Ul),m=K.T,S=se.p;try{se.p=32>f?32:f,K.T=null,f=Um,Um=null;var C=Cc,I=Ul;if(Fr=0,Ed=Cc=null,Ul=0,(rs&6)!==0)throw Error(n(331));var ne=rs;if(rs|=4,ev(C.current),Jy(C,C.current,I,f),rs=ne,Kh(0,!1),wt&&typeof wt.onPostCommitFiberRoot=="function")try{wt.onPostCommitFiberRoot(ft,C)}catch{}return!0}finally{se.p=S,K.T=m,bv(a,c)}}function vv(a,c,f){c=Hi(f,c),c=ym(a.stateNode,c,2),a=jn(a,c,2),a!==null&&(re(a,2),Qo(a))}function ps(a,c,f){if(a.tag===3)vv(a,a,f);else for(;c!==null;){if(c.tag===3){vv(c,a,f);break}else if(c.tag===1){var m=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Nc===null||!Nc.has(m))){a=Hi(f,a),f=wy(2),m=jn(c,f,2),m!==null&&(Sy(f,m,c,a),re(m,2),Qo(m));break}}c=c.return}}function Hm(a,c,f){var m=a.pingCache;if(m===null){m=a.pingCache=new QA;var S=new Set;m.set(c,S)}else S=m.get(c),S===void 0&&(S=new Set,m.set(c,S));S.has(f)||(Om=!0,S.add(f),a=r3.bind(null,a,c,f),c.then(a,a))}function r3(a,c,f){var m=a.pingCache;m!==null&&m.delete(c),a.pingedLanes|=a.suspendedLanes&f,a.warmLanes&=~f,ks===a&&($n&f)===f&&(cr===4||cr===3&&($n&62914560)===$n&&300>Pt()-N0?(rs&2)===0&&kd(a,0):Im|=f,Cd===$n&&(Cd=0)),Qo(a)}function wv(a,c){c===0&&(c=As()),a=xo(a,c),a!==null&&(re(a,c),Qo(a))}function i3(a){var c=a.memoizedState,f=0;c!==null&&(f=c.retryLane),wv(a,f)}function a3(a,c){var f=0;switch(a.tag){case 31:case 13:var m=a.stateNode,S=a.memoizedState;S!==null&&(f=S.retryLane);break;case 19:m=a.stateNode;break;case 22:m=a.stateNode._retryCache;break;default:throw Error(n(314))}m!==null&&m.delete(c),wv(a,f)}function o3(a,c){return Et(a,c)}var L0=null,Td=null,Gm=!1,R0=!1,Vm=!1,kc=0;function Qo(a){a!==Td&&a.next===null&&(Td===null?L0=Td=a:Td=Td.next=a),R0=!0,Gm||(Gm=!0,c3())}function Kh(a,c){if(!Vm&&R0){Vm=!0;do for(var f=!1,m=L0;m!==null;){if(a!==0){var S=m.pendingLanes;if(S===0)var C=0;else{var I=m.suspendedLanes,ne=m.pingedLanes;C=(1<<31-At(42|a)+1)-1,C&=S&~(I&~ne),C=C&201326741?C&201326741|1:C?C|2:0}C!==0&&(f=!0,Nv(m,C))}else C=$n,C=Yt(m,m===ks?C:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(C&3)===0||On(m,C)||(f=!0,Nv(m,C));m=m.next}while(f);Vm=!1}}function l3(){Sv()}function Sv(){R0=Gm=!1;var a=0;kc!==0&&y3()&&(a=kc);for(var c=Pt(),f=null,m=L0;m!==null;){var S=m.next,C=_v(m,c);C===0?(m.next=null,f===null?L0=S:f.next=S,S===null&&(Td=f)):(f=m,(a!==0||(C&3)!==0)&&(R0=!0)),m=S}Fr!==0&&Fr!==5||Kh(a),kc!==0&&(kc=0)}function _v(a,c){for(var f=a.suspendedLanes,m=a.pingedLanes,S=a.expirationTimes,C=a.pendingLanes&-62914561;0<C;){var I=31-At(C),ne=1<<I,be=S[I];be===-1?((ne&f)===0||(ne&m)!==0)&&(S[I]=an(ne,c)):be<=c&&(a.expiredLanes|=ne),C&=~ne}if(c=ks,f=$n,f=Yt(a,a===c?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m=a.callbackNode,f===0||a===c&&(fs===2||fs===9)||a.cancelPendingCommit!==null)return m!==null&&m!==null&&vt(m),a.callbackNode=null,a.callbackPriority=0;if((f&3)===0||On(a,f)){if(c=f&-f,c===a.callbackPriority)return c;switch(m!==null&&vt(m),Tt(f)){case 2:case 8:f=Me;break;case 32:f=Fe;break;case 268435456:f=Te;break;default:f=Fe}return m=Av.bind(null,a),f=Et(f,m),a.callbackPriority=c,a.callbackNode=f,c}return m!==null&&m!==null&&vt(m),a.callbackPriority=2,a.callbackNode=null,2}function Av(a,c){if(Fr!==0&&Fr!==5)return a.callbackNode=null,a.callbackPriority=0,null;var f=a.callbackNode;if(D0()&&a.callbackNode!==f)return null;var m=$n;return m=Yt(a,a===ks?m:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m===0?null:(iv(a,m,c),_v(a,Pt()),a.callbackNode!=null&&a.callbackNode===f?Av.bind(null,a):null)}function Nv(a,c){if(D0())return null;iv(a,c,!0)}function c3(){w3(function(){(rs&6)!==0?Et(je,l3):Sv()})}function Wm(){if(kc===0){var a=y;a===0&&(a=It,It<<=1,(It&261888)===0&&(It=256)),kc=a}return kc}function Cv(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:mi(""+a)}function Ev(a,c){var f=c.ownerDocument.createElement("input");return f.name=c.name,f.value=c.value,a.id&&f.setAttribute("form",a.id),c.parentNode.insertBefore(f,c),a=new FormData(a),f.parentNode.removeChild(f),a}function u3(a,c,f,m,S){if(c==="submit"&&f&&f.stateNode===S){var C=Cv((S[jt]||null).action),I=m.submitter;I&&(c=(c=I[jt]||null)?Cv(c.formAction):I.getAttribute("formAction"),c!==null&&(C=c,I=null));var ne=new Ui("action","action",null,m,S);a.push({event:ne,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(kc!==0){var be=I?Ev(S,I):new FormData(S);fm(f,{pending:!0,data:be,method:S.method,action:C},null,be)}}else typeof C=="function"&&(ne.preventDefault(),be=I?Ev(S,I):new FormData(S),fm(f,{pending:!0,data:be,method:S.method,action:C},C,be))},currentTarget:S}]})}}for(var Ym=0;Ym<Nl.length;Ym++){var Km=Nl[Ym],d3=Km.toLowerCase(),h3=Km[0].toUpperCase()+Km.slice(1);$i(d3,"on"+h3)}$i(Al,"onAnimationEnd"),$i(nu,"onAnimationIteration"),$i(Ah,"onAnimationStart"),$i("dblclick","onDoubleClick"),$i("focusin","onFocus"),$i("focusout","onBlur"),$i(r0,"onTransitionRun"),$i(i0,"onTransitionStart"),$i(a0,"onTransitionCancel"),$i(Nh,"onTransitionEnd"),gi("onMouseEnter",["mouseout","mouseover"]),gi("onMouseLeave",["mouseout","mouseover"]),gi("onPointerEnter",["pointerout","pointerover"]),gi("onPointerLeave",["pointerout","pointerover"]),ki("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ki("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ki("onBeforeInput",["compositionend","keypress","textInput","paste"]),ki("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ki("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ki("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),f3=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Xh));function kv(a,c){c=(c&4)!==0;for(var f=0;f<a.length;f++){var m=a[f],S=m.event;m=m.listeners;e:{var C=void 0;if(c)for(var I=m.length-1;0<=I;I--){var ne=m[I],be=ne.instance,qe=ne.currentTarget;if(ne=ne.listener,be!==C&&S.isPropagationStopped())break e;C=ne,S.currentTarget=qe;try{C(S)}catch(rt){su(rt)}S.currentTarget=null,C=be}else for(I=0;I<m.length;I++){if(ne=m[I],be=ne.instance,qe=ne.currentTarget,ne=ne.listener,be!==C&&S.isPropagationStopped())break e;C=ne,S.currentTarget=qe;try{C(S)}catch(rt){su(rt)}S.currentTarget=null,C=be}}}}function Fn(a,c){var f=c[sn];f===void 0&&(f=c[sn]=new Set);var m=a+"__bubble";f.has(m)||(jv(c,a,2,!1),f.add(m))}function Xm(a,c,f){var m=0;c&&(m|=4),jv(f,a,m,c)}var P0="_reactListening"+Math.random().toString(36).slice(2);function Jm(a){if(!a[P0]){a[P0]=!0,pl.forEach(function(f){f!=="selectionchange"&&(f3.has(f)||Xm(f,!1,a),Xm(f,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[P0]||(c[P0]=!0,Xm("selectionchange",!1,c))}}function jv(a,c,f,m){switch(r2(c)){case 2:var S=z3;break;case 8:S=$3;break;default:S=hx}f=S.bind(null,c,f,a),S=void 0,!Jc||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(S=!0),m?S!==void 0?a.addEventListener(c,f,{capture:!0,passive:S}):a.addEventListener(c,f,!0):S!==void 0?a.addEventListener(c,f,{passive:S}):a.addEventListener(c,f,!1)}function Zm(a,c,f,m,S){var C=m;if((c&1)===0&&(c&2)===0&&m!==null)e:for(;;){if(m===null)return;var I=m.tag;if(I===3||I===4){var ne=m.stateNode.containerInfo;if(ne===S)break;if(I===4)for(I=m.return;I!==null;){var be=I.tag;if((be===3||be===4)&&I.stateNode.containerInfo===S)return;I=I.return}for(;ne!==null;){if(I=Tr(ne),I===null)return;if(be=I.tag,be===5||be===6||be===26||be===27){m=C=I;continue e}ne=ne.parentNode}}m=m.return}Ju(function(){var qe=C,rt=xl(f),xt=[];e:{var He=Ch.get(a);if(He!==void 0){var Je=Ui,Wt=a;switch(a){case"keypress":if(Fi(f)===0)break e;case"keydown":case"keyup":Je=Hn;break;case"focusin":Wt="focus",Je=io;break;case"focusout":Wt="blur",Je=io;break;case"beforeblur":case"afterblur":Je=io;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Je=Zc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Je=ro;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Je=fr;break;case Al:case nu:case Ah:Je=j;break;case Nh:Je=Lr;break;case"scroll":case"scrollend":Je=rc;break;case"wheel":Je=ua;break;case"copy":case"cut":case"paste":Je=ge;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Je=Ws;break;case"toggle":case"beforetoggle":Je=Qc}var pn=(c&4)!==0,Ss=!pn&&(a==="scroll"||a==="scrollend"),Le=pn?He!==null?He+"Capture":null:He;pn=[];for(var Ne=qe,$e;Ne!==null;){var ht=Ne;if($e=ht.stateNode,ht=ht.tag,ht!==5&&ht!==26&&ht!==27||$e===null||Le===null||(ht=Ti(Ne,Le),ht!=null&&pn.push(Jh(Ne,ht,$e))),Ss)break;Ne=Ne.return}0<pn.length&&(He=new Je(He,Wt,null,f,rt),xt.push({event:He,listeners:pn}))}}if((c&7)===0){e:{if(He=a==="mouseover"||a==="pointerover",Je=a==="mouseout"||a==="pointerout",He&&f!==Qa&&(Wt=f.relatedTarget||f.fromElement)&&(Tr(Wt)||Wt[dt]))break e;if((Je||He)&&(He=rt.window===rt?rt:(He=rt.ownerDocument)?He.defaultView||He.parentWindow:window,Je?(Wt=f.relatedTarget||f.toElement,Je=qe,Wt=Wt?Tr(Wt):null,Wt!==null&&(Ss=i(Wt),pn=Wt.tag,Wt!==Ss||pn!==5&&pn!==27&&pn!==6)&&(Wt=null)):(Je=null,Wt=qe),Je!==Wt)){if(pn=Zc,ht="onMouseLeave",Le="onMouseEnter",Ne="mouse",(a==="pointerout"||a==="pointerover")&&(pn=Ws,ht="onPointerLeave",Le="onPointerEnter",Ne="pointer"),Ss=Je==null?He:Za(Je),$e=Wt==null?He:Za(Wt),He=new pn(ht,Ne+"leave",Je,f,rt),He.target=Ss,He.relatedTarget=$e,ht=null,Tr(rt)===qe&&(pn=new pn(Le,Ne+"enter",Wt,f,rt),pn.target=$e,pn.relatedTarget=Ss,ht=pn),Ss=ht,Je&&Wt)t:{for(pn=p3,Le=Je,Ne=Wt,$e=0,ht=Le;ht;ht=pn(ht))$e++;ht=0;for(var ln=Ne;ln;ln=pn(ln))ht++;for(;0<$e-ht;)Le=pn(Le),$e--;for(;0<ht-$e;)Ne=pn(Ne),ht--;for(;$e--;){if(Le===Ne||Ne!==null&&Le===Ne.alternate){pn=Le;break t}Le=pn(Le),Ne=pn(Ne)}pn=null}else pn=null;Je!==null&&Tv(xt,He,Je,pn,!1),Wt!==null&&Ss!==null&&Tv(xt,Ss,Wt,pn,!0)}}e:{if(He=qe?Za(qe):window,Je=He.nodeName&&He.nodeName.toLowerCase(),Je==="select"||Je==="input"&&He.type==="file")var es=Uo;else if(eu(He))if(xi)es=Oa;else{es=Ys;var Qt=cc}else Je=He.nodeName,!Je||Je.toLowerCase()!=="input"||He.type!=="checkbox"&&He.type!=="radio"?qe&&Oo(qe.elementType)&&(es=Uo):es=td;if(es&&(es=es(a,qe))){Li(xt,es,f,rt);break e}Qt&&Qt(a,He,qe),a==="focusout"&&qe&&He.type==="number"&&qe.memoizedProps.value!=null&&Dn(He,"number",He.value)}switch(Qt=qe?Za(qe):window,a){case"focusin":(eu(Qt)||Qt.contentEditable==="true")&&(Ri=Qt,mo=qe,Gr=null);break;case"focusout":Gr=mo=Ri=null;break;case"mousedown":zi=!0;break;case"contextmenu":case"mouseup":case"dragend":zi=!1,Zn(xt,f,rt);break;case"selectionchange":if(_l)break;case"keydown":case"keyup":Zn(xt,f,rt)}var Ln;if(La)e:{switch(a){case"compositionstart":var qn="onCompositionStart";break e;case"compositionend":qn="onCompositionEnd";break e;case"compositionupdate":qn="onCompositionUpdate";break e}qn=void 0}else Ra?Fo(a,f)&&(qn="onCompositionEnd"):a==="keydown"&&f.keyCode===229&&(qn="onCompositionStart");qn&&(lo&&f.locale!=="ko"&&(Ra||qn!=="onCompositionStart"?qn==="onCompositionEnd"&&Ra&&(Ln=Zu()):(Di=rt,yl="value"in Di?Di.value:Di.textContent,Ra=!0)),Qt=B0(qe,qn),0<Qt.length&&(qn=new De(qn,a,null,f,rt),xt.push({event:qn,listeners:Qt}),Ln?qn.data=Ln:(Ln=ac(f),Ln!==null&&(qn.data=Ln)))),(Ln=Sl?ri(a,f):co(a,f))&&(qn=B0(qe,"onBeforeInput"),0<qn.length&&(Qt=new De("onBeforeInput","beforeinput",null,f,rt),xt.push({event:Qt,listeners:qn}),Qt.data=Ln)),u3(xt,a,qe,f,rt)}kv(xt,c)})}function Jh(a,c,f){return{instance:a,listener:c,currentTarget:f}}function B0(a,c){for(var f=c+"Capture",m=[];a!==null;){var S=a,C=S.stateNode;if(S=S.tag,S!==5&&S!==26&&S!==27||C===null||(S=Ti(a,f),S!=null&&m.unshift(Jh(a,S,C)),S=Ti(a,c),S!=null&&m.push(Jh(a,S,C))),a.tag===3)return m;a=a.return}return[]}function p3(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Tv(a,c,f,m,S){for(var C=c._reactName,I=[];f!==null&&f!==m;){var ne=f,be=ne.alternate,qe=ne.stateNode;if(ne=ne.tag,be!==null&&be===m)break;ne!==5&&ne!==26&&ne!==27||qe===null||(be=qe,S?(qe=Ti(f,C),qe!=null&&I.unshift(Jh(f,qe,be))):S||(qe=Ti(f,C),qe!=null&&I.push(Jh(f,qe,be)))),f=f.return}I.length!==0&&a.push({event:c,listeners:I})}var g3=/\r\n?/g,m3=/\u0000|\uFFFD/g;function Dv(a){return(typeof a=="string"?a:""+a).replace(g3,`
`).replace(m3,"")}function Lv(a,c){return c=Dv(c),Dv(a)===c}function ws(a,c,f,m,S,C){switch(f){case"children":typeof m=="string"?c==="body"||c==="textarea"&&m===""||bn(a,m):(typeof m=="number"||typeof m=="bigint")&&c!=="body"&&bn(a,""+m);break;case"className":la(a,"class",m);break;case"tabIndex":la(a,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":la(a,f,m);break;case"style":ja(a,m,C);break;case"data":if(c!=="object"){la(a,"data",m);break}case"src":case"href":if(m===""&&(c!=="a"||f!=="href")){a.removeAttribute(f);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(f);break}m=mi(""+m),a.setAttribute(f,m);break;case"action":case"formAction":if(typeof m=="function"){a.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof C=="function"&&(f==="formAction"?(c!=="input"&&ws(a,c,"name",S.name,S,null),ws(a,c,"formEncType",S.formEncType,S,null),ws(a,c,"formMethod",S.formMethod,S,null),ws(a,c,"formTarget",S.formTarget,S,null)):(ws(a,c,"encType",S.encType,S,null),ws(a,c,"method",S.method,S,null),ws(a,c,"target",S.target,S,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(f);break}m=mi(""+m),a.setAttribute(f,m);break;case"onClick":m!=null&&(a.onclick=ca);break;case"onScroll":m!=null&&Fn("scroll",a);break;case"onScrollEnd":m!=null&&Fn("scrollend",a);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(f=m.__html,f!=null){if(S.children!=null)throw Error(n(60));a.innerHTML=f}}break;case"multiple":a.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":a.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){a.removeAttribute("xlink:href");break}f=mi(""+m),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(f,""+m):a.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(f,""):a.removeAttribute(f);break;case"capture":case"download":m===!0?a.setAttribute(f,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(f,m):a.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?a.setAttribute(f,m):a.removeAttribute(f);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?a.removeAttribute(f):a.setAttribute(f,m);break;case"popover":Fn("beforetoggle",a),Fn("toggle",a),si(a,"popover",m);break;case"xlinkActuate":ji(a,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":ji(a,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":ji(a,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":ji(a,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":ji(a,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":ji(a,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":ji(a,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":ji(a,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":ji(a,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":si(a,"is",m);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=Kc.get(f)||f,si(a,f,m))}}function Qm(a,c,f,m,S,C){switch(f){case"style":ja(a,m,C);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(f=m.__html,f!=null){if(S.children!=null)throw Error(n(60));a.innerHTML=f}}break;case"children":typeof m=="string"?bn(a,m):(typeof m=="number"||typeof m=="bigint")&&bn(a,""+m);break;case"onScroll":m!=null&&Fn("scroll",a);break;case"onScrollEnd":m!=null&&Fn("scrollend",a);break;case"onClick":m!=null&&(a.onclick=ca);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ni.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(S=f.endsWith("Capture"),c=f.slice(2,S?f.length-7:void 0),C=a[jt]||null,C=C!=null?C[f]:null,typeof C=="function"&&a.removeEventListener(c,C,S),typeof m=="function")){typeof C!="function"&&C!==null&&(f in a?a[f]=null:a.hasAttribute(f)&&a.removeAttribute(f)),a.addEventListener(c,m,S);break e}f in a?a[f]=m:m===!0?a.setAttribute(f,""):si(a,f,m)}}}function ci(a,c,f){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Fn("error",a),Fn("load",a);var m=!1,S=!1,C;for(C in f)if(f.hasOwnProperty(C)){var I=f[C];if(I!=null)switch(C){case"src":m=!0;break;case"srcSet":S=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:ws(a,c,C,I,f,null)}}S&&ws(a,c,"srcSet",f.srcSet,f,null),m&&ws(a,c,"src",f.src,f,null);return;case"input":Fn("invalid",a);var ne=C=I=S=null,be=null,qe=null;for(m in f)if(f.hasOwnProperty(m)){var rt=f[m];if(rt!=null)switch(m){case"name":S=rt;break;case"type":I=rt;break;case"checked":be=rt;break;case"defaultChecked":qe=rt;break;case"value":C=rt;break;case"defaultValue":ne=rt;break;case"children":case"dangerouslySetInnerHTML":if(rt!=null)throw Error(n(137,c));break;default:ws(a,c,m,rt,f,null)}}fn(a,C,ne,be,qe,I,S,!1);return;case"select":Fn("invalid",a),m=I=C=null;for(S in f)if(f.hasOwnProperty(S)&&(ne=f[S],ne!=null))switch(S){case"value":C=ne;break;case"defaultValue":I=ne;break;case"multiple":m=ne;default:ws(a,c,S,ne,f,null)}c=C,f=I,a.multiple=!!m,c!=null?Ot(a,!!m,c,!1):f!=null&&Ot(a,!!m,f,!0);return;case"textarea":Fn("invalid",a),C=S=m=null;for(I in f)if(f.hasOwnProperty(I)&&(ne=f[I],ne!=null))switch(I){case"value":m=ne;break;case"defaultValue":S=ne;break;case"children":C=ne;break;case"dangerouslySetInnerHTML":if(ne!=null)throw Error(n(91));break;default:ws(a,c,I,ne,f,null)}ms(a,m,S,C);return;case"option":for(be in f)f.hasOwnProperty(be)&&(m=f[be],m!=null)&&(be==="selected"?a.selected=m&&typeof m!="function"&&typeof m!="symbol":ws(a,c,be,m,f,null));return;case"dialog":Fn("beforetoggle",a),Fn("toggle",a),Fn("cancel",a),Fn("close",a);break;case"iframe":case"object":Fn("load",a);break;case"video":case"audio":for(m=0;m<Xh.length;m++)Fn(Xh[m],a);break;case"image":Fn("error",a),Fn("load",a);break;case"details":Fn("toggle",a);break;case"embed":case"source":case"link":Fn("error",a),Fn("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(qe in f)if(f.hasOwnProperty(qe)&&(m=f[qe],m!=null))switch(qe){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:ws(a,c,qe,m,f,null)}return;default:if(Oo(c)){for(rt in f)f.hasOwnProperty(rt)&&(m=f[rt],m!==void 0&&Qm(a,c,rt,m,f,void 0));return}}for(ne in f)f.hasOwnProperty(ne)&&(m=f[ne],m!=null&&ws(a,c,ne,m,f,null))}function x3(a,c,f,m){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var S=null,C=null,I=null,ne=null,be=null,qe=null,rt=null;for(Je in f){var xt=f[Je];if(f.hasOwnProperty(Je)&&xt!=null)switch(Je){case"checked":break;case"value":break;case"defaultValue":be=xt;default:m.hasOwnProperty(Je)||ws(a,c,Je,null,m,xt)}}for(var He in m){var Je=m[He];if(xt=f[He],m.hasOwnProperty(He)&&(Je!=null||xt!=null))switch(He){case"type":C=Je;break;case"name":S=Je;break;case"checked":qe=Je;break;case"defaultChecked":rt=Je;break;case"value":I=Je;break;case"defaultValue":ne=Je;break;case"children":case"dangerouslySetInnerHTML":if(Je!=null)throw Error(n(137,c));break;default:Je!==xt&&ws(a,c,He,Je,m,xt)}}Lt(a,I,ne,be,qe,rt,C,S);return;case"select":Je=I=ne=He=null;for(C in f)if(be=f[C],f.hasOwnProperty(C)&&be!=null)switch(C){case"value":break;case"multiple":Je=be;default:m.hasOwnProperty(C)||ws(a,c,C,null,m,be)}for(S in m)if(C=m[S],be=f[S],m.hasOwnProperty(S)&&(C!=null||be!=null))switch(S){case"value":He=C;break;case"defaultValue":ne=C;break;case"multiple":I=C;default:C!==be&&ws(a,c,S,C,m,be)}c=ne,f=I,m=Je,He!=null?Ot(a,!!f,He,!1):!!m!=!!f&&(c!=null?Ot(a,!!f,c,!0):Ot(a,!!f,f?[]:"",!1));return;case"textarea":Je=He=null;for(ne in f)if(S=f[ne],f.hasOwnProperty(ne)&&S!=null&&!m.hasOwnProperty(ne))switch(ne){case"value":break;case"children":break;default:ws(a,c,ne,null,m,S)}for(I in m)if(S=m[I],C=f[I],m.hasOwnProperty(I)&&(S!=null||C!=null))switch(I){case"value":He=S;break;case"defaultValue":Je=S;break;case"children":break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(n(91));break;default:S!==C&&ws(a,c,I,S,m,C)}Ft(a,He,Je);return;case"option":for(var Wt in f)He=f[Wt],f.hasOwnProperty(Wt)&&He!=null&&!m.hasOwnProperty(Wt)&&(Wt==="selected"?a.selected=!1:ws(a,c,Wt,null,m,He));for(be in m)He=m[be],Je=f[be],m.hasOwnProperty(be)&&He!==Je&&(He!=null||Je!=null)&&(be==="selected"?a.selected=He&&typeof He!="function"&&typeof He!="symbol":ws(a,c,be,He,m,Je));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var pn in f)He=f[pn],f.hasOwnProperty(pn)&&He!=null&&!m.hasOwnProperty(pn)&&ws(a,c,pn,null,m,He);for(qe in m)if(He=m[qe],Je=f[qe],m.hasOwnProperty(qe)&&He!==Je&&(He!=null||Je!=null))switch(qe){case"children":case"dangerouslySetInnerHTML":if(He!=null)throw Error(n(137,c));break;default:ws(a,c,qe,He,m,Je)}return;default:if(Oo(c)){for(var Ss in f)He=f[Ss],f.hasOwnProperty(Ss)&&He!==void 0&&!m.hasOwnProperty(Ss)&&Qm(a,c,Ss,void 0,m,He);for(rt in m)He=m[rt],Je=f[rt],!m.hasOwnProperty(rt)||He===Je||He===void 0&&Je===void 0||Qm(a,c,rt,He,m,Je);return}}for(var Le in f)He=f[Le],f.hasOwnProperty(Le)&&He!=null&&!m.hasOwnProperty(Le)&&ws(a,c,Le,null,m,He);for(xt in m)He=m[xt],Je=f[xt],!m.hasOwnProperty(xt)||He===Je||He==null&&Je==null||ws(a,c,xt,He,m,Je)}function Rv(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function b3(){if(typeof performance.getEntriesByType=="function"){for(var a=0,c=0,f=performance.getEntriesByType("resource"),m=0;m<f.length;m++){var S=f[m],C=S.transferSize,I=S.initiatorType,ne=S.duration;if(C&&ne&&Rv(I)){for(I=0,ne=S.responseEnd,m+=1;m<f.length;m++){var be=f[m],qe=be.startTime;if(qe>ne)break;var rt=be.transferSize,xt=be.initiatorType;rt&&Rv(xt)&&(be=be.responseEnd,I+=rt*(be<ne?1:(ne-qe)/(be-qe)))}if(--m,c+=8*(C+I)/(S.duration/1e3),a++,10<a)break}}if(0<a)return c/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var ex=null,tx=null;function O0(a){return a.nodeType===9?a:a.ownerDocument}function Pv(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Bv(a,c){if(a===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&c==="foreignObject"?0:a}function nx(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var sx=null;function y3(){var a=window.event;return a&&a.type==="popstate"?a===sx?!1:(sx=a,!0):(sx=null,!1)}var Ov=typeof setTimeout=="function"?setTimeout:void 0,v3=typeof clearTimeout=="function"?clearTimeout:void 0,Iv=typeof Promise=="function"?Promise:void 0,w3=typeof queueMicrotask=="function"?queueMicrotask:typeof Iv<"u"?function(a){return Iv.resolve(null).then(a).catch(S3)}:Ov;function S3(a){setTimeout(function(){throw a})}function jc(a){return a==="head"}function Mv(a,c){var f=c,m=0;do{var S=f.nextSibling;if(a.removeChild(f),S&&S.nodeType===8)if(f=S.data,f==="/$"||f==="/&"){if(m===0){a.removeChild(S),Pd(c);return}m--}else if(f==="$"||f==="$?"||f==="$~"||f==="$!"||f==="&")m++;else if(f==="html")Zh(a.ownerDocument.documentElement);else if(f==="head"){f=a.ownerDocument.head,Zh(f);for(var C=f.firstChild;C;){var I=C.nextSibling,ne=C.nodeName;C[Ns]||ne==="SCRIPT"||ne==="STYLE"||ne==="LINK"&&C.rel.toLowerCase()==="stylesheet"||f.removeChild(C),C=I}}else f==="body"&&Zh(a.ownerDocument.body);f=S}while(f);Pd(c)}function Fv(a,c){var f=a;a=0;do{var m=f.nextSibling;if(f.nodeType===1?c?(f._stashedDisplay=f.style.display,f.style.display="none"):(f.style.display=f._stashedDisplay||"",f.getAttribute("style")===""&&f.removeAttribute("style")):f.nodeType===3&&(c?(f._stashedText=f.nodeValue,f.nodeValue=""):f.nodeValue=f._stashedText||""),m&&m.nodeType===8)if(f=m.data,f==="/$"){if(a===0)break;a--}else f!=="$"&&f!=="$?"&&f!=="$~"&&f!=="$!"||a++;f=m}while(f)}function rx(a){var c=a.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var f=c;switch(c=c.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":rx(f),Hr(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}a.removeChild(f)}}function _3(a,c,f,m){for(;a.nodeType===1;){var S=f;if(a.nodeName.toLowerCase()!==c.toLowerCase()){if(!m&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(m){if(!a[Ns])switch(c){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(C=a.getAttribute("rel"),C==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(C!==S.rel||a.getAttribute("href")!==(S.href==null||S.href===""?null:S.href)||a.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin)||a.getAttribute("title")!==(S.title==null?null:S.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(C=a.getAttribute("src"),(C!==(S.src==null?null:S.src)||a.getAttribute("type")!==(S.type==null?null:S.type)||a.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin))&&C&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(c==="input"&&a.type==="hidden"){var C=S.name==null?null:""+S.name;if(S.type==="hidden"&&a.getAttribute("name")===C)return a}else return a;if(a=qa(a.nextSibling),a===null)break}return null}function A3(a,c,f){if(c==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!f||(a=qa(a.nextSibling),a===null))return null;return a}function Uv(a,c){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!c||(a=qa(a.nextSibling),a===null))return null;return a}function ix(a){return a.data==="$?"||a.data==="$~"}function ax(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function N3(a,c){var f=a.ownerDocument;if(a.data==="$~")a._reactRetry=c;else if(a.data!=="$?"||f.readyState!=="loading")c();else{var m=function(){c(),f.removeEventListener("DOMContentLoaded",m)};f.addEventListener("DOMContentLoaded",m),a._reactRetry=m}}function qa(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"||c==="F!"||c==="F")break;if(c==="/$"||c==="/&")return null}}return a}var ox=null;function zv(a){a=a.nextSibling;for(var c=0;a;){if(a.nodeType===8){var f=a.data;if(f==="/$"||f==="/&"){if(c===0)return qa(a.nextSibling);c--}else f!=="$"&&f!=="$!"&&f!=="$?"&&f!=="$~"&&f!=="&"||c++}a=a.nextSibling}return null}function $v(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var f=a.data;if(f==="$"||f==="$!"||f==="$?"||f==="$~"||f==="&"){if(c===0)return a;c--}else f!=="/$"&&f!=="/&"||c++}a=a.previousSibling}return null}function qv(a,c,f){switch(c=O0(f),a){case"html":if(a=c.documentElement,!a)throw Error(n(452));return a;case"head":if(a=c.head,!a)throw Error(n(453));return a;case"body":if(a=c.body,!a)throw Error(n(454));return a;default:throw Error(n(451))}}function Zh(a){for(var c=a.attributes;c.length;)a.removeAttributeNode(c[0]);Hr(a)}var Ha=new Map,Hv=new Set;function I0(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var zl=se.d;se.d={f:C3,r:E3,D:k3,C:j3,L:T3,m:D3,X:R3,S:L3,M:P3};function C3(){var a=zl.f(),c=k0();return a||c}function E3(a){var c=Ci(a);c!==null&&c.tag===5&&c.type==="form"?oy(c):zl.r(a)}var Dd=typeof document>"u"?null:document;function Gv(a,c,f){var m=Dd;if(m&&typeof c=="string"&&c){var S=Ct(c);S='link[rel="'+a+'"][href="'+S+'"]',typeof f=="string"&&(S+='[crossorigin="'+f+'"]'),Hv.has(S)||(Hv.add(S),a={rel:a,crossOrigin:f,href:c},m.querySelector(S)===null&&(c=m.createElement("link"),ci(c,"link",a),Ds(c),m.head.appendChild(c)))}}function k3(a){zl.D(a),Gv("dns-prefetch",a,null)}function j3(a,c){zl.C(a,c),Gv("preconnect",a,c)}function T3(a,c,f){zl.L(a,c,f);var m=Dd;if(m&&a&&c){var S='link[rel="preload"][as="'+Ct(c)+'"]';c==="image"&&f&&f.imageSrcSet?(S+='[imagesrcset="'+Ct(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(S+='[imagesizes="'+Ct(f.imageSizes)+'"]')):S+='[href="'+Ct(a)+'"]';var C=S;switch(c){case"style":C=Ld(a);break;case"script":C=Rd(a)}Ha.has(C)||(a=g({rel:"preload",href:c==="image"&&f&&f.imageSrcSet?void 0:a,as:c},f),Ha.set(C,a),m.querySelector(S)!==null||c==="style"&&m.querySelector(Qh(C))||c==="script"&&m.querySelector(ef(C))||(c=m.createElement("link"),ci(c,"link",a),Ds(c),m.head.appendChild(c)))}}function D3(a,c){zl.m(a,c);var f=Dd;if(f&&a){var m=c&&typeof c.as=="string"?c.as:"script",S='link[rel="modulepreload"][as="'+Ct(m)+'"][href="'+Ct(a)+'"]',C=S;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":C=Rd(a)}if(!Ha.has(C)&&(a=g({rel:"modulepreload",href:a},c),Ha.set(C,a),f.querySelector(S)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(ef(C)))return}m=f.createElement("link"),ci(m,"link",a),Ds(m),f.head.appendChild(m)}}}function L3(a,c,f){zl.S(a,c,f);var m=Dd;if(m&&a){var S=Ei(m).hoistableStyles,C=Ld(a);c=c||"default";var I=S.get(C);if(!I){var ne={loading:0,preload:null};if(I=m.querySelector(Qh(C)))ne.loading=5;else{a=g({rel:"stylesheet",href:a,"data-precedence":c},f),(f=Ha.get(C))&&lx(a,f);var be=I=m.createElement("link");Ds(be),ci(be,"link",a),be._p=new Promise(function(qe,rt){be.onload=qe,be.onerror=rt}),be.addEventListener("load",function(){ne.loading|=1}),be.addEventListener("error",function(){ne.loading|=2}),ne.loading|=4,M0(I,c,m)}I={type:"stylesheet",instance:I,count:1,state:ne},S.set(C,I)}}}function R3(a,c){zl.X(a,c);var f=Dd;if(f&&a){var m=Ei(f).hoistableScripts,S=Rd(a),C=m.get(S);C||(C=f.querySelector(ef(S)),C||(a=g({src:a,async:!0},c),(c=Ha.get(S))&&cx(a,c),C=f.createElement("script"),Ds(C),ci(C,"link",a),f.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},m.set(S,C))}}function P3(a,c){zl.M(a,c);var f=Dd;if(f&&a){var m=Ei(f).hoistableScripts,S=Rd(a),C=m.get(S);C||(C=f.querySelector(ef(S)),C||(a=g({src:a,async:!0,type:"module"},c),(c=Ha.get(S))&&cx(a,c),C=f.createElement("script"),Ds(C),ci(C,"link",a),f.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},m.set(S,C))}}function Vv(a,c,f,m){var S=(S=de.current)?I0(S):null;if(!S)throw Error(n(446));switch(a){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(c=Ld(f.href),f=Ei(S).hoistableStyles,m=f.get(c),m||(m={type:"style",instance:null,count:0,state:null},f.set(c,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){a=Ld(f.href);var C=Ei(S).hoistableStyles,I=C.get(a);if(I||(S=S.ownerDocument||S,I={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},C.set(a,I),(C=S.querySelector(Qh(a)))&&!C._p&&(I.instance=C,I.state.loading=5),Ha.has(a)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},Ha.set(a,f),C||B3(S,a,f,I.state))),c&&m===null)throw Error(n(528,""));return I}if(c&&m!==null)throw Error(n(529,""));return null;case"script":return c=f.async,f=f.src,typeof f=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=Rd(f),f=Ei(S).hoistableScripts,m=f.get(c),m||(m={type:"script",instance:null,count:0,state:null},f.set(c,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,a))}}function Ld(a){return'href="'+Ct(a)+'"'}function Qh(a){return'link[rel="stylesheet"]['+a+"]"}function Wv(a){return g({},a,{"data-precedence":a.precedence,precedence:null})}function B3(a,c,f,m){a.querySelector('link[rel="preload"][as="style"]['+c+"]")?m.loading=1:(c=a.createElement("link"),m.preload=c,c.addEventListener("load",function(){return m.loading|=1}),c.addEventListener("error",function(){return m.loading|=2}),ci(c,"link",f),Ds(c),a.head.appendChild(c))}function Rd(a){return'[src="'+Ct(a)+'"]'}function ef(a){return"script[async]"+a}function Yv(a,c,f){if(c.count++,c.instance===null)switch(c.type){case"style":var m=a.querySelector('style[data-href~="'+Ct(f.href)+'"]');if(m)return c.instance=m,Ds(m),m;var S=g({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return m=(a.ownerDocument||a).createElement("style"),Ds(m),ci(m,"style",S),M0(m,f.precedence,a),c.instance=m;case"stylesheet":S=Ld(f.href);var C=a.querySelector(Qh(S));if(C)return c.state.loading|=4,c.instance=C,Ds(C),C;m=Wv(f),(S=Ha.get(S))&&lx(m,S),C=(a.ownerDocument||a).createElement("link"),Ds(C);var I=C;return I._p=new Promise(function(ne,be){I.onload=ne,I.onerror=be}),ci(C,"link",m),c.state.loading|=4,M0(C,f.precedence,a),c.instance=C;case"script":return C=Rd(f.src),(S=a.querySelector(ef(C)))?(c.instance=S,Ds(S),S):(m=f,(S=Ha.get(C))&&(m=g({},f),cx(m,S)),a=a.ownerDocument||a,S=a.createElement("script"),Ds(S),ci(S,"link",m),a.head.appendChild(S),c.instance=S);case"void":return null;default:throw Error(n(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(m=c.instance,c.state.loading|=4,M0(m,f.precedence,a));return c.instance}function M0(a,c,f){for(var m=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),S=m.length?m[m.length-1]:null,C=S,I=0;I<m.length;I++){var ne=m[I];if(ne.dataset.precedence===c)C=ne;else if(C!==S)break}C?C.parentNode.insertBefore(a,C.nextSibling):(c=f.nodeType===9?f.head:f,c.insertBefore(a,c.firstChild))}function lx(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.title==null&&(a.title=c.title)}function cx(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.integrity==null&&(a.integrity=c.integrity)}var F0=null;function Kv(a,c,f){if(F0===null){var m=new Map,S=F0=new Map;S.set(f,m)}else S=F0,m=S.get(f),m||(m=new Map,S.set(f,m));if(m.has(a))return m;for(m.set(a,null),f=f.getElementsByTagName(a),S=0;S<f.length;S++){var C=f[S];if(!(C[Ns]||C[wn]||a==="link"&&C.getAttribute("rel")==="stylesheet")&&C.namespaceURI!=="http://www.w3.org/2000/svg"){var I=C.getAttribute(c)||"";I=a+I;var ne=m.get(I);ne?ne.push(C):m.set(I,[C])}}return m}function Xv(a,c,f){a=a.ownerDocument||a,a.head.insertBefore(f,c==="title"?a.querySelector("head > title"):null)}function O3(a,c,f){if(f===1||c.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;return c.rel==="stylesheet"?(a=c.disabled,typeof c.precedence=="string"&&a==null):!0;case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function Jv(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function I3(a,c,f,m){if(f.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var S=Ld(m.href),C=c.querySelector(Qh(S));if(C){c=C._p,c!==null&&typeof c=="object"&&typeof c.then=="function"&&(a.count++,a=U0.bind(a),c.then(a,a)),f.state.loading|=4,f.instance=C,Ds(C);return}C=c.ownerDocument||c,m=Wv(m),(S=Ha.get(S))&&lx(m,S),C=C.createElement("link"),Ds(C);var I=C;I._p=new Promise(function(ne,be){I.onload=ne,I.onerror=be}),ci(C,"link",m),f.instance=C}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(f,c),(c=f.state.preload)&&(f.state.loading&3)===0&&(a.count++,f=U0.bind(a),c.addEventListener("load",f),c.addEventListener("error",f))}}var ux=0;function M3(a,c){return a.stylesheets&&a.count===0&&$0(a,a.stylesheets),0<a.count||0<a.imgCount?function(f){var m=setTimeout(function(){if(a.stylesheets&&$0(a,a.stylesheets),a.unsuspend){var C=a.unsuspend;a.unsuspend=null,C()}},6e4+c);0<a.imgBytes&&ux===0&&(ux=62500*b3());var S=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&$0(a,a.stylesheets),a.unsuspend)){var C=a.unsuspend;a.unsuspend=null,C()}},(a.imgBytes>ux?50:800)+c);return a.unsuspend=f,function(){a.unsuspend=null,clearTimeout(m),clearTimeout(S)}}:null}function U0(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)$0(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var z0=null;function $0(a,c){a.stylesheets=null,a.unsuspend!==null&&(a.count++,z0=new Map,c.forEach(F3,a),z0=null,U0.call(a))}function F3(a,c){if(!(c.state.loading&4)){var f=z0.get(a);if(f)var m=f.get(null);else{f=new Map,z0.set(a,f);for(var S=a.querySelectorAll("link[data-precedence],style[data-precedence]"),C=0;C<S.length;C++){var I=S[C];(I.nodeName==="LINK"||I.getAttribute("media")!=="not all")&&(f.set(I.dataset.precedence,I),m=I)}m&&f.set(null,m)}S=c.instance,I=S.getAttribute("data-precedence"),C=f.get(I)||m,C===m&&f.set(null,S),f.set(I,S),this.count++,m=U0.bind(this),S.addEventListener("load",m),S.addEventListener("error",m),C?C.parentNode.insertBefore(S,C.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(S,a.firstChild)),c.state.loading|=4}}var tf={$$typeof:k,Provider:null,Consumer:null,_currentValue:ce,_currentValue2:ce,_threadCount:0};function U3(a,c,f,m,S,C,I,ne,be){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ut(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ut(0),this.hiddenUpdates=ut(null),this.identifierPrefix=m,this.onUncaughtError=S,this.onCaughtError=C,this.onRecoverableError=I,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=be,this.incompleteTransitions=new Map}function Zv(a,c,f,m,S,C,I,ne,be,qe,rt,xt){return a=new U3(a,c,f,I,be,qe,rt,xt,ne),c=1,C===!0&&(c|=24),C=Wr(3,null,null,c),a.current=C,C.stateNode=a,c=xc(),c.refCount++,a.pooledCache=c,c.refCount++,C.memoizedState={element:m,isDehydrated:f,cache:c},Dt(C),a}function Qv(a){return a?(a=Pr,a):Pr}function e2(a,c,f,m,S,C){S=Qv(S),m.context===null?m.context=S:m.pendingContext=S,m=dn(c),m.payload={element:f},C=C===void 0?null:C,C!==null&&(m.callback=C),f=jn(a,m,c),f!==null&&(ta(f,a,c),ns(f,a,c))}function t2(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var f=a.retryLane;a.retryLane=f!==0&&f<c?f:c}}function dx(a,c){t2(a,c),(a=a.alternate)&&t2(a,c)}function n2(a){if(a.tag===13||a.tag===31){var c=xo(a,67108864);c!==null&&ta(c,a,67108864),dx(a,67108864)}}function s2(a){if(a.tag===13||a.tag===31){var c=ba();c=kt(c);var f=xo(a,c);f!==null&&ta(f,a,c),dx(a,c)}}var q0=!0;function z3(a,c,f,m){var S=K.T;K.T=null;var C=se.p;try{se.p=2,hx(a,c,f,m)}finally{se.p=C,K.T=S}}function $3(a,c,f,m){var S=K.T;K.T=null;var C=se.p;try{se.p=8,hx(a,c,f,m)}finally{se.p=C,K.T=S}}function hx(a,c,f,m){if(q0){var S=fx(m);if(S===null)Zm(a,c,m,H0,f),i2(a,m);else if(H3(S,a,c,f,m))m.stopPropagation();else if(i2(a,m),c&4&&-1<q3.indexOf(a)){for(;S!==null;){var C=Ci(S);if(C!==null)switch(C.tag){case 3:if(C=C.stateNode,C.current.memoizedState.isDehydrated){var I=Bt(C.pendingLanes);if(I!==0){var ne=C;for(ne.pendingLanes|=2,ne.entangledLanes|=2;I;){var be=1<<31-At(I);ne.entanglements[1]|=be,I&=~be}Qo(C),(rs&6)===0&&(C0=Pt()+500,Kh(0))}}break;case 31:case 13:ne=xo(C,2),ne!==null&&ta(ne,C,2),k0(),dx(C,2)}if(C=fx(m),C===null&&Zm(a,c,m,H0,f),C===S)break;S=C}S!==null&&m.stopPropagation()}else Zm(a,c,m,null,f)}}function fx(a){return a=xl(a),px(a)}var H0=null;function px(a){if(H0=null,a=Tr(a),a!==null){var c=i(a);if(c===null)a=null;else{var f=c.tag;if(f===13){if(a=o(c),a!==null)return a;a=null}else if(f===31){if(a=l(c),a!==null)return a;a=null}else if(f===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null)}}return H0=a,null}function r2(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ut()){case je:return 2;case Me:return 8;case Fe:case ue:return 32;case Te:return 268435456;default:return 32}default:return 32}}var gx=!1,Tc=null,Dc=null,Lc=null,nf=new Map,sf=new Map,Rc=[],q3="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function i2(a,c){switch(a){case"focusin":case"focusout":Tc=null;break;case"dragenter":case"dragleave":Dc=null;break;case"mouseover":case"mouseout":Lc=null;break;case"pointerover":case"pointerout":nf.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":sf.delete(c.pointerId)}}function rf(a,c,f,m,S,C){return a===null||a.nativeEvent!==C?(a={blockedOn:c,domEventName:f,eventSystemFlags:m,nativeEvent:C,targetContainers:[S]},c!==null&&(c=Ci(c),c!==null&&n2(c)),a):(a.eventSystemFlags|=m,c=a.targetContainers,S!==null&&c.indexOf(S)===-1&&c.push(S),a)}function H3(a,c,f,m,S){switch(c){case"focusin":return Tc=rf(Tc,a,c,f,m,S),!0;case"dragenter":return Dc=rf(Dc,a,c,f,m,S),!0;case"mouseover":return Lc=rf(Lc,a,c,f,m,S),!0;case"pointerover":var C=S.pointerId;return nf.set(C,rf(nf.get(C)||null,a,c,f,m,S)),!0;case"gotpointercapture":return C=S.pointerId,sf.set(C,rf(sf.get(C)||null,a,c,f,m,S)),!0}return!1}function a2(a){var c=Tr(a.target);if(c!==null){var f=i(c);if(f!==null){if(c=f.tag,c===13){if(c=o(f),c!==null){a.blockedOn=c,An(a.priority,function(){s2(f)});return}}else if(c===31){if(c=l(f),c!==null){a.blockedOn=c,An(a.priority,function(){s2(f)});return}}else if(c===3&&f.stateNode.current.memoizedState.isDehydrated){a.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}a.blockedOn=null}function G0(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var f=fx(a.nativeEvent);if(f===null){f=a.nativeEvent;var m=new f.constructor(f.type,f);Qa=m,f.target.dispatchEvent(m),Qa=null}else return c=Ci(f),c!==null&&n2(c),a.blockedOn=f,!1;c.shift()}return!0}function o2(a,c,f){G0(a)&&f.delete(c)}function G3(){gx=!1,Tc!==null&&G0(Tc)&&(Tc=null),Dc!==null&&G0(Dc)&&(Dc=null),Lc!==null&&G0(Lc)&&(Lc=null),nf.forEach(o2),sf.forEach(o2)}function V0(a,c){a.blockedOn===c&&(a.blockedOn=null,gx||(gx=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,G3)))}var W0=null;function l2(a){W0!==a&&(W0=a,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){W0===a&&(W0=null);for(var c=0;c<a.length;c+=3){var f=a[c],m=a[c+1],S=a[c+2];if(typeof m!="function"){if(px(m||f)===null)continue;break}var C=Ci(f);C!==null&&(a.splice(c,3),c-=3,fm(C,{pending:!0,data:S,method:f.method,action:m},m,S))}}))}function Pd(a){function c(be){return V0(be,a)}Tc!==null&&V0(Tc,a),Dc!==null&&V0(Dc,a),Lc!==null&&V0(Lc,a),nf.forEach(c),sf.forEach(c);for(var f=0;f<Rc.length;f++){var m=Rc[f];m.blockedOn===a&&(m.blockedOn=null)}for(;0<Rc.length&&(f=Rc[0],f.blockedOn===null);)a2(f),f.blockedOn===null&&Rc.shift();if(f=(a.ownerDocument||a).$$reactFormReplay,f!=null)for(m=0;m<f.length;m+=3){var S=f[m],C=f[m+1],I=S[jt]||null;if(typeof C=="function")I||l2(f);else if(I){var ne=null;if(C&&C.hasAttribute("formAction")){if(S=C,I=C[jt]||null)ne=I.formAction;else if(px(S)!==null)continue}else ne=I.action;typeof ne=="function"?f[m+1]=ne:(f.splice(m,3),m-=3),l2(f)}}}function c2(){function a(C){C.canIntercept&&C.info==="react-transition"&&C.intercept({handler:function(){return new Promise(function(I){return S=I})},focusReset:"manual",scroll:"manual"})}function c(){S!==null&&(S(),S=null),m||setTimeout(f,20)}function f(){if(!m&&!navigation.transition){var C=navigation.currentEntry;C&&C.url!=null&&navigation.navigate(C.url,{state:C.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,S=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",c),navigation.addEventListener("navigateerror",c),setTimeout(f,100),function(){m=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",c),navigation.removeEventListener("navigateerror",c),S!==null&&(S(),S=null)}}}function mx(a){this._internalRoot=a}Y0.prototype.render=mx.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(n(409));var f=c.current,m=ba();e2(f,m,a,c,null,null)},Y0.prototype.unmount=mx.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;e2(a.current,2,null,a,null,null),k0(),c[dt]=null}};function Y0(a){this._internalRoot=a}Y0.prototype.unstable_scheduleHydration=function(a){if(a){var c=Rt();a={blockedOn:null,target:a,priority:c};for(var f=0;f<Rc.length&&c!==0&&c<Rc[f].priority;f++);Rc.splice(f,0,a),f===0&&a2(a)}};var u2=e.version;if(u2!=="19.2.4")throw Error(n(527,u2,"19.2.4"));se.findDOMNode=function(a){var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(n(188)):(a=Object.keys(a).join(","),Error(n(268,a)));return a=h(c),a=a!==null?p(a):null,a=a===null?null:a.stateNode,a};var V3={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:K,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var K0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!K0.isDisabled&&K0.supportsFiber)try{ft=K0.inject(V3),wt=K0}catch{}}return of.createRoot=function(a,c){if(!r(a))throw Error(n(299));var f=!1,m="",S=xy,C=by,I=yy;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(m=c.identifierPrefix),c.onUncaughtError!==void 0&&(S=c.onUncaughtError),c.onCaughtError!==void 0&&(C=c.onCaughtError),c.onRecoverableError!==void 0&&(I=c.onRecoverableError)),c=Zv(a,1,!1,null,null,f,m,null,S,C,I,c2),a[dt]=c.current,Jm(a),new mx(c)},of.hydrateRoot=function(a,c,f){if(!r(a))throw Error(n(299));var m=!1,S="",C=xy,I=by,ne=yy,be=null;return f!=null&&(f.unstable_strictMode===!0&&(m=!0),f.identifierPrefix!==void 0&&(S=f.identifierPrefix),f.onUncaughtError!==void 0&&(C=f.onUncaughtError),f.onCaughtError!==void 0&&(I=f.onCaughtError),f.onRecoverableError!==void 0&&(ne=f.onRecoverableError),f.formState!==void 0&&(be=f.formState)),c=Zv(a,1,!0,c,f??null,m,S,be,C,I,ne,c2),c.context=Qv(null),f=c.current,m=ba(),m=kt(m),S=dn(m),S.callback=null,jn(f,S,m),f=m,c.current.lanes=f,re(c,f),Qo(c),a[dt]=c.current,Jm(a),new Y0(c)},of.version="19.2.4",of}var S2;function rN(){if(S2)return wx.exports;S2=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),wx.exports=sN(),wx.exports}var iN=rN();const aN=Ig(iN);var _2="popstate";function oN(s={}){function e(n,r){let{pathname:i,search:o,hash:l}=n.location;return m1("",{pathname:i,search:o,hash:l},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(n,r){return typeof r=="string"?r:Rf(r)}return cN(e,t,null,s)}function Vs(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function Ka(s,e){if(!s){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function lN(){return Math.random().toString(36).substring(2,10)}function A2(s,e){return{usr:s.state,key:s.key,idx:e}}function m1(s,e,t=null,n){return{pathname:typeof s=="string"?s:s.pathname,search:"",hash:"",...typeof e=="string"?yh(e):e,state:t,key:e&&e.key||n||lN()}}function Rf({pathname:s="/",search:e="",hash:t=""}){return e&&e!=="?"&&(s+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(s+=t.charAt(0)==="#"?t:"#"+t),s}function yh(s){let e={};if(s){let t=s.indexOf("#");t>=0&&(e.hash=s.substring(t),s=s.substring(0,t));let n=s.indexOf("?");n>=0&&(e.search=s.substring(n),s=s.substring(0,n)),s&&(e.pathname=s)}return e}function cN(s,e,t,n={}){let{window:r=document.defaultView,v5Compat:i=!1}=n,o=r.history,l="POP",d=null,h=p();h==null&&(h=0,o.replaceState({...o.state,idx:h},""));function p(){return(o.state||{idx:null}).idx}function g(){l="POP";let _=p(),N=_==null?null:_-h;h=_,d&&d({action:l,location:v.location,delta:N})}function b(_,N){l="PUSH";let E=m1(v.location,_,N);h=p()+1;let k=A2(E,h),T=v.createHref(E);try{o.pushState(k,"",T)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;r.location.assign(T)}i&&d&&d({action:l,location:v.location,delta:1})}function x(_,N){l="REPLACE";let E=m1(v.location,_,N);h=p();let k=A2(E,h),T=v.createHref(E);o.replaceState(k,"",T),i&&d&&d({action:l,location:v.location,delta:0})}function w(_){return uN(_)}let v={get action(){return l},get location(){return s(r,o)},listen(_){if(d)throw new Error("A history only accepts one active listener");return r.addEventListener(_2,g),d=_,()=>{r.removeEventListener(_2,g),d=null}},createHref(_){return e(r,_)},createURL:w,encodeLocation(_){let N=w(_);return{pathname:N.pathname,search:N.search,hash:N.hash}},push:b,replace:x,go(_){return o.go(_)}};return v}function uN(s,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Vs(t,"No window.location.(origin|href) available to create URL");let n=typeof s=="string"?s:Rf(s);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=t+n),new URL(n,t)}function MS(s,e,t="/"){return dN(s,e,t,!1)}function dN(s,e,t,n){let r=typeof e=="string"?yh(e):e,i=Zl(r.pathname||"/",t);if(i==null)return null;let o=FS(s);hN(o);let l=null;for(let d=0;l==null&&d<o.length;++d){let h=_N(i);l=wN(o[d],h,n)}return l}function FS(s,e=[],t=[],n="",r=!1){let i=(o,l,d=r,h)=>{let p={relativePath:h===void 0?o.path||"":h,caseSensitive:o.caseSensitive===!0,childrenIndex:l,route:o};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(n)&&d)return;Vs(p.relativePath.startsWith(n),`Absolute route path "${p.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(n.length)}let g=Xl([n,p.relativePath]),b=t.concat(p);o.children&&o.children.length>0&&(Vs(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),FS(o.children,e,b,g,d)),!(o.path==null&&!o.index)&&e.push({path:g,score:yN(g,o.index),routesMeta:b})};return s.forEach((o,l)=>{if(o.path===""||!o.path?.includes("?"))i(o,l);else for(let d of US(o.path))i(o,l,!0,d)}),e}function US(s){let e=s.split("/");if(e.length===0)return[];let[t,...n]=e,r=t.endsWith("?"),i=t.replace(/\?$/,"");if(n.length===0)return r?[i,""]:[i];let o=US(n.join("/")),l=[];return l.push(...o.map(d=>d===""?i:[i,d].join("/"))),r&&l.push(...o),l.map(d=>s.startsWith("/")&&d===""?"/":d)}function hN(s){s.sort((e,t)=>e.score!==t.score?t.score-e.score:vN(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var fN=/^:[\w-]+$/,pN=3,gN=2,mN=1,xN=10,bN=-2,N2=s=>s==="*";function yN(s,e){let t=s.split("/"),n=t.length;return t.some(N2)&&(n+=bN),e&&(n+=gN),t.filter(r=>!N2(r)).reduce((r,i)=>r+(fN.test(i)?pN:i===""?mN:xN),n)}function vN(s,e){return s.length===e.length&&s.slice(0,-1).every((n,r)=>n===e[r])?s[s.length-1]-e[e.length-1]:0}function wN(s,e,t=!1){let{routesMeta:n}=s,r={},i="/",o=[];for(let l=0;l<n.length;++l){let d=n[l],h=l===n.length-1,p=i==="/"?e:e.slice(i.length)||"/",g=vg({path:d.relativePath,caseSensitive:d.caseSensitive,end:h},p),b=d.route;if(!g&&h&&t&&!n[n.length-1].route.index&&(g=vg({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},p)),!g)return null;Object.assign(r,g.params),o.push({params:r,pathname:Xl([i,g.pathname]),pathnameBase:EN(Xl([i,g.pathnameBase])),route:b}),g.pathnameBase!=="/"&&(i=Xl([i,g.pathnameBase]))}return o}function vg(s,e){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[t,n]=SN(s.path,s.caseSensitive,s.end),r=e.match(t);if(!r)return null;let i=r[0],o=i.replace(/(.)\/+$/,"$1"),l=r.slice(1);return{params:n.reduce((h,{paramName:p,isOptional:g},b)=>{if(p==="*"){let w=l[b]||"";o=i.slice(0,i.length-w.length).replace(/(.)\/+$/,"$1")}const x=l[b];return g&&!x?h[p]=void 0:h[p]=(x||"").replace(/%2F/g,"/"),h},{}),pathname:i,pathnameBase:o,pattern:s}}function SN(s,e=!1,t=!0){Ka(s==="*"||!s.endsWith("*")||s.endsWith("/*"),`Route path "${s}" will be treated as if it were "${s.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${s.replace(/\*$/,"/*")}".`);let n=[],r="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,d)=>(n.push({paramName:l,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return s.endsWith("*")?(n.push({paramName:"*"}),r+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":s!==""&&s!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),n]}function _N(s){try{return s.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ka(!1,`The URL path "${s}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),s}}function Zl(s,e){if(e==="/")return s;if(!s.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=s.charAt(t);return n&&n!=="/"?null:s.slice(t)||"/"}var AN=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function NN(s,e="/"){let{pathname:t,search:n="",hash:r=""}=typeof s=="string"?yh(s):s,i;return t?(t=t.replace(/\/\/+/g,"/"),t.startsWith("/")?i=C2(t.substring(1),"/"):i=C2(t,e)):i=e,{pathname:i,search:kN(n),hash:jN(r)}}function C2(s,e){let t=e.replace(/\/+$/,"").split("/");return s.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function Nx(s,e,t,n){return`Cannot include a '${s}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function CN(s){return s.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function hb(s){let e=CN(s);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function fb(s,e,t,n=!1){let r;typeof s=="string"?r=yh(s):(r={...s},Vs(!r.pathname||!r.pathname.includes("?"),Nx("?","pathname","search",r)),Vs(!r.pathname||!r.pathname.includes("#"),Nx("#","pathname","hash",r)),Vs(!r.search||!r.search.includes("#"),Nx("#","search","hash",r)));let i=s===""||r.pathname==="",o=i?"/":r.pathname,l;if(o==null)l=t;else{let g=e.length-1;if(!n&&o.startsWith("..")){let b=o.split("/");for(;b[0]==="..";)b.shift(),g-=1;r.pathname=b.join("/")}l=g>=0?e[g]:"/"}let d=NN(r,l),h=o&&o!=="/"&&o.endsWith("/"),p=(i||o===".")&&t.endsWith("/");return!d.pathname.endsWith("/")&&(h||p)&&(d.pathname+="/"),d}var Xl=s=>s.join("/").replace(/\/\/+/g,"/"),EN=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),kN=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,jN=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s,TN=class{constructor(s,e,t,n=!1){this.status=s,this.statusText=e||"",this.internal=n,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function DN(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}function LN(s){return s.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var zS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function $S(s,e){let t=s;if(typeof t!="string"||!AN.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let n=t,r=!1;if(zS)try{let i=new URL(window.location.href),o=t.startsWith("//")?new URL(i.protocol+t):new URL(t),l=Zl(o.pathname,e);o.origin===i.origin&&l!=null?t=l+o.search+o.hash:r=!0}catch{Ka(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:n,isExternal:r,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var qS=["POST","PUT","PATCH","DELETE"];new Set(qS);var RN=["GET",...qS];new Set(RN);var vh=Y.createContext(null);vh.displayName="DataRouter";var Mg=Y.createContext(null);Mg.displayName="DataRouterState";var PN=Y.createContext(!1),HS=Y.createContext({isTransitioning:!1});HS.displayName="ViewTransition";var BN=Y.createContext(new Map);BN.displayName="Fetchers";var ON=Y.createContext(null);ON.displayName="Await";var Ea=Y.createContext(null);Ea.displayName="Navigation";var Kf=Y.createContext(null);Kf.displayName="Location";var Lo=Y.createContext({outlet:null,matches:[],isDataRoute:!1});Lo.displayName="Route";var pb=Y.createContext(null);pb.displayName="RouteError";var GS="REACT_ROUTER_ERROR",IN="REDIRECT",MN="ROUTE_ERROR_RESPONSE";function FN(s){if(s.startsWith(`${GS}:${IN}:{`))try{let e=JSON.parse(s.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function UN(s){if(s.startsWith(`${GS}:${MN}:{`))try{let e=JSON.parse(s.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new TN(e.status,e.statusText,e.data)}catch{}}function zN(s,{relative:e}={}){Vs(wh(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=Y.useContext(Ea),{hash:r,pathname:i,search:o}=Xf(s,{relative:e}),l=i;return t!=="/"&&(l=i==="/"?t:Xl([t,i])),n.createHref({pathname:l,search:o,hash:r})}function wh(){return Y.useContext(Kf)!=null}function Ql(){return Vs(wh(),"useLocation() may be used only in the context of a <Router> component."),Y.useContext(Kf).location}var VS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function WS(s){Y.useContext(Ea).static||Y.useLayoutEffect(s)}function ka(){let{isDataRoute:s}=Y.useContext(Lo);return s?eC():$N()}function $N(){Vs(wh(),"useNavigate() may be used only in the context of a <Router> component.");let s=Y.useContext(vh),{basename:e,navigator:t}=Y.useContext(Ea),{matches:n}=Y.useContext(Lo),{pathname:r}=Ql(),i=JSON.stringify(hb(n)),o=Y.useRef(!1);return WS(()=>{o.current=!0}),Y.useCallback((d,h={})=>{if(Ka(o.current,VS),!o.current)return;if(typeof d=="number"){t.go(d);return}let p=fb(d,JSON.parse(i),r,h.relative==="path");s==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:Xl([e,p.pathname])),(h.replace?t.replace:t.push)(p,h.state,h)},[e,t,i,r,s])}Y.createContext(null);function gb(){let{matches:s}=Y.useContext(Lo),e=s[s.length-1];return e?e.params:{}}function Xf(s,{relative:e}={}){let{matches:t}=Y.useContext(Lo),{pathname:n}=Ql(),r=JSON.stringify(hb(t));return Y.useMemo(()=>fb(s,JSON.parse(r),n,e==="path"),[s,r,n,e])}function qN(s,e){return YS(s,e)}function YS(s,e,t,n,r){Vs(wh(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=Y.useContext(Ea),{matches:o}=Y.useContext(Lo),l=o[o.length-1],d=l?l.params:{},h=l?l.pathname:"/",p=l?l.pathnameBase:"/",g=l&&l.route;{let E=g&&g.path||"";XS(h,!g||E.endsWith("*")||E.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${E}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${E}"> to <Route path="${E==="/"?"*":`${E}/*`}">.`)}let b=Ql(),x;if(e){let E=typeof e=="string"?yh(e):e;Vs(p==="/"||E.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${E.pathname}" was given in the \`location\` prop.`),x=E}else x=b;let w=x.pathname||"/",v=w;if(p!=="/"){let E=p.replace(/^\//,"").split("/");v="/"+w.replace(/^\//,"").split("/").slice(E.length).join("/")}let _=MS(s,{pathname:v});Ka(g||_!=null,`No routes matched location "${x.pathname}${x.search}${x.hash}" `),Ka(_==null||_[_.length-1].route.element!==void 0||_[_.length-1].route.Component!==void 0||_[_.length-1].route.lazy!==void 0,`Matched leaf route at location "${x.pathname}${x.search}${x.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let N=YN(_&&_.map(E=>Object.assign({},E,{params:Object.assign({},d,E.params),pathname:Xl([p,i.encodeLocation?i.encodeLocation(E.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?p:Xl([p,i.encodeLocation?i.encodeLocation(E.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathnameBase])})),o,t,n,r);return e&&N?Y.createElement(Kf.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...x},navigationType:"POP"}},N):N}function HN(){let s=QN(),e=DN(s)?`${s.status} ${s.statusText}`:s instanceof Error?s.message:JSON.stringify(s),t=s instanceof Error?s.stack:null,n="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:n},i={padding:"2px 4px",backgroundColor:n},o=null;return console.error("Error handled by React Router default ErrorBoundary:",s),o=Y.createElement(Y.Fragment,null,Y.createElement("p",null," Hey developer "),Y.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Y.createElement("code",{style:i},"ErrorBoundary")," or"," ",Y.createElement("code",{style:i},"errorElement")," prop on your route.")),Y.createElement(Y.Fragment,null,Y.createElement("h2",null,"Unexpected Application Error!"),Y.createElement("h3",{style:{fontStyle:"italic"}},e),t?Y.createElement("pre",{style:r},t):null,o)}var GN=Y.createElement(HN,null),KS=class extends Y.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,e){return e.location!==s.location||e.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:e.error,location:e.location,revalidation:s.revalidation||e.revalidation}}componentDidCatch(s,e){this.props.onError?this.props.onError(s,e):console.error("React Router caught the following error during render",s)}render(){let s=this.state.error;if(this.context&&typeof s=="object"&&s&&"digest"in s&&typeof s.digest=="string"){const t=UN(s.digest);t&&(s=t)}let e=s!==void 0?Y.createElement(Lo.Provider,{value:this.props.routeContext},Y.createElement(pb.Provider,{value:s,children:this.props.component})):this.props.children;return this.context?Y.createElement(VN,{error:s},e):e}};KS.contextType=PN;var Cx=new WeakMap;function VN({children:s,error:e}){let{basename:t}=Y.useContext(Ea);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let n=FN(e.digest);if(n){let r=Cx.get(e);if(r)throw r;let i=$S(n.location,t);if(zS&&!Cx.get(e))if(i.isExternal||n.reloadDocument)window.location.href=i.absoluteURL||i.to;else{const o=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(i.to,{replace:n.replace}));throw Cx.set(e,o),o}return Y.createElement("meta",{httpEquiv:"refresh",content:`0;url=${i.absoluteURL||i.to}`})}}return s}function WN({routeContext:s,match:e,children:t}){let n=Y.useContext(vh);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),Y.createElement(Lo.Provider,{value:s},t)}function YN(s,e=[],t=null,n=null,r=null){if(s==null){if(!t)return null;if(t.errors)s=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)s=t.matches;else return null}let i=s,o=t?.errors;if(o!=null){let p=i.findIndex(g=>g.route.id&&o?.[g.route.id]!==void 0);Vs(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,p+1))}let l=!1,d=-1;if(t)for(let p=0;p<i.length;p++){let g=i[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(d=p),g.route.id){let{loaderData:b,errors:x}=t,w=g.route.loader&&!b.hasOwnProperty(g.route.id)&&(!x||x[g.route.id]===void 0);if(g.route.lazy||w){l=!0,d>=0?i=i.slice(0,d+1):i=[i[0]];break}}}let h=t&&n?(p,g)=>{n(p,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:LN(t.matches),errorInfo:g})}:void 0;return i.reduceRight((p,g,b)=>{let x,w=!1,v=null,_=null;t&&(x=o&&g.route.id?o[g.route.id]:void 0,v=g.route.errorElement||GN,l&&(d<0&&b===0?(XS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),w=!0,_=null):d===b&&(w=!0,_=g.route.hydrateFallbackElement||null)));let N=e.concat(i.slice(0,b+1)),E=()=>{let k;return x?k=v:w?k=_:g.route.Component?k=Y.createElement(g.route.Component,null):g.route.element?k=g.route.element:k=p,Y.createElement(WN,{match:g,routeContext:{outlet:p,matches:N,isDataRoute:t!=null},children:k})};return t&&(g.route.ErrorBoundary||g.route.errorElement||b===0)?Y.createElement(KS,{location:t.location,revalidation:t.revalidation,component:v,error:x,children:E(),routeContext:{outlet:null,matches:N,isDataRoute:!0},onError:h}):E()},null)}function mb(s){return`${s} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function KN(s){let e=Y.useContext(vh);return Vs(e,mb(s)),e}function XN(s){let e=Y.useContext(Mg);return Vs(e,mb(s)),e}function JN(s){let e=Y.useContext(Lo);return Vs(e,mb(s)),e}function xb(s){let e=JN(s),t=e.matches[e.matches.length-1];return Vs(t.route.id,`${s} can only be used on routes that contain a unique "id"`),t.route.id}function ZN(){return xb("useRouteId")}function QN(){let s=Y.useContext(pb),e=XN("useRouteError"),t=xb("useRouteError");return s!==void 0?s:e.errors?.[t]}function eC(){let{router:s}=KN("useNavigate"),e=xb("useNavigate"),t=Y.useRef(!1);return WS(()=>{t.current=!0}),Y.useCallback(async(r,i={})=>{Ka(t.current,VS),t.current&&(typeof r=="number"?await s.navigate(r):await s.navigate(r,{fromRouteId:e,...i}))},[s,e])}var E2={};function XS(s,e,t){!e&&!E2[s]&&(E2[s]=!0,Ka(!1,t))}Y.memo(tC);function tC({routes:s,future:e,state:t,onError:n}){return YS(s,void 0,t,n,e)}function JS({to:s,replace:e,state:t,relative:n}){Vs(wh(),"<Navigate> may be used only in the context of a <Router> component.");let{static:r}=Y.useContext(Ea);Ka(!r,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=Y.useContext(Lo),{pathname:o}=Ql(),l=ka(),d=fb(s,hb(i),o,n==="path"),h=JSON.stringify(d);return Y.useEffect(()=>{l(JSON.parse(h),{replace:e,state:t,relative:n})},[l,h,n,e,t]),null}function Wa(s){Vs(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function nC({basename:s="/",children:e=null,location:t,navigationType:n="POP",navigator:r,static:i=!1,unstable_useTransitions:o}){Vs(!wh(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=s.replace(/^\/*/,"/"),d=Y.useMemo(()=>({basename:l,navigator:r,static:i,unstable_useTransitions:o,future:{}}),[l,r,i,o]);typeof t=="string"&&(t=yh(t));let{pathname:h="/",search:p="",hash:g="",state:b=null,key:x="default"}=t,w=Y.useMemo(()=>{let v=Zl(h,l);return v==null?null:{location:{pathname:v,search:p,hash:g,state:b,key:x},navigationType:n}},[l,h,p,g,b,x,n]);return Ka(w!=null,`<Router basename="${l}"> is not able to match the URL "${h}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),w==null?null:Y.createElement(Ea.Provider,{value:d},Y.createElement(Kf.Provider,{children:e,value:w}))}function sC({children:s,location:e}){return qN(x1(s),e)}function x1(s,e=[]){let t=[];return Y.Children.forEach(s,(n,r)=>{if(!Y.isValidElement(n))return;let i=[...e,r];if(n.type===Y.Fragment){t.push.apply(t,x1(n.props.children,i));return}Vs(n.type===Wa,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Vs(!n.props.index||!n.props.children,"An index route cannot have child routes.");let o={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,middleware:n.props.middleware,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=x1(n.props.children,i)),t.push(o)}),t}var wp="get",Sp="application/x-www-form-urlencoded";function Fg(s){return typeof HTMLElement<"u"&&s instanceof HTMLElement}function rC(s){return Fg(s)&&s.tagName.toLowerCase()==="button"}function iC(s){return Fg(s)&&s.tagName.toLowerCase()==="form"}function aC(s){return Fg(s)&&s.tagName.toLowerCase()==="input"}function oC(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}function lC(s,e){return s.button===0&&(!e||e==="_self")&&!oC(s)}function b1(s=""){return new URLSearchParams(typeof s=="string"||Array.isArray(s)||s instanceof URLSearchParams?s:Object.keys(s).reduce((e,t)=>{let n=s[t];return e.concat(Array.isArray(n)?n.map(r=>[t,r]):[[t,n]])},[]))}function cC(s,e){let t=b1(s);return e&&e.forEach((n,r)=>{t.has(r)||e.getAll(r).forEach(i=>{t.append(r,i)})}),t}var X0=null;function uC(){if(X0===null)try{new FormData(document.createElement("form"),0),X0=!1}catch{X0=!0}return X0}var dC=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ex(s){return s!=null&&!dC.has(s)?(Ka(!1,`"${s}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Sp}"`),null):s}function hC(s,e){let t,n,r,i,o;if(iC(s)){let l=s.getAttribute("action");n=l?Zl(l,e):null,t=s.getAttribute("method")||wp,r=Ex(s.getAttribute("enctype"))||Sp,i=new FormData(s)}else if(rC(s)||aC(s)&&(s.type==="submit"||s.type==="image")){let l=s.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let d=s.getAttribute("formaction")||l.getAttribute("action");if(n=d?Zl(d,e):null,t=s.getAttribute("formmethod")||l.getAttribute("method")||wp,r=Ex(s.getAttribute("formenctype"))||Ex(l.getAttribute("enctype"))||Sp,i=new FormData(l,s),!uC()){let{name:h,type:p,value:g}=s;if(p==="image"){let b=h?`${h}.`:"";i.append(`${b}x`,"0"),i.append(`${b}y`,"0")}else h&&i.append(h,g)}}else{if(Fg(s))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=wp,n=null,r=Sp,o=s}return i&&r==="text/plain"&&(o=i,i=void 0),{action:n,method:t.toLowerCase(),encType:r,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function bb(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function fC(s,e,t,n){let r=typeof s=="string"?new URL(s,typeof window>"u"?"server://singlefetch/":window.location.origin):s;return t?r.pathname.endsWith("/")?r.pathname=`${r.pathname}_.${n}`:r.pathname=`${r.pathname}.${n}`:r.pathname==="/"?r.pathname=`_root.${n}`:e&&Zl(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function pC(s,e){if(s.id in e)return e[s.id];try{let t=await import(s.module);return e[s.id]=t,t}catch(t){return console.error(`Error loading route module \`${s.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function gC(s){return s==null?!1:s.href==null?s.rel==="preload"&&typeof s.imageSrcSet=="string"&&typeof s.imageSizes=="string":typeof s.rel=="string"&&typeof s.href=="string"}async function mC(s,e,t){let n=await Promise.all(s.map(async r=>{let i=e.routes[r.route.id];if(i){let o=await pC(i,t);return o.links?o.links():[]}return[]}));return vC(n.flat(1).filter(gC).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function k2(s,e,t,n,r,i){let o=(d,h)=>t[h]?d.route.id!==t[h].route.id:!0,l=(d,h)=>t[h].pathname!==d.pathname||t[h].route.path?.endsWith("*")&&t[h].params["*"]!==d.params["*"];return i==="assets"?e.filter((d,h)=>o(d,h)||l(d,h)):i==="data"?e.filter((d,h)=>{let p=n.routes[d.route.id];if(!p||!p.hasLoader)return!1;if(o(d,h)||l(d,h))return!0;if(d.route.shouldRevalidate){let g=d.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(s,window.origin),nextParams:d.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function xC(s,e,{includeHydrateFallback:t}={}){return bC(s.map(n=>{let r=e.routes[n.route.id];if(!r)return[];let i=[r.module];return r.clientActionModule&&(i=i.concat(r.clientActionModule)),r.clientLoaderModule&&(i=i.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(i=i.concat(r.hydrateFallbackModule)),r.imports&&(i=i.concat(r.imports)),i}).flat(1))}function bC(s){return[...new Set(s)]}function yC(s){let e={},t=Object.keys(s).sort();for(let n of t)e[n]=s[n];return e}function vC(s,e){let t=new Set;return new Set(e),s.reduce((n,r)=>{let i=JSON.stringify(yC(r));return t.has(i)||(t.add(i),n.push({key:i,link:r})),n},[])}function ZS(){let s=Y.useContext(vh);return bb(s,"You must render this element inside a <DataRouterContext.Provider> element"),s}function wC(){let s=Y.useContext(Mg);return bb(s,"You must render this element inside a <DataRouterStateContext.Provider> element"),s}var yb=Y.createContext(void 0);yb.displayName="FrameworkContext";function QS(){let s=Y.useContext(yb);return bb(s,"You must render this element inside a <HydratedRouter> element"),s}function SC(s,e){let t=Y.useContext(yb),[n,r]=Y.useState(!1),[i,o]=Y.useState(!1),{onFocus:l,onBlur:d,onMouseEnter:h,onMouseLeave:p,onTouchStart:g}=e,b=Y.useRef(null);Y.useEffect(()=>{if(s==="render"&&o(!0),s==="viewport"){let v=N=>{N.forEach(E=>{o(E.isIntersecting)})},_=new IntersectionObserver(v,{threshold:.5});return b.current&&_.observe(b.current),()=>{_.disconnect()}}},[s]),Y.useEffect(()=>{if(n){let v=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(v)}}},[n]);let x=()=>{r(!0)},w=()=>{r(!1),o(!1)};return t?s!=="intent"?[i,b,{}]:[i,b,{onFocus:lf(l,x),onBlur:lf(d,w),onMouseEnter:lf(h,x),onMouseLeave:lf(p,w),onTouchStart:lf(g,x)}]:[!1,b,{}]}function lf(s,e){return t=>{s&&s(t),t.defaultPrevented||e(t)}}function _C({page:s,...e}){let{router:t}=ZS(),n=Y.useMemo(()=>MS(t.routes,s,t.basename),[t.routes,s,t.basename]);return n?Y.createElement(NC,{page:s,matches:n,...e}):null}function AC(s){let{manifest:e,routeModules:t}=QS(),[n,r]=Y.useState([]);return Y.useEffect(()=>{let i=!1;return mC(s,e,t).then(o=>{i||r(o)}),()=>{i=!0}},[s,e,t]),n}function NC({page:s,matches:e,...t}){let n=Ql(),{future:r,manifest:i,routeModules:o}=QS(),{basename:l}=ZS(),{loaderData:d,matches:h}=wC(),p=Y.useMemo(()=>k2(s,e,h,i,n,"data"),[s,e,h,i,n]),g=Y.useMemo(()=>k2(s,e,h,i,n,"assets"),[s,e,h,i,n]),b=Y.useMemo(()=>{if(s===n.pathname+n.search+n.hash)return[];let v=new Set,_=!1;if(e.forEach(E=>{let k=i.routes[E.route.id];!k||!k.hasLoader||(!p.some(T=>T.route.id===E.route.id)&&E.route.id in d&&o[E.route.id]?.shouldRevalidate||k.hasClientLoader?_=!0:v.add(E.route.id))}),v.size===0)return[];let N=fC(s,l,r.unstable_trailingSlashAwareDataRequests,"data");return _&&v.size>0&&N.searchParams.set("_routes",e.filter(E=>v.has(E.route.id)).map(E=>E.route.id).join(",")),[N.pathname+N.search]},[l,r.unstable_trailingSlashAwareDataRequests,d,n,i,p,e,s,o]),x=Y.useMemo(()=>xC(g,i),[g,i]),w=AC(g);return Y.createElement(Y.Fragment,null,b.map(v=>Y.createElement("link",{key:v,rel:"prefetch",as:"fetch",href:v,...t})),x.map(v=>Y.createElement("link",{key:v,rel:"modulepreload",href:v,...t})),w.map(({key:v,link:_})=>Y.createElement("link",{key:v,nonce:t.nonce,..._,crossOrigin:_.crossOrigin??t.crossOrigin})))}function CC(...s){return e=>{s.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var EC=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{EC&&(window.__reactRouterVersion="7.13.0")}catch{}function kC({basename:s,children:e,unstable_useTransitions:t,window:n}){let r=Y.useRef();r.current==null&&(r.current=oN({window:n,v5Compat:!0}));let i=r.current,[o,l]=Y.useState({action:i.action,location:i.location}),d=Y.useCallback(h=>{t===!1?l(h):Y.startTransition(()=>l(h))},[t]);return Y.useLayoutEffect(()=>i.listen(d),[i,d]),Y.createElement(nC,{basename:s,children:e,location:o.location,navigationType:o.action,navigator:i,unstable_useTransitions:t})}var e_=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Cf=Y.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:r,reloadDocument:i,replace:o,state:l,target:d,to:h,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b,...x},w){let{basename:v,unstable_useTransitions:_}=Y.useContext(Ea),N=typeof h=="string"&&e_.test(h),E=$S(h,v);h=E.to;let k=zN(h,{relative:r}),[T,P,O]=SC(n,x),F=LC(h,{replace:o,state:l,target:d,preventScrollReset:p,relative:r,viewTransition:g,unstable_defaultShouldRevalidate:b,unstable_useTransitions:_});function $(G){e&&e(G),G.defaultPrevented||F(G)}let z=Y.createElement("a",{...x,...O,href:E.absoluteURL||k,onClick:E.isExternal||i?e:$,ref:CC(w,P),target:d,"data-discover":!N&&t==="render"?"true":void 0});return T&&!N?Y.createElement(Y.Fragment,null,z,Y.createElement(_C,{page:k})):z});Cf.displayName="Link";var jC=Y.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:r=!1,style:i,to:o,viewTransition:l,children:d,...h},p){let g=Xf(o,{relative:h.relative}),b=Ql(),x=Y.useContext(Mg),{navigator:w,basename:v}=Y.useContext(Ea),_=x!=null&&IC(g)&&l===!0,N=w.encodeLocation?w.encodeLocation(g).pathname:g.pathname,E=b.pathname,k=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;t||(E=E.toLowerCase(),k=k?k.toLowerCase():null,N=N.toLowerCase()),k&&v&&(k=Zl(k,v)||k);const T=N!=="/"&&N.endsWith("/")?N.length-1:N.length;let P=E===N||!r&&E.startsWith(N)&&E.charAt(T)==="/",O=k!=null&&(k===N||!r&&k.startsWith(N)&&k.charAt(N.length)==="/"),F={isActive:P,isPending:O,isTransitioning:_},$=P?e:void 0,z;typeof n=="function"?z=n(F):z=[n,P?"active":null,O?"pending":null,_?"transitioning":null].filter(Boolean).join(" ");let G=typeof i=="function"?i(F):i;return Y.createElement(Cf,{...h,"aria-current":$,className:z,ref:p,style:G,to:o,viewTransition:l},typeof d=="function"?d(F):d)});jC.displayName="NavLink";var TC=Y.forwardRef(({discover:s="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:r,state:i,method:o=wp,action:l,onSubmit:d,relative:h,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b,...x},w)=>{let{unstable_useTransitions:v}=Y.useContext(Ea),_=BC(),N=OC(l,{relative:h}),E=o.toLowerCase()==="get"?"get":"post",k=typeof l=="string"&&e_.test(l),T=P=>{if(d&&d(P),P.defaultPrevented)return;P.preventDefault();let O=P.nativeEvent.submitter,F=O?.getAttribute("formmethod")||o,$=()=>_(O||P.currentTarget,{fetcherKey:e,method:F,navigate:t,replace:r,state:i,relative:h,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b});v&&t!==!1?Y.startTransition(()=>$()):$()};return Y.createElement("form",{ref:w,method:E,action:N,onSubmit:n?d:T,...x,"data-discover":!k&&s==="render"?"true":void 0})});TC.displayName="Form";function DC(s){return`${s} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function t_(s){let e=Y.useContext(vh);return Vs(e,DC(s)),e}function LC(s,{target:e,replace:t,state:n,preventScrollReset:r,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:l,unstable_useTransitions:d}={}){let h=ka(),p=Ql(),g=Xf(s,{relative:i});return Y.useCallback(b=>{if(lC(b,e)){b.preventDefault();let x=t!==void 0?t:Rf(p)===Rf(g),w=()=>h(s,{replace:x,state:n,preventScrollReset:r,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:l});d?Y.startTransition(()=>w()):w()}},[p,h,g,t,n,e,s,r,i,o,l,d])}function n_(s){Ka(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=Y.useRef(b1(s)),t=Y.useRef(!1),n=Ql(),r=Y.useMemo(()=>cC(n.search,t.current?null:e.current),[n.search]),i=ka(),o=Y.useCallback((l,d)=>{const h=b1(typeof l=="function"?l(new URLSearchParams(r)):l);t.current=!0,i("?"+h,d)},[i,r]);return[r,o]}var RC=0,PC=()=>`__${String(++RC)}__`;function BC(){let{router:s}=t_("useSubmit"),{basename:e}=Y.useContext(Ea),t=ZN(),n=s.fetch,r=s.navigate;return Y.useCallback(async(i,o={})=>{let{action:l,method:d,encType:h,formData:p,body:g}=hC(i,e);if(o.navigate===!1){let b=o.fetcherKey||PC();await n(b,t,o.action||l,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:p,body:g,formMethod:o.method||d,formEncType:o.encType||h,flushSync:o.flushSync})}else await r(o.action||l,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:p,body:g,formMethod:o.method||d,formEncType:o.encType||h,replace:o.replace,state:o.state,fromRouteId:t,flushSync:o.flushSync,viewTransition:o.viewTransition})},[n,r,e,t])}function OC(s,{relative:e}={}){let{basename:t}=Y.useContext(Ea),n=Y.useContext(Lo);Vs(n,"useFormAction must be used inside a RouteContext");let[r]=n.matches.slice(-1),i={...Xf(s||".",{relative:e})},o=Ql();if(s==null){i.search=o.search;let l=new URLSearchParams(i.search),d=l.getAll("index");if(d.some(p=>p==="")){l.delete("index"),d.filter(g=>g).forEach(g=>l.append("index",g));let p=l.toString();i.search=p?`?${p}`:""}}return(!s||s===".")&&r.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(i.pathname=i.pathname==="/"?t:Xl([t,i.pathname])),Rf(i)}function IC(s,{relative:e}={}){let t=Y.useContext(HS);Vs(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=t_("useViewTransitionState"),r=Xf(s,{relative:e});if(!t.isTransitioning)return!1;let i=Zl(t.currentLocation.pathname,n)||t.currentLocation.pathname,o=Zl(t.nextLocation.pathname,n)||t.nextLocation.pathname;return vg(r.pathname,o)!=null||vg(r.pathname,i)!=null}const s_=(...s)=>s.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim();const MC=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const FC=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase());const j2=s=>{const e=FC(s);return e.charAt(0).toUpperCase()+e.slice(1)};var UC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const zC=s=>{for(const e in s)if(e.startsWith("aria-")||e==="role"||e==="title")return!0;return!1};const $C=Y.forwardRef(({color:s="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:r="",children:i,iconNode:o,...l},d)=>Y.createElement("svg",{ref:d,...UC,width:e,height:e,stroke:s,strokeWidth:n?Number(t)*24/Number(e):t,className:s_("lucide",r),...!i&&!zC(l)&&{"aria-hidden":"true"},...l},[...o.map(([h,p])=>Y.createElement(h,p)),...Array.isArray(i)?i:[i]]));const hn=(s,e)=>{const t=Y.forwardRef(({className:n,...r},i)=>Y.createElement($C,{ref:i,iconNode:e,className:s_(`lucide-${MC(j2(s))}`,`lucide-${s}`,n),...r}));return t.displayName=j2(s),t};const qC=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],mh=hn("arrow-left",qC);const HC=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Jl=hn("arrow-right",HC);const GC=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],wg=hn("book-open",GC);const VC=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]],WC=hn("calculator",VC);const YC=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ll=hn("calendar",YC);const KC=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],r_=hn("check",KC);const XC=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],T2=hn("chevron-down",XC);const JC=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],i_=hn("chevron-left",JC);const ZC=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ef=hn("chevron-right",ZC);const QC=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],a_=hn("chevron-up",QC);const e6=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],To=hn("circle-alert",e6);const t6=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Is=hn("circle-check-big",t6);const n6=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ei=hn("clock",n6);const s6=[["path",{d:"M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5",key:"laymnq"}],["path",{d:"M8.5 8.5v.01",key:"ue8clq"}],["path",{d:"M16 15.5v.01",key:"14dtrp"}],["path",{d:"M12 12v.01",key:"u5ubse"}],["path",{d:"M11 17v.01",key:"1hyl5a"}],["path",{d:"M7 14v.01",key:"uct60s"}]],y1=hn("cookie",s6);const r6=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],kx=hn("copy",r6);const i6=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],v1=hn("credit-card",i6);const a6=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],o_=hn("download",a6);const o6=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],l6=hn("eraser",o6);const c6=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Na=hn("file-text",c6);const u6=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],d6=hn("file",u6);const h6=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],Au=hn("graduation-cap",h6);const f6=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],p6=hn("grid-3x3",f6);const g6=[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]],m6=hn("hand",g6);const x6=[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]],b6=hn("highlighter",x6);const y6=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],vb=hn("log-out",y6);const v6=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Sg=hn("mail",v6);const w6=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Hc=hn("message-square",w6);const S6=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],_6=hn("mic-off",S6);const A6=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],N6=hn("mic",A6);const C6=[["path",{d:"M5 12h14",key:"1ays0h"}]],E6=hn("minus",C6);const k6=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],j6=hn("pen",k6);const T6=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],cf=hn("plus",T6);const D6=[["path",{d:"M18 7c0-5.333-8-5.333-8 0",key:"1prm2n"}],["path",{d:"M10 7v14",key:"18tmcs"}],["path",{d:"M6 21h12",key:"4dkmi1"}],["path",{d:"M6 13h10",key:"ybwr4a"}]],L6=hn("pound-sterling",D6);const R6=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],P6=hn("redo",R6);const B6=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],O6=hn("refresh-cw",B6);const I6=[["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"m19 8 3 8a5 5 0 0 1-6 0zV7",key:"zcdpyk"}],["path",{d:"M3 7h1a17 17 0 0 0 8-2 17 17 0 0 0 8 2h1",key:"1yorad"}],["path",{d:"m5 8 3 8a5 5 0 0 1-6 0zV7",key:"eua70x"}],["path",{d:"M7 21h10",key:"1b0cd5"}]],M6=hn("scale",I6);const F6=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],U6=hn("send",F6);const z6=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],D2=hn("settings",z6);const $6=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Ru=hn("shield",$6);const q6=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],cl=hn("star",q6);const H6=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Kl=hn("trash-2",H6);const G6=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],w1=hn("trending-up",G6);const V6=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],W6=hn("type",V6);const Y6=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],K6=hn("undo",Y6);const X6=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],J6=hn("upload",X6);const Z6=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],rh=hn("user",Z6);const Q6=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Pu=hn("users",Q6);const eE=[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],l_=hn("video-off",eE);const tE=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],dl=hn("video",tE);const nE=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],xh=hn("x",nE);const sE=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],rE=hn("zoom-in",sE);const iE=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],aE=hn("zoom-out",iE);var _p={exports:{}};function oE(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ap={exports:{}};const lE={},cE=Object.freeze(Object.defineProperty({__proto__:null,default:lE},Symbol.toStringTag,{value:"Module"})),uE=K3(cE);var dE=Ap.exports,L2;function Yn(){return L2||(L2=1,(function(s,e){(function(t,n){s.exports=n()})(dE,function(){var t=t||(function(n,r){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof bx<"u"&&bx.crypto&&(i=bx.crypto),!i&&typeof oE=="function")try{i=uE}catch{}var o=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},l=Object.create||(function(){function E(){}return function(k){var T;return E.prototype=k,T=new E,E.prototype=null,T}})(),d={},h=d.lib={},p=h.Base=(function(){return{extend:function(E){var k=l(this);return E&&k.mixIn(E),(!k.hasOwnProperty("init")||this.init===k.init)&&(k.init=function(){k.$super.init.apply(this,arguments)}),k.init.prototype=k,k.$super=this,k},create:function(){var E=this.extend();return E.init.apply(E,arguments),E},init:function(){},mixIn:function(E){for(var k in E)E.hasOwnProperty(k)&&(this[k]=E[k]);E.hasOwnProperty("toString")&&(this.toString=E.toString)},clone:function(){return this.init.prototype.extend(this)}}})(),g=h.WordArray=p.extend({init:function(E,k){E=this.words=E||[],k!=r?this.sigBytes=k:this.sigBytes=E.length*4},toString:function(E){return(E||x).stringify(this)},concat:function(E){var k=this.words,T=E.words,P=this.sigBytes,O=E.sigBytes;if(this.clamp(),P%4)for(var F=0;F<O;F++){var $=T[F>>>2]>>>24-F%4*8&255;k[P+F>>>2]|=$<<24-(P+F)%4*8}else for(var z=0;z<O;z+=4)k[P+z>>>2]=T[z>>>2];return this.sigBytes+=O,this},clamp:function(){var E=this.words,k=this.sigBytes;E[k>>>2]&=4294967295<<32-k%4*8,E.length=n.ceil(k/4)},clone:function(){var E=p.clone.call(this);return E.words=this.words.slice(0),E},random:function(E){for(var k=[],T=0;T<E;T+=4)k.push(o());return new g.init(k,E)}}),b=d.enc={},x=b.Hex={stringify:function(E){for(var k=E.words,T=E.sigBytes,P=[],O=0;O<T;O++){var F=k[O>>>2]>>>24-O%4*8&255;P.push((F>>>4).toString(16)),P.push((F&15).toString(16))}return P.join("")},parse:function(E){for(var k=E.length,T=[],P=0;P<k;P+=2)T[P>>>3]|=parseInt(E.substr(P,2),16)<<24-P%8*4;return new g.init(T,k/2)}},w=b.Latin1={stringify:function(E){for(var k=E.words,T=E.sigBytes,P=[],O=0;O<T;O++){var F=k[O>>>2]>>>24-O%4*8&255;P.push(String.fromCharCode(F))}return P.join("")},parse:function(E){for(var k=E.length,T=[],P=0;P<k;P++)T[P>>>2]|=(E.charCodeAt(P)&255)<<24-P%4*8;return new g.init(T,k)}},v=b.Utf8={stringify:function(E){try{return decodeURIComponent(escape(w.stringify(E)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(E){return w.parse(unescape(encodeURIComponent(E)))}},_=h.BufferedBlockAlgorithm=p.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(E){typeof E=="string"&&(E=v.parse(E)),this._data.concat(E),this._nDataBytes+=E.sigBytes},_process:function(E){var k,T=this._data,P=T.words,O=T.sigBytes,F=this.blockSize,$=F*4,z=O/$;E?z=n.ceil(z):z=n.max((z|0)-this._minBufferSize,0);var G=z*F,R=n.min(G*4,O);if(G){for(var q=0;q<G;q+=F)this._doProcessBlock(P,q);k=P.splice(0,G),T.sigBytes-=R}return new g.init(k,R)},clone:function(){var E=p.clone.call(this);return E._data=this._data.clone(),E},_minBufferSize:0});h.Hasher=_.extend({cfg:p.extend(),init:function(E){this.cfg=this.cfg.extend(E),this.reset()},reset:function(){_.reset.call(this),this._doReset()},update:function(E){return this._append(E),this._process(),this},finalize:function(E){E&&this._append(E);var k=this._doFinalize();return k},blockSize:16,_createHelper:function(E){return function(k,T){return new E.init(T).finalize(k)}},_createHmacHelper:function(E){return function(k,T){return new N.HMAC.init(E,T).finalize(k)}}});var N=d.algo={};return d})(Math);return t})})(Ap)),Ap.exports}var Np={exports:{}},hE=Np.exports,R2;function Ug(){return R2||(R2=1,(function(s,e){(function(t,n){s.exports=n(Yn())})(hE,function(t){return(function(n){var r=t,i=r.lib,o=i.Base,l=i.WordArray,d=r.x64={};d.Word=o.extend({init:function(h,p){this.high=h,this.low=p}}),d.WordArray=o.extend({init:function(h,p){h=this.words=h||[],p!=n?this.sigBytes=p:this.sigBytes=h.length*8},toX32:function(){for(var h=this.words,p=h.length,g=[],b=0;b<p;b++){var x=h[b];g.push(x.high),g.push(x.low)}return l.create(g,this.sigBytes)},clone:function(){for(var h=o.clone.call(this),p=h.words=this.words.slice(0),g=p.length,b=0;b<g;b++)p[b]=p[b].clone();return h}})})(),t})})(Np)),Np.exports}var Cp={exports:{}},fE=Cp.exports,P2;function pE(){return P2||(P2=1,(function(s,e){(function(t,n){s.exports=n(Yn())})(fE,function(t){return(function(){if(typeof ArrayBuffer=="function"){var n=t,r=n.lib,i=r.WordArray,o=i.init,l=i.init=function(d){if(d instanceof ArrayBuffer&&(d=new Uint8Array(d)),(d instanceof Int8Array||typeof Uint8ClampedArray<"u"&&d instanceof Uint8ClampedArray||d instanceof Int16Array||d instanceof Uint16Array||d instanceof Int32Array||d instanceof Uint32Array||d instanceof Float32Array||d instanceof Float64Array)&&(d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength)),d instanceof Uint8Array){for(var h=d.byteLength,p=[],g=0;g<h;g++)p[g>>>2]|=d[g]<<24-g%4*8;o.call(this,p,h)}else o.apply(this,arguments)};l.prototype=i}})(),t.lib.WordArray})})(Cp)),Cp.exports}var Ep={exports:{}},gE=Ep.exports,B2;function mE(){return B2||(B2=1,(function(s,e){(function(t,n){s.exports=n(Yn())})(gE,function(t){return(function(){var n=t,r=n.lib,i=r.WordArray,o=n.enc;o.Utf16=o.Utf16BE={stringify:function(d){for(var h=d.words,p=d.sigBytes,g=[],b=0;b<p;b+=2){var x=h[b>>>2]>>>16-b%4*8&65535;g.push(String.fromCharCode(x))}return g.join("")},parse:function(d){for(var h=d.length,p=[],g=0;g<h;g++)p[g>>>1]|=d.charCodeAt(g)<<16-g%2*16;return i.create(p,h*2)}},o.Utf16LE={stringify:function(d){for(var h=d.words,p=d.sigBytes,g=[],b=0;b<p;b+=2){var x=l(h[b>>>2]>>>16-b%4*8&65535);g.push(String.fromCharCode(x))}return g.join("")},parse:function(d){for(var h=d.length,p=[],g=0;g<h;g++)p[g>>>1]|=l(d.charCodeAt(g)<<16-g%2*16);return i.create(p,h*2)}};function l(d){return d<<8&4278255360|d>>>8&16711935}})(),t.enc.Utf16})})(Ep)),Ep.exports}var kp={exports:{}},xE=kp.exports,O2;function Uu(){return O2||(O2=1,(function(s,e){(function(t,n){s.exports=n(Yn())})(xE,function(t){return(function(){var n=t,r=n.lib,i=r.WordArray,o=n.enc;o.Base64={stringify:function(d){var h=d.words,p=d.sigBytes,g=this._map;d.clamp();for(var b=[],x=0;x<p;x+=3)for(var w=h[x>>>2]>>>24-x%4*8&255,v=h[x+1>>>2]>>>24-(x+1)%4*8&255,_=h[x+2>>>2]>>>24-(x+2)%4*8&255,N=w<<16|v<<8|_,E=0;E<4&&x+E*.75<p;E++)b.push(g.charAt(N>>>6*(3-E)&63));var k=g.charAt(64);if(k)for(;b.length%4;)b.push(k);return b.join("")},parse:function(d){var h=d.length,p=this._map,g=this._reverseMap;if(!g){g=this._reverseMap=[];for(var b=0;b<p.length;b++)g[p.charCodeAt(b)]=b}var x=p.charAt(64);if(x){var w=d.indexOf(x);w!==-1&&(h=w)}return l(d,h,g)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function l(d,h,p){for(var g=[],b=0,x=0;x<h;x++)if(x%4){var w=p[d.charCodeAt(x-1)]<<x%4*2,v=p[d.charCodeAt(x)]>>>6-x%4*2,_=w|v;g[b>>>2]|=_<<24-b%4*8,b++}return i.create(g,b)}})(),t.enc.Base64})})(kp)),kp.exports}var jp={exports:{}},bE=jp.exports,I2;function yE(){return I2||(I2=1,(function(s,e){(function(t,n){s.exports=n(Yn())})(bE,function(t){return(function(){var n=t,r=n.lib,i=r.WordArray,o=n.enc;o.Base64url={stringify:function(d,h){h===void 0&&(h=!0);var p=d.words,g=d.sigBytes,b=h?this._safe_map:this._map;d.clamp();for(var x=[],w=0;w<g;w+=3)for(var v=p[w>>>2]>>>24-w%4*8&255,_=p[w+1>>>2]>>>24-(w+1)%4*8&255,N=p[w+2>>>2]>>>24-(w+2)%4*8&255,E=v<<16|_<<8|N,k=0;k<4&&w+k*.75<g;k++)x.push(b.charAt(E>>>6*(3-k)&63));var T=b.charAt(64);if(T)for(;x.length%4;)x.push(T);return x.join("")},parse:function(d,h){h===void 0&&(h=!0);var p=d.length,g=h?this._safe_map:this._map,b=this._reverseMap;if(!b){b=this._reverseMap=[];for(var x=0;x<g.length;x++)b[g.charCodeAt(x)]=x}var w=g.charAt(64);if(w){var v=d.indexOf(w);v!==-1&&(p=v)}return l(d,p,b)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function l(d,h,p){for(var g=[],b=0,x=0;x<h;x++)if(x%4){var w=p[d.charCodeAt(x-1)]<<x%4*2,v=p[d.charCodeAt(x)]>>>6-x%4*2,_=w|v;g[b>>>2]|=_<<24-b%4*8,b++}return i.create(g,b)}})(),t.enc.Base64url})})(jp)),jp.exports}var Tp={exports:{}},vE=Tp.exports,M2;function zu(){return M2||(M2=1,(function(s,e){(function(t,n){s.exports=n(Yn())})(vE,function(t){return(function(n){var r=t,i=r.lib,o=i.WordArray,l=i.Hasher,d=r.algo,h=[];(function(){for(var v=0;v<64;v++)h[v]=n.abs(n.sin(v+1))*4294967296|0})();var p=d.MD5=l.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(v,_){for(var N=0;N<16;N++){var E=_+N,k=v[E];v[E]=(k<<8|k>>>24)&16711935|(k<<24|k>>>8)&4278255360}var T=this._hash.words,P=v[_+0],O=v[_+1],F=v[_+2],$=v[_+3],z=v[_+4],G=v[_+5],R=v[_+6],q=v[_+7],J=v[_+8],Z=v[_+9],le=v[_+10],K=v[_+11],se=v[_+12],ce=v[_+13],ye=v[_+14],Ce=v[_+15],M=T[0],L=T[1],U=T[2],H=T[3];M=g(M,L,U,H,P,7,h[0]),H=g(H,M,L,U,O,12,h[1]),U=g(U,H,M,L,F,17,h[2]),L=g(L,U,H,M,$,22,h[3]),M=g(M,L,U,H,z,7,h[4]),H=g(H,M,L,U,G,12,h[5]),U=g(U,H,M,L,R,17,h[6]),L=g(L,U,H,M,q,22,h[7]),M=g(M,L,U,H,J,7,h[8]),H=g(H,M,L,U,Z,12,h[9]),U=g(U,H,M,L,le,17,h[10]),L=g(L,U,H,M,K,22,h[11]),M=g(M,L,U,H,se,7,h[12]),H=g(H,M,L,U,ce,12,h[13]),U=g(U,H,M,L,ye,17,h[14]),L=g(L,U,H,M,Ce,22,h[15]),M=b(M,L,U,H,O,5,h[16]),H=b(H,M,L,U,R,9,h[17]),U=b(U,H,M,L,K,14,h[18]),L=b(L,U,H,M,P,20,h[19]),M=b(M,L,U,H,G,5,h[20]),H=b(H,M,L,U,le,9,h[21]),U=b(U,H,M,L,Ce,14,h[22]),L=b(L,U,H,M,z,20,h[23]),M=b(M,L,U,H,Z,5,h[24]),H=b(H,M,L,U,ye,9,h[25]),U=b(U,H,M,L,$,14,h[26]),L=b(L,U,H,M,J,20,h[27]),M=b(M,L,U,H,ce,5,h[28]),H=b(H,M,L,U,F,9,h[29]),U=b(U,H,M,L,q,14,h[30]),L=b(L,U,H,M,se,20,h[31]),M=x(M,L,U,H,G,4,h[32]),H=x(H,M,L,U,J,11,h[33]),U=x(U,H,M,L,K,16,h[34]),L=x(L,U,H,M,ye,23,h[35]),M=x(M,L,U,H,O,4,h[36]),H=x(H,M,L,U,z,11,h[37]),U=x(U,H,M,L,q,16,h[38]),L=x(L,U,H,M,le,23,h[39]),M=x(M,L,U,H,ce,4,h[40]),H=x(H,M,L,U,P,11,h[41]),U=x(U,H,M,L,$,16,h[42]),L=x(L,U,H,M,R,23,h[43]),M=x(M,L,U,H,Z,4,h[44]),H=x(H,M,L,U,se,11,h[45]),U=x(U,H,M,L,Ce,16,h[46]),L=x(L,U,H,M,F,23,h[47]),M=w(M,L,U,H,P,6,h[48]),H=w(H,M,L,U,q,10,h[49]),U=w(U,H,M,L,ye,15,h[50]),L=w(L,U,H,M,G,21,h[51]),M=w(M,L,U,H,se,6,h[52]),H=w(H,M,L,U,$,10,h[53]),U=w(U,H,M,L,le,15,h[54]),L=w(L,U,H,M,O,21,h[55]),M=w(M,L,U,H,J,6,h[56]),H=w(H,M,L,U,Ce,10,h[57]),U=w(U,H,M,L,R,15,h[58]),L=w(L,U,H,M,ce,21,h[59]),M=w(M,L,U,H,z,6,h[60]),H=w(H,M,L,U,K,10,h[61]),U=w(U,H,M,L,F,15,h[62]),L=w(L,U,H,M,Z,21,h[63]),T[0]=T[0]+M|0,T[1]=T[1]+L|0,T[2]=T[2]+U|0,T[3]=T[3]+H|0},_doFinalize:function(){var v=this._data,_=v.words,N=this._nDataBytes*8,E=v.sigBytes*8;_[E>>>5]|=128<<24-E%32;var k=n.floor(N/4294967296),T=N;_[(E+64>>>9<<4)+15]=(k<<8|k>>>24)&16711935|(k<<24|k>>>8)&4278255360,_[(E+64>>>9<<4)+14]=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360,v.sigBytes=(_.length+1)*4,this._process();for(var P=this._hash,O=P.words,F=0;F<4;F++){var $=O[F];O[F]=($<<8|$>>>24)&16711935|($<<24|$>>>8)&4278255360}return P},clone:function(){var v=l.clone.call(this);return v._hash=this._hash.clone(),v}});function g(v,_,N,E,k,T,P){var O=v+(_&N|~_&E)+k+P;return(O<<T|O>>>32-T)+_}function b(v,_,N,E,k,T,P){var O=v+(_&E|N&~E)+k+P;return(O<<T|O>>>32-T)+_}function x(v,_,N,E,k,T,P){var O=v+(_^N^E)+k+P;return(O<<T|O>>>32-T)+_}function w(v,_,N,E,k,T,P){var O=v+(N^(_|~E))+k+P;return(O<<T|O>>>32-T)+_}r.MD5=l._createHelper(p),r.HmacMD5=l._createHmacHelper(p)})(Math),t.MD5})})(Tp)),Tp.exports}var Dp={exports:{}},wE=Dp.exports,F2;function c_(){return F2||(F2=1,(function(s,e){(function(t,n){s.exports=n(Yn())})(wE,function(t){return(function(){var n=t,r=n.lib,i=r.WordArray,o=r.Hasher,l=n.algo,d=[],h=l.SHA1=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(p,g){for(var b=this._hash.words,x=b[0],w=b[1],v=b[2],_=b[3],N=b[4],E=0;E<80;E++){if(E<16)d[E]=p[g+E]|0;else{var k=d[E-3]^d[E-8]^d[E-14]^d[E-16];d[E]=k<<1|k>>>31}var T=(x<<5|x>>>27)+N+d[E];E<20?T+=(w&v|~w&_)+1518500249:E<40?T+=(w^v^_)+1859775393:E<60?T+=(w&v|w&_|v&_)-1894007588:T+=(w^v^_)-899497514,N=_,_=v,v=w<<30|w>>>2,w=x,x=T}b[0]=b[0]+x|0,b[1]=b[1]+w|0,b[2]=b[2]+v|0,b[3]=b[3]+_|0,b[4]=b[4]+N|0},_doFinalize:function(){var p=this._data,g=p.words,b=this._nDataBytes*8,x=p.sigBytes*8;return g[x>>>5]|=128<<24-x%32,g[(x+64>>>9<<4)+14]=Math.floor(b/4294967296),g[(x+64>>>9<<4)+15]=b,p.sigBytes=g.length*4,this._process(),this._hash},clone:function(){var p=o.clone.call(this);return p._hash=this._hash.clone(),p}});n.SHA1=o._createHelper(h),n.HmacSHA1=o._createHmacHelper(h)})(),t.SHA1})})(Dp)),Dp.exports}var Lp={exports:{}},SE=Lp.exports,U2;function wb(){return U2||(U2=1,(function(s,e){(function(t,n){s.exports=n(Yn())})(SE,function(t){return(function(n){var r=t,i=r.lib,o=i.WordArray,l=i.Hasher,d=r.algo,h=[],p=[];(function(){function x(N){for(var E=n.sqrt(N),k=2;k<=E;k++)if(!(N%k))return!1;return!0}function w(N){return(N-(N|0))*4294967296|0}for(var v=2,_=0;_<64;)x(v)&&(_<8&&(h[_]=w(n.pow(v,1/2))),p[_]=w(n.pow(v,1/3)),_++),v++})();var g=[],b=d.SHA256=l.extend({_doReset:function(){this._hash=new o.init(h.slice(0))},_doProcessBlock:function(x,w){for(var v=this._hash.words,_=v[0],N=v[1],E=v[2],k=v[3],T=v[4],P=v[5],O=v[6],F=v[7],$=0;$<64;$++){if($<16)g[$]=x[w+$]|0;else{var z=g[$-15],G=(z<<25|z>>>7)^(z<<14|z>>>18)^z>>>3,R=g[$-2],q=(R<<15|R>>>17)^(R<<13|R>>>19)^R>>>10;g[$]=G+g[$-7]+q+g[$-16]}var J=T&P^~T&O,Z=_&N^_&E^N&E,le=(_<<30|_>>>2)^(_<<19|_>>>13)^(_<<10|_>>>22),K=(T<<26|T>>>6)^(T<<21|T>>>11)^(T<<7|T>>>25),se=F+K+J+p[$]+g[$],ce=le+Z;F=O,O=P,P=T,T=k+se|0,k=E,E=N,N=_,_=se+ce|0}v[0]=v[0]+_|0,v[1]=v[1]+N|0,v[2]=v[2]+E|0,v[3]=v[3]+k|0,v[4]=v[4]+T|0,v[5]=v[5]+P|0,v[6]=v[6]+O|0,v[7]=v[7]+F|0},_doFinalize:function(){var x=this._data,w=x.words,v=this._nDataBytes*8,_=x.sigBytes*8;return w[_>>>5]|=128<<24-_%32,w[(_+64>>>9<<4)+14]=n.floor(v/4294967296),w[(_+64>>>9<<4)+15]=v,x.sigBytes=w.length*4,this._process(),this._hash},clone:function(){var x=l.clone.call(this);return x._hash=this._hash.clone(),x}});r.SHA256=l._createHelper(b),r.HmacSHA256=l._createHmacHelper(b)})(Math),t.SHA256})})(Lp)),Lp.exports}var Rp={exports:{}},_E=Rp.exports,z2;function AE(){return z2||(z2=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),wb())})(_E,function(t){return(function(){var n=t,r=n.lib,i=r.WordArray,o=n.algo,l=o.SHA256,d=o.SHA224=l.extend({_doReset:function(){this._hash=new i.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var h=l._doFinalize.call(this);return h.sigBytes-=4,h}});n.SHA224=l._createHelper(d),n.HmacSHA224=l._createHmacHelper(d)})(),t.SHA224})})(Rp)),Rp.exports}var Pp={exports:{}},NE=Pp.exports,$2;function u_(){return $2||($2=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),Ug())})(NE,function(t){return(function(){var n=t,r=n.lib,i=r.Hasher,o=n.x64,l=o.Word,d=o.WordArray,h=n.algo;function p(){return l.create.apply(l,arguments)}var g=[p(1116352408,3609767458),p(1899447441,602891725),p(3049323471,3964484399),p(3921009573,2173295548),p(961987163,4081628472),p(1508970993,3053834265),p(2453635748,2937671579),p(2870763221,3664609560),p(3624381080,2734883394),p(310598401,1164996542),p(607225278,1323610764),p(1426881987,3590304994),p(1925078388,4068182383),p(2162078206,991336113),p(2614888103,633803317),p(3248222580,3479774868),p(3835390401,2666613458),p(4022224774,944711139),p(264347078,2341262773),p(604807628,2007800933),p(770255983,1495990901),p(1249150122,1856431235),p(1555081692,3175218132),p(1996064986,2198950837),p(2554220882,3999719339),p(2821834349,766784016),p(2952996808,2566594879),p(3210313671,3203337956),p(3336571891,1034457026),p(3584528711,2466948901),p(113926993,3758326383),p(338241895,168717936),p(666307205,1188179964),p(773529912,1546045734),p(1294757372,1522805485),p(1396182291,2643833823),p(1695183700,2343527390),p(1986661051,1014477480),p(2177026350,1206759142),p(2456956037,344077627),p(2730485921,1290863460),p(2820302411,3158454273),p(3259730800,3505952657),p(3345764771,106217008),p(3516065817,3606008344),p(3600352804,1432725776),p(4094571909,1467031594),p(275423344,851169720),p(430227734,3100823752),p(506948616,1363258195),p(659060556,3750685593),p(883997877,3785050280),p(958139571,3318307427),p(1322822218,3812723403),p(1537002063,2003034995),p(1747873779,3602036899),p(1955562222,1575990012),p(2024104815,1125592928),p(2227730452,2716904306),p(2361852424,442776044),p(2428436474,593698344),p(2756734187,3733110249),p(3204031479,2999351573),p(3329325298,3815920427),p(3391569614,3928383900),p(3515267271,566280711),p(3940187606,3454069534),p(4118630271,4000239992),p(116418474,1914138554),p(174292421,2731055270),p(289380356,3203993006),p(460393269,320620315),p(685471733,587496836),p(852142971,1086792851),p(1017036298,365543100),p(1126000580,2618297676),p(1288033470,3409855158),p(1501505948,4234509866),p(1607167915,987167468),p(1816402316,1246189591)],b=[];(function(){for(var w=0;w<80;w++)b[w]=p()})();var x=h.SHA512=i.extend({_doReset:function(){this._hash=new d.init([new l.init(1779033703,4089235720),new l.init(3144134277,2227873595),new l.init(1013904242,4271175723),new l.init(2773480762,1595750129),new l.init(1359893119,2917565137),new l.init(2600822924,725511199),new l.init(528734635,4215389547),new l.init(1541459225,327033209)])},_doProcessBlock:function(w,v){for(var _=this._hash.words,N=_[0],E=_[1],k=_[2],T=_[3],P=_[4],O=_[5],F=_[6],$=_[7],z=N.high,G=N.low,R=E.high,q=E.low,J=k.high,Z=k.low,le=T.high,K=T.low,se=P.high,ce=P.low,ye=O.high,Ce=O.low,M=F.high,L=F.low,U=$.high,H=$.low,ae=z,de=G,xe=R,he=q,me=J,ve=Z,Re=le,Ke=K,Ge=se,ke=ce,X=ye,Pe=Ce,gt=M,bt=L,Ye=U,Et=H,vt=0;vt<80;vt++){var st,St,Pt=b[vt];if(vt<16)St=Pt.high=w[v+vt*2]|0,st=Pt.low=w[v+vt*2+1]|0;else{var Ut=b[vt-15],je=Ut.high,Me=Ut.low,Fe=(je>>>1|Me<<31)^(je>>>8|Me<<24)^je>>>7,ue=(Me>>>1|je<<31)^(Me>>>8|je<<24)^(Me>>>7|je<<25),Te=b[vt-2],Oe=Te.high,ct=Te.low,ft=(Oe>>>19|ct<<13)^(Oe<<3|ct>>>29)^Oe>>>6,wt=(ct>>>19|Oe<<13)^(ct<<3|Oe>>>29)^(ct>>>6|Oe<<26),it=b[vt-7],At=it.high,We=it.low,lt=b[vt-16],pt=lt.high,It=lt.low;st=ue+We,St=Fe+At+(st>>>0<ue>>>0?1:0),st=st+wt,St=St+ft+(st>>>0<wt>>>0?1:0),st=st+It,St=St+pt+(st>>>0<It>>>0?1:0),Pt.high=St,Pt.low=st}var en=Ge&X^~Ge&gt,Mt=ke&Pe^~ke&bt,Bt=ae&xe^ae&me^xe&me,Yt=de&he^de&ve^he&ve,On=(ae>>>28|de<<4)^(ae<<30|de>>>2)^(ae<<25|de>>>7),an=(de>>>28|ae<<4)^(de<<30|ae>>>2)^(de<<25|ae>>>7),As=(Ge>>>14|ke<<18)^(Ge>>>18|ke<<14)^(Ge<<23|ke>>>9),ut=(ke>>>14|Ge<<18)^(ke>>>18|Ge<<14)^(ke<<23|Ge>>>9),re=g[vt],Qe=re.high,mt=re.low,Xe=Et+ut,et=Ye+As+(Xe>>>0<Et>>>0?1:0),Xe=Xe+Mt,et=et+en+(Xe>>>0<Mt>>>0?1:0),Xe=Xe+mt,et=et+Qe+(Xe>>>0<mt>>>0?1:0),Xe=Xe+st,et=et+St+(Xe>>>0<st>>>0?1:0),kt=an+Yt,Tt=On+Bt+(kt>>>0<an>>>0?1:0);Ye=gt,Et=bt,gt=X,bt=Pe,X=Ge,Pe=ke,ke=Ke+Xe|0,Ge=Re+et+(ke>>>0<Ke>>>0?1:0)|0,Re=me,Ke=ve,me=xe,ve=he,xe=ae,he=de,de=Xe+kt|0,ae=et+Tt+(de>>>0<Xe>>>0?1:0)|0}G=N.low=G+de,N.high=z+ae+(G>>>0<de>>>0?1:0),q=E.low=q+he,E.high=R+xe+(q>>>0<he>>>0?1:0),Z=k.low=Z+ve,k.high=J+me+(Z>>>0<ve>>>0?1:0),K=T.low=K+Ke,T.high=le+Re+(K>>>0<Ke>>>0?1:0),ce=P.low=ce+ke,P.high=se+Ge+(ce>>>0<ke>>>0?1:0),Ce=O.low=Ce+Pe,O.high=ye+X+(Ce>>>0<Pe>>>0?1:0),L=F.low=L+bt,F.high=M+gt+(L>>>0<bt>>>0?1:0),H=$.low=H+Et,$.high=U+Ye+(H>>>0<Et>>>0?1:0)},_doFinalize:function(){var w=this._data,v=w.words,_=this._nDataBytes*8,N=w.sigBytes*8;v[N>>>5]|=128<<24-N%32,v[(N+128>>>10<<5)+30]=Math.floor(_/4294967296),v[(N+128>>>10<<5)+31]=_,w.sigBytes=v.length*4,this._process();var E=this._hash.toX32();return E},clone:function(){var w=i.clone.call(this);return w._hash=this._hash.clone(),w},blockSize:1024/32});n.SHA512=i._createHelper(x),n.HmacSHA512=i._createHmacHelper(x)})(),t.SHA512})})(Pp)),Pp.exports}var Bp={exports:{}},CE=Bp.exports,q2;function EE(){return q2||(q2=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),Ug(),u_())})(CE,function(t){return(function(){var n=t,r=n.x64,i=r.Word,o=r.WordArray,l=n.algo,d=l.SHA512,h=l.SHA384=d.extend({_doReset:function(){this._hash=new o.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var p=d._doFinalize.call(this);return p.sigBytes-=16,p}});n.SHA384=d._createHelper(h),n.HmacSHA384=d._createHmacHelper(h)})(),t.SHA384})})(Bp)),Bp.exports}var Op={exports:{}},kE=Op.exports,H2;function jE(){return H2||(H2=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),Ug())})(kE,function(t){return(function(n){var r=t,i=r.lib,o=i.WordArray,l=i.Hasher,d=r.x64,h=d.Word,p=r.algo,g=[],b=[],x=[];(function(){for(var _=1,N=0,E=0;E<24;E++){g[_+5*N]=(E+1)*(E+2)/2%64;var k=N%5,T=(2*_+3*N)%5;_=k,N=T}for(var _=0;_<5;_++)for(var N=0;N<5;N++)b[_+5*N]=N+(2*_+3*N)%5*5;for(var P=1,O=0;O<24;O++){for(var F=0,$=0,z=0;z<7;z++){if(P&1){var G=(1<<z)-1;G<32?$^=1<<G:F^=1<<G-32}P&128?P=P<<1^113:P<<=1}x[O]=h.create(F,$)}})();var w=[];(function(){for(var _=0;_<25;_++)w[_]=h.create()})();var v=p.SHA3=l.extend({cfg:l.cfg.extend({outputLength:512}),_doReset:function(){for(var _=this._state=[],N=0;N<25;N++)_[N]=new h.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(_,N){for(var E=this._state,k=this.blockSize/2,T=0;T<k;T++){var P=_[N+2*T],O=_[N+2*T+1];P=(P<<8|P>>>24)&16711935|(P<<24|P>>>8)&4278255360,O=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360;var F=E[T];F.high^=O,F.low^=P}for(var $=0;$<24;$++){for(var z=0;z<5;z++){for(var G=0,R=0,q=0;q<5;q++){var F=E[z+5*q];G^=F.high,R^=F.low}var J=w[z];J.high=G,J.low=R}for(var z=0;z<5;z++)for(var Z=w[(z+4)%5],le=w[(z+1)%5],K=le.high,se=le.low,G=Z.high^(K<<1|se>>>31),R=Z.low^(se<<1|K>>>31),q=0;q<5;q++){var F=E[z+5*q];F.high^=G,F.low^=R}for(var ce=1;ce<25;ce++){var G,R,F=E[ce],ye=F.high,Ce=F.low,M=g[ce];M<32?(G=ye<<M|Ce>>>32-M,R=Ce<<M|ye>>>32-M):(G=Ce<<M-32|ye>>>64-M,R=ye<<M-32|Ce>>>64-M);var L=w[b[ce]];L.high=G,L.low=R}var U=w[0],H=E[0];U.high=H.high,U.low=H.low;for(var z=0;z<5;z++)for(var q=0;q<5;q++){var ce=z+5*q,F=E[ce],ae=w[ce],de=w[(z+1)%5+5*q],xe=w[(z+2)%5+5*q];F.high=ae.high^~de.high&xe.high,F.low=ae.low^~de.low&xe.low}var F=E[0],he=x[$];F.high^=he.high,F.low^=he.low}},_doFinalize:function(){var _=this._data,N=_.words;this._nDataBytes*8;var E=_.sigBytes*8,k=this.blockSize*32;N[E>>>5]|=1<<24-E%32,N[(n.ceil((E+1)/k)*k>>>5)-1]|=128,_.sigBytes=N.length*4,this._process();for(var T=this._state,P=this.cfg.outputLength/8,O=P/8,F=[],$=0;$<O;$++){var z=T[$],G=z.high,R=z.low;G=(G<<8|G>>>24)&16711935|(G<<24|G>>>8)&4278255360,R=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360,F.push(R),F.push(G)}return new o.init(F,P)},clone:function(){for(var _=l.clone.call(this),N=_._state=this._state.slice(0),E=0;E<25;E++)N[E]=N[E].clone();return _}});r.SHA3=l._createHelper(v),r.HmacSHA3=l._createHmacHelper(v)})(Math),t.SHA3})})(Op)),Op.exports}var Ip={exports:{}},TE=Ip.exports,G2;function DE(){return G2||(G2=1,(function(s,e){(function(t,n){s.exports=n(Yn())})(TE,function(t){return(function(n){var r=t,i=r.lib,o=i.WordArray,l=i.Hasher,d=r.algo,h=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),p=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),g=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),b=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),x=o.create([0,1518500249,1859775393,2400959708,2840853838]),w=o.create([1352829926,1548603684,1836072691,2053994217,0]),v=d.RIPEMD160=l.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(O,F){for(var $=0;$<16;$++){var z=F+$,G=O[z];O[z]=(G<<8|G>>>24)&16711935|(G<<24|G>>>8)&4278255360}var R=this._hash.words,q=x.words,J=w.words,Z=h.words,le=p.words,K=g.words,se=b.words,ce,ye,Ce,M,L,U,H,ae,de,xe;U=ce=R[0],H=ye=R[1],ae=Ce=R[2],de=M=R[3],xe=L=R[4];for(var he,$=0;$<80;$+=1)he=ce+O[F+Z[$]]|0,$<16?he+=_(ye,Ce,M)+q[0]:$<32?he+=N(ye,Ce,M)+q[1]:$<48?he+=E(ye,Ce,M)+q[2]:$<64?he+=k(ye,Ce,M)+q[3]:he+=T(ye,Ce,M)+q[4],he=he|0,he=P(he,K[$]),he=he+L|0,ce=L,L=M,M=P(Ce,10),Ce=ye,ye=he,he=U+O[F+le[$]]|0,$<16?he+=T(H,ae,de)+J[0]:$<32?he+=k(H,ae,de)+J[1]:$<48?he+=E(H,ae,de)+J[2]:$<64?he+=N(H,ae,de)+J[3]:he+=_(H,ae,de)+J[4],he=he|0,he=P(he,se[$]),he=he+xe|0,U=xe,xe=de,de=P(ae,10),ae=H,H=he;he=R[1]+Ce+de|0,R[1]=R[2]+M+xe|0,R[2]=R[3]+L+U|0,R[3]=R[4]+ce+H|0,R[4]=R[0]+ye+ae|0,R[0]=he},_doFinalize:function(){var O=this._data,F=O.words,$=this._nDataBytes*8,z=O.sigBytes*8;F[z>>>5]|=128<<24-z%32,F[(z+64>>>9<<4)+14]=($<<8|$>>>24)&16711935|($<<24|$>>>8)&4278255360,O.sigBytes=(F.length+1)*4,this._process();for(var G=this._hash,R=G.words,q=0;q<5;q++){var J=R[q];R[q]=(J<<8|J>>>24)&16711935|(J<<24|J>>>8)&4278255360}return G},clone:function(){var O=l.clone.call(this);return O._hash=this._hash.clone(),O}});function _(O,F,$){return O^F^$}function N(O,F,$){return O&F|~O&$}function E(O,F,$){return(O|~F)^$}function k(O,F,$){return O&$|F&~$}function T(O,F,$){return O^(F|~$)}function P(O,F){return O<<F|O>>>32-F}r.RIPEMD160=l._createHelper(v),r.HmacRIPEMD160=l._createHmacHelper(v)})(),t.RIPEMD160})})(Ip)),Ip.exports}var Mp={exports:{}},LE=Mp.exports,V2;function Sb(){return V2||(V2=1,(function(s,e){(function(t,n){s.exports=n(Yn())})(LE,function(t){(function(){var n=t,r=n.lib,i=r.Base,o=n.enc,l=o.Utf8,d=n.algo;d.HMAC=i.extend({init:function(h,p){h=this._hasher=new h.init,typeof p=="string"&&(p=l.parse(p));var g=h.blockSize,b=g*4;p.sigBytes>b&&(p=h.finalize(p)),p.clamp();for(var x=this._oKey=p.clone(),w=this._iKey=p.clone(),v=x.words,_=w.words,N=0;N<g;N++)v[N]^=1549556828,_[N]^=909522486;x.sigBytes=w.sigBytes=b,this.reset()},reset:function(){var h=this._hasher;h.reset(),h.update(this._iKey)},update:function(h){return this._hasher.update(h),this},finalize:function(h){var p=this._hasher,g=p.finalize(h);p.reset();var b=p.finalize(this._oKey.clone().concat(g));return b}})})()})})(Mp)),Mp.exports}var Fp={exports:{}},RE=Fp.exports,W2;function PE(){return W2||(W2=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),wb(),Sb())})(RE,function(t){return(function(){var n=t,r=n.lib,i=r.Base,o=r.WordArray,l=n.algo,d=l.SHA256,h=l.HMAC,p=l.PBKDF2=i.extend({cfg:i.extend({keySize:128/32,hasher:d,iterations:25e4}),init:function(g){this.cfg=this.cfg.extend(g)},compute:function(g,b){for(var x=this.cfg,w=h.create(x.hasher,g),v=o.create(),_=o.create([1]),N=v.words,E=_.words,k=x.keySize,T=x.iterations;N.length<k;){var P=w.update(b).finalize(_);w.reset();for(var O=P.words,F=O.length,$=P,z=1;z<T;z++){$=w.finalize($),w.reset();for(var G=$.words,R=0;R<F;R++)O[R]^=G[R]}v.concat(P),E[0]++}return v.sigBytes=k*4,v}});n.PBKDF2=function(g,b,x){return p.create(x).compute(g,b)}})(),t.PBKDF2})})(Fp)),Fp.exports}var Up={exports:{}},BE=Up.exports,Y2;function Yc(){return Y2||(Y2=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),c_(),Sb())})(BE,function(t){return(function(){var n=t,r=n.lib,i=r.Base,o=r.WordArray,l=n.algo,d=l.MD5,h=l.EvpKDF=i.extend({cfg:i.extend({keySize:128/32,hasher:d,iterations:1}),init:function(p){this.cfg=this.cfg.extend(p)},compute:function(p,g){for(var b,x=this.cfg,w=x.hasher.create(),v=o.create(),_=v.words,N=x.keySize,E=x.iterations;_.length<N;){b&&w.update(b),b=w.update(p).finalize(g),w.reset();for(var k=1;k<E;k++)b=w.finalize(b),w.reset();v.concat(b)}return v.sigBytes=N*4,v}});n.EvpKDF=function(p,g,b){return h.create(b).compute(p,g)}})(),t.EvpKDF})})(Up)),Up.exports}var zp={exports:{}},OE=zp.exports,K2;function ti(){return K2||(K2=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),Yc())})(OE,function(t){t.lib.Cipher||(function(n){var r=t,i=r.lib,o=i.Base,l=i.WordArray,d=i.BufferedBlockAlgorithm,h=r.enc;h.Utf8;var p=h.Base64,g=r.algo,b=g.EvpKDF,x=i.Cipher=d.extend({cfg:o.extend(),createEncryptor:function(G,R){return this.create(this._ENC_XFORM_MODE,G,R)},createDecryptor:function(G,R){return this.create(this._DEC_XFORM_MODE,G,R)},init:function(G,R,q){this.cfg=this.cfg.extend(q),this._xformMode=G,this._key=R,this.reset()},reset:function(){d.reset.call(this),this._doReset()},process:function(G){return this._append(G),this._process()},finalize:function(G){G&&this._append(G);var R=this._doFinalize();return R},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function G(R){return typeof R=="string"?z:O}return function(R){return{encrypt:function(q,J,Z){return G(J).encrypt(R,q,J,Z)},decrypt:function(q,J,Z){return G(J).decrypt(R,q,J,Z)}}}})()});i.StreamCipher=x.extend({_doFinalize:function(){var G=this._process(!0);return G},blockSize:1});var w=r.mode={},v=i.BlockCipherMode=o.extend({createEncryptor:function(G,R){return this.Encryptor.create(G,R)},createDecryptor:function(G,R){return this.Decryptor.create(G,R)},init:function(G,R){this._cipher=G,this._iv=R}}),_=w.CBC=(function(){var G=v.extend();G.Encryptor=G.extend({processBlock:function(q,J){var Z=this._cipher,le=Z.blockSize;R.call(this,q,J,le),Z.encryptBlock(q,J),this._prevBlock=q.slice(J,J+le)}}),G.Decryptor=G.extend({processBlock:function(q,J){var Z=this._cipher,le=Z.blockSize,K=q.slice(J,J+le);Z.decryptBlock(q,J),R.call(this,q,J,le),this._prevBlock=K}});function R(q,J,Z){var le,K=this._iv;K?(le=K,this._iv=n):le=this._prevBlock;for(var se=0;se<Z;se++)q[J+se]^=le[se]}return G})(),N=r.pad={},E=N.Pkcs7={pad:function(G,R){for(var q=R*4,J=q-G.sigBytes%q,Z=J<<24|J<<16|J<<8|J,le=[],K=0;K<J;K+=4)le.push(Z);var se=l.create(le,J);G.concat(se)},unpad:function(G){var R=G.words[G.sigBytes-1>>>2]&255;G.sigBytes-=R}};i.BlockCipher=x.extend({cfg:x.cfg.extend({mode:_,padding:E}),reset:function(){var G;x.reset.call(this);var R=this.cfg,q=R.iv,J=R.mode;this._xformMode==this._ENC_XFORM_MODE?G=J.createEncryptor:(G=J.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==G?this._mode.init(this,q&&q.words):(this._mode=G.call(J,this,q&&q.words),this._mode.__creator=G)},_doProcessBlock:function(G,R){this._mode.processBlock(G,R)},_doFinalize:function(){var G,R=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(R.pad(this._data,this.blockSize),G=this._process(!0)):(G=this._process(!0),R.unpad(G)),G},blockSize:128/32});var k=i.CipherParams=o.extend({init:function(G){this.mixIn(G)},toString:function(G){return(G||this.formatter).stringify(this)}}),T=r.format={},P=T.OpenSSL={stringify:function(G){var R,q=G.ciphertext,J=G.salt;return J?R=l.create([1398893684,1701076831]).concat(J).concat(q):R=q,R.toString(p)},parse:function(G){var R,q=p.parse(G),J=q.words;return J[0]==1398893684&&J[1]==1701076831&&(R=l.create(J.slice(2,4)),J.splice(0,4),q.sigBytes-=16),k.create({ciphertext:q,salt:R})}},O=i.SerializableCipher=o.extend({cfg:o.extend({format:P}),encrypt:function(G,R,q,J){J=this.cfg.extend(J);var Z=G.createEncryptor(q,J),le=Z.finalize(R),K=Z.cfg;return k.create({ciphertext:le,key:q,iv:K.iv,algorithm:G,mode:K.mode,padding:K.padding,blockSize:G.blockSize,formatter:J.format})},decrypt:function(G,R,q,J){J=this.cfg.extend(J),R=this._parse(R,J.format);var Z=G.createDecryptor(q,J).finalize(R.ciphertext);return Z},_parse:function(G,R){return typeof G=="string"?R.parse(G,this):G}}),F=r.kdf={},$=F.OpenSSL={execute:function(G,R,q,J,Z){if(J||(J=l.random(64/8)),Z)var le=b.create({keySize:R+q,hasher:Z}).compute(G,J);else var le=b.create({keySize:R+q}).compute(G,J);var K=l.create(le.words.slice(R),q*4);return le.sigBytes=R*4,k.create({key:le,iv:K,salt:J})}},z=i.PasswordBasedCipher=O.extend({cfg:O.cfg.extend({kdf:$}),encrypt:function(G,R,q,J){J=this.cfg.extend(J);var Z=J.kdf.execute(q,G.keySize,G.ivSize,J.salt,J.hasher);J.iv=Z.iv;var le=O.encrypt.call(this,G,R,Z.key,J);return le.mixIn(Z),le},decrypt:function(G,R,q,J){J=this.cfg.extend(J),R=this._parse(R,J.format);var Z=J.kdf.execute(q,G.keySize,G.ivSize,R.salt,J.hasher);J.iv=Z.iv;var le=O.decrypt.call(this,G,R,Z.key,J);return le}})})()})})(zp)),zp.exports}var $p={exports:{}},IE=$p.exports,X2;function ME(){return X2||(X2=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),ti())})(IE,function(t){return t.mode.CFB=(function(){var n=t.lib.BlockCipherMode.extend();n.Encryptor=n.extend({processBlock:function(i,o){var l=this._cipher,d=l.blockSize;r.call(this,i,o,d,l),this._prevBlock=i.slice(o,o+d)}}),n.Decryptor=n.extend({processBlock:function(i,o){var l=this._cipher,d=l.blockSize,h=i.slice(o,o+d);r.call(this,i,o,d,l),this._prevBlock=h}});function r(i,o,l,d){var h,p=this._iv;p?(h=p.slice(0),this._iv=void 0):h=this._prevBlock,d.encryptBlock(h,0);for(var g=0;g<l;g++)i[o+g]^=h[g]}return n})(),t.mode.CFB})})($p)),$p.exports}var qp={exports:{}},FE=qp.exports,J2;function UE(){return J2||(J2=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),ti())})(FE,function(t){return t.mode.CTR=(function(){var n=t.lib.BlockCipherMode.extend(),r=n.Encryptor=n.extend({processBlock:function(i,o){var l=this._cipher,d=l.blockSize,h=this._iv,p=this._counter;h&&(p=this._counter=h.slice(0),this._iv=void 0);var g=p.slice(0);l.encryptBlock(g,0),p[d-1]=p[d-1]+1|0;for(var b=0;b<d;b++)i[o+b]^=g[b]}});return n.Decryptor=r,n})(),t.mode.CTR})})(qp)),qp.exports}var Hp={exports:{}},zE=Hp.exports,Z2;function $E(){return Z2||(Z2=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),ti())})(zE,function(t){return t.mode.CTRGladman=(function(){var n=t.lib.BlockCipherMode.extend();function r(l){if((l>>24&255)===255){var d=l>>16&255,h=l>>8&255,p=l&255;d===255?(d=0,h===255?(h=0,p===255?p=0:++p):++h):++d,l=0,l+=d<<16,l+=h<<8,l+=p}else l+=1<<24;return l}function i(l){return(l[0]=r(l[0]))===0&&(l[1]=r(l[1])),l}var o=n.Encryptor=n.extend({processBlock:function(l,d){var h=this._cipher,p=h.blockSize,g=this._iv,b=this._counter;g&&(b=this._counter=g.slice(0),this._iv=void 0),i(b);var x=b.slice(0);h.encryptBlock(x,0);for(var w=0;w<p;w++)l[d+w]^=x[w]}});return n.Decryptor=o,n})(),t.mode.CTRGladman})})(Hp)),Hp.exports}var Gp={exports:{}},qE=Gp.exports,Q2;function HE(){return Q2||(Q2=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),ti())})(qE,function(t){return t.mode.OFB=(function(){var n=t.lib.BlockCipherMode.extend(),r=n.Encryptor=n.extend({processBlock:function(i,o){var l=this._cipher,d=l.blockSize,h=this._iv,p=this._keystream;h&&(p=this._keystream=h.slice(0),this._iv=void 0),l.encryptBlock(p,0);for(var g=0;g<d;g++)i[o+g]^=p[g]}});return n.Decryptor=r,n})(),t.mode.OFB})})(Gp)),Gp.exports}var Vp={exports:{}},GE=Vp.exports,ew;function VE(){return ew||(ew=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),ti())})(GE,function(t){return t.mode.ECB=(function(){var n=t.lib.BlockCipherMode.extend();return n.Encryptor=n.extend({processBlock:function(r,i){this._cipher.encryptBlock(r,i)}}),n.Decryptor=n.extend({processBlock:function(r,i){this._cipher.decryptBlock(r,i)}}),n})(),t.mode.ECB})})(Vp)),Vp.exports}var Wp={exports:{}},WE=Wp.exports,tw;function YE(){return tw||(tw=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),ti())})(WE,function(t){return t.pad.AnsiX923={pad:function(n,r){var i=n.sigBytes,o=r*4,l=o-i%o,d=i+l-1;n.clamp(),n.words[d>>>2]|=l<<24-d%4*8,n.sigBytes+=l},unpad:function(n){var r=n.words[n.sigBytes-1>>>2]&255;n.sigBytes-=r}},t.pad.Ansix923})})(Wp)),Wp.exports}var Yp={exports:{}},KE=Yp.exports,nw;function XE(){return nw||(nw=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),ti())})(KE,function(t){return t.pad.Iso10126={pad:function(n,r){var i=r*4,o=i-n.sigBytes%i;n.concat(t.lib.WordArray.random(o-1)).concat(t.lib.WordArray.create([o<<24],1))},unpad:function(n){var r=n.words[n.sigBytes-1>>>2]&255;n.sigBytes-=r}},t.pad.Iso10126})})(Yp)),Yp.exports}var Kp={exports:{}},JE=Kp.exports,sw;function ZE(){return sw||(sw=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),ti())})(JE,function(t){return t.pad.Iso97971={pad:function(n,r){n.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(n,r)},unpad:function(n){t.pad.ZeroPadding.unpad(n),n.sigBytes--}},t.pad.Iso97971})})(Kp)),Kp.exports}var Xp={exports:{}},QE=Xp.exports,rw;function ek(){return rw||(rw=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),ti())})(QE,function(t){return t.pad.ZeroPadding={pad:function(n,r){var i=r*4;n.clamp(),n.sigBytes+=i-(n.sigBytes%i||i)},unpad:function(n){for(var r=n.words,i=n.sigBytes-1,i=n.sigBytes-1;i>=0;i--)if(r[i>>>2]>>>24-i%4*8&255){n.sigBytes=i+1;break}}},t.pad.ZeroPadding})})(Xp)),Xp.exports}var Jp={exports:{}},tk=Jp.exports,iw;function nk(){return iw||(iw=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),ti())})(tk,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})})(Jp)),Jp.exports}var Zp={exports:{}},sk=Zp.exports,aw;function rk(){return aw||(aw=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),ti())})(sk,function(t){return(function(n){var r=t,i=r.lib,o=i.CipherParams,l=r.enc,d=l.Hex,h=r.format;h.Hex={stringify:function(p){return p.ciphertext.toString(d)},parse:function(p){var g=d.parse(p);return o.create({ciphertext:g})}}})(),t.format.Hex})})(Zp)),Zp.exports}var Qp={exports:{}},ik=Qp.exports,ow;function ak(){return ow||(ow=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),Uu(),zu(),Yc(),ti())})(ik,function(t){return(function(){var n=t,r=n.lib,i=r.BlockCipher,o=n.algo,l=[],d=[],h=[],p=[],g=[],b=[],x=[],w=[],v=[],_=[];(function(){for(var k=[],T=0;T<256;T++)T<128?k[T]=T<<1:k[T]=T<<1^283;for(var P=0,O=0,T=0;T<256;T++){var F=O^O<<1^O<<2^O<<3^O<<4;F=F>>>8^F&255^99,l[P]=F,d[F]=P;var $=k[P],z=k[$],G=k[z],R=k[F]*257^F*16843008;h[P]=R<<24|R>>>8,p[P]=R<<16|R>>>16,g[P]=R<<8|R>>>24,b[P]=R;var R=G*16843009^z*65537^$*257^P*16843008;x[F]=R<<24|R>>>8,w[F]=R<<16|R>>>16,v[F]=R<<8|R>>>24,_[F]=R,P?(P=$^k[k[k[G^$]]],O^=k[k[O]]):P=O=1}})();var N=[0,1,2,4,8,16,32,64,128,27,54],E=o.AES=i.extend({_doReset:function(){var k;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var T=this._keyPriorReset=this._key,P=T.words,O=T.sigBytes/4,F=this._nRounds=O+6,$=(F+1)*4,z=this._keySchedule=[],G=0;G<$;G++)G<O?z[G]=P[G]:(k=z[G-1],G%O?O>6&&G%O==4&&(k=l[k>>>24]<<24|l[k>>>16&255]<<16|l[k>>>8&255]<<8|l[k&255]):(k=k<<8|k>>>24,k=l[k>>>24]<<24|l[k>>>16&255]<<16|l[k>>>8&255]<<8|l[k&255],k^=N[G/O|0]<<24),z[G]=z[G-O]^k);for(var R=this._invKeySchedule=[],q=0;q<$;q++){var G=$-q;if(q%4)var k=z[G];else var k=z[G-4];q<4||G<=4?R[q]=k:R[q]=x[l[k>>>24]]^w[l[k>>>16&255]]^v[l[k>>>8&255]]^_[l[k&255]]}}},encryptBlock:function(k,T){this._doCryptBlock(k,T,this._keySchedule,h,p,g,b,l)},decryptBlock:function(k,T){var P=k[T+1];k[T+1]=k[T+3],k[T+3]=P,this._doCryptBlock(k,T,this._invKeySchedule,x,w,v,_,d);var P=k[T+1];k[T+1]=k[T+3],k[T+3]=P},_doCryptBlock:function(k,T,P,O,F,$,z,G){for(var R=this._nRounds,q=k[T]^P[0],J=k[T+1]^P[1],Z=k[T+2]^P[2],le=k[T+3]^P[3],K=4,se=1;se<R;se++){var ce=O[q>>>24]^F[J>>>16&255]^$[Z>>>8&255]^z[le&255]^P[K++],ye=O[J>>>24]^F[Z>>>16&255]^$[le>>>8&255]^z[q&255]^P[K++],Ce=O[Z>>>24]^F[le>>>16&255]^$[q>>>8&255]^z[J&255]^P[K++],M=O[le>>>24]^F[q>>>16&255]^$[J>>>8&255]^z[Z&255]^P[K++];q=ce,J=ye,Z=Ce,le=M}var ce=(G[q>>>24]<<24|G[J>>>16&255]<<16|G[Z>>>8&255]<<8|G[le&255])^P[K++],ye=(G[J>>>24]<<24|G[Z>>>16&255]<<16|G[le>>>8&255]<<8|G[q&255])^P[K++],Ce=(G[Z>>>24]<<24|G[le>>>16&255]<<16|G[q>>>8&255]<<8|G[J&255])^P[K++],M=(G[le>>>24]<<24|G[q>>>16&255]<<16|G[J>>>8&255]<<8|G[Z&255])^P[K++];k[T]=ce,k[T+1]=ye,k[T+2]=Ce,k[T+3]=M},keySize:256/32});n.AES=i._createHelper(E)})(),t.AES})})(Qp)),Qp.exports}var eg={exports:{}},ok=eg.exports,lw;function lk(){return lw||(lw=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),Uu(),zu(),Yc(),ti())})(ok,function(t){return(function(){var n=t,r=n.lib,i=r.WordArray,o=r.BlockCipher,l=n.algo,d=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],h=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],p=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],g=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],b=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],x=l.DES=o.extend({_doReset:function(){for(var N=this._key,E=N.words,k=[],T=0;T<56;T++){var P=d[T]-1;k[T]=E[P>>>5]>>>31-P%32&1}for(var O=this._subKeys=[],F=0;F<16;F++){for(var $=O[F]=[],z=p[F],T=0;T<24;T++)$[T/6|0]|=k[(h[T]-1+z)%28]<<31-T%6,$[4+(T/6|0)]|=k[28+(h[T+24]-1+z)%28]<<31-T%6;$[0]=$[0]<<1|$[0]>>>31;for(var T=1;T<7;T++)$[T]=$[T]>>>(T-1)*4+3;$[7]=$[7]<<5|$[7]>>>27}for(var G=this._invSubKeys=[],T=0;T<16;T++)G[T]=O[15-T]},encryptBlock:function(N,E){this._doCryptBlock(N,E,this._subKeys)},decryptBlock:function(N,E){this._doCryptBlock(N,E,this._invSubKeys)},_doCryptBlock:function(N,E,k){this._lBlock=N[E],this._rBlock=N[E+1],w.call(this,4,252645135),w.call(this,16,65535),v.call(this,2,858993459),v.call(this,8,16711935),w.call(this,1,1431655765);for(var T=0;T<16;T++){for(var P=k[T],O=this._lBlock,F=this._rBlock,$=0,z=0;z<8;z++)$|=g[z][((F^P[z])&b[z])>>>0];this._lBlock=F,this._rBlock=O^$}var G=this._lBlock;this._lBlock=this._rBlock,this._rBlock=G,w.call(this,1,1431655765),v.call(this,8,16711935),v.call(this,2,858993459),w.call(this,16,65535),w.call(this,4,252645135),N[E]=this._lBlock,N[E+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function w(N,E){var k=(this._lBlock>>>N^this._rBlock)&E;this._rBlock^=k,this._lBlock^=k<<N}function v(N,E){var k=(this._rBlock>>>N^this._lBlock)&E;this._lBlock^=k,this._rBlock^=k<<N}n.DES=o._createHelper(x);var _=l.TripleDES=o.extend({_doReset:function(){var N=this._key,E=N.words;if(E.length!==2&&E.length!==4&&E.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var k=E.slice(0,2),T=E.length<4?E.slice(0,2):E.slice(2,4),P=E.length<6?E.slice(0,2):E.slice(4,6);this._des1=x.createEncryptor(i.create(k)),this._des2=x.createEncryptor(i.create(T)),this._des3=x.createEncryptor(i.create(P))},encryptBlock:function(N,E){this._des1.encryptBlock(N,E),this._des2.decryptBlock(N,E),this._des3.encryptBlock(N,E)},decryptBlock:function(N,E){this._des3.decryptBlock(N,E),this._des2.encryptBlock(N,E),this._des1.decryptBlock(N,E)},keySize:192/32,ivSize:64/32,blockSize:64/32});n.TripleDES=o._createHelper(_)})(),t.TripleDES})})(eg)),eg.exports}var tg={exports:{}},ck=tg.exports,cw;function uk(){return cw||(cw=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),Uu(),zu(),Yc(),ti())})(ck,function(t){return(function(){var n=t,r=n.lib,i=r.StreamCipher,o=n.algo,l=o.RC4=i.extend({_doReset:function(){for(var p=this._key,g=p.words,b=p.sigBytes,x=this._S=[],w=0;w<256;w++)x[w]=w;for(var w=0,v=0;w<256;w++){var _=w%b,N=g[_>>>2]>>>24-_%4*8&255;v=(v+x[w]+N)%256;var E=x[w];x[w]=x[v],x[v]=E}this._i=this._j=0},_doProcessBlock:function(p,g){p[g]^=d.call(this)},keySize:256/32,ivSize:0});function d(){for(var p=this._S,g=this._i,b=this._j,x=0,w=0;w<4;w++){g=(g+1)%256,b=(b+p[g])%256;var v=p[g];p[g]=p[b],p[b]=v,x|=p[(p[g]+p[b])%256]<<24-w*8}return this._i=g,this._j=b,x}n.RC4=i._createHelper(l);var h=o.RC4Drop=l.extend({cfg:l.cfg.extend({drop:192}),_doReset:function(){l._doReset.call(this);for(var p=this.cfg.drop;p>0;p--)d.call(this)}});n.RC4Drop=i._createHelper(h)})(),t.RC4})})(tg)),tg.exports}var ng={exports:{}},dk=ng.exports,uw;function hk(){return uw||(uw=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),Uu(),zu(),Yc(),ti())})(dk,function(t){return(function(){var n=t,r=n.lib,i=r.StreamCipher,o=n.algo,l=[],d=[],h=[],p=o.Rabbit=i.extend({_doReset:function(){for(var b=this._key.words,x=this.cfg.iv,w=0;w<4;w++)b[w]=(b[w]<<8|b[w]>>>24)&16711935|(b[w]<<24|b[w]>>>8)&4278255360;var v=this._X=[b[0],b[3]<<16|b[2]>>>16,b[1],b[0]<<16|b[3]>>>16,b[2],b[1]<<16|b[0]>>>16,b[3],b[2]<<16|b[1]>>>16],_=this._C=[b[2]<<16|b[2]>>>16,b[0]&4294901760|b[1]&65535,b[3]<<16|b[3]>>>16,b[1]&4294901760|b[2]&65535,b[0]<<16|b[0]>>>16,b[2]&4294901760|b[3]&65535,b[1]<<16|b[1]>>>16,b[3]&4294901760|b[0]&65535];this._b=0;for(var w=0;w<4;w++)g.call(this);for(var w=0;w<8;w++)_[w]^=v[w+4&7];if(x){var N=x.words,E=N[0],k=N[1],T=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,P=(k<<8|k>>>24)&16711935|(k<<24|k>>>8)&4278255360,O=T>>>16|P&4294901760,F=P<<16|T&65535;_[0]^=T,_[1]^=O,_[2]^=P,_[3]^=F,_[4]^=T,_[5]^=O,_[6]^=P,_[7]^=F;for(var w=0;w<4;w++)g.call(this)}},_doProcessBlock:function(b,x){var w=this._X;g.call(this),l[0]=w[0]^w[5]>>>16^w[3]<<16,l[1]=w[2]^w[7]>>>16^w[5]<<16,l[2]=w[4]^w[1]>>>16^w[7]<<16,l[3]=w[6]^w[3]>>>16^w[1]<<16;for(var v=0;v<4;v++)l[v]=(l[v]<<8|l[v]>>>24)&16711935|(l[v]<<24|l[v]>>>8)&4278255360,b[x+v]^=l[v]},blockSize:128/32,ivSize:64/32});function g(){for(var b=this._X,x=this._C,w=0;w<8;w++)d[w]=x[w];x[0]=x[0]+1295307597+this._b|0,x[1]=x[1]+3545052371+(x[0]>>>0<d[0]>>>0?1:0)|0,x[2]=x[2]+886263092+(x[1]>>>0<d[1]>>>0?1:0)|0,x[3]=x[3]+1295307597+(x[2]>>>0<d[2]>>>0?1:0)|0,x[4]=x[4]+3545052371+(x[3]>>>0<d[3]>>>0?1:0)|0,x[5]=x[5]+886263092+(x[4]>>>0<d[4]>>>0?1:0)|0,x[6]=x[6]+1295307597+(x[5]>>>0<d[5]>>>0?1:0)|0,x[7]=x[7]+3545052371+(x[6]>>>0<d[6]>>>0?1:0)|0,this._b=x[7]>>>0<d[7]>>>0?1:0;for(var w=0;w<8;w++){var v=b[w]+x[w],_=v&65535,N=v>>>16,E=((_*_>>>17)+_*N>>>15)+N*N,k=((v&4294901760)*v|0)+((v&65535)*v|0);h[w]=E^k}b[0]=h[0]+(h[7]<<16|h[7]>>>16)+(h[6]<<16|h[6]>>>16)|0,b[1]=h[1]+(h[0]<<8|h[0]>>>24)+h[7]|0,b[2]=h[2]+(h[1]<<16|h[1]>>>16)+(h[0]<<16|h[0]>>>16)|0,b[3]=h[3]+(h[2]<<8|h[2]>>>24)+h[1]|0,b[4]=h[4]+(h[3]<<16|h[3]>>>16)+(h[2]<<16|h[2]>>>16)|0,b[5]=h[5]+(h[4]<<8|h[4]>>>24)+h[3]|0,b[6]=h[6]+(h[5]<<16|h[5]>>>16)+(h[4]<<16|h[4]>>>16)|0,b[7]=h[7]+(h[6]<<8|h[6]>>>24)+h[5]|0}n.Rabbit=i._createHelper(p)})(),t.Rabbit})})(ng)),ng.exports}var sg={exports:{}},fk=sg.exports,dw;function pk(){return dw||(dw=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),Uu(),zu(),Yc(),ti())})(fk,function(t){return(function(){var n=t,r=n.lib,i=r.StreamCipher,o=n.algo,l=[],d=[],h=[],p=o.RabbitLegacy=i.extend({_doReset:function(){var b=this._key.words,x=this.cfg.iv,w=this._X=[b[0],b[3]<<16|b[2]>>>16,b[1],b[0]<<16|b[3]>>>16,b[2],b[1]<<16|b[0]>>>16,b[3],b[2]<<16|b[1]>>>16],v=this._C=[b[2]<<16|b[2]>>>16,b[0]&4294901760|b[1]&65535,b[3]<<16|b[3]>>>16,b[1]&4294901760|b[2]&65535,b[0]<<16|b[0]>>>16,b[2]&4294901760|b[3]&65535,b[1]<<16|b[1]>>>16,b[3]&4294901760|b[0]&65535];this._b=0;for(var _=0;_<4;_++)g.call(this);for(var _=0;_<8;_++)v[_]^=w[_+4&7];if(x){var N=x.words,E=N[0],k=N[1],T=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,P=(k<<8|k>>>24)&16711935|(k<<24|k>>>8)&4278255360,O=T>>>16|P&4294901760,F=P<<16|T&65535;v[0]^=T,v[1]^=O,v[2]^=P,v[3]^=F,v[4]^=T,v[5]^=O,v[6]^=P,v[7]^=F;for(var _=0;_<4;_++)g.call(this)}},_doProcessBlock:function(b,x){var w=this._X;g.call(this),l[0]=w[0]^w[5]>>>16^w[3]<<16,l[1]=w[2]^w[7]>>>16^w[5]<<16,l[2]=w[4]^w[1]>>>16^w[7]<<16,l[3]=w[6]^w[3]>>>16^w[1]<<16;for(var v=0;v<4;v++)l[v]=(l[v]<<8|l[v]>>>24)&16711935|(l[v]<<24|l[v]>>>8)&4278255360,b[x+v]^=l[v]},blockSize:128/32,ivSize:64/32});function g(){for(var b=this._X,x=this._C,w=0;w<8;w++)d[w]=x[w];x[0]=x[0]+1295307597+this._b|0,x[1]=x[1]+3545052371+(x[0]>>>0<d[0]>>>0?1:0)|0,x[2]=x[2]+886263092+(x[1]>>>0<d[1]>>>0?1:0)|0,x[3]=x[3]+1295307597+(x[2]>>>0<d[2]>>>0?1:0)|0,x[4]=x[4]+3545052371+(x[3]>>>0<d[3]>>>0?1:0)|0,x[5]=x[5]+886263092+(x[4]>>>0<d[4]>>>0?1:0)|0,x[6]=x[6]+1295307597+(x[5]>>>0<d[5]>>>0?1:0)|0,x[7]=x[7]+3545052371+(x[6]>>>0<d[6]>>>0?1:0)|0,this._b=x[7]>>>0<d[7]>>>0?1:0;for(var w=0;w<8;w++){var v=b[w]+x[w],_=v&65535,N=v>>>16,E=((_*_>>>17)+_*N>>>15)+N*N,k=((v&4294901760)*v|0)+((v&65535)*v|0);h[w]=E^k}b[0]=h[0]+(h[7]<<16|h[7]>>>16)+(h[6]<<16|h[6]>>>16)|0,b[1]=h[1]+(h[0]<<8|h[0]>>>24)+h[7]|0,b[2]=h[2]+(h[1]<<16|h[1]>>>16)+(h[0]<<16|h[0]>>>16)|0,b[3]=h[3]+(h[2]<<8|h[2]>>>24)+h[1]|0,b[4]=h[4]+(h[3]<<16|h[3]>>>16)+(h[2]<<16|h[2]>>>16)|0,b[5]=h[5]+(h[4]<<8|h[4]>>>24)+h[3]|0,b[6]=h[6]+(h[5]<<16|h[5]>>>16)+(h[4]<<16|h[4]>>>16)|0,b[7]=h[7]+(h[6]<<8|h[6]>>>24)+h[5]|0}n.RabbitLegacy=i._createHelper(p)})(),t.RabbitLegacy})})(sg)),sg.exports}var rg={exports:{}},gk=rg.exports,hw;function mk(){return hw||(hw=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),Uu(),zu(),Yc(),ti())})(gk,function(t){return(function(){var n=t,r=n.lib,i=r.BlockCipher,o=n.algo;const l=16,d=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],h=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var p={pbox:[],sbox:[]};function g(_,N){let E=N>>24&255,k=N>>16&255,T=N>>8&255,P=N&255,O=_.sbox[0][E]+_.sbox[1][k];return O=O^_.sbox[2][T],O=O+_.sbox[3][P],O}function b(_,N,E){let k=N,T=E,P;for(let O=0;O<l;++O)k=k^_.pbox[O],T=g(_,k)^T,P=k,k=T,T=P;return P=k,k=T,T=P,T=T^_.pbox[l],k=k^_.pbox[l+1],{left:k,right:T}}function x(_,N,E){let k=N,T=E,P;for(let O=l+1;O>1;--O)k=k^_.pbox[O],T=g(_,k)^T,P=k,k=T,T=P;return P=k,k=T,T=P,T=T^_.pbox[1],k=k^_.pbox[0],{left:k,right:T}}function w(_,N,E){for(let F=0;F<4;F++){_.sbox[F]=[];for(let $=0;$<256;$++)_.sbox[F][$]=h[F][$]}let k=0;for(let F=0;F<l+2;F++)_.pbox[F]=d[F]^N[k],k++,k>=E&&(k=0);let T=0,P=0,O=0;for(let F=0;F<l+2;F+=2)O=b(_,T,P),T=O.left,P=O.right,_.pbox[F]=T,_.pbox[F+1]=P;for(let F=0;F<4;F++)for(let $=0;$<256;$+=2)O=b(_,T,P),T=O.left,P=O.right,_.sbox[F][$]=T,_.sbox[F][$+1]=P;return!0}var v=o.Blowfish=i.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var _=this._keyPriorReset=this._key,N=_.words,E=_.sigBytes/4;w(p,N,E)}},encryptBlock:function(_,N){var E=b(p,_[N],_[N+1]);_[N]=E.left,_[N+1]=E.right},decryptBlock:function(_,N){var E=x(p,_[N],_[N+1]);_[N]=E.left,_[N+1]=E.right},blockSize:64/32,keySize:128/32,ivSize:64/32});n.Blowfish=i._createHelper(v)})(),t.Blowfish})})(rg)),rg.exports}var xk=_p.exports,fw;function bk(){return fw||(fw=1,(function(s,e){(function(t,n,r){s.exports=n(Yn(),Ug(),pE(),mE(),Uu(),yE(),zu(),c_(),wb(),AE(),u_(),EE(),jE(),DE(),Sb(),PE(),Yc(),ti(),ME(),UE(),$E(),HE(),VE(),YE(),XE(),ZE(),ek(),nk(),rk(),ak(),lk(),uk(),hk(),pk(),mk())})(xk,function(t){return t})})(_p)),_p.exports}var yk=bk();const uf=Ig(yk),vk="/assets/profile-CNnUK3VC.jpg";function zg(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(s);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(s,n[r])&&(t[n[r]]=s[n[r]]);return t}function wk(s,e,t,n){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(p){try{h(n.next(p))}catch(g){o(g)}}function d(p){try{h(n.throw(p))}catch(g){o(g)}}function h(p){p.done?i(p.value):r(p.value).then(l,d)}h((n=n.apply(s,e||[])).next())})}const Sk=s=>s?(...e)=>s(...e):(...e)=>fetch(...e);class _b extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class _k extends _b{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class pw extends _b{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class gw extends _b{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var S1;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(S1||(S1={}));class Ak{constructor(e,{headers:t={},customFetch:n,region:r=S1.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=Sk(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return wk(this,arguments,void 0,function*(t,n={}){var r;let i,o;try{const{headers:l,method:d,body:h,signal:p,timeout:g}=n;let b={},{region:x}=n;x||(x=this.region);const w=new URL(`${this.url}/${t}`);x&&x!=="any"&&(b["x-region"]=x,w.searchParams.set("forceFunctionRegion",x));let v;h&&(l&&!Object.prototype.hasOwnProperty.call(l,"Content-Type")||!l)?typeof Blob<"u"&&h instanceof Blob||h instanceof ArrayBuffer?(b["Content-Type"]="application/octet-stream",v=h):typeof h=="string"?(b["Content-Type"]="text/plain",v=h):typeof FormData<"u"&&h instanceof FormData?v=h:(b["Content-Type"]="application/json",v=JSON.stringify(h)):h&&typeof h!="string"&&!(typeof Blob<"u"&&h instanceof Blob)&&!(h instanceof ArrayBuffer)&&!(typeof FormData<"u"&&h instanceof FormData)?v=JSON.stringify(h):v=h;let _=p;g&&(o=new AbortController,i=setTimeout(()=>o.abort(),g),p?(_=o.signal,p.addEventListener("abort",()=>o.abort())):_=o.signal);const N=yield this.fetch(w.toString(),{method:d||"POST",headers:Object.assign(Object.assign(Object.assign({},b),this.headers),l),body:v,signal:_}).catch(P=>{throw new _k(P)}),E=N.headers.get("x-relay-error");if(E&&E==="true")throw new pw(N);if(!N.ok)throw new gw(N);let k=((r=N.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),T;return k==="application/json"?T=yield N.json():k==="application/octet-stream"||k==="application/pdf"?T=yield N.blob():k==="text/event-stream"?T=N:k==="multipart/form-data"?T=yield N.formData():T=yield N.text(),{data:T,error:null,response:N}}catch(l){return{data:null,error:l,response:l instanceof gw||l instanceof pw?l.context:void 0}}finally{i&&clearTimeout(i)}})}}var Nk=class extends Error{constructor(s){super(s.message),this.name="PostgrestError",this.details=s.details,this.hint=s.hint,this.code=s.code}},Ck=class{constructor(s){var e,t,n;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(e=s.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=s.signal,this.isMaybeSingle=(t=s.isMaybeSingle)!==null&&t!==void 0?t:!1,this.urlLengthLimit=(n=s.urlLengthLimit)!==null&&n!==void 0?n:8e3,s.fetch?this.fetch=s.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,e){return this.headers=new Headers(this.headers),this.headers.set(s,e),this}then(s,e){var t=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let r=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,l=null,d=null,h=i.status,p=i.statusText;if(i.ok){var g,b;if(t.method!=="HEAD"){var x;const N=await i.text();N===""||(t.headers.get("Accept")==="text/csv"||t.headers.get("Accept")&&(!((x=t.headers.get("Accept"))===null||x===void 0)&&x.includes("application/vnd.pgrst.plan+text"))?l=N:l=JSON.parse(N))}const v=(g=t.headers.get("Prefer"))===null||g===void 0?void 0:g.match(/count=(exact|planned|estimated)/),_=(b=i.headers.get("content-range"))===null||b===void 0?void 0:b.split("/");v&&_&&_.length>1&&(d=parseInt(_[1])),t.isMaybeSingle&&t.method==="GET"&&Array.isArray(l)&&(l.length>1?(o={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,d=null,h=406,p="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{var w;const v=await i.text();try{o=JSON.parse(v),Array.isArray(o)&&i.status===404&&(l=[],o=null,h=200,p="OK")}catch{i.status===404&&v===""?(h=204,p="No Content"):o={message:v}}if(o&&t.isMaybeSingle&&(!(o==null||(w=o.details)===null||w===void 0)&&w.includes("0 rows"))&&(o=null,h=200,p="OK"),o&&t.shouldThrowOnError)throw new Nk(o)}return{error:o,data:l,count:d,status:h,statusText:p}});return this.shouldThrowOnError||(r=r.catch(i=>{var o;let l="",d="",h="";const p=i?.cause;if(p){var g,b,x,w;const N=(g=p?.message)!==null&&g!==void 0?g:"",E=(b=p?.code)!==null&&b!==void 0?b:"";l=`${(x=i?.name)!==null&&x!==void 0?x:"FetchError"}: ${i?.message}`,l+=`

Caused by: ${(w=p?.name)!==null&&w!==void 0?w:"Error"}: ${N}`,E&&(l+=` (${E})`),p?.stack&&(l+=`
${p.stack}`)}else{var v;l=(v=i?.stack)!==null&&v!==void 0?v:""}const _=this.url.toString().length;return i?.name==="AbortError"||i?.code==="ABORT_ERR"?(h="",d="Request was aborted (timeout or manual cancellation)",_>this.urlLengthLimit&&(d+=`. Note: Your request URL is ${_} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):(p?.name==="HeadersOverflowError"||p?.code==="UND_ERR_HEADERS_OVERFLOW")&&(h="",d="HTTP headers exceeded server limits (typically 16KB)",_>this.urlLengthLimit&&(d+=`. Your request URL is ${_} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(o=i?.name)!==null&&o!==void 0?o:"FetchError"}: ${i?.message}`,details:l,hint:d,code:h},data:null,count:null,status:0,statusText:""}})),r.then(s,e)}returns(){return this}overrideTypes(){return this}},Ek=class extends Ck{select(s){let e=!1;const t=(s??"*").split("").map(n=>/\s/.test(n)&&!e?"":(n==='"'&&(e=!e),n)).join("");return this.url.searchParams.set("select",t),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:e=!0,nullsFirst:t,foreignTable:n,referencedTable:r=n}={}){const i=r?`${r}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${s}.${e?"asc":"desc"}${t===void 0?"":t?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:e,referencedTable:t=e}={}){const n=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(n,`${s}`),this}range(s,e,{foreignTable:t,referencedTable:n=t}={}){const r=typeof n>"u"?"offset":`${n}.offset`,i=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${s}`),this.url.searchParams.set(i,`${e-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:e=!1,settings:t=!1,buffers:n=!1,wal:r=!1,format:i="text"}={}){var o;const l=[s?"analyze":null,e?"verbose":null,t?"settings":null,n?"buffers":null,r?"wal":null].filter(Boolean).join("|"),d=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${d}"; options=${l};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}};const mw=new RegExp("[,()]");var Gd=class extends Ek{eq(s,e){return this.url.searchParams.append(s,`eq.${e}`),this}neq(s,e){return this.url.searchParams.append(s,`neq.${e}`),this}gt(s,e){return this.url.searchParams.append(s,`gt.${e}`),this}gte(s,e){return this.url.searchParams.append(s,`gte.${e}`),this}lt(s,e){return this.url.searchParams.append(s,`lt.${e}`),this}lte(s,e){return this.url.searchParams.append(s,`lte.${e}`),this}like(s,e){return this.url.searchParams.append(s,`like.${e}`),this}likeAllOf(s,e){return this.url.searchParams.append(s,`like(all).{${e.join(",")}}`),this}likeAnyOf(s,e){return this.url.searchParams.append(s,`like(any).{${e.join(",")}}`),this}ilike(s,e){return this.url.searchParams.append(s,`ilike.${e}`),this}ilikeAllOf(s,e){return this.url.searchParams.append(s,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(s,e){return this.url.searchParams.append(s,`ilike(any).{${e.join(",")}}`),this}regexMatch(s,e){return this.url.searchParams.append(s,`match.${e}`),this}regexIMatch(s,e){return this.url.searchParams.append(s,`imatch.${e}`),this}is(s,e){return this.url.searchParams.append(s,`is.${e}`),this}isDistinct(s,e){return this.url.searchParams.append(s,`isdistinct.${e}`),this}in(s,e){const t=Array.from(new Set(e)).map(n=>typeof n=="string"&&mw.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(s,`in.(${t})`),this}notIn(s,e){const t=Array.from(new Set(e)).map(n=>typeof n=="string"&&mw.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(s,`not.in.(${t})`),this}contains(s,e){return typeof e=="string"?this.url.searchParams.append(s,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(s,`cs.{${e.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(e)}`),this}containedBy(s,e){return typeof e=="string"?this.url.searchParams.append(s,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(s,`cd.{${e.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(e)}`),this}rangeGt(s,e){return this.url.searchParams.append(s,`sr.${e}`),this}rangeGte(s,e){return this.url.searchParams.append(s,`nxl.${e}`),this}rangeLt(s,e){return this.url.searchParams.append(s,`sl.${e}`),this}rangeLte(s,e){return this.url.searchParams.append(s,`nxr.${e}`),this}rangeAdjacent(s,e){return this.url.searchParams.append(s,`adj.${e}`),this}overlaps(s,e){return typeof e=="string"?this.url.searchParams.append(s,`ov.${e}`):this.url.searchParams.append(s,`ov.{${e.join(",")}}`),this}textSearch(s,e,{config:t,type:n}={}){let r="";n==="plain"?r="pl":n==="phrase"?r="ph":n==="websearch"&&(r="w");const i=t===void 0?"":`(${t})`;return this.url.searchParams.append(s,`${r}fts${i}.${e}`),this}match(s){return Object.entries(s).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(s,e,t){return this.url.searchParams.append(s,`not.${e}.${t}`),this}or(s,{foreignTable:e,referencedTable:t=e}={}){const n=t?`${t}.or`:"or";return this.url.searchParams.append(n,`(${s})`),this}filter(s,e,t){return this.url.searchParams.append(s,`${e}.${t}`),this}},kk=class{constructor(s,{headers:e={},schema:t,fetch:n,urlLengthLimit:r=8e3}){this.url=s,this.headers=new Headers(e),this.schema=t,this.fetch=n,this.urlLengthLimit=r}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(s,e){const{head:t=!1,count:n}=e??{},r=t?"HEAD":"GET";let i=!1;const o=(s??"*").split("").map(h=>/\s/.test(h)&&!i?"":(h==='"'&&(i=!i),h)).join(""),{url:l,headers:d}=this.cloneRequestState();return l.searchParams.set("select",o),n&&d.append("Prefer",`count=${n}`),new Gd({method:r,url:l,headers:d,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(s,{count:e,defaultToNull:t=!0}={}){var n;const r="POST",{url:i,headers:o}=this.cloneRequestState();if(e&&o.append("Prefer",`count=${e}`),t||o.append("Prefer","missing=default"),Array.isArray(s)){const l=s.reduce((d,h)=>d.concat(Object.keys(h)),[]);if(l.length>0){const d=[...new Set(l)].map(h=>`"${h}"`);i.searchParams.set("columns",d.join(","))}}return new Gd({method:r,url:i,headers:o,schema:this.schema,body:s,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(s,{onConflict:e,ignoreDuplicates:t=!1,count:n,defaultToNull:r=!0}={}){var i;const o="POST",{url:l,headers:d}=this.cloneRequestState();if(d.append("Prefer",`resolution=${t?"ignore":"merge"}-duplicates`),e!==void 0&&l.searchParams.set("on_conflict",e),n&&d.append("Prefer",`count=${n}`),r||d.append("Prefer","missing=default"),Array.isArray(s)){const h=s.reduce((p,g)=>p.concat(Object.keys(g)),[]);if(h.length>0){const p=[...new Set(h)].map(g=>`"${g}"`);l.searchParams.set("columns",p.join(","))}}return new Gd({method:o,url:l,headers:d,schema:this.schema,body:s,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch,urlLengthLimit:this.urlLengthLimit})}update(s,{count:e}={}){var t;const n="PATCH",{url:r,headers:i}=this.cloneRequestState();return e&&i.append("Prefer",`count=${e}`),new Gd({method:n,url:r,headers:i,schema:this.schema,body:s,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:s}={}){var e;const t="DELETE",{url:n,headers:r}=this.cloneRequestState();return s&&r.append("Prefer",`count=${s}`),new Gd({method:t,url:n,headers:r,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}};function Pf(s){"@babel/helpers - typeof";return Pf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pf(s)}function jk(s,e){if(Pf(s)!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var n=t.call(s,e);if(Pf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function Tk(s){var e=jk(s,"string");return Pf(e)=="symbol"?e:e+""}function Dk(s,e,t){return(e=Tk(e))in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function xw(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),t.push.apply(t,n)}return t}function J0(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?xw(Object(t),!0).forEach(function(n){Dk(s,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):xw(Object(t)).forEach(function(n){Object.defineProperty(s,n,Object.getOwnPropertyDescriptor(t,n))})}return s}var Lk=class d_{constructor(e,{headers:t={},schema:n,fetch:r,timeout:i,urlLengthLimit:o=8e3}={}){this.url=e,this.headers=new Headers(t),this.schemaName=n,this.urlLengthLimit=o;const l=r??globalThis.fetch;i!==void 0&&i>0?this.fetch=(d,h)=>{const p=new AbortController,g=setTimeout(()=>p.abort(),i),b=h?.signal;if(b){if(b.aborted)return clearTimeout(g),l(d,h);const x=()=>{clearTimeout(g),p.abort()};return b.addEventListener("abort",x,{once:!0}),l(d,J0(J0({},h),{},{signal:p.signal})).finally(()=>{clearTimeout(g),b.removeEventListener("abort",x)})}return l(d,J0(J0({},h),{},{signal:p.signal})).finally(()=>clearTimeout(g))}:this.fetch=l}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new kk(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(e){return new d_(this.url,{headers:this.headers,schema:e,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,t={},{head:n=!1,get:r=!1,count:i}={}){var o;let l;const d=new URL(`${this.url}/rpc/${e}`);let h;const p=x=>x!==null&&typeof x=="object"&&(!Array.isArray(x)||x.some(p)),g=n&&Object.values(t).some(p);g?(l="POST",h=t):n||r?(l=n?"HEAD":"GET",Object.entries(t).filter(([x,w])=>w!==void 0).map(([x,w])=>[x,Array.isArray(w)?`{${w.join(",")}}`:`${w}`]).forEach(([x,w])=>{d.searchParams.append(x,w)})):(l="POST",h=t);const b=new Headers(this.headers);return g?b.set("Prefer",i?`count=${i},return=minimal`:"return=minimal"):i&&b.set("Prefer",`count=${i}`),new Gd({method:l,url:d,headers:b,schema:this.schemaName,body:h,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}};class Rk{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const t=globalThis.process;if(t){const n=t.versions;if(n&&n.node){const r=n.node,i=parseInt(r.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Pk="2.95.3",Bk=`realtime-js/${Pk}`,Ok="1.0.0",h_="2.0.0",bw=h_,_1=1e4,Ik=1e3,Mk=100;var Ic;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(Ic||(Ic={}));var zr;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(zr||(zr={}));var jo;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(jo||(jo={}));var A1;(function(s){s.websocket="websocket"})(A1||(A1={}));var Nu;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(Nu||(Nu={}));class Fk{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,n;const r=(n=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,r)}_encodeJsonUserBroadcastPush(e){var t,n;const r=(n=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&n!==void 0?n:{},o=new TextEncoder().encode(JSON.stringify(r)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,t,n){var r,i;const o=e.topic,l=(r=e.ref)!==null&&r!==void 0?r:"",d=(i=e.join_ref)!==null&&i!==void 0?i:"",h=e.payload.event,p=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},g=Object.keys(p).length===0?"":JSON.stringify(p);if(d.length>255)throw new Error(`joinRef length ${d.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`ref length ${l.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`userEvent length ${h.length} exceeds maximum of 255`);if(g.length>255)throw new Error(`metadata length ${g.length} exceeds maximum of 255`);const b=this.USER_BROADCAST_PUSH_META_LENGTH+d.length+l.length+o.length+h.length+g.length,x=new ArrayBuffer(this.HEADER_LENGTH+b);let w=new DataView(x),v=0;w.setUint8(v++,this.KINDS.userBroadcastPush),w.setUint8(v++,d.length),w.setUint8(v++,l.length),w.setUint8(v++,o.length),w.setUint8(v++,h.length),w.setUint8(v++,g.length),w.setUint8(v++,t),Array.from(d,N=>w.setUint8(v++,N.charCodeAt(0))),Array.from(l,N=>w.setUint8(v++,N.charCodeAt(0))),Array.from(o,N=>w.setUint8(v++,N.charCodeAt(0))),Array.from(h,N=>w.setUint8(v++,N.charCodeAt(0))),Array.from(g,N=>w.setUint8(v++,N.charCodeAt(0)));var _=new Uint8Array(x.byteLength+n.byteLength);return _.set(new Uint8Array(x),0),_.set(new Uint8Array(n),x.byteLength),_.buffer}decode(e,t){if(this._isArrayBuffer(e)){let n=this._binaryDecode(e);return t(n)}if(typeof e=="string"){const n=JSON.parse(e),[r,i,o,l,d]=n;return t({join_ref:r,ref:i,topic:o,event:l,payload:d})}return t({})}_binaryDecode(e){const t=new DataView(e),n=t.getUint8(0),r=new TextDecoder;if(n===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,r)}_decodeUserBroadcast(e,t,n){const r=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),l=t.getUint8(4);let d=this.HEADER_LENGTH+4;const h=n.decode(e.slice(d,d+r));d=d+r;const p=n.decode(e.slice(d,d+i));d=d+i;const g=n.decode(e.slice(d,d+o));d=d+o;const b=e.slice(d,e.byteLength),x=l===this.JSON_ENCODING?JSON.parse(n.decode(b)):b,w={type:this.BROADCAST_EVENT,event:p,payload:x};return o>0&&(w.meta=JSON.parse(g)),{join_ref:null,ref:null,topic:h,event:this.BROADCAST_EVENT,payload:w}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e?.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([n])=>t.includes(n)))}}class f_{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ts;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(Ts||(Ts={}));const yw=(s,e,t={})=>{var n;const r=(n=t.skipTypes)!==null&&n!==void 0?n:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=Uk(o,s,e,r),i),{}):{}},Uk=(s,e,t,n)=>{const r=e.find(l=>l.name===s),i=r?.type,o=t[s];return i&&!n.includes(i)?p_(i,o):N1(o)},p_=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return Hk(e,t)}switch(s){case Ts.bool:return zk(e);case Ts.float4:case Ts.float8:case Ts.int2:case Ts.int4:case Ts.int8:case Ts.numeric:case Ts.oid:return $k(e);case Ts.json:case Ts.jsonb:return qk(e);case Ts.timestamp:return Gk(e);case Ts.abstime:case Ts.date:case Ts.daterange:case Ts.int4range:case Ts.int8range:case Ts.money:case Ts.reltime:case Ts.text:case Ts.time:case Ts.timestamptz:case Ts.timetz:case Ts.tsrange:case Ts.tstzrange:return N1(e);default:return N1(e)}},N1=s=>s,zk=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},$k=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},qk=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch{return s}return s},Hk=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,n=s[t];if(s[0]==="{"&&n==="}"){let i;const o=s.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>p_(e,l))}return s},Gk=s=>typeof s=="string"?s.replace(" ","T"):s,g_=s=>{const e=new URL(s);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class jx{constructor(e,t,n={},r=_1){this.channel=e,this.event=t,this.payload=n,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var vw;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(vw||(vw={}));class kf{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},r=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=kf.syncState(this.state,r,i,o),this.pendingDiffs.forEach(d=>{this.state=kf.syncDiff(this.state,d,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(n.diff,{},r=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=kf.syncDiff(this.state,r,i,o),l())}),this.onJoin((r,i,o)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:i,newPresences:o})}),this.onLeave((r,i,o)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,r){const i=this.cloneDeep(e),o=this.transformState(t),l={},d={};return this.map(i,(h,p)=>{o[h]||(d[h]=p)}),this.map(o,(h,p)=>{const g=i[h];if(g){const b=p.map(_=>_.presence_ref),x=g.map(_=>_.presence_ref),w=p.filter(_=>x.indexOf(_.presence_ref)<0),v=g.filter(_=>b.indexOf(_.presence_ref)<0);w.length>0&&(l[h]=w),v.length>0&&(d[h]=v)}else l[h]=p}),this.syncDiff(i,{joins:l,leaves:d},n,r)}static syncDiff(e,t,n,r){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),r||(r=()=>{}),this.map(i,(l,d)=>{var h;const p=(h=e[l])!==null&&h!==void 0?h:[];if(e[l]=this.cloneDeep(d),p.length>0){const g=e[l].map(x=>x.presence_ref),b=p.filter(x=>g.indexOf(x.presence_ref)<0);e[l].unshift(...b)}n(l,p,d)}),this.map(o,(l,d)=>{let h=e[l];if(!h)return;const p=d.map(g=>g.presence_ref);h=h.filter(g=>p.indexOf(g.presence_ref)<0),e[l]=h,r(l,h,d),h.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const r=e[n];return"metas"in r?t[n]=r.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[n]=r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ww;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(ww||(ww={}));var jf;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(jf||(jf={}));var Gl;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(Gl||(Gl={}));class Qd{constructor(e,t={config:{}},n){var r,i;if(this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=zr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new jx(this,jo.join,this.params,this.timeout),this.rejoinTimer=new f_(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=zr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=zr.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=zr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=zr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=zr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(jo.reply,{},(o,l)=>{this._trigger(this._replyEventName(l),o)}),this.presence=new kf(this),this.broadcastEndpointURL=g_(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(r=this.params.config)===null||r===void 0?void 0:r.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var n,r,i;if(this.socket.isConnected()||this.socket.connect(),this.state==zr.closed){const{config:{broadcast:o,presence:l,private:d}}=this.params,h=(r=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(x=>x.filter))!==null&&r!==void 0?r:[],p=!!this.bindings[jf.PRESENCE]&&this.bindings[jf.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,g={},b={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:p}),postgres_changes:h,private:d};this.socket.accessTokenValue&&(g.access_token=this.socket.accessTokenValue),this._onError(x=>e?.(Gl.CHANNEL_ERROR,x)),this._onClose(()=>e?.(Gl.CLOSED)),this.updateJoinPayload(Object.assign({config:b},g)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:x})=>{var w;if(this.socket._isManualToken()||this.socket.setAuth(),x===void 0){e?.(Gl.SUBSCRIBED);return}else{const v=this.bindings.postgres_changes,_=(w=v?.length)!==null&&w!==void 0?w:0,N=[];for(let E=0;E<_;E++){const k=v[E],{filter:{event:T,schema:P,table:O,filter:F}}=k,$=x&&x[E];if($&&$.event===T&&Qd.isFilterValueEqual($.schema,P)&&Qd.isFilterValueEqual($.table,O)&&Qd.isFilterValueEqual($.filter,F))N.push(Object.assign(Object.assign({},k),{id:$.id}));else{this.unsubscribe(),this.state=zr.errored,e?.(Gl.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=N,e&&e(Gl.SUBSCRIBED);return}}).receive("error",x=>{this.state=zr.errored,e?.(Gl.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(x).join(", ")||"error")))}).receive("timeout",()=>{e?.(Gl.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===zr.joined&&e===jf.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,n)}async httpSend(e,t,n={}){var r;if(t==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},l=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);if(l.status===202)return{success:!0};let d=l.statusText;try{const h=await l.json();d=h.error||h.message||d}catch{}return Promise.reject(new Error(d))}async send(e,t={}){var n,r;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,l={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(l.Authorization=`Bearer ${this.socket.accessTokenValue}`);const d={method:"POST",headers:l,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const h=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((r=h.body)===null||r===void 0?void 0:r.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,d;const h=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((d=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||d===void 0)&&d.ack)&&i("ok"),h.receive("ok",()=>i("ok")),h.receive("error",()=>i("error")),h.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=zr.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(jo.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(r=>{n=new jx(this,jo.leave,{},e),n.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=zr.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const r=new AbortController,i=setTimeout(()=>r.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(i),o}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new jx(this,e,t,n);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Mk){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var r,i;const o=e.toLocaleLowerCase(),{close:l,error:d,leave:h,join:p}=jo;if(n&&[l,d,h,p].indexOf(o)>=0&&n!==this._joinRef())return;let b=this._onMessage(o,t,n);if(t&&!b)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(x=>{var w,v,_;return((w=x.filter)===null||w===void 0?void 0:w.event)==="*"||((_=(v=x.filter)===null||v===void 0?void 0:v.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===o}).map(x=>x.callback(b,n)):(i=this.bindings[o])===null||i===void 0||i.filter(x=>{var w,v,_,N,E,k;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in x){const T=x.id,P=(w=x.filter)===null||w===void 0?void 0:w.event;return T&&((v=t.ids)===null||v===void 0?void 0:v.includes(T))&&(P==="*"||P?.toLocaleLowerCase()===((_=t.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const T=(E=(N=x?.filter)===null||N===void 0?void 0:N.event)===null||E===void 0?void 0:E.toLocaleLowerCase();return T==="*"||T===((k=t?.event)===null||k===void 0?void 0:k.toLocaleLowerCase())}else return x.type.toLocaleLowerCase()===o}).map(x=>{if(typeof b=="object"&&"ids"in b){const w=b.data,{schema:v,table:_,commit_timestamp:N,type:E,errors:k}=w;b=Object.assign(Object.assign({},{schema:v,table:_,commit_timestamp:N,eventType:E,new:{},old:{},errors:k}),this._getPayloadRecords(w))}x.callback(b,n)})}_isClosed(){return this.state===zr.closed}_isJoined(){return this.state===zr.joined}_isJoining(){return this.state===zr.joining}_isLeaving(){return this.state===zr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:n};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(r=>{var i;return!(((i=r.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&Qd.isEqual(r.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}static isFilterValueEqual(e,t){return(e??void 0)===(t??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(jo.close,{},e)}_onError(e){this._on(jo.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=zr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=yw(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=yw(e.columns,e.old_record)),t}}const Tx=()=>{},Z0={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Vk=[1e3,2e3,5e3,1e4],Wk=1e4,Yk=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Kk{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=_1,this.transport=null,this.heartbeatIntervalMs=Z0.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Tx,this.ref=0,this.reconnectTimer=null,this.vsn=bw,this.logger=Tx,this.conn=null,this.sendBuffer=[],this.serializer=new Fk,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=r=>r?(...i)=>r(...i):(...i)=>fetch(...i),!(!((n=t?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${A1.websocket}`,this.httpEndpoint=g_(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Rk.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return t==="ok"&&this._remove(e),this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Ic.connecting:return Nu.Connecting;case Ic.open:return Nu.Open;case Ic.closing:return Nu.Closing;default:return Nu.Closed}}isConnected(){return this.connectionState()===Nu.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,r=this.getChannels().find(i=>i.topic===n);if(r)return r;{const i=new Qd(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:n,payload:r,ref:i}=e,o=()=>{this.encode(e,l=>{var d;(d=this.conn)===null||d===void 0||d.send(l)})};this.log("push",`${t} ${n} (${i})`,r),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Ik,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Z0.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply"&&t.ref&&t.ref===this.pendingHeartbeatRef){const h=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error",h)}catch(p){this.log("error","error in heartbeat callback",p)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:n,event:r,payload:i,ref:o}=t,l=o?`(${o})`:"",d=i.status||"";this.log("receive",`${d} ${n} ${r} ${l}`.trim(),i),this.channels.filter(h=>h._isMember(n)).forEach(h=>h._trigger(r,i,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Ic.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Ic.open||this.conn.readyState===Ic.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this._terminateWorker()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(t){this.log("error","error in heartbeat callback",t)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(jo.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return`${e}${n}${r}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([Yk],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,n=!1;if(e)t=e,n=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(r){this.log("error","Error fetching access token from callback",r),t=this.accessTokenValue}else t=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const i={access_token:t,version:Bk};t&&r.updateJoinPayload(i),r.joinedOnce&&r._isJoined()&&r._push(jo.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(r){this.log("error",`error in ${e} callback`,r)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new f_(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Z0.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,r,i,o,l,d,h,p,g,b,x;switch(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e?.timeout)!==null&&n!==void 0?n:_1,this.heartbeatIntervalMs=(r=e?.heartbeatIntervalMs)!==null&&r!==void 0?r:Z0.HEARTBEAT_INTERVAL,this.worker=(i=e?.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=e?.heartbeatCallback)!==null&&l!==void 0?l:Tx,this.vsn=(d=e?.vsn)!==null&&d!==void 0?d:bw,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:(w=>Vk[w-1]||Wk),this.vsn){case Ok:this.encode=(p=e?.encode)!==null&&p!==void 0?p:((w,v)=>v(JSON.stringify(w))),this.decode=(g=e?.decode)!==null&&g!==void 0?g:((w,v)=>v(JSON.parse(w)));break;case h_:this.encode=(b=e?.encode)!==null&&b!==void 0?b:this.serializer.encode.bind(this.serializer),this.decode=(x=e?.decode)!==null&&x!==void 0?x:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}var Bf=class extends Error{constructor(s,e){super(s),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Xk(s,e,t){const n=new URL(e,s);if(t)for(const[r,i]of Object.entries(t))i!==void 0&&n.searchParams.set(r,i);return n.toString()}async function Jk(s){return!s||s.type==="none"?{}:s.type==="bearer"?{Authorization:`Bearer ${s.token}`}:s.type==="header"?{[s.name]:s.value}:s.type==="custom"?await s.getHeaders():{}}function Zk(s){const e=s.fetchImpl??globalThis.fetch;return{async request({method:t,path:n,query:r,body:i,headers:o}){const l=Xk(s.baseUrl,n,r),d=await Jk(s.auth),h=await e(l,{method:t,headers:{...i?{"Content-Type":"application/json"}:{},...d,...o},body:i?JSON.stringify(i):void 0}),p=await h.text(),g=(h.headers.get("content-type")||"").includes("application/json"),b=g&&p?JSON.parse(p):p;if(!h.ok){const x=g?b:void 0,w=x?.error;throw new Bf(w?.message??`Request failed with status ${h.status}`,{status:h.status,icebergType:w?.type,icebergCode:w?.code,details:x})}return{status:h.status,headers:h.headers,data:b}}}}function Q0(s){return s.join("")}var Qk=class{constructor(s,e=""){this.client=s,this.prefix=e}async listNamespaces(s){const e=s?{parent:Q0(s.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(s,e){const t={namespace:s.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data}async dropNamespace(s){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Q0(s.namespace)}`})}async loadNamespaceMetadata(s){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Q0(s.namespace)}`})).data.properties}}async namespaceExists(s){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Q0(s.namespace)}`}),!0}catch(e){if(e instanceof Bf&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(s,e){try{return await this.createNamespace(s,e)}catch(t){if(t instanceof Bf&&t.status===409)return;throw t}}};function Bd(s){return s.join("")}var ej=class{constructor(s,e="",t){this.client=s,this.prefix=e,this.accessDelegation=t}async listTables(s){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Bd(s.namespace)}/tables`})).data.identifiers}async createTable(s,e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Bd(s.namespace)}/tables`,body:e,headers:t})).data.metadata}async updateTable(s,e){const t=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Bd(s.namespace)}/tables/${s.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}}async dropTable(s,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Bd(s.namespace)}/tables/${s.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(s){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Bd(s.namespace)}/tables/${s.name}`,headers:e})).data.metadata}async tableExists(s){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Bd(s.namespace)}/tables/${s.name}`,headers:e}),!0}catch(t){if(t instanceof Bf&&t.status===404)return!1;throw t}}async createTableIfNotExists(s,e){try{return await this.createTable(s,e)}catch(t){if(t instanceof Bf&&t.status===409)return await this.loadTable({namespace:s.namespace,name:e.name});throw t}}},tj=class{constructor(s){let e="v1";s.catalogName&&(e+=`/${s.catalogName}`);const t=s.baseUrl.endsWith("/")?s.baseUrl:`${s.baseUrl}/`;this.client=Zk({baseUrl:t,auth:s.auth,fetchImpl:s.fetch}),this.accessDelegation=s.accessDelegation?.join(","),this.namespaceOps=new Qk(this.client,e),this.tableOps=new ej(this.client,e,this.accessDelegation)}async listNamespaces(s){return this.namespaceOps.listNamespaces(s)}async createNamespace(s,e){return this.namespaceOps.createNamespace(s,e)}async dropNamespace(s){await this.namespaceOps.dropNamespace(s)}async loadNamespaceMetadata(s){return this.namespaceOps.loadNamespaceMetadata(s)}async listTables(s){return this.tableOps.listTables(s)}async createTable(s,e){return this.tableOps.createTable(s,e)}async updateTable(s,e){return this.tableOps.updateTable(s,e)}async dropTable(s,e){await this.tableOps.dropTable(s,e)}async loadTable(s){return this.tableOps.loadTable(s)}async namespaceExists(s){return this.namespaceOps.namespaceExists(s)}async tableExists(s){return this.tableOps.tableExists(s)}async createNamespaceIfNotExists(s,e){return this.namespaceOps.createNamespaceIfNotExists(s,e)}async createTableIfNotExists(s,e){return this.tableOps.createTableIfNotExists(s,e)}},$g=class extends Error{constructor(s,e="storage",t,n){super(s),this.__isStorageError=!0,this.namespace=e,this.name=e==="vectors"?"StorageVectorsError":"StorageError",this.status=t,this.statusCode=n}};function qg(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}var ep=class extends $g{constructor(s,e,t,n="storage"){super(s,n,e,t),this.name=n==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},m_=class extends $g{constructor(s,e,t="storage"){super(s,t),this.name=t==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};const nj=s=>s?(...e)=>s(...e):(...e)=>fetch(...e),sj=s=>{if(typeof s!="object"||s===null)return!1;const e=Object.getPrototypeOf(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},C1=s=>{if(Array.isArray(s))return s.map(t=>C1(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,n])=>{const r=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[r]=C1(n)}),e},rj=s=>!s||typeof s!="string"||s.length===0||s.length>100||s.trim()!==s||s.includes("/")||s.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(s);function Of(s){"@babel/helpers - typeof";return Of=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Of(s)}function ij(s,e){if(Of(s)!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var n=t.call(s,e);if(Of(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function aj(s){var e=ij(s,"string");return Of(e)=="symbol"?e:e+""}function oj(s,e,t){return(e=aj(e))in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function Sw(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),t.push.apply(t,n)}return t}function xn(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Sw(Object(t),!0).forEach(function(n){oj(s,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):Sw(Object(t)).forEach(function(n){Object.defineProperty(s,n,Object.getOwnPropertyDescriptor(t,n))})}return s}const _w=s=>{var e;return s.msg||s.message||s.error_description||(typeof s.error=="string"?s.error:(e=s.error)===null||e===void 0?void 0:e.message)||JSON.stringify(s)},lj=async(s,e,t,n)=>{if(s&&typeof s=="object"&&"status"in s&&"ok"in s&&typeof s.status=="number"&&!t?.noResolveJson){const r=s,i=r.status||500;if(typeof r.json=="function")r.json().then(o=>{const l=o?.statusCode||o?.code||i+"";e(new ep(_w(o),i,l,n))}).catch(()=>{if(n==="vectors"){const o=i+"";e(new ep(r.statusText||`HTTP ${i} error`,i,o,n))}else{const o=i+"";e(new ep(r.statusText||`HTTP ${i} error`,i,o,n))}});else{const o=i+"";e(new ep(r.statusText||`HTTP ${i} error`,i,o,n))}}else e(new m_(_w(s),s,n))},cj=(s,e,t,n)=>{const r={method:s,headers:e?.headers||{}};return s==="GET"||s==="HEAD"||!n?xn(xn({},r),t):(sj(n)?(r.headers=xn({"Content-Type":"application/json"},e?.headers),r.body=JSON.stringify(n)):r.body=n,e?.duplex&&(r.duplex=e.duplex),xn(xn({},r),t))};async function df(s,e,t,n,r,i,o){return new Promise((l,d)=>{s(t,cj(e,n,r,i)).then(h=>{if(!h.ok)throw h;if(n?.noResolveJson)return h;if(o==="vectors"){const p=h.headers.get("content-type");if(h.headers.get("content-length")==="0"||h.status===204)return{};if(!p||!p.includes("application/json"))return{}}return h.json()}).then(h=>l(h)).catch(h=>lj(h,d,n,o))})}function x_(s="storage"){return{get:async(e,t,n,r)=>df(e,"GET",t,n,r,void 0,s),post:async(e,t,n,r,i)=>df(e,"POST",t,r,i,n,s),put:async(e,t,n,r,i)=>df(e,"PUT",t,r,i,n,s),head:async(e,t,n,r)=>df(e,"HEAD",t,xn(xn({},n),{},{noResolveJson:!0}),r,void 0,s),remove:async(e,t,n,r,i)=>df(e,"DELETE",t,r,i,n,s)}}const uj=x_("storage"),{get:If,post:Eo,put:E1,head:dj,remove:Ab}=uj,Aa=x_("vectors");var Sh=class{constructor(s,e={},t,n="storage"){this.shouldThrowOnError=!1,this.url=s,this.headers=e,this.fetch=nj(t),this.namespace=n}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(s){var e=this;try{return{data:await s(),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(qg(t))return{data:null,error:t};throw t}}},hj=class{constructor(s,e){this.downloadFn=s,this.shouldThrowOnError=e}then(s,e){return this.execute().then(s,e)}async execute(){var s=this;try{return{data:(await s.downloadFn()).body,error:null}}catch(e){if(s.shouldThrowOnError)throw e;if(qg(e))return{data:null,error:e};throw e}}};let b_;b_=Symbol.toStringTag;var fj=class{constructor(s,e){this.downloadFn=s,this.shouldThrowOnError=e,this[b_]="BlobDownloadBuilder",this.promise=null}asStream(){return new hj(this.downloadFn,this.shouldThrowOnError)}then(s,e){return this.getPromise().then(s,e)}catch(s){return this.getPromise().catch(s)}finally(s){return this.getPromise().finally(s)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var s=this;try{return{data:await(await s.downloadFn()).blob(),error:null}}catch(e){if(s.shouldThrowOnError)throw e;if(qg(e))return{data:null,error:e};throw e}}};const pj={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Aw={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var gj=class extends Sh{constructor(s,e={},t,n){super(s,e,n,"storage"),this.bucketId=t}async uploadOrUpdate(s,e,t,n){var r=this;return r.handleOperation(async()=>{let i;const o=xn(xn({},Aw),n);let l=xn(xn({},r.headers),s==="POST"&&{"x-upsert":String(o.upsert)});const d=o.metadata;typeof Blob<"u"&&t instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),d&&i.append("metadata",r.encodeMetadata(d)),i.append("",t)):typeof FormData<"u"&&t instanceof FormData?(i=t,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),d&&!i.has("metadata")&&i.append("metadata",r.encodeMetadata(d))):(i=t,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,d&&(l["x-metadata"]=r.toBase64(r.encodeMetadata(d))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),n?.headers&&(l=xn(xn({},l),n.headers));const h=r._removeEmptyFolders(e),p=r._getFinalPath(h),g=await(s=="PUT"?E1:Eo)(r.fetch,`${r.url}/object/${p}`,i,xn({headers:l},o?.duplex?{duplex:o.duplex}:{}));return{path:h,id:g.Id,fullPath:g.Key}})}async upload(s,e,t){return this.uploadOrUpdate("POST",s,e,t)}async uploadToSignedUrl(s,e,t,n){var r=this;const i=r._removeEmptyFolders(s),o=r._getFinalPath(i),l=new URL(r.url+`/object/upload/sign/${o}`);return l.searchParams.set("token",e),r.handleOperation(async()=>{let d;const h=xn({upsert:Aw.upsert},n),p=xn(xn({},r.headers),{"x-upsert":String(h.upsert)});return typeof Blob<"u"&&t instanceof Blob?(d=new FormData,d.append("cacheControl",h.cacheControl),d.append("",t)):typeof FormData<"u"&&t instanceof FormData?(d=t,d.append("cacheControl",h.cacheControl)):(d=t,p["cache-control"]=`max-age=${h.cacheControl}`,p["content-type"]=h.contentType),{path:i,fullPath:(await E1(r.fetch,l.toString(),d,{headers:p})).Key}})}async createSignedUploadUrl(s,e){var t=this;return t.handleOperation(async()=>{let n=t._getFinalPath(s);const r=xn({},t.headers);e?.upsert&&(r["x-upsert"]="true");const i=await Eo(t.fetch,`${t.url}/object/upload/sign/${n}`,{},{headers:r}),o=new URL(t.url+i.url),l=o.searchParams.get("token");if(!l)throw new $g("No token returned by API");return{signedUrl:o.toString(),path:s,token:l}})}async update(s,e,t){return this.uploadOrUpdate("PUT",s,e,t)}async move(s,e,t){var n=this;return n.handleOperation(async()=>await Eo(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:s,destinationKey:e,destinationBucket:t?.destinationBucket},{headers:n.headers}))}async copy(s,e,t){var n=this;return n.handleOperation(async()=>({path:(await Eo(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:s,destinationKey:e,destinationBucket:t?.destinationBucket},{headers:n.headers})).Key}))}async createSignedUrl(s,e,t){var n=this;return n.handleOperation(async()=>{let r=n._getFinalPath(s),i=await Eo(n.fetch,`${n.url}/object/sign/${r}`,xn({expiresIn:e},t?.transform?{transform:t.transform}:{}),{headers:n.headers});const o=t?.download?`&download=${t.download===!0?"":t.download}`:"";return{signedUrl:encodeURI(`${n.url}${i.signedURL}${o}`)}})}async createSignedUrls(s,e,t){var n=this;return n.handleOperation(async()=>{const r=await Eo(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:e,paths:s},{headers:n.headers}),i=t?.download?`&download=${t.download===!0?"":t.download}`:"";return r.map(o=>xn(xn({},o),{},{signedUrl:o.signedURL?encodeURI(`${n.url}${o.signedURL}${i}`):null}))})}download(s,e,t){const n=typeof e?.transform<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString(e?.transform||{}),i=r?`?${r}`:"",o=this._getFinalPath(s),l=()=>If(this.fetch,`${this.url}/${n}/${o}${i}`,{headers:this.headers,noResolveJson:!0},t);return new fj(l,this.shouldThrowOnError)}async info(s){var e=this;const t=e._getFinalPath(s);return e.handleOperation(async()=>C1(await If(e.fetch,`${e.url}/object/info/${t}`,{headers:e.headers})))}async exists(s){var e=this;const t=e._getFinalPath(s);try{return await dj(e.fetch,`${e.url}/object/${t}`,{headers:e.headers}),{data:!0,error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(qg(n)&&n instanceof m_){const r=n.originalError;if([400,404].includes(r?.status))return{data:!1,error:n}}throw n}}getPublicUrl(s,e){const t=this._getFinalPath(s),n=[],r=e?.download?`download=${e.download===!0?"":e.download}`:"";r!==""&&n.push(r);const i=typeof e?.transform<"u"?"render/image":"object",o=this.transformOptsToQueryString(e?.transform||{});o!==""&&n.push(o);let l=n.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${t}${l}`)}}}async remove(s){var e=this;return e.handleOperation(async()=>await Ab(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:s},{headers:e.headers}))}async list(s,e,t){var n=this;return n.handleOperation(async()=>{const r=xn(xn(xn({},pj),e),{},{prefix:s||""});return await Eo(n.fetch,`${n.url}/object/list/${n.bucketId}`,r,{headers:n.headers},t)})}async listV2(s,e){var t=this;return t.handleOperation(async()=>{const n=xn({},s);return await Eo(t.fetch,`${t.url}/object/list-v2/${t.bucketId}`,n,{headers:t.headers},e)})}encodeMetadata(s){return JSON.stringify(s)}toBase64(s){return typeof Buffer<"u"?Buffer.from(s).toString("base64"):btoa(s)}_getFinalPath(s){return`${this.bucketId}/${s.replace(/^\/+/,"")}`}_removeEmptyFolders(s){return s.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(s){const e=[];return s.width&&e.push(`width=${s.width}`),s.height&&e.push(`height=${s.height}`),s.resize&&e.push(`resize=${s.resize}`),s.format&&e.push(`format=${s.format}`),s.quality&&e.push(`quality=${s.quality}`),e.join("&")}};const mj="2.95.3",Jf={"X-Client-Info":`storage-js/${mj}`};var xj=class extends Sh{constructor(s,e={},t,n){const r=new URL(s);n?.useNewHostname&&/supabase\.(co|in|red)$/.test(r.hostname)&&!r.hostname.includes("storage.supabase.")&&(r.hostname=r.hostname.replace("supabase.","storage.supabase."));const i=r.href.replace(/\/$/,""),o=xn(xn({},Jf),e);super(i,o,t,"storage")}async listBuckets(s){var e=this;return e.handleOperation(async()=>{const t=e.listBucketOptionsToQueryString(s);return await If(e.fetch,`${e.url}/bucket${t}`,{headers:e.headers})})}async getBucket(s){var e=this;return e.handleOperation(async()=>await If(e.fetch,`${e.url}/bucket/${s}`,{headers:e.headers}))}async createBucket(s,e={public:!1}){var t=this;return t.handleOperation(async()=>await Eo(t.fetch,`${t.url}/bucket`,{id:s,name:s,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}))}async updateBucket(s,e){var t=this;return t.handleOperation(async()=>await E1(t.fetch,`${t.url}/bucket/${s}`,{id:s,name:s,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}))}async emptyBucket(s){var e=this;return e.handleOperation(async()=>await Eo(e.fetch,`${e.url}/bucket/${s}/empty`,{},{headers:e.headers}))}async deleteBucket(s){var e=this;return e.handleOperation(async()=>await Ab(e.fetch,`${e.url}/bucket/${s}`,{},{headers:e.headers}))}listBucketOptionsToQueryString(s){const e={};return s&&("limit"in s&&(e.limit=String(s.limit)),"offset"in s&&(e.offset=String(s.offset)),s.search&&(e.search=s.search),s.sortColumn&&(e.sortColumn=s.sortColumn),s.sortOrder&&(e.sortOrder=s.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},bj=class extends Sh{constructor(s,e={},t){const n=s.replace(/\/$/,""),r=xn(xn({},Jf),e);super(n,r,t,"storage")}async createBucket(s){var e=this;return e.handleOperation(async()=>await Eo(e.fetch,`${e.url}/bucket`,{name:s},{headers:e.headers}))}async listBuckets(s){var e=this;return e.handleOperation(async()=>{const t=new URLSearchParams;s?.limit!==void 0&&t.set("limit",s.limit.toString()),s?.offset!==void 0&&t.set("offset",s.offset.toString()),s?.sortColumn&&t.set("sortColumn",s.sortColumn),s?.sortOrder&&t.set("sortOrder",s.sortOrder),s?.search&&t.set("search",s.search);const n=t.toString(),r=n?`${e.url}/bucket?${n}`:`${e.url}/bucket`;return await If(e.fetch,r,{headers:e.headers})})}async deleteBucket(s){var e=this;return e.handleOperation(async()=>await Ab(e.fetch,`${e.url}/bucket/${s}`,{},{headers:e.headers}))}from(s){var e=this;if(!rj(s))throw new $g("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const t=new tj({baseUrl:this.url,catalogName:s,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(t,{get(r,i){const o=r[i];return typeof o!="function"?o:async(...l)=>{try{return{data:await o.apply(r,l),error:null}}catch(d){if(n)throw d;return{data:null,error:d}}}}})}},yj=class extends Sh{constructor(s,e={},t){const n=s.replace(/\/$/,""),r=xn(xn({},Jf),{},{"Content-Type":"application/json"},e);super(n,r,t,"vectors")}async createIndex(s){var e=this;return e.handleOperation(async()=>await Aa.post(e.fetch,`${e.url}/CreateIndex`,s,{headers:e.headers})||{})}async getIndex(s,e){var t=this;return t.handleOperation(async()=>await Aa.post(t.fetch,`${t.url}/GetIndex`,{vectorBucketName:s,indexName:e},{headers:t.headers}))}async listIndexes(s){var e=this;return e.handleOperation(async()=>await Aa.post(e.fetch,`${e.url}/ListIndexes`,s,{headers:e.headers}))}async deleteIndex(s,e){var t=this;return t.handleOperation(async()=>await Aa.post(t.fetch,`${t.url}/DeleteIndex`,{vectorBucketName:s,indexName:e},{headers:t.headers})||{})}},vj=class extends Sh{constructor(s,e={},t){const n=s.replace(/\/$/,""),r=xn(xn({},Jf),{},{"Content-Type":"application/json"},e);super(n,r,t,"vectors")}async putVectors(s){var e=this;if(s.vectors.length<1||s.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Aa.post(e.fetch,`${e.url}/PutVectors`,s,{headers:e.headers})||{})}async getVectors(s){var e=this;return e.handleOperation(async()=>await Aa.post(e.fetch,`${e.url}/GetVectors`,s,{headers:e.headers}))}async listVectors(s){var e=this;if(s.segmentCount!==void 0){if(s.segmentCount<1||s.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(s.segmentIndex!==void 0&&(s.segmentIndex<0||s.segmentIndex>=s.segmentCount))throw new Error(`segmentIndex must be between 0 and ${s.segmentCount-1}`)}return e.handleOperation(async()=>await Aa.post(e.fetch,`${e.url}/ListVectors`,s,{headers:e.headers}))}async queryVectors(s){var e=this;return e.handleOperation(async()=>await Aa.post(e.fetch,`${e.url}/QueryVectors`,s,{headers:e.headers}))}async deleteVectors(s){var e=this;if(s.keys.length<1||s.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Aa.post(e.fetch,`${e.url}/DeleteVectors`,s,{headers:e.headers})||{})}},wj=class extends Sh{constructor(s,e={},t){const n=s.replace(/\/$/,""),r=xn(xn({},Jf),{},{"Content-Type":"application/json"},e);super(n,r,t,"vectors")}async createBucket(s){var e=this;return e.handleOperation(async()=>await Aa.post(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:s},{headers:e.headers})||{})}async getBucket(s){var e=this;return e.handleOperation(async()=>await Aa.post(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:s},{headers:e.headers}))}async listBuckets(s={}){var e=this;return e.handleOperation(async()=>await Aa.post(e.fetch,`${e.url}/ListVectorBuckets`,s,{headers:e.headers}))}async deleteBucket(s){var e=this;return e.handleOperation(async()=>await Aa.post(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:s},{headers:e.headers})||{})}},Sj=class extends wj{constructor(s,e={}){super(s,e.headers||{},e.fetch)}from(s){return new _j(this.url,this.headers,s,this.fetch)}async createBucket(s){var e=()=>super.createBucket,t=this;return e().call(t,s)}async getBucket(s){var e=()=>super.getBucket,t=this;return e().call(t,s)}async listBuckets(s={}){var e=()=>super.listBuckets,t=this;return e().call(t,s)}async deleteBucket(s){var e=()=>super.deleteBucket,t=this;return e().call(t,s)}},_j=class extends yj{constructor(s,e,t,n){super(s,e,n),this.vectorBucketName=t}async createIndex(s){var e=()=>super.createIndex,t=this;return e().call(t,xn(xn({},s),{},{vectorBucketName:t.vectorBucketName}))}async listIndexes(s={}){var e=()=>super.listIndexes,t=this;return e().call(t,xn(xn({},s),{},{vectorBucketName:t.vectorBucketName}))}async getIndex(s){var e=()=>super.getIndex,t=this;return e().call(t,t.vectorBucketName,s)}async deleteIndex(s){var e=()=>super.deleteIndex,t=this;return e().call(t,t.vectorBucketName,s)}index(s){return new Aj(this.url,this.headers,this.vectorBucketName,s,this.fetch)}},Aj=class extends vj{constructor(s,e,t,n,r){super(s,e,r),this.vectorBucketName=t,this.indexName=n}async putVectors(s){var e=()=>super.putVectors,t=this;return e().call(t,xn(xn({},s),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(s){var e=()=>super.getVectors,t=this;return e().call(t,xn(xn({},s),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(s={}){var e=()=>super.listVectors,t=this;return e().call(t,xn(xn({},s),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(s){var e=()=>super.queryVectors,t=this;return e().call(t,xn(xn({},s),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(s){var e=()=>super.deleteVectors,t=this;return e().call(t,xn(xn({},s),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},Nj=class extends xj{constructor(s,e={},t,n){super(s,e,t,n)}from(s){return new gj(this.url,this.headers,s,this.fetch)}get vectors(){return new Sj(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new bj(this.url+"/iceberg",this.headers,this.fetch)}};const y_="2.95.3",Vd=30*1e3,k1=3,Dx=k1*Vd,Cj="http://localhost:9999",Ej="supabase.auth.token",kj={"X-Client-Info":`gotrue-js/${y_}`},j1="X-Supabase-Api-Version",v_={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},jj=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Tj=600*1e3;class Mf extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function tn(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class Dj extends Mf{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function Lj(s){return tn(s)&&s.name==="AuthApiError"}class Cu extends Mf{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ec extends Mf{constructor(e,t,n,r){super(e,n,r),this.name=t,this.status=n}}class va extends ec{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Lx(s){return tn(s)&&s.name==="AuthSessionMissingError"}class Od extends ec{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class tp extends ec{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class np extends ec{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Rj(s){return tn(s)&&s.name==="AuthImplicitGrantRedirectError"}class Nw extends ec{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Pj extends ec{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class T1 extends ec{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Rx(s){return tn(s)&&s.name==="AuthRetryableFetchError"}class Cw extends ec{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class D1 extends ec{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const _g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ew=` 	
\r=`.split(""),Bj=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<Ew.length;e+=1)s[Ew[e].charCodeAt(0)]=-2;for(let e=0;e<_g.length;e+=1)s[_g[e].charCodeAt(0)]=e;return s})();function kw(s,e,t){if(s!==null)for(e.queue=e.queue<<8|s,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(_g[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(_g[n]),e.queuedBits-=6}}function w_(s,e,t){const n=Bj[s];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function jw(s){const e=[],t=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},i=o=>{Mj(o,n,t)};for(let o=0;o<s.length;o+=1)w_(s.charCodeAt(o),r,i);return e.join("")}function Oj(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function Ij(s,e){for(let t=0;t<s.length;t+=1){let n=s.charCodeAt(t);if(n>55295&&n<=56319){const r=(n-55296)*1024&65535;n=(s.charCodeAt(t+1)-56320&65535|r)+65536,t+=1}Oj(n,e)}}function Mj(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let n=1;n<6;n+=1)if((s>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function ih(s){const e=[],t={queue:0,queuedBits:0},n=r=>{e.push(r)};for(let r=0;r<s.length;r+=1)w_(s.charCodeAt(r),t,n);return new Uint8Array(e)}function Fj(s){const e=[];return Ij(s,t=>e.push(t)),new Uint8Array(e)}function ku(s){const e=[],t={queue:0,queuedBits:0},n=r=>{e.push(r)};return s.forEach(r=>kw(r,t,n)),kw(null,t,n),e.join("")}function Uj(s){return Math.round(Date.now()/1e3)+s}function zj(){return Symbol("auth-callback")}const di=()=>typeof window<"u"&&typeof document<"u",xu={tested:!1,writable:!1},S_=()=>{if(!di())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(xu.tested)return xu.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),xu.tested=!0,xu.writable=!0}catch{xu.tested=!0,xu.writable=!1}return xu.writable};function $j(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((r,i)=>{e[i]=r})}catch{}return t.searchParams.forEach((n,r)=>{e[r]=n}),e}const __=s=>s?(...e)=>s(...e):(...e)=>fetch(...e),qj=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",Wd=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},bu=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},ui=async(s,e)=>{await s.removeItem(e)};class Hg{constructor(){this.promise=new Hg.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Hg.promiseConstructor=Promise;function sp(s){const e=s.split(".");if(e.length!==3)throw new D1("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!jj.test(e[n]))throw new D1("JWT not in base64url format");return{header:JSON.parse(jw(e[0])),payload:JSON.parse(jw(e[1])),signature:ih(e[2]),raw:{header:e[0],payload:e[1]}}}async function Hj(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function Gj(s,e){return new Promise((n,r)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await s(i);if(!e(i,null,o)){n(o);return}}catch(o){if(!e(i,o)){r(o);return}}})()})}function Vj(s){return("0"+s.toString(16)).substr(-2)}function Wj(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let r="";for(let i=0;i<56;i++)r+=t.charAt(Math.floor(Math.random()*n));return r}return crypto.getRandomValues(e),Array.from(e,Vj).join("")}async function Yj(s){const t=new TextEncoder().encode(s),n=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(n);return Array.from(r).map(i=>String.fromCharCode(i)).join("")}async function Kj(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await Yj(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Id(s,e,t=!1){const n=Wj();let r=n;t&&(r+="/PASSWORD_RECOVERY"),await Wd(s,`${e}-code-verifier`,r);const i=await Kj(n);return[i,n===i?"plain":"s256"]}const Xj=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Jj(s){const e=s.headers.get(j1);if(!e||!e.match(Xj))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Zj(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function Qj(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const e8=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Md(s){if(!e8.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Px(){const s={};return new Proxy(s,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function t8(s,e){return new Proxy(s,{get:(t,n,r)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const i=n.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,n,r)}return!e.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,n,r)}})}function Tw(s){return JSON.parse(JSON.stringify(s))}const yu=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),n8=[502,503,504];async function Dw(s){var e;if(!qj(s))throw new T1(yu(s),0);if(n8.includes(s.status))throw new T1(yu(s),s.status);let t;try{t=await s.json()}catch(i){throw new Cu(yu(i),i)}let n;const r=Jj(s);if(r&&r.getTime()>=v_["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new Cw(yu(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new va}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Cw(yu(t),s.status,t.weak_password.reasons);throw new Dj(yu(t),s.status||500,n)}const s8=(s,e,t,n)=>{const r={method:s,headers:e?.headers||{}};return s==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),r.body=JSON.stringify(n),Object.assign(Object.assign({},r),t))};async function mn(s,e,t,n){var r;const i=Object.assign({},n?.headers);i[j1]||(i[j1]=v_["2024-01-01"].name),n?.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const o=(r=n?.query)!==null&&r!==void 0?r:{};n?.redirectTo&&(o.redirect_to=n.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",d=await r8(s,e,t+l,{headers:i,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(d):{data:Object.assign({},d),error:null}}async function r8(s,e,t,n,r,i){const o=s8(e,n,r,i);let l;try{l=await s(t,Object.assign({},o))}catch(d){throw console.error(d),new T1(yu(d),0)}if(l.ok||await Dw(l),n?.noResolveJson)return l;try{return await l.json()}catch(d){await Dw(d)}}function Co(s){var e;let t=null;o8(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=Uj(s.expires_in)));const n=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:n},error:null}}function Lw(s){const e=Co(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=s.weak_password),e}function Mc(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function i8(s){return{data:s,error:null}}function a8(s){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:r,verification_type:i}=s,o=zg(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:n,redirect_to:r,verification_type:i},d=Object.assign({},o);return{data:{properties:l,user:d},error:null}}function Rw(s){return s}function o8(s){return s.access_token&&s.refresh_token&&s.expires_in}const Bx=["global","local","others"];class l8{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=__(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Bx[0]){if(Bx.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Bx.join(", ")}`);try{return await mn(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(tn(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await mn(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Mc})}catch(n){if(tn(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=zg(e,["options"]),r=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(r.new_email=n?.newEmail,delete r.newEmail),await mn(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:a8,redirectTo:t?.redirectTo})}catch(t){if(tn(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await mn(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Mc})}catch(t){if(tn(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,r,i,o,l,d;try{const h={nextPage:null,lastPage:0,total:0},p=await mn(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(r=e?.perPage)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:""},xform:Rw});if(p.error)throw p.error;const g=await p.json(),b=(o=p.headers.get("x-total-count"))!==null&&o!==void 0?o:0,x=(d=(l=p.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&d!==void 0?d:[];return x.length>0&&(x.forEach(w=>{const v=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(w.split(";")[1].split("=")[1]);h[`${_}Page`]=v}),h.total=parseInt(b)),{data:Object.assign(Object.assign({},g),h),error:null}}catch(h){if(tn(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){Md(e);try{return await mn(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Mc})}catch(t){if(tn(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Md(e);try{return await mn(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Mc})}catch(n){if(tn(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){Md(e);try{return await mn(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Mc})}catch(n){if(tn(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Md(e.userId);try{const{data:t,error:n}=await mn(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:t,error:n}}catch(t){if(tn(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Md(e.userId),Md(e.id);try{return{data:await mn(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(tn(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,n,r,i,o,l,d;try{const h={nextPage:null,lastPage:0,total:0},p=await mn(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(r=e?.perPage)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:""},xform:Rw});if(p.error)throw p.error;const g=await p.json(),b=(o=p.headers.get("x-total-count"))!==null&&o!==void 0?o:0,x=(d=(l=p.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&d!==void 0?d:[];return x.length>0&&(x.forEach(w=>{const v=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(w.split(";")[1].split("=")[1]);h[`${_}Page`]=v}),h.total=parseInt(b)),{data:Object.assign(Object.assign({},g),h),error:null}}catch(h){if(tn(h))return{data:{clients:[]},error:h};throw h}}async _createOAuthClient(e){try{return await mn(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(tn(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await mn(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(tn(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await mn(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(tn(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(e){try{return await mn(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(tn(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await mn(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(tn(t))return{data:null,error:t};throw t}}}function Pw(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}const Fd={debug:!!(globalThis&&S_()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class A_ extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class c8 extends A_{}async function u8(s,e,t){Fd.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Fd.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async r=>{if(r){Fd.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,r.name);try{return await t()}finally{Fd.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,r.name)}}else{if(e===0)throw Fd.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new c8(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(Fd.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function d8(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function N_(s){if(!/^0x[a-fA-F0-9]{40}$/.test(s))throw new Error(`@supabase/auth-js: Address "${s}" is invalid.`);return s.toLowerCase()}function h8(s){return parseInt(s,16)}function f8(s){const e=new TextEncoder().encode(s);return"0x"+Array.from(e,n=>n.toString(16).padStart(2,"0")).join("")}function p8(s){var e;const{chainId:t,domain:n,expirationTime:r,issuedAt:i=new Date,nonce:o,notBefore:l,requestId:d,resources:h,scheme:p,uri:g,version:b}=s;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!g)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(b!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${b}`);if(!((e=s.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${s.statement}`)}const x=N_(s.address),w=p?`${p}://${n}`:n,v=s.statement?`${s.statement}
`:"",_=`${w} wants you to sign in with your Ethereum account:
${x}

${v}`;let N=`URI: ${g}
Version: ${b}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(r&&(N+=`
Expiration Time: ${r.toISOString()}`),l&&(N+=`
Not Before: ${l.toISOString()}`),d&&(N+=`
Request ID: ${d}`),h){let E=`
Resources:`;for(const k of h){if(!k||typeof k!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${k}`);E+=`
- ${k}`}N+=E}return`${_}
${N}`}class kr extends Error{constructor({message:e,code:t,cause:n,name:r}){var i;super(e,{cause:n}),this.__isWebAuthnError=!0,this.name=(i=r??(n instanceof Error?n.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}}class Ag extends kr{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function g8({error:s,options:e}){var t,n,r;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(e.signal instanceof AbortSignal)return new kr({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else if(s.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new kr({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:s});if(e.mediation==="conditional"&&((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new kr({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:s});if(((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new kr({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:s})}else{if(s.name==="InvalidStateError")return new kr({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:s});if(s.name==="NotAllowedError")return new kr({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="NotSupportedError")return i.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new kr({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:s}):new kr({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:s});if(s.name==="SecurityError"){const o=window.location.hostname;if(C_(o)){if(i.rp.id!==o)return new kr({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new kr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new kr({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:s})}else if(s.name==="UnknownError")return new kr({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new kr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}function m8({error:s,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(e.signal instanceof AbortSignal)return new kr({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else{if(s.name==="NotAllowedError")return new kr({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="SecurityError"){const n=window.location.hostname;if(C_(n)){if(t.rpId!==n)return new kr({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new kr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="UnknownError")return new kr({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new kr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}class x8{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const b8=new x8;function y8(s){if(!s)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(s);const{challenge:e,user:t,excludeCredentials:n}=s,r=zg(s,["challenge","user","excludeCredentials"]),i=ih(e).buffer,o=Object.assign(Object.assign({},t),{id:ih(t.id).buffer}),l=Object.assign(Object.assign({},r),{challenge:i,user:o});if(n&&n.length>0){l.excludeCredentials=new Array(n.length);for(let d=0;d<n.length;d++){const h=n[d];l.excludeCredentials[d]=Object.assign(Object.assign({},h),{id:ih(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return l}function v8(s){if(!s)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(s);const{challenge:e,allowCredentials:t}=s,n=zg(s,["challenge","allowCredentials"]),r=ih(e).buffer,i=Object.assign(Object.assign({},n),{challenge:r});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const l=t[o];i.allowCredentials[o]=Object.assign(Object.assign({},l),{id:ih(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return i}function w8(s){var e;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const t=s;return{id:s.id,rawId:s.id,response:{attestationObject:ku(new Uint8Array(s.response.attestationObject)),clientDataJSON:ku(new Uint8Array(s.response.clientDataJSON))},type:"public-key",clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function S8(s){var e;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const t=s,n=s.getClientExtensionResults(),r=s.response;return{id:s.id,rawId:s.id,response:{authenticatorData:ku(new Uint8Array(r.authenticatorData)),clientDataJSON:ku(new Uint8Array(r.clientDataJSON)),signature:ku(new Uint8Array(r.signature)),userHandle:r.userHandle?ku(new Uint8Array(r.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function C_(s){return s==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(s)}function Bw(){var s,e;return!!(di()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((s=navigator?.credentials)===null||s===void 0?void 0:s.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function _8(s){try{const e=await navigator.credentials.create(s);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Ag("Browser returned unexpected credential type",e)}:{data:null,error:new Ag("Empty credential response",e)}}catch(e){return{data:null,error:g8({error:e,options:s})}}}async function A8(s){try{const e=await navigator.credentials.get(s);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Ag("Browser returned unexpected credential type",e)}:{data:null,error:new Ag("Empty credential response",e)}}catch(e){return{data:null,error:m8({error:e,options:s})}}}const N8={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},C8={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Ng(...s){const e=r=>r!==null&&typeof r=="object"&&!Array.isArray(r),t=r=>r instanceof ArrayBuffer||ArrayBuffer.isView(r),n={};for(const r of s)if(r)for(const i in r){const o=r[i];if(o!==void 0)if(Array.isArray(o))n[i]=o;else if(t(o))n[i]=o;else if(e(o)){const l=n[i];e(l)?n[i]=Ng(l,o):n[i]=Ng(o)}else n[i]=o}return n}function E8(s,e){return Ng(N8,s,e||{})}function k8(s,e){return Ng(C8,s,e||{})}class j8{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:n,signal:r},i){var o;try{const{data:l,error:d}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!l)return{data:null,error:d};const h=r??b8.createNewAbortSignal();if(l.webauthn.type==="create"){const{user:p}=l.webauthn.credential_options.publicKey;if(!p.name){const g=n;if(g)p.name=`${p.id}:${g}`;else{const x=(await this.client.getUser()).data.user,w=((o=x?.user_metadata)===null||o===void 0?void 0:o.name)||x?.email||x?.id||"User";p.name=`${p.id}:${w}`}}p.displayName||(p.displayName=p.name)}switch(l.webauthn.type){case"create":{const p=E8(l.webauthn.credential_options.publicKey,i?.create),{data:g,error:b}=await _8({publicKey:p,signal:h});return g?{data:{factorId:e,challengeId:l.id,webauthn:{type:l.webauthn.type,credential_response:g}},error:null}:{data:null,error:b}}case"request":{const p=k8(l.webauthn.credential_options.publicKey,i?.request),{data:g,error:b}=await A8(Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:p,signal:h}));return g?{data:{factorId:e,challengeId:l.id,webauthn:{type:l.webauthn.type,credential_response:g}},error:null}:{data:null,error:b}}}}catch(l){return tn(l)?{data:null,error:l}:{data:null,error:new Cu("Unexpected error in challenge",l)}}}async _verify({challengeId:e,factorId:t,webauthn:n}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:n})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:r}={}},i){if(!t)return{data:null,error:new Mf("rpId is required for WebAuthn authentication")};try{if(!Bw())return{data:null,error:new Cu("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:n},signal:r},{request:i});if(!o)return{data:null,error:l};const{webauthn:d}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:d.type,rpId:t,rpOrigins:n,credential_response:d.credential_response}})}catch(o){return tn(o)?{data:null,error:o}:{data:null,error:new Cu("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:r}={}},i){if(!t)return{data:null,error:new Mf("rpId is required for WebAuthn registration")};try{if(!Bw())return{data:null,error:new Cu("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(p=>{var g;return(g=p.data)===null||g===void 0?void 0:g.all.find(b=>b.factor_type==="webauthn"&&b.friendly_name===e&&b.status!=="unverified")}).then(p=>p?this.client.mfa.unenroll({factorId:p?.id}):void 0),{data:null,error:l};const{data:d,error:h}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:n},signal:r},{create:i});return d?this._verify({factorId:o.id,challengeId:d.challengeId,webauthn:{rpId:t,rpOrigins:n,type:d.webauthn.type,credential_response:d.webauthn.credential_response}}):{data:null,error:h}}catch(o){return tn(o)?{data:null,error:o}:{data:null,error:new Cu("Unexpected error in register",o)}}}}d8();const T8={url:Cj,storageKey:Ej,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:kj,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function Ow(s,e,t){return await t()}const Ud={};class Ff{get jwks(){var e,t;return(t=(e=Ud[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Ud[this.storageKey]=Object.assign(Object.assign({},Ud[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Ud[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ud[this.storageKey]=Object.assign(Object.assign({},Ud[this.storageKey]),{cachedAt:e})}constructor(e){var t,n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},T8),e);if(this.storageKey=i.storageKey,this.instanceID=(t=Ff.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,Ff.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&di()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new l8({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=__(i.fetch),this.lock=i.lock||Ow,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,this.lockAcquireTimeout=i.lockAcquireTimeout,i.lock?this.lock=i.lock:this.persistSession&&di()&&(!((n=globalThis?.navigator)===null||n===void 0)&&n.locks)?this.lock=u8:this.lock=Ow,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new j8(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:S_()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Pw(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=Pw(this.memoryStorage)),di()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o);try{await this._notifyAllSubscribers(o.data.event,o.data.session,!1)}catch(l){this._debug("#broadcastChannel","error",l)}})}this.initialize().catch(o=>{this._debug("#initialize()","error",o)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${y_}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},n="none";if(di()&&(t=$j(window.location.href),this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce")),di()&&this.detectSessionInUrl&&n!=="none"){const{data:r,error:i}=await this._getSessionFromURL(t,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Rj(i)){const d=(e=i.details)===null||e===void 0?void 0:e.code;if(d==="identity_already_exists"||d==="identity_not_found"||d==="single_identity_not_deletable")return{error:i}}return{error:i}}const{session:o,redirectType:l}=r;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return tn(t)?this._returnResult({error:t}):this._returnResult({error:new Cu("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,r;try{const i=await mn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(r=e?.options)===null||r===void 0?void 0:r.captchaToken}},xform:Co}),{data:o,error:l}=i;if(l||!o)return this._returnResult({data:{user:null,session:null},error:l});const d=o.session,h=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",d)),this._returnResult({data:{user:h,session:d},error:null})}catch(i){if(tn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var t,n,r;try{let i;if("email"in e){const{email:p,password:g,options:b}=e;let x=null,w=null;this.flowType==="pkce"&&([x,w]=await Id(this.storage,this.storageKey)),i=await mn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:b?.emailRedirectTo,body:{email:p,password:g,data:(t=b?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:b?.captchaToken},code_challenge:x,code_challenge_method:w},xform:Co})}else if("phone"in e){const{phone:p,password:g,options:b}=e;i=await mn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:p,password:g,data:(n=b?.data)!==null&&n!==void 0?n:{},channel:(r=b?.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:b?.captchaToken}},xform:Co})}else throw new tp("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return await ui(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:l});const d=o.session,h=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",d)),this._returnResult({data:{user:h,session:d},error:null})}catch(i){if(await ui(this.storage,`${this.storageKey}-code-verifier`),tn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:l}=e;t=await mn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:Lw})}else if("phone"in e){const{phone:i,password:o,options:l}=e;t=await mn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:Lw})}else throw new tp("You must provide either an email or phone number and a password");const{data:n,error:r}=t;if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!n||!n.session||!n.user){const i=new Od;return this._returnResult({data:{user:null,session:null},error:i})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:r})}catch(t){if(tn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,n,r,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(r=e.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,n,r,i,o,l,d,h,p,g,b;let x,w;if("message"in e)x=e.message,w=e.signature;else{const{chain:v,wallet:_,statement:N,options:E}=e;let k;if(di())if(typeof _=="object")k=_;else{const z=window;if("ethereum"in z&&typeof z.ethereum=="object"&&"request"in z.ethereum&&typeof z.ethereum.request=="function")k=z.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof _!="object"||!E?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");k=_}const T=new URL((t=E?.url)!==null&&t!==void 0?t:window.location.href),P=await k.request({method:"eth_requestAccounts"}).then(z=>z).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!P||P.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const O=N_(P[0]);let F=(n=E?.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!F){const z=await k.request({method:"eth_chainId"});F=h8(z)}const $={domain:T.host,address:O,statement:N,uri:T.href,version:"1",chainId:F,nonce:(r=E?.signInWithEthereum)===null||r===void 0?void 0:r.nonce,issuedAt:(o=(i=E?.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(l=E?.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(d=E?.signInWithEthereum)===null||d===void 0?void 0:d.notBefore,requestId:(h=E?.signInWithEthereum)===null||h===void 0?void 0:h.requestId,resources:(p=E?.signInWithEthereum)===null||p===void 0?void 0:p.resources};x=p8($),w=await k.request({method:"personal_sign",params:[f8(x),O]})}try{const{data:v,error:_}=await mn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:x,signature:w},!((g=e.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(b=e.options)===null||b===void 0?void 0:b.captchaToken}}:null),xform:Co});if(_)throw _;if(!v||!v.session||!v.user){const N=new Od;return this._returnResult({data:{user:null,session:null},error:N})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:Object.assign({},v),error:_})}catch(v){if(tn(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async signInWithSolana(e){var t,n,r,i,o,l,d,h,p,g,b,x;let w,v;if("message"in e)w=e.message,v=e.signature;else{const{chain:_,wallet:N,statement:E,options:k}=e;let T;if(di())if(typeof N=="object")T=N;else{const O=window;if("solana"in O&&typeof O.solana=="object"&&("signIn"in O.solana&&typeof O.solana.signIn=="function"||"signMessage"in O.solana&&typeof O.solana.signMessage=="function"))T=O.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof N!="object"||!k?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");T=N}const P=new URL((t=k?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in T&&T.signIn){const O=await T.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},k?.signInWithSolana),{version:"1",domain:P.host,uri:P.href}),E?{statement:E}:null));let F;if(Array.isArray(O)&&O[0]&&typeof O[0]=="object")F=O[0];else if(O&&typeof O=="object"&&"signedMessage"in O&&"signature"in O)F=O;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in F&&"signature"in F&&(typeof F.signedMessage=="string"||F.signedMessage instanceof Uint8Array)&&F.signature instanceof Uint8Array)w=typeof F.signedMessage=="string"?F.signedMessage:new TextDecoder().decode(F.signedMessage),v=F.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in T)||typeof T.signMessage!="function"||!("publicKey"in T)||typeof T!="object"||!T.publicKey||!("toBase58"in T.publicKey)||typeof T.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");w=[`${P.host} wants you to sign in with your Solana account:`,T.publicKey.toBase58(),...E?["",E,""]:[""],"Version: 1",`URI: ${P.href}`,`Issued At: ${(r=(n=k?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&r!==void 0?r:new Date().toISOString()}`,...!((i=k?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${k.signInWithSolana.notBefore}`]:[],...!((o=k?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${k.signInWithSolana.expirationTime}`]:[],...!((l=k?.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${k.signInWithSolana.chainId}`]:[],...!((d=k?.signInWithSolana)===null||d===void 0)&&d.nonce?[`Nonce: ${k.signInWithSolana.nonce}`]:[],...!((h=k?.signInWithSolana)===null||h===void 0)&&h.requestId?[`Request ID: ${k.signInWithSolana.requestId}`]:[],...!((g=(p=k?.signInWithSolana)===null||p===void 0?void 0:p.resources)===null||g===void 0)&&g.length?["Resources",...k.signInWithSolana.resources.map(F=>`- ${F}`)]:[]].join(`
`);const O=await T.signMessage(new TextEncoder().encode(w),"utf8");if(!O||!(O instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");v=O}}try{const{data:_,error:N}=await mn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:w,signature:ku(v)},!((b=e.options)===null||b===void 0)&&b.captchaToken?{gotrue_meta_security:{captcha_token:(x=e.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:Co});if(N)throw N;if(!_||!_.session||!_.user){const E=new Od;return this._returnResult({data:{user:null,session:null},error:E})}return _.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),this._returnResult({data:Object.assign({},_),error:N})}catch(_){if(tn(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async _exchangeCodeForSession(e){const t=await bu(this.storage,`${this.storageKey}-code-verifier`),[n,r]=(t??"").split("/");try{if(!n&&this.flowType==="pkce")throw new Pj;const{data:i,error:o}=await mn(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Co});if(await ui(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const l=new Od;return this._returnResult({data:{user:null,session:null,redirectType:null},error:l})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:r??null}),error:o})}catch(i){if(await ui(this.storage,`${this.storageKey}-code-verifier`),tn(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:t,provider:n,token:r,access_token:i,nonce:o}=e,l=await mn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:r,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Co}),{data:d,error:h}=l;if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!d||!d.session||!d.user){const p=new Od;return this._returnResult({data:{user:null,session:null},error:p})}return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),this._returnResult({data:d,error:h})}catch(t){if(tn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,n,r,i,o;try{if("email"in e){const{email:l,options:d}=e;let h=null,p=null;this.flowType==="pkce"&&([h,p]=await Id(this.storage,this.storageKey));const{error:g}=await mn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=d?.data)!==null&&t!==void 0?t:{},create_user:(n=d?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:h,code_challenge_method:p},redirectTo:d?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:g})}if("phone"in e){const{phone:l,options:d}=e,{data:h,error:p}=await mn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(r=d?.data)!==null&&r!==void 0?r:{},create_user:(i=d?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:d?.captchaToken},channel:(o=d?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:h?.message_id},error:p})}throw new tp("You must provide either an email or phone number.")}catch(l){if(await ui(this.storage,`${this.storageKey}-code-verifier`),tn(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async verifyOtp(e){var t,n;try{let r,i;"options"in e&&(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:l}=await mn(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:Co});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const d=o.session,h=o.user;return d?.access_token&&(await this._saveSession(d),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",d)),this._returnResult({data:{user:h,session:d},error:null})}catch(r){if(tn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithSSO(e){var t,n,r,i,o;try{let l=null,d=null;this.flowType==="pkce"&&([l,d]=await Id(this.storage,this.storageKey));const h=await mn(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((r=e?.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:d}),headers:this.headers,xform:i8});return!((i=h.data)===null||i===void 0)&&i.url&&di()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(h.data.url),this._returnResult(h)}catch(l){if(await ui(this.storage,`${this.storageKey}-code-verifier`),tn(l))return this._returnResult({data:null,error:l});throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new va;const{error:r}=await mn(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:r})})}catch(e){if(tn(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:r,options:i}=e,{error:o}=await mn(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:r,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:n,type:r,options:i}=e,{data:o,error:l}=await mn(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:r,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:l})}throw new tp("You must provide either an email or phone number and a type")}catch(t){if(tn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await bu(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Dx:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const o=await bu(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=Px()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=t8(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:r},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await mn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Mc}):await this._useSession(async t=>{var n,r,i;const{data:o,error:l}=t;if(l)throw l;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new va}:await mn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0,xform:Mc})})}catch(t){if(tn(t))return Lx(t)&&(await this._removeSession(),await ui(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:r,error:i}=n;if(i)throw i;if(!r.session)throw new va;const o=r.session;let l=null,d=null;this.flowType==="pkce"&&e.email!=null&&([l,d]=await Id(this.storage,this.storageKey));const{data:h,error:p}=await mn(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:d}),jwt:o.access_token,xform:Mc});if(p)throw p;return o.user=h.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(n){if(await ui(this.storage,`${this.storageKey}-code-verifier`),tn(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new va;const t=Date.now()/1e3;let n=t,r=!0,i=null;const{payload:o}=sp(e.access_token);if(o.exp&&(n=o.exp,r=n<=t),r){const{data:l,error:d}=await this._callRefreshToken(e.refresh_token);if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:d}=await this._getUser(e.access_token);if(d)return this._returnResult({data:{user:null,session:null},error:d});i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(t){if(tn(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new va;const{data:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):r?this._returnResult({data:{user:r.user,session:r},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(tn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!di())throw new np("No browser detected.");if(e.error||e.error_description||e.error_code)throw new np(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Nw("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new np("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Nw("No code detected.");const{data:E,error:k}=await this._exchangeCodeForSession(e.code);if(k)throw k;const T=new URL(window.location.href);return T.searchParams.delete("code"),window.history.replaceState(window.history.state,"",T.toString()),{data:{session:E.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:r,access_token:i,refresh_token:o,expires_in:l,expires_at:d,token_type:h}=e;if(!i||!l||!o||!h)throw new np("No session defined in URL");const p=Math.round(Date.now()/1e3),g=parseInt(l);let b=p+g;d&&(b=parseInt(d));const x=b-p;x*1e3<=Vd&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${x}s, should have been closer to ${g}s`);const w=b-g;p-w>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",w,b,p):p-w<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",w,b,p);const{data:v,error:_}=await this._getUser(i);if(_)throw _;const N={provider_token:n,provider_refresh_token:r,access_token:i,expires_in:g,expires_at:b,refresh_token:o,token_type:h,user:v.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:N,redirectType:e.type},error:null})}catch(n){if(tn(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await bu(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:r,error:i}=t;if(i&&!Lx(i))return this._returnResult({error:i});const o=(n=r.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(Lj(l)&&(l.status===404||l.status===401||l.status===403)||Lx(l)))return this._returnResult({error:l})}return e!=="others"&&(await this._removeSession(),await ui(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=zj(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,r;try{const{data:{session:i},error:o}=t;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let n=null,r=null;this.flowType==="pkce"&&([n,r]=await Id(this.storage,this.storageKey,!0));try{return await mn(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(await ui(this.storage,`${this.storageKey}-code-verifier`),tn(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(tn(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:n,error:r}=await this._useSession(async i=>{var o,l,d,h,p;const{data:g,error:b}=i;if(b)throw b;const x=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(d=e.options)===null||d===void 0?void 0:d.queryParams,skipBrowserRedirect:!0});return await mn(this.fetch,"GET",x,{headers:this.headers,jwt:(p=(h=g.session)===null||h===void 0?void 0:h.access_token)!==null&&p!==void 0?p:void 0})});if(r)throw r;return di()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n?.url),this._returnResult({data:{provider:e.provider,url:n?.url},error:null})}catch(n){if(tn(n))return this._returnResult({data:{provider:e.provider,url:null},error:n});throw n}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var n;try{const{error:r,data:{session:i}}=t;if(r)throw r;const{options:o,provider:l,token:d,access_token:h,nonce:p}=e,g=await mn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=i?.access_token)!==null&&n!==void 0?n:void 0,body:{provider:l,id_token:d,access_token:h,nonce:p,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:Co}),{data:b,error:x}=g;return x?this._returnResult({data:{user:null,session:null},error:x}):!b||!b.session||!b.user?this._returnResult({data:{user:null,session:null},error:new Od}):(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("USER_UPDATED",b.session)),this._returnResult({data:b,error:x}))}catch(r){if(await ui(this.storage,`${this.storageKey}-code-verifier`),tn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,r;const{data:i,error:o}=t;if(o)throw o;return await mn(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(r=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&r!==void 0?r:void 0})})}catch(t){if(tn(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await Gj(async r=>(r>0&&await Hj(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await mn(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Co})),(r,i)=>{const o=200*Math.pow(2,r);return i&&Rx(i)&&Date.now()+o-n<Vd})}catch(n){if(this._debug(t,"error",n),tn(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),di()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const r=await bu(this.storage,this.storageKey);if(r&&this.userStorage){let o=await bu(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:r.user},await Wd(this.userStorage,this.storageKey+"-user",o)),r.user=(e=o?.user)!==null&&e!==void 0?e:Px()}else if(r&&!r.user&&!r.user){const o=await bu(this.storage,this.storageKey+"-user");o&&o?.user?(r.user=o.user,await ui(this.storage,this.storageKey+"-user"),await Wd(this.storage,this.storageKey,r)):r.user=Px()}if(this._debug(n,"session from storage",r),!this._isValidSession(r)){this._debug(n,"session is not valid"),r!==null&&await this._removeSession();return}const i=((t=r.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Dx;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${Dx}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),Rx(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(r.user&&r.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(r.access_token);!l&&o?.user?(r.user=o.user,await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(n,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(n,"error",r),console.error(r);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new va;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Hg;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new va;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={data:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(r,"error",i),tn(i)){const o={data:null,error:i};return Rx(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,n=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(d){i.push(d)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await ui(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await Wd(this.userStorage,this.storageKey+"-user",{user:t.user});const r=Object.assign({},t);delete r.user;const i=Tw(r);await Wd(this.storage,this.storageKey,i)}else{const r=Tw(t);await Wd(this.storage,this.storageKey,r)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await ui(this.storage,this.storageKey),await ui(this.storage,this.storageKey+"-code-verifier"),await ui(this.storage,this.storageKey+"-user"),this.userStorage&&await ui(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&di()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Vd);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const t=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const t=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,t&&clearTimeout(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((n.expires_at*1e3-e)/Vd);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${Vd}ms, refresh threshold is ${k1} ticks`),r<=k1&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof A_)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!di()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const r=[`provider=${encodeURIComponent(t)}`];if(n?.redirectTo&&r.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&r.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,o]=await Id(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(l.toString())}if(n?.queryParams){const i=new URLSearchParams(n.queryParams);r.push(i.toString())}return n?.skipBrowserRedirect&&r.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:r,error:i}=t;return i?this._returnResult({data:null,error:i}):await mn(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=r?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(tn(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,r;const{data:i,error:o}=t;if(o)return this._returnResult({data:null,error:o});const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:d,error:h}=await mn(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token});return h?this._returnResult({data:null,error:h}):(e.factorType==="totp"&&d.type==="totp"&&(!((r=d?.totp)===null||r===void 0)&&r.qr_code)&&(d.totp.qr_code=`data:image/svg+xml;utf-8,${d.totp.qr_code}`),this._returnResult({data:d,error:null}))})}catch(t){if(tn(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?w8(e.webauthn.credential_response):S8(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:d}=await mn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(n=r?.session)===null||n===void 0?void 0:n.access_token});return d?this._returnResult({data:null,error:d}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:d}))})}catch(t){if(tn(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=await mn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(n=r?.session)===null||n===void 0?void 0:n.access_token});if(o.error)return o;const{data:l}=o;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:y8(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:v8(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(tn(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:n}=await this.getUser();if(n)return{data:null,error:n};const r={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=t?.factors)!==null&&e!==void 0?e:[])r.all.push(i),i.status==="verified"&&r[i.factor_type].push(i);return{data:r,error:null}}async _getAuthenticatorAssuranceLevel(e){var t,n,r,i;if(e)try{const{payload:x}=sp(e);let w=null;x.aal&&(w=x.aal);let v=w;const{data:{user:_},error:N}=await this.getUser(e);if(N)return this._returnResult({data:null,error:N});((n=(t=_?.factors)===null||t===void 0?void 0:t.filter(T=>T.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(v="aal2");const k=x.amr||[];return{data:{currentLevel:w,nextLevel:v,currentAuthenticationMethods:k},error:null}}catch(x){if(tn(x))return this._returnResult({data:null,error:x});throw x}const{data:{session:o},error:l}=await this.getSession();if(l)return this._returnResult({data:null,error:l});if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:d}=sp(o.access_token);let h=null;d.aal&&(h=d.aal);let p=h;((i=(r=o.user.factors)===null||r===void 0?void 0:r.filter(x=>x.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(p="aal2");const b=d.amr||[];return{data:{currentLevel:h,nextLevel:p,currentAuthenticationMethods:b},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;return r?this._returnResult({data:null,error:r}):n?await mn(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:n.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new va})})}catch(t){if(tn(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:r},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!r)return this._returnResult({data:null,error:new va});const o=await mn(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"approve"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&di()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(n){if(tn(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:r},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!r)return this._returnResult({data:null,error:new va});const o=await mn(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"deny"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&di()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(n){if(tn(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;return n?this._returnResult({data:null,error:n}):t?await mn(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:r=>({data:r,error:null})}):this._returnResult({data:null,error:new va})})}catch(e){if(tn(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;return r?this._returnResult({data:null,error:r}):n?(await mn(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new va})})}catch(t){if(tn(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(l=>l.kid===e);if(n)return n;const r=Date.now();if(n=this.jwks.keys.find(l=>l.kid===e),n&&this.jwks_cached_at+Tj>r)return n;const{data:i,error:o}=await mn(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=r,n=i.keys.find(l=>l.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:x,error:w}=await this.getSession();if(w||!x.session)return this._returnResult({data:null,error:w});n=x.session.access_token}const{header:r,payload:i,signature:o,raw:{header:l,payload:d}}=sp(n);t?.allowExpired||Zj(i.exp);const h=!r.alg||r.alg.startsWith("HS")||!r.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(r.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!h){const{error:x}=await this.getUser(n);if(x)throw x;return{data:{claims:i,header:r,signature:o},error:null}}const p=Qj(r.alg),g=await crypto.subtle.importKey("jwk",h,p,!0,["verify"]);if(!await crypto.subtle.verify(p,g,o,Fj(`${l}.${d}`)))throw new D1("Invalid JWT signature");return{data:{claims:i,header:r,signature:o},error:null}}catch(n){if(tn(n))return this._returnResult({data:null,error:n});throw n}}}Ff.nextInstanceID={};const D8=Ff,L8="2.95.3";let vf="";typeof Deno<"u"?vf="deno":typeof document<"u"?vf="web":typeof navigator<"u"&&navigator.product==="ReactNative"?vf="react-native":vf="node";const R8={"X-Client-Info":`supabase-js-${vf}/${L8}`},P8={headers:R8},B8={schema:"public"},O8={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},I8={};function Uf(s){"@babel/helpers - typeof";return Uf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Uf(s)}function M8(s,e){if(Uf(s)!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var n=t.call(s,e);if(Uf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function F8(s){var e=M8(s,"string");return Uf(e)=="symbol"?e:e+""}function U8(s,e,t){return(e=F8(e))in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function Iw(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),t.push.apply(t,n)}return t}function dr(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Iw(Object(t),!0).forEach(function(n){U8(s,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):Iw(Object(t)).forEach(function(n){Object.defineProperty(s,n,Object.getOwnPropertyDescriptor(t,n))})}return s}const z8=s=>s?(...e)=>s(...e):(...e)=>fetch(...e),$8=()=>Headers,q8=(s,e,t)=>{const n=z8(t),r=$8();return async(i,o)=>{var l;const d=(l=await e())!==null&&l!==void 0?l:s;let h=new r(o?.headers);return h.has("apikey")||h.set("apikey",s),h.has("Authorization")||h.set("Authorization",`Bearer ${d}`),n(i,dr(dr({},o),{},{headers:h}))}};function H8(s){return s.endsWith("/")?s:s+"/"}function G8(s,e){var t,n;const{db:r,auth:i,realtime:o,global:l}=s,{db:d,auth:h,realtime:p,global:g}=e,b={db:dr(dr({},d),r),auth:dr(dr({},h),i),realtime:dr(dr({},p),o),storage:{},global:dr(dr(dr({},g),l),{},{headers:dr(dr({},(t=g?.headers)!==null&&t!==void 0?t:{}),(n=l?.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return s.accessToken?b.accessToken=s.accessToken:delete b.accessToken,b}function V8(s){const e=s?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(H8(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var W8=class extends D8{constructor(s){super(s)}},Y8=class{constructor(s,e,t){var n,r;this.supabaseUrl=s,this.supabaseKey=e;const i=V8(s);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,l={db:B8,realtime:I8,auth:dr(dr({},O8),{},{storageKey:o}),global:P8},d=G8(t??{},l);if(this.storageKey=(n=d.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(r=d.global.headers)!==null&&r!==void 0?r:{},d.accessToken)this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(p,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}});else{var h;this.auth=this._initSupabaseAuthClient((h=d.auth)!==null&&h!==void 0?h:{},this.headers,d.global.fetch)}this.fetch=q8(e,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(dr({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(p=>this.realtime.setAuth(p)).catch(p=>console.warn("Failed to set initial Realtime auth token:",p)),this.rest=new Lk(new URL("rest/v1",i).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch,timeout:d.db.timeout,urlLengthLimit:d.db.urlLengthLimit}),this.storage=new Nj(this.storageUrl.href,this.headers,this.fetch,t?.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new Ak(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(s){return this.rest.from(s)}schema(s){return this.rest.schema(s)}rpc(s,e={},t={head:!1,get:!1,count:void 0}){return this.rest.rpc(s,e,t)}channel(s,e={config:{}}){return this.realtime.channel(s,e)}getChannels(){return this.realtime.getChannels()}removeChannel(s){return this.realtime.removeChannel(s)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var s=this,e,t;if(s.accessToken)return await s.accessToken();const{data:n}=await s.auth.getSession();return(e=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:s.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:s,persistSession:e,detectSessionInUrl:t,storage:n,userStorage:r,storageKey:i,flowType:o,lock:l,debug:d,throwOnError:h},p,g){const b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new W8({url:this.authUrl.href,headers:dr(dr({},b),p),storageKey:i,autoRefreshToken:s,persistSession:e,detectSessionInUrl:t,storage:n,userStorage:r,flowType:o,lock:l,debug:d,throwOnError:h,fetch:g,hasCustomAuthorizationHeader:Object.keys(this.headers).some(x=>x.toLowerCase()==="authorization")})}_initRealtimeClient(s){return new Kk(this.realtimeUrl.href,dr(dr({},s),{},{params:dr(dr({},{apikey:this.supabaseKey}),s?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,e)=>{this._handleTokenChanged(s,"CLIENT",e?.access_token)})}_handleTokenChanged(s,e,t){(s==="TOKEN_REFRESHED"||s==="SIGNED_IN")&&this.changedAccessToken!==t?(this.changedAccessToken=t,this.realtime.setAuth(t)):s==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const K8=(s,e,t)=>new Y8(s,e,t);function X8(){if(typeof window<"u")return!1;const s=globalThis.process;if(!s)return!1;const e=s.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}X8()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const J8="https://bxkgaazvfhzofninrxyn.supabase.co",E_="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ4a2dhYXp2Zmh6b2ZuaW5yeHluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2ODE3NzcsImV4cCI6MjA4NjI1Nzc3N30.bMdnSqCsqoy40ctIvaFRqhCALBXQWb2S41_a6k86drs",ds=K8(J8,E_,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),wf={async getAll(){const{data:s,error:e}=await ds.from("students").select("*").order("created_at",{ascending:!1});if(e)throw e;return s},async getById(s){const{data:e,error:t}=await ds.from("students").select("*").eq("id",s).single();if(t)throw t;return e},async create(s){if(!ds)throw new Error("Supabase not configured");const e={name:s.name,email:s.email||`${String(s.name).replace(/\s+/g,"").toLowerCase()}_${Date.now()}@example.com`};s.user_id&&(e.user_id=s.user_id);const{data:t,error:n}=await ds.from("students").insert([e]).select().single();if(n)throw n;return t},async update(s,e){const{data:t,error:n}=await ds.from("students").update(e).eq("id",s).select().single();if(n)throw n;return t},async delete(s){const{error:e}=await ds.from("students").delete().eq("id",s);if(e)throw e}},vu={async getAll(){const{data:s,error:e}=await ds.from("bookings").select("*, students(name, email)").order("date",{ascending:!0});if(e)throw e;return s},async getByStudent(s){const{data:e,error:t}=await ds.from("bookings").select("*").eq("student_id",s).order("date",{ascending:!0});if(t)throw t;return e},async getUpcoming(){const s=new Date().toISOString(),{data:e,error:t}=await ds.from("bookings").select("*, students(name, email)").gte("date",s).eq("status","confirmed").order("date",{ascending:!0});if(t)throw t;return e},async create(s){const{data:e,error:t}=await ds.from("bookings").insert([s]).select().single();if(t)throw t;return e},async update(s,e){const{data:t,error:n}=await ds.from("bookings").update(e).eq("id",s).select().single();if(n)throw n;return t},async cancel(s){return await this.update(s,{status:"cancelled"})},async delete(s){const{error:e}=await ds.from("bookings").delete().eq("id",s);if(e)throw e},async checkAvailability(s,e){const{data:t,error:n}=await ds.from("bookings").select("id").eq("date",s).eq("time",e).eq("status","confirmed");if(n)throw n;return t.length===0}},Ox={async getByStudent(s){const{data:e,error:t}=await ds.from("chat_messages").select("*").eq("student_id",s).order("timestamp",{ascending:!0});if(t)throw t;return e},async send(s){const{data:e,error:t}=await ds.from("chat_messages").insert([s]).select().single();if(t)throw t;return e},async markAsRead(s){const{error:e}=await ds.from("chat_messages").update({read:!0}).eq("student_id",s).eq("read",!1);if(e)throw e},subscribeToStudent(s,e){return ds.channel(`chat:${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`student_id=eq.${s}`},e).subscribe()}},L1={async getAll(){const{data:s,error:e}=await ds.from("session_history").select("*").order("date",{ascending:!1});if(e)throw e;return s},async getByStudent(s){const{data:e,error:t}=await ds.from("session_history").select("*").eq("student_id",s).order("date",{ascending:!1});if(t)throw t;return e},async create(s){const{data:e,error:t}=await ds.from("session_history").insert([s]).select().single();if(t)throw t;return e}},wu={async getAll(){const{data:s,error:e}=await ds.from("availability_slots").select("*").order("day_of_week",{ascending:!0});if(e)throw e;return s},async create(s){const{data:e,error:t}=await ds.from("availability_slots").insert([s]).select().single();if(t)throw t;return e},async update(s,e){const{data:t,error:n}=await ds.from("availability_slots").update(e).eq("id",s).select().single();if(n)throw n;return t},async delete(s){const{error:e}=await ds.from("availability_slots").delete().eq("id",s);if(e)throw e}},Su="davina.potter@outlook.com",xr={async _sendEmail(s,e,t,n="Davina Tutoring"){const r={to:s,subject:e,html:t,from_name:n};console.log("[EmailService] Attempting to send email:",{to:s,subject:e});try{if(!ds||!ds.functions)throw console.error("[EmailService] Supabase client is not properly initialized. Check your VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY."),new Error("Supabase client not initialized");const{data:i,error:o}=await ds.functions.invoke("send-general-email",{body:r});if(o)throw console.error("[EmailService] Supabase Edge Function returned an error:",o),(o.message?.toLowerCase().includes("authorized")||o.message?.toLowerCase().includes("verify"))&&console.warn("[EmailService] POTENTIAL TRIAL LIMIT: Resend may be blocking this email because the recipient is not your verified email and you are on a Trial plan."),o;return console.log("[EmailService] Email sent successfully:",i),i}catch(i){throw console.error("[EmailService] Critical failure sending email:",i),i}},async sendConfirmation(s){try{const e=s.type==="consultation"||s.subject==="Free Consultation",t=e?`Booking Confirmed: ${s.subject} with Davina`:`Lesson Confirmed: ${s.subject} for ${s.date}`,n=`
                <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; border: 1px solid #eee; border-radius: 12px; overflow: hidden;">
                    <div style="background: #7c3aed; padding: 20px; text-align: center; color: white;">
                        <h2 style="margin: 0;">Booking Confirmed!</h2>
                    </div>
                    <div style="padding: 30px;">
                        <p>Hi ${s.student},</p>
                        <p>Your ${e?"consultation":"lesson"} is confirmed. I'm looking forward to our session!</p>
                        
                        <div style="background: #f4f4f9; padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <p style="margin: 5px 0;"><strong> Subject:</strong> ${s.subject}</p>
                            <p style="margin: 5px 0;"><strong> Date:</strong> ${s.date}</p>
                            <p style="margin: 5px 0;"><strong> Time:</strong> ${s.time}</p>
                            ${s.meetingLink?`
                            <div style="margin-top: 15px;">
                                <a href="${s.meetingLink}" style="background: #7c3aed; color: white; padding: 10px 20px; text-decoration: none; border-radius: 6px; font-weight: bold; display: inline-block;">Join Session</a>
                            </div>
                            <p style="font-size: 12px; margin-top: 10px;">Or copy link: ${s.meetingLink}</p>
                            `:""}
                        </div>

                        ${e?`
                        <p><strong>How to prepare:</strong><br>
                        To help us make the most of our chat, feel free to share your Exam Board, current grades, or specific topics you find difficult.</p>
                        `:`
                        <p>Please ensure you have a stable internet connection and a quiet space for our lesson.</p>
                        `}
                        
                        <p style="margin-top: 30px; border-top: 1px solid #eee; pt: 20px;">
                            See you soon,<br>
                            <strong>Davina Potter</strong>
                        </p>
                    </div>
                </div>
            `;await this._sendEmail(s.email,t,n),console.log("Confirmation email sent"),await this.sendTeacherNotification(s)}catch(e){throw console.error("Failed to send confirmation email:",e),e}},async sendTeacherNotification(s){try{const e=`New Booking: ${s.student} - ${s.subject}`,t=`
                <div style="font-family: sans-serif; line-height: 1.5; color: #333;">
                    <h2>New Booking Notification</h2>
                    <p><strong>Student:</strong> ${s.student}</p>
                    <p><strong>Email:</strong> ${s.email}</p>
                    <p><strong>Subject:</strong> ${s.subject}</p>
                    <p><strong>Date:</strong> ${s.date}</p>
                    <p><strong>Time:</strong> ${s.time}</p>
                    <p><strong>Type:</strong> ${s.bookingFor==="parent"?"Parent Booking":"Student Booking"}</p>
                    <p><strong>Role:</strong> ${s.bookingFor==="parent"?"Parent":"Student"}</p>
                </div>
            `;await this._sendEmail(Su,e,t)}catch(e){console.error("Failed to send teacher notification:",e)}},async sendRescheduleRequest(s,e){try{if(e==="teacher"){const t=`Reschedule Request: ${s.subject}`,n=`
                    <div style="font-family: sans-serif;">
                        <p>Hi ${s.student},</p>
                        <p>I would like to request to reschedule our lesson originally set for ${s.date} at ${s.time}.</p>
                        <div style="background: #f9f9f9; padding: 15px; border-radius: 8px;">
                            <p><strong>Requested New Time:</strong></p>
                            <p> Date: ${s.requestedDate}</p>
                            <p> Time: ${s.requestedTime}</p>
                        </div>
                        <p>Please login to your dashboard to Approve or Deny this request.</p>
                        <p>Best,<br>Davina Potter</p>
                    </div>
                `;return await this._sendEmail(s.email,t,n)}else if(e==="student"||e==="parent"){const t=`RESCHEDULE REQUEST: ${s.subject}`,n=`
                    <div style="font-family: sans-serif;">
                        <p><strong>${e==="parent"?"Parent":"Student"}:</strong> ${s.student}</p>
                        <p><strong>Requested Date:</strong> ${s.requestedDate}</p>
                        <p><strong>Requested Time:</strong> ${s.requestedTime}</p>
                        <p><strong>Subject:</strong> ${s.subject}</p>
                    </div>
                `;return await this._sendEmail(Su,t,n)}}catch(t){console.error("Failed to send reschedule request:",t)}},async sendRescheduleResponse(s,e){try{const t=`Reschedule ${e}: ${s.subject}`,n=`
                <div style="font-family: sans-serif;">
                    <p>Hi ${s.student},</p>
                    <p>Your reschedule request has been <strong>${e}</strong>.</p>
                    <div style="background: #f9f9f9; padding: 15px; border-radius: 8px;">
                        <p><strong>New Lesson Time:</strong></p>
                        <p> Date: ${s.date}</p>
                        <p> Time: ${s.time}</p>
                    </div>
                    <p>Best,<br>Davina</p>
                </div>
            `;await this._sendEmail(s.email,t,n),(e==="Accepted"||e==="Declined"||e==="Approved")&&await this.sendRescheduleResponseToTeacher(s,e)}catch(t){console.error("Failed to send reschedule response:",t)}},async sendRescheduleResponseToTeacher(s,e){try{const t=`RESCHEDULE ${e.toUpperCase()}: ${s.subject}`,n=`<p>Student <strong>${s.student}</strong> has ${e} the reschedule for ${s.date} at ${s.time}.</p>`;await this._sendEmail(Su,t,n)}catch(t){console.error("Failed to notify teacher of reschedule response:",t)}},async sendCancellationNotice(s,e){try{if(e==="teacher"){const t=`Lesson Cancelled: ${s.subject}`,n=`
                    <div style="font-family: sans-serif;">
                        <p>Hi ${s.student},</p>
                        <p>The lesson scheduled for ${s.date} at ${s.time} has been cancelled.</p>
                        <p><strong>Topic:</strong> ${s.subject}</p>
                        <p>If this was a paid lesson, any applicable refunds will be processed shortly.</p>
                    </div>
                `;return await this._sendEmail(s.email,t,n)}else if(e==="student"){const t=`LESSON CANCELLED: ${s.subject}`,n=`<p>Student <strong>${s.student}</strong> cancelled the lesson on ${s.date} at ${s.time}.</p>`;await this._sendEmail(Su,t,n)}}catch(t){console.error("Failed to send cancellation email:",t)}},async sendRefundNotice(s){try{const e=`Refund Processed: ${s.subject}`,t=`
                <div style="font-family: sans-serif;">
                    <p>Hi ${s.student},</p>
                    <p>A refund of <strong>${s.cost}</strong> has been initiated for your lesson on ${s.date}.</p>
                    <p>Please allow 5-10 business days for this to appear in your account.</p>
                </div>
            `;return await this._sendEmail(s.email,e,t)}catch(e){console.error("Failed to send refund email:",e)}},async sendReceipt(s){try{const e=`Receipt: Payment for ${s.subject}`,t=`
                <div style="font-family: sans-serif; border: 1px solid #eee; padding: 20px; max-width: 500px;">
                    <h3>Payment Receipt</h3>
                    <hr>
                    <p><strong>Receipt #:</strong> ${s.id.toString().slice(-6)}</p>
                    <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
                    <p><strong>Item:</strong> ${s.subject}</p>
                    <p><strong>Amount:</strong> ${s.cost}</p>
                    <p><strong>Status:</strong> Paid</p>
                    <hr>
                    <p>Thank you for your business!</p>
                    <p>Best,<br>Davina</p>
                </div>
            `;return await this._sendEmail(s.email,e,t)}catch(e){console.error("Failed to send receipt email:",e)}},async sendReminder(s){console.log("Reminder logic is handled by Supabase Edge Function")},async sendPaymentOverriddenNotification(s,e){try{const t="PAYMENT EXCEPTION USED",n=`<p><strong>URGENT:</strong> Payment override used for student <strong>${s}</strong> on ${e}.</p>`;await this._sendEmail(Su,t,n,"System Alert")}catch(t){console.error("Failed to send payment override notification:",t)}},async sendMessageNotification(s,e,t){try{const n=`New Message from ${s}`,r=`
                <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; border: 1px solid #eee; border-radius: 12px; overflow: hidden;">
                    <div style="background: #0d9488; padding: 20px; text-align: center; color: white;">
                        <h2 style="margin: 0;">New Message Notification</h2>
                    </div>
                    <div style="padding: 30px;">
                        <p>Hi,</p>
                        <p>You have a new message from <strong>${s}</strong>:</p>
                        <blockquote style="background: #f0fdfa; border-left: 4px solid #0d9488; padding: 15px; font-style: italic; margin: 20px 0; border-radius: 0 8px 8px 0;">
                            "${t}"
                        </blockquote>
                        <div style="text-align: center; margin-top: 30px;">
                            <a href="${window.location.origin}" style="background: #0d9488; color: white; padding: 12px 25px; text-decoration: none; border-radius: 8px; font-weight: bold; display: inline-block;">View in Dashboard</a>
                        </div>
                        <p style="margin-top: 30px; font-size: 14px; color: #666; text-align: center;">
                            TutorPro Notification System
                        </p>
                    </div>
                </div>
            `;await this._sendEmail(e,n,r,"TutorPro System")}catch(n){console.error("Failed to send message notification:",n)}},async sendNewBookingNotificationToTeacher(s){try{const e=`NEW BOOKING: ${s.subject}`,t=`
                <p><strong>Student:</strong> ${s.student}</p>
                <p><strong>Email:</strong> ${s.email}</p>
                <p><strong>Date:</strong> ${s.date}</p>
                <p><strong>Time:</strong> ${s.time}</p>
                <p><strong>Type:</strong> ${s.recurringId?"Recurring":"Individual"}</p>
            `;await this._sendEmail(Su,e,t)}catch(e){console.error("Failed to notify teacher of new booking:",e)}}},Z8=()=>E_!=="",$r={isUsingBackend:Z8(),async getStudents(){const s=()=>{try{const i=localStorage.getItem("tutor_students"),o=i?JSON.parse(i):[];return Array.isArray(o)?o:[]}catch{return[]}},e=()=>{try{const i=sessionStorage.getItem("tutor_students_fallback"),o=i?JSON.parse(i):[];return Array.isArray(o)?o:[]}catch{return[]}};if(this.isUsingBackend)try{const i=await wf.getAll(),o=s(),l=e(),d=[...i||[]];for(const h of[...o,...l]){if(!h||!h.id)continue;const p=d.findIndex(g=>g.id===h.id);p>=0?d[p]={...d[p],...h}:d.push(h)}return d}catch{const o=s(),l=e(),d=new Set;return[...o,...l].filter(h=>h?.id&&!d.has(h.id)&&d.add(h.id))}const t=s(),n=e(),r=new Set;return[...t,...n].filter(i=>i?.id&&!r.has(i.id)&&r.add(i.id))},async createStudent(s){const e=n=>{if(!n||typeof n!="object")return n;const r={...n};return r.email||(r.email=`${String(r.name||"student").replace(/\s+/g,"").toLowerCase()}_${Date.now()}@example.com`),r},t=n=>{const r=e({name:n?.name||"",email:n?.email||""}),i={...r,id:r.id&&typeof r.id=="string"?r.id:Date.now().toString()};try{const o=localStorage.getItem("tutor_students"),l=o?JSON.parse(o):[];if(!Array.isArray(l))throw new Error("Invalid local data");const d=[...l,i];return localStorage.setItem("tutor_students",JSON.stringify(d)),i}catch(o){try{return sessionStorage.setItem("tutor_students_fallback",JSON.stringify([i])),console.warn("dataService: localStorage failed, saved to sessionStorage",o?.message),i}catch(l){throw console.error("dataService: Could not persist student",l),new Error("Browser storage is full or disabled. Try another browser or clear site data.")}}};try{if(this.isUsingBackend){try{const n=e({...s}),r=await wf.create(n);if(r&&r.id){try{const i=localStorage.getItem("tutor_students"),o=i?JSON.parse(i):[];Array.isArray(o)&&localStorage.setItem("tutor_students",JSON.stringify([...o,r]))}catch{}return r}}catch(n){console.warn("dataService: Backend create failed, saving locally:",n?.message||n)}return t(s)}return t(s)}catch(n){throw console.error("dataService createStudent error:",n),new Error(n?.message||"Failed to create account. Please try again.")}},async updateStudent(s,e){if(this.isUsingBackend)try{return await wf.update(s,e)}catch(r){console.warn("dataService: Backend update failed, updating locally:",r?.message||r)}const t=await this.getStudents(),n=t.findIndex(r=>r.id===s);return n!==-1?(t[n]={...t[n],...e},localStorage.setItem("tutor_students",JSON.stringify(t)),t[n]):null},async deleteStudent(s){if(this.isUsingBackend)return await wf.delete(s);const t=(await this.getStudents()).filter(n=>n.id!==s);localStorage.setItem("tutor_students",JSON.stringify(t))},async getBookings(){const s=JSON.parse(localStorage.getItem("tutor_bookings")||"[]");if(this.isUsingBackend)try{const e=await vu.getAll(),n=(Array.isArray(e)?e:[]).map(r=>({...r,student:r.student||r.students&&r.students.name||r.student_id,paymentStatus:r.paymentStatus??r.payment_status}));return s.forEach(r=>{n.some(i=>i.id===r.id)||n.push({...r,student:r.student})}),n}catch{return s}return s},async getBookingsByStudent(s){return this.isUsingBackend?await vu.getByStudent(s):(await this.getBookings()).filter(t=>t.studentId===s)},async createBooking(s){const e={...s,id:s.id||Date.now().toString(),student:s.student};if(this.isUsingBackend)try{const n={student_id:s.studentId,date:(s.date||"").includes("T")?s.date:`${s.date}T12:00:00.000Z`,time:(s.time||"").length===5?s.time+":00":s.time,subject:s.subject,status:s.status||"confirmed",type:s.type||"lesson",cost:s.cost!=null?s.cost:30,payment_status:(s.paymentStatus||s.payment_status||"due").toLowerCase().replace(/ /g,"_")},r=await vu.create(n),i={...r,student:s.student,studentName:s.studentName||s.student,type:r.type||s.type||"lesson",cost:r.cost!=null?r.cost:s.cost!=null?s.cost:30,paymentStatus:r.payment_status||r.paymentStatus||s.paymentStatus},o=JSON.parse(localStorage.getItem("tutor_bookings")||"[]");return localStorage.setItem("tutor_bookings",JSON.stringify([...o,i])),window.dispatchEvent(new Event("storage")),i}catch(n){console.warn("createBooking backend failed, saving locally",n?.message)}const t=await this.getBookings();return t.push(e),localStorage.setItem("tutor_bookings",JSON.stringify(t)),window.dispatchEvent(new Event("storage")),e},async updateBooking(s,e){if(this.isUsingBackend)return await vu.update(s,e);const t=await this.getBookings(),n=t.findIndex(r=>r.id===s);return n!==-1?(t[n]={...t[n],...e},localStorage.setItem("tutor_bookings",JSON.stringify(t)),window.dispatchEvent(new Event("storage")),t[n]):null},async cancelBooking(s){return await this.updateBooking(s,{status:"cancelled"})},async deleteBooking(s){if(this.isUsingBackend)return await vu.delete(s);const t=(await this.getBookings()).filter(n=>n.id!==s);localStorage.setItem("tutor_bookings",JSON.stringify(t)),window.dispatchEvent(new Event("storage"))},async checkAvailability(s,e){return this.isUsingBackend?await vu.checkAvailability(s,e):!(await this.getBookings()).some(n=>n.date===s&&n.time===e&&n.status==="confirmed")},async getChatMessages(s=null){if(this.isUsingBackend&&s)return await Ox.getByStudent(s);const e=localStorage.getItem("chat_messages_v2");if(!e)return s?[]:{};const t=JSON.parse(e);return s?t[s]||[]:t},async sendChatMessage(s,e,t){if(this.isUsingBackend)return await Ox.send({student_id:s,sender:e,message:t,timestamp:new Date().toISOString()});const n=await this.getChatMessages(),r={sender:e,message:t,timestamp:new Date().toISOString()},i={...n,[s]:[...n[s]||[],r]};return localStorage.setItem("chat_messages_v2",JSON.stringify(i)),r},subscribeToChatMessages(s,e){if(this.isUsingBackend)return Ox.subscribeToStudent(s,e);const t=()=>{this.getChatMessages(s).then(e)};return window.addEventListener("storage",t),{unsubscribe:()=>window.removeEventListener("storage",t)}},async getSessionHistory(){if(this.isUsingBackend)return await L1.getAll();const s=localStorage.getItem("tutor_session_history");return s?JSON.parse(s):[]},async createSession(s){if(this.isUsingBackend)return await L1.create(s);const e=await this.getSessionHistory(),t={...s,id:s.id||Date.now().toString()};return e.push(t),localStorage.setItem("tutor_session_history",JSON.stringify(e)),t},async getAvailability(){if(this.isUsingBackend)return{slots:await wu.getAll()||[],lessonSlots:[],allLessonSlots:[],consultationSlots:await this.getConsultationSlots()};const s=localStorage.getItem("tutor_slots"),e=localStorage.getItem("tutor_lesson_slots");let t=localStorage.getItem("tutor_all_lesson_slots"),n=localStorage.getItem("tutor_weekly_schedule");const r=[{day:"Monday",intervals:[{start:"09:00",end:"15:00"},{start:"18:45",end:"20:00"}],active:!0},{day:"Tuesday",intervals:[{start:"18:00",end:"20:00"}],active:!0},{day:"Wednesday",intervals:[{start:"13:00",end:"16:00"}],active:!0},{day:"Thursday",intervals:[{start:"09:00",end:"16:00"},{start:"19:00",end:"20:00"}],active:!0},{day:"Friday",intervals:[{start:"09:00",end:"12:00"},{start:"18:00",end:"20:00"}],active:!0},{day:"Saturday",intervals:[{start:"09:00",end:"18:00"}],active:!0},{day:"Sunday",intervals:[{start:"09:00",end:"18:00"}],active:!0}];if(!n||n==="[]"||n==="{}")n=JSON.stringify(r);else try{const i=JSON.parse(n);(!Array.isArray(i)||i.length===0||!i.some(o=>o.active))&&(n=JSON.stringify(r))}catch{n=JSON.stringify(r)}if(!t||JSON.parse(t).length===0)try{const i=JSON.parse(n),o=e?JSON.parse(e):[],l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=[],h=new Date,p=60;for(let b=0;b<p;b++){const x=new Date(h);x.setDate(h.getDate()+b);const w=l[x.getDay()],v=i.find(_=>_.day===w);!v||!v.active||v.intervals.forEach(_=>{if(!_.start||!_.end)return;const[N,E]=_.start.split(":").map(Number),[k,T]=_.end.split(":").map(Number);for(let P=N;P<k&&!(P===k&&T<60);P++){const O=`${String(P).padStart(2,"0")}:${String(E||0).padStart(2,"0")}`,F=x.toISOString().split("T")[0];o.some($=>$.date===F&&$.time===O)||d.push({id:`gen-${F}-${O}`,date:F,time:O,bookedBy:null,generated:!0})}})}const g=[...o,...d];t=JSON.stringify(g),localStorage.setItem("tutor_all_lesson_slots",t)}catch(i){console.error("Error generating slots in dataService:",i)}return{slots:s?JSON.parse(s):[],lessonSlots:e?JSON.parse(e):[],allLessonSlots:t?JSON.parse(t):[],consultationSlots:await this.getConsultationSlots()}},async getConsultationSlots(){if(this.isUsingBackend){const h=await wu.getAll(),p=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],g=p.map(b=>({day:b,intervals:[],active:!1}));h.forEach(b=>{if(b.is_active){const x=p[b.day_of_week],w=g.find(v=>v.day===x);if(w){w.active=!0;const v=b.start_time.slice(0,5),_=b.end_time.slice(0,5);w.intervals.push({start:v,end:_})}}}),localStorage.setItem("tutor_weekly_schedule",JSON.stringify(g))}let s=localStorage.getItem("tutor_weekly_schedule");const e=[{day:"Monday",intervals:[{start:"09:00",end:"17:00"}],active:!0},{day:"Tuesday",intervals:[{start:"09:00",end:"17:00"}],active:!0},{day:"Wednesday",intervals:[{start:"09:00",end:"17:00"}],active:!0},{day:"Thursday",intervals:[{start:"09:00",end:"17:00"}],active:!0},{day:"Friday",intervals:[{start:"09:00",end:"15:00"}],active:!0},{day:"Saturday",intervals:[{start:"09:00",end:"18:00"}],active:!0},{day:"Sunday",intervals:[{start:"09:00",end:"18:00"}],active:!0}];let t=[],n=!1;try{if(!s||s==="[]"||s==="{}")throw new Error("Empty schedule");if(t=JSON.parse(s),!Array.isArray(t)||t.length===0)throw new Error("Invalid schedule format")}catch{console.warn("getConsultationSlots: Schedule missing/invalid. Auto-repairing with default."),t=e,n=!0}n&&(localStorage.setItem("tutor_weekly_schedule",JSON.stringify(t)),window.dispatchEvent(new Event("storage")));const r=await this.getBookings(),i=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],o=[],l=new Date,d=60;for(let h=0;h<d;h++){const p=new Date(l);p.setDate(l.getDate()+h);const g=i[p.getDay()],b=p.toISOString().split("T")[0],x=t.find(w=>w.day===g);!x||!x.active||x.intervals.forEach(w=>{if(!w.start||!w.end)return;const[v,_]=w.start.split(":").map(Number),[N,E]=w.end.split(":").map(Number);let k=v*60+_;const T=N*60+E;for(;k<T;){const P=Math.floor(k/60),O=k%60,F=`${String(P).padStart(2,"0")}:${String(O).padStart(2,"0")}`;r.some(z=>{if(z.date!==b||z.status==="cancelled")return!1;const[G,R]=z.time.split(":").map(Number),q=G*60+R,Z=q+60;return k>=q&&k<Z})||o.push({id:`consult-${b}-${F}`,date:b,time:F,type:"consultation",generated:!0}),k+=15}})}return o},async saveAvailability(s,e){this.isUsingBackend||(localStorage.setItem("tutor_slots",JSON.stringify(s)),localStorage.setItem("tutor_lesson_slots",JSON.stringify(e)))},async saveWeeklySchedule(s){if(localStorage.setItem("tutor_weekly_schedule",JSON.stringify(s)),window.dispatchEvent(new Event("storage")),this.isUsingBackend)try{const e=await wu.getAll();await Promise.all(e.map(n=>wu.delete(n.id)));const t={Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6,Sunday:0};for(const n of s){if(!n.active)continue;const r=t[n.day];for(const i of n.intervals)await wu.create({day_of_week:r,start_time:i.start,end_time:i.end,slot_type:"both",is_active:!0})}}catch(e){console.error("Failed to save schedule to DB:",e)}},async getWeeklySchedule(){const s=[{day:"Monday",intervals:[{start:"09:00",end:"17:00"}],active:!0},{day:"Tuesday",intervals:[{start:"09:00",end:"17:00"}],active:!0},{day:"Wednesday",intervals:[{start:"09:00",end:"17:00"}],active:!0},{day:"Thursday",intervals:[{start:"09:00",end:"17:00"}],active:!0},{day:"Friday",intervals:[{start:"09:00",end:"15:00"}],active:!0},{day:"Saturday",intervals:[{start:"09:00",end:"18:00"}],active:!0},{day:"Sunday",intervals:[{start:"09:00",end:"18:00"}],active:!0}];if(this.isUsingBackend)try{const r=await wu.getAll();if(!r||r.length===0)return s;const i=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=i.map(d=>({day:d,intervals:[],active:!1}));return r.forEach(d=>{if(d.is_active){const h=o[d.day_of_week],p=l.find(g=>g.day===h);p&&(p.active=!0,p.intervals.push({start:d.start_time.slice(0,5),end:d.end_time.slice(0,5)}))}}),l.forEach(d=>{d.intervals.sort((h,p)=>h.start.localeCompare(p.start))}),l}catch(r){return console.error("Error getting schedule from DB:",r),s}const e=localStorage.getItem("tutor_weekly_schedule"),t=e?JSON.parse(e):s;return["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(r=>t.find(o=>o.day===r)||{day:r,intervals:[],active:!1})}},Q8=s=>{if(!s||!s.date||!s.time)return"#";try{const e=new Date(`${s.date}T${s.time}`),t=new Date(e.getTime()+3600*1e3),n=i=>i.toISOString().replace(/-|:|\.\d\d\d/g,"");return`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:`Tutoring: ${s.subject||"Lesson"}`,dates:`${n(e)}/${n(t)}`,details:"Tutoring session with Davina. Join via your Student Dashboard.",location:"https://davina-tutor-pro.netlify.app"}).toString()}`}catch(e){return console.error("Error generating calendar link",e),"#"}},Mw=s=>s?s.trim().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "):"",eT=({onBook:s})=>{const[e,t]=Y.useState([]),[n,r]=Y.useState(null),[i,o]=Y.useState(null),[l,d]=Y.useState(!1),[h,p]=Y.useState(""),[g,b]=Y.useState(""),[x,w]=Y.useState(""),[v,_]=Y.useState(""),[N,E]=Y.useState(!1),[k,T]=Y.useState("pupil"),[P,O]=Y.useState(null),[F,$]=Y.useState(null),[z,G]=Y.useState(""),[R,q]=Y.useState(null);Y.useEffect(()=>{const le=async()=>{const{consultationSlots:K}=await $r.getAvailability();console.log("Loading Consultation Slots:",K?K.length:0),K&&t(K)};return le(),window.addEventListener("storage",le),()=>window.removeEventListener("storage",le)},[]);const J=e.reduce((le,K)=>(le[K.date]||(le[K.date]=[]),le[K.date].push(K),le),{}),Z=Object.keys(J).sort();return e.length===0?u.jsxs("div",{className:"text-center py-12 text-gray-500",children:[u.jsx(ll,{size:48,className:"mx-auto mb-4 opacity-50"}),u.jsx("p",{children:"No available slots found for the next 30 days."})]}):u.jsxs("div",{className:"flex flex-col md:flex-row gap-8 min-h-[500px]",children:[u.jsxs("div",{className:"md:w-1/3 md:max-h-[450px] overflow-y-auto pr-2 custom-scrollbar",children:[u.jsx("h3",{className:"font-bold text-gray-400 uppercase text-xs mb-3",children:"Select Date"}),u.jsx("div",{className:"space-y-2",children:Z.map(le=>u.jsxs("button",{onClick:()=>r(le),className:`w-full p-4 rounded-xl text-left border-2 transition-all ${n===le?"border-purple-600 bg-purple-50 ring-2 ring-purple-100":"border-white bg-white hover:border-purple-100"}`,children:[u.jsx("div",{className:"font-bold text-sm uppercase text-gray-400",children:new Date(le).toLocaleDateString("en-GB",{weekday:"long"})}),u.jsx("div",{className:"font-extrabold text-xl text-gray-800",children:new Date(le).toLocaleDateString("en-GB",{month:"short",day:"numeric"})})]},le))})]}),u.jsx("div",{className:"md:w-2/3 bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:n?u.jsx("div",{className:"grid grid-cols-3 gap-3",children:J[n].map(le=>u.jsx("button",{onClick:()=>{o(le),s&&s({date:le.date,time:le.time})},className:"py-2 px-1 rounded-lg border border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-600 hover:text-white transition-all text-sm font-bold shadow-sm",children:le.time},le.id))}):u.jsx("div",{className:"h-full flex items-center justify-center text-gray-300",children:"Select a date"})}),R&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[120] flex items-center justify-center p-4",children:u.jsxs("div",{className:"bg-white p-8 rounded-3xl text-center max-w-md w-full",children:[u.jsx(Is,{className:"text-green-600 mx-auto mb-4",size:48}),u.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Confirmed!"}),u.jsxs("p",{className:"mb-6",children:["Session on ",R.date," at ",R.time]}),u.jsx("button",{onClick:()=>q(null),className:"w-full py-3 bg-purple-600 text-white rounded-xl font-bold",children:"Close"})]})})]})},tT=()=>{const s=ka(),[e,t]=Y.useState(null),[n,r]=Y.useState(!1),[i,o]=Y.useState(!1),[l,d]=Y.useState(!1),[h,p]=Y.useState("existing"),[g,b]=Y.useState(!1),[x,w]=Y.useState(!1),[v,_]=Y.useState(!1),[N,E]=Y.useState("email"),[k,T]=Y.useState(""),[P,O]=Y.useState(null),[F,$]=Y.useState(null),[z,G]=Y.useState(!1),[R,q]=Y.useState(!1),[J,Z]=Y.useState("initial"),[le,K]=Y.useState(null);Y.useEffect(()=>{(()=>{const me=JSON.parse(localStorage.getItem("tutor_bookings")||"[]");let ve=!1;const Re=me.map(X=>X.type==="consultation"&&(X.paymentStatus!=="Paid"||X.cost!==0)?(ve=!0,{...X,paymentStatus:"Paid",cost:0}):X);ve&&(localStorage.setItem("tutor_bookings",JSON.stringify(Re)),window.dispatchEvent(new Event("storage")));const Ke=JSON.parse(localStorage.getItem("tutor_session_history")||"[]");let Ge=!1;const ke=Ke.map(X=>(X.type==="consultation"||X.subject==="Free Consultation")&&(X.paymentStatus!=="Paid"||X.cost!==0)?(Ge=!0,{...X,paymentStatus:"Paid",cost:0}):X);Ge&&(localStorage.setItem("tutor_session_history",JSON.stringify(ke)),window.dispatchEvent(new Event("storage")))})()},[]);const[se,ce]=Y.useState(null),[ye,Ce]=Y.useState("existing"),[M,L]=Y.useState(null),U=he=>{console.log("LandingPage: handleBookingRequest called",he),L(he),q(!0),Z("who-are-you")},H=async(he,me)=>{if(!M)return;const ve="consult-"+Date.now().toString(36),Re=me.name||me.firstName||me.studentName||M.name||"Student",Ke=Mw(Re),Ge=`${window.location.origin}/session/${ve}?host=false&student=${encodeURIComponent(Ke)}`,ke=me.subject||M.subject||"Consultation",X={id:ve,date:M.date,time:M.time,student:Ke,email:me.email||M.email,subject:ke,bookingFor:he,studentName:Ke,type:"consultation",meetingLink:Ge,bookedAt:new Date().toISOString(),paymentStatus:"Paid",cost:0,status:"confirmed",studentId:me.id,parentId:me.parentId};try{await $r.createBooking(X),xr.sendConfirmation({...X,link:Ge}).catch(Pe=>console.error("Email error:",Pe)),xr.sendTeacherNotification(X).catch(Pe=>console.error("Email notification error:",Pe)),L(null),$({type:"success",message:"Booking Confirmed! You can now view it in your dashboard."})}catch(Pe){console.error("Booking creation failed:",Pe),$({type:"error",message:"Failed to create booking. Please checks your connection and try again."})}};Y.useEffect(()=>{const he=document.createElement("script");return he.src="https://assets.calendly.com/assets/external/widget.js",he.async=!0,document.body.appendChild(he),()=>{document.body.contains(he)&&document.body.removeChild(he)}},[]),Y.useEffect(()=>{const he=me=>{i&&!me.target.closest(".booking-dropdown")&&o(!1)};return i&&document.addEventListener("click",he),()=>document.removeEventListener("click",he)},[i]);const ae=he=>{t(e===he?null:he)},de=he=>{const me=document.getElementById(he);me&&me.scrollIntoView({behavior:"smooth"})},xe=[{q:"How do online sessions work?",a:"We use a dedicated interactive whiteboard and high-quality video chat built right into this platform. No need to download Zoom or other appsjust click the link I send you!"},{q:"What is your cancellation policy?",a:"Life happens! You can cancel or reschedule up to 24 hours before your session free of charge. Cancellations within 24 hours may incur a 50% fee."},{q:"Do you assign homework?",a:"Homework is purely optional and suggested to help reinforce learning. I can assign 30-60 minutes of practice between sessions if desired, but we can adjust this based on your schedule."},{q:"How are safeguarding and recordings handled?",a:"Student safety is paramount. All sessions are conducted via secure, private links. Sessions can be recorded for revision purposes upon request, with strict data privacy controls."},{q:"What tools do I need?",a:"Just a laptop or tablet with a webcam and microphone. A stable internet connection is key. Using a mouse or drawing tablet can help with interactive whiteboard tasks, but isn't strictly necessary."},{q:"Can I book a free consultation?",a:"Absolutely! I offer a complimentary 15-minute chat to discuss your goals and see if we're a good fit. Use the 'Book Now' button to schedule it."}];return u.jsxs("div",{className:"min-h-screen bg-brand-light font-sans text-brand-navy scroll-smooth",children:[u.jsx("nav",{className:"fixed top-0 w-full bg-white/90 backdrop-blur-md shadow-sm z-50 px-6 py-4",children:u.jsxs("div",{className:"max-w-6xl mx-auto flex justify-between items-center",children:[u.jsxs("div",{className:"flex items-center gap-2 text-purple-600 font-bold text-xl cursor-pointer",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),children:[u.jsx(Au,{size:32}),u.jsx("span",{children:"Davina's Tutoring Platform"})]}),u.jsxs("div",{className:"hidden md:flex items-center gap-8 font-medium text-gray-600",children:[u.jsx("button",{onClick:()=>de("about"),className:"hover:text-purple-600 transition-colors",children:"About"}),u.jsx("button",{onClick:()=>de("reviews"),className:"hover:text-purple-600 transition-colors",children:"Reviews"}),u.jsx("button",{onClick:()=>de("booking"),className:"hover:text-purple-600 transition-colors",children:"Book"}),u.jsx("button",{onClick:()=>de("faq"),className:"hover:text-purple-600 transition-colors",children:"FAQ"})]}),u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsx("button",{onClick:()=>{K(null),r(!0)},className:"text-purple-600 font-bold hover:bg-purple-50 px-4 py-2 rounded-lg transition-colors",children:"Log In"}),u.jsxs("div",{className:"relative booking-dropdown",children:[u.jsxs("button",{onClick:()=>o(!i),className:"bg-purple-600 text-white px-5 py-2.5 rounded-full font-bold shadow-md hover:bg-purple-700 transition-all hover:scale-105 flex items-center gap-2",children:["Book Lessons",u.jsx(T2,{size:16,className:`transition-transform ${i?"rotate-180":""}`})]}),i&&u.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden z-50",children:[u.jsx("button",{onClick:()=>{de("booking"),o(!1)},className:"w-full px-5 py-4 text-left hover:bg-purple-50 transition-colors border-b border-gray-100",children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:u.jsx(ei,{size:20,className:"text-purple-600"})}),u.jsxs("div",{children:[u.jsx("div",{className:"font-bold text-gray-900",children:"Free Consultation"}),u.jsx("div",{className:"text-xs text-gray-500",children:"15-minute intro session"})]})]})}),u.jsx("button",{onClick:()=>{d(!0),o(!1)},className:"w-full px-5 py-4 text-left hover:bg-teal-50 transition-colors",children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-10 h-10 bg-teal-100 rounded-full flex items-center justify-center",children:u.jsx(wg,{size:20,className:"text-teal-600"})}),u.jsxs("div",{children:[u.jsx("div",{className:"font-bold text-gray-900",children:"Book First Lesson"}),u.jsx("div",{className:"text-xs text-gray-500",children:"1-hour paid session"})]})]})}),u.jsx("button",{onClick:()=>{d(!0),p("new"),o(!1)},className:"w-full px-5 py-4 text-left hover:bg-teal-50 transition-colors",children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center",children:u.jsx(dl,{size:20,className:"text-yellow-600"})}),u.jsxs("div",{children:[u.jsx("div",{className:"font-bold text-gray-900",children:"Book 10 Hour Lesson Block"}),u.jsx("div",{className:"text-xs text-secondary-500",children:"Discount for the 10 lesson bundle"})]})]})})]})]})]})]})}),u.jsxs("header",{className:"pt-32 pb-20 px-6 relative overflow-hidden",children:[u.jsxs("div",{className:"max-w-4xl mx-auto text-center relative z-10",children:[u.jsxs("div",{className:"inline-flex items-center gap-2 bg-purple-100 text-purple-700 px-4 py-1.5 rounded-full text-sm font-bold mb-6 animate-in slide-in-from-bottom-5 fade-in duration-700",children:[u.jsx("span",{className:"w-2 h-2 bg-purple-600 rounded-full animate-pulse"}),"Accepting New Students for 2026"]}),u.jsxs("h1",{className:"text-4xl md:text-6xl font-extrabold tracking-tight mb-6 text-brand-navy",children:["Master Your Subjects with ",u.jsx("br",{})," Expert Personal Tutoring"]}),u.jsx("p",{className:"text-xl text-gray-500 font-medium max-w-2xl mx-auto mb-10 leading-relaxed",children:"Personalized learning plans, interactive online sessions, and proven results. Unlock your full potential today."}),u.jsx("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:u.jsxs("button",{onClick:()=>{K(null),de("booking")},className:"w-full sm:w-auto px-8 py-4 bg-purple-600 text-white rounded-xl font-bold text-lg shadow-lg hover:bg-purple-700 transition-all flex items-center justify-center gap-2",children:[u.jsx(ll,{size:20}),"Book Free Consultation"]})})]}),u.jsxs("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0",children:[u.jsx("div",{className:"absolute top-20 left-10 w-96 h-96 bg-teal-100 rounded-full blur-[100px] opacity-40"}),u.jsx("div",{className:"absolute bottom-20 right-10 w-80 h-80 bg-purple-200 rounded-full blur-[80px] opacity-40"})]})]}),u.jsx("div",{className:"bg-white py-12 border-y border-gray-100",children:u.jsx("div",{className:"max-w-6xl mx-auto px-6 flex flex-wrap justify-center gap-12 text-center",children:[{icon:cl,label:"5-Star Reviews",val:"60+"},{icon:ei,label:"Tutoring Hours",val:"550+"},{icon:Ru,label:"DBS Checked",val:"Verified"}].map((he,me)=>u.jsxs("div",{className:"space-y-2",children:[u.jsx("div",{className:"mx-auto w-12 h-12 bg-gray-50 rounded-full flex items-center justify-center text-purple-600",children:u.jsx(he.icon,{size:24})}),u.jsx("h3",{className:"text-2xl font-bold text-brand-navy",children:he.val}),u.jsx("p",{className:"text-sm text-gray-500 font-bold uppercase tracking-wider",children:he.label})]},me))})}),u.jsx("section",{className:"py-20 bg-gray-50 border-b border-gray-100",children:u.jsxs("div",{className:"max-w-6xl mx-auto px-6",children:[u.jsxs("div",{className:"text-center mb-16",children:[u.jsx("h2",{className:"text-sm font-bold text-teal-500 uppercase tracking-widest mb-2",children:"My Expertise"}),u.jsx("h3",{className:"text-3xl font-bold text-brand-navy",children:"Specialized Tutoring Subjects"})]}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-8 max-w-4xl mx-auto",children:[u.jsxs("div",{className:"bg-white rounded-3xl p-8 shadow-sm border border-gray-100 hover:shadow-xl transition-all group",children:[u.jsx("div",{className:"w-16 h-16 bg-purple-50 rounded-2xl flex items-center justify-center text-purple-600 mb-6 group-hover:scale-110 transition-transform",children:u.jsx(Pu,{size:32})}),u.jsxs("div",{className:"flex justify-between items-start mb-4",children:[u.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Sociology"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 text-xs font-bold rounded-full",children:"GCSE"}),u.jsx("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 text-xs font-bold rounded-full",children:"A-Level"})]})]}),u.jsx("p",{className:"text-gray-600 leading-relaxed mb-6",children:"Exploring society, culture, and identity. I specialize in making complex theories accessible and helping students master essay-writing techniques for top marks."}),u.jsxs("ul",{className:"space-y-3",children:[u.jsxs("li",{className:"flex items-center gap-3 text-sm text-gray-700 font-medium",children:[u.jsx(Is,{size:18,className:"text-purple-500"})," Families and Households"]}),u.jsxs("li",{className:"flex items-center gap-3 text-sm text-gray-700 font-medium",children:[u.jsx(Is,{size:18,className:"text-purple-500"})," Education"]}),u.jsxs("li",{className:"flex items-center gap-3 text-sm text-gray-700 font-medium",children:[u.jsx(Is,{size:18,className:"text-purple-500"})," Crime and Deviance"]}),u.jsxs("li",{className:"flex items-center gap-3 text-sm text-gray-700 font-medium",children:[u.jsx(Is,{size:18,className:"text-purple-500"})," Research Methods"]}),u.jsxs("li",{className:"flex items-center gap-3 text-sm text-gray-700 font-medium",children:[u.jsx(Is,{size:18,className:"text-purple-500"})," General Inequalities"]})]})]}),u.jsxs("div",{className:"bg-white rounded-3xl p-8 shadow-sm border border-gray-100 hover:shadow-xl transition-all group",children:[u.jsx("div",{className:"w-16 h-16 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600 mb-6 group-hover:scale-110 transition-transform",children:u.jsx(WC,{size:32})}),u.jsxs("div",{className:"flex justify-between items-start mb-4",children:[u.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Mathematics"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 text-xs font-bold rounded-full",children:"KS3"}),u.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 text-xs font-bold rounded-full",children:"GCSE"})]})]}),u.jsx("p",{className:"text-gray-600 leading-relaxed mb-6",children:"Building confidence in numbers. From algebra to geometry, I help students understand the 'why' behind the methods, turning anxiety into achievement."}),u.jsxs("ul",{className:"space-y-3",children:[u.jsxs("li",{className:"flex items-center gap-3 text-sm text-gray-700 font-medium",children:[u.jsx(Is,{size:18,className:"text-blue-500"})," Exam Board Specific Prep (AQA, Edexcel)"]}),u.jsxs("li",{className:"flex items-center gap-3 text-sm text-gray-700 font-medium",children:[u.jsx(Is,{size:18,className:"text-blue-500"})," Problem Solving & Logic"]}),u.jsxs("li",{className:"flex items-center gap-3 text-sm text-gray-700 font-medium",children:[u.jsx(Is,{size:18,className:"text-blue-500"})," Grade 9-1 Targeting Strategies"]})]})]})]})]})}),u.jsx("section",{id:"pricing",className:"py-20 bg-white",children:u.jsxs("div",{className:"max-w-6xl mx-auto px-6",children:[u.jsxs("div",{className:"text-center mb-16",children:[u.jsx("h2",{className:"text-sm font-bold text-purple-500 uppercase tracking-widest mb-2",children:"Pricing Plans"}),u.jsx("h3",{className:"text-3xl font-bold text-brand-navy",children:"Invest in Your Academic Success"})]}),u.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[u.jsxs("div",{className:"bg-purple-600 rounded-3xl p-8 text-white shadow-xl flex flex-col transform hover:scale-105 transition-all",children:[u.jsx("h4",{className:"text-xl font-bold mb-2",children:"KS3 Sessions"}),u.jsx("p",{className:"text-purple-100 text-sm mb-6",children:"Building strong foundations for younger learners."}),u.jsxs("div",{className:"space-y-4 mb-8",children:[u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-purple-100",children:"Single Lesson"}),u.jsx("span",{className:"font-bold",children:"25.00"})]}),u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsxs("div",{className:"flex flex-col",children:[u.jsx("span",{className:"text-purple-100",children:"10 Lesson Bundle"}),u.jsx("span",{className:"text-[10px] text-teal-300 font-bold",children:"Save 20"})]}),u.jsx("span",{className:"font-bold text-teal-300",children:"230.00"})]})]}),u.jsx("button",{onClick:()=>{K("KS3 Maths"),q(!0)},className:"mt-auto w-full py-3 bg-white text-purple-600 rounded-xl font-bold hover:bg-gray-50 transition-colors",children:"Get Started"})]}),u.jsxs("div",{className:"bg-purple-600 rounded-3xl p-8 text-white shadow-xl flex flex-col transform md:scale-110 z-10 hover:scale-115 transition-all",children:[u.jsx("h4",{className:"text-xl font-bold mb-2",children:"GCSE Sessions"}),u.jsx("p",{className:"text-purple-100 text-sm mb-6",children:"Targeted exam preparation and grade boosting."}),u.jsxs("div",{className:"space-y-4 mb-8",children:[u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-purple-100",children:"Single Lesson"}),u.jsx("span",{className:"font-bold",children:"30.00"})]}),u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsxs("div",{className:"flex flex-col",children:[u.jsx("span",{className:"text-purple-100",children:"10 Lesson Bundle"}),u.jsx("span",{className:"text-[10px] text-teal-300 font-bold",children:"Save 20"})]}),u.jsx("span",{className:"font-bold text-teal-300",children:"280.00"})]})]}),u.jsx("button",{onClick:()=>{K("GCSE Maths"),q(!0)},className:"mt-auto w-full py-3 bg-white text-purple-600 rounded-xl font-bold hover:bg-gray-50 transition-colors",children:"Get Started"})]}),u.jsxs("div",{className:"bg-purple-600 rounded-3xl p-8 text-white shadow-xl flex flex-col transform hover:scale-105 transition-all",children:[u.jsx("h4",{className:"text-xl font-bold mb-2",children:"A-Level Sessions"}),u.jsx("p",{className:"text-purple-100 text-sm mb-6",children:"In-depth analysis and expert subject mastery."}),u.jsxs("div",{className:"space-y-4 mb-8",children:[u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-purple-100",children:"Single Lesson"}),u.jsx("span",{className:"font-bold",children:"40.00"})]}),u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsxs("div",{className:"flex flex-col",children:[u.jsx("span",{className:"text-purple-100",children:"10 Lesson Bundle"}),u.jsx("span",{className:"text-[10px] text-teal-300 font-bold",children:"Save 30"})]}),u.jsx("span",{className:"font-bold text-teal-300",children:"370.00"})]})]}),u.jsx("button",{onClick:()=>{K("A-Level Sociology"),q(!0)},className:"mt-auto w-full py-3 bg-white text-purple-600 rounded-xl font-bold hover:bg-gray-50 transition-colors",children:"Get Started"})]})]})]})}),u.jsx("section",{id:"about",className:"py-20 px-6",children:u.jsxs("div",{className:"max-w-5xl mx-auto grid md:grid-cols-2 gap-12 items-center",children:[u.jsxs("div",{className:"relative",children:[u.jsxs("div",{className:"aspect-[4/5] bg-gray-200 rounded-2xl overflow-hidden shadow-xl relative z-10 group",children:[u.jsx("img",{src:vk,alt:"Davina Potter",className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105",onError:he=>{he.target.style.display="none",he.target.nextSibling.style.display="flex"}}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-100 to-white flex items-center justify-center text-gray-300 hidden",children:u.jsxs("div",{className:"text-center",children:[u.jsx("span",{className:"text-6xl",children:""}),u.jsx("p",{className:"mt-4 font-bold",children:"Davina Potter"})]})})]}),u.jsx("div",{className:"absolute -bottom-6 -right-6 w-full h-full border-4 border-teal-400 rounded-2xl -z-0"})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-sm font-bold text-teal-500 uppercase tracking-widest mb-2",children:"About Your Tutor"}),u.jsxs("h3",{className:"text-3xl font-bold text-brand-navy mb-6",children:["Expert Guidance, ",u.jsx("br",{}),"Personalized for You."]}),u.jsx("p",{className:"text-lg text-gray-600 mb-6 leading-relaxed",children:"Hi, I'm Davina! With over 3 years of experience and 550+ tutoring hours, I help students excel in **Maths KS3, GCSE and Sociology GCSE, A level**. I have a First-Class degree in Sociology and am currently pursuing a Master's in Banking and Finance at Surrey University."}),u.jsx("p",{className:"text-lg text-gray-600 mb-6 leading-relaxed",children:"Sociology has a special place in my heart, and I strive to convey this enthusiasm to my students. I also love tutoring Mathsit was a subject I improved on significantly through hard work, going from a Grade 5/C to a Grade 7/A."}),u.jsx("p",{className:"text-lg text-gray-600 mb-8 leading-relaxed",children:"I believe in creating a safe space where students can express their ideas and grow. There is nothing more rewarding than seeing students achieve what they once thought was impossible."}),u.jsx("div",{className:"space-y-4",children:["First-Class Degree in Sociology","MSc Banking & Finance Student (Surrey University)","Specialist in KS3, GCSE & A-Level (Maths & Sociology)","Full Enhanced DBS Checked (Issued 2026)"].map((he,me)=>u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(Is,{size:20,className:"text-green-500 flex-shrink-0"}),u.jsx("span",{className:"font-medium text-gray-700",children:he})]},me))})]})]})}),u.jsx("section",{id:"reviews",className:"py-20 px-6 bg-white overflow-hidden",children:u.jsxs("div",{className:"max-w-6xl mx-auto",children:[u.jsxs("div",{className:"text-center mb-16 relative",children:[u.jsx("h2",{className:"text-sm font-bold text-teal-500 uppercase tracking-widest mb-2",children:"Success Stories"}),u.jsx("h3",{className:"text-3xl font-bold text-brand-navy",children:"What My Students Say"}),u.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 bg-yellow-100 rounded-full blur-[60px] opacity-60 -z-10"})]}),u.jsx("div",{className:"grid md:grid-cols-3 gap-8",children:[{id:"rev-1",studentName:"Linsey",rating:5,comment:"Davina has been nothing short of outstanding. She has supported my daughter in getting from a grade C to B in A level sociology in a short space of time. Davina is incredibly knowledgeable about the specification and I would highly recommend her tutoring.",subject:"A-Level Sociology"},{id:"rev-2",studentName:"Olivia",rating:5,comment:"I was able to go up a full grade with Davina. She is a really knowledgeable person and very easy to learn from! Thank you so much!!",subject:"A-Level Sociology"},{id:"rev-3",studentName:"Abosede",rating:5,comment:"Davina has been a fantastic tutor to my daughter. She is knowledgeable, patient, and disciplined in her teaching approach. Her guidance has significantly helped my daughter, deepening her understanding and strengthening her knowledge.",subject:"A-Level Sociology"},{id:"rev-4",studentName:"Laura",rating:5,comment:"Davina has been a fantastic tutor for my daughter. She was achieving B and C grades during her assessments and mock exams. However after her sessions with Davina my daughter achieved an A* in her final A level exam. Davina really helped boost her confidence.",subject:"A-Level Sociology"},{id:"rev-5",studentName:"Gemma",rating:5,comment:"Davina has been a fantastic tutor to my son. She is patient and disciplined in her lessons and really helped him expand his knowledge. Elliot feels so much more confident doing his exams.",subject:"GCSE Maths"},{id:"rev-6",studentName:"Ella",rating:5,comment:"Davina has been an excellent tutor, I felt so much more confident going into my exams. She is very patient, and supportive with both knowledge and exam structure. I definitely recommend Davina.",subject:"GCSE Maths"},{id:"rev-7",studentName:"Kim",rating:5,comment:"Been absolutely brilliant for my daughter and didnt think online tutoring would work but its been simple and a great help ! Would recommend Davina to any A Level student requiring help throughout their studies.",subject:"A-Level Sociology"},{id:"rev-8",studentName:"Sophie",rating:5,comment:"amazing! we did a-level sociology revision and focused mainly on education as a topic. i love the layout of the lessons and how content based they are and Davina has some really great revision resources to share.",subject:"A-Level Sociology"},{id:"rev-9",studentName:"Parmajit",rating:5,comment:"Best tutor ever!",subject:"A-Level Sociology"},{id:"rev-10",studentName:"Emma",rating:5,comment:"Davina helped my child to improve her knowledge and focus her Sociology revision ahead of her GCSE. She has now passed and enrolled to study Sociology at A level.",subject:"GCSE Sociology"},{id:"rev-11",studentName:"Gioia",rating:5,comment:"Fantastic lesson!",subject:"A-Level Sociology"},{id:"rev-12",studentName:"Nyah",rating:5,comment:"so encouraging",subject:"Maths"},...JSON.parse(localStorage.getItem("tutor_public_reviews")||"[]").reverse().slice(0,3)].slice(0,z?void 0:3).map((he,me)=>u.jsxs("div",{className:"bg-gray-50 p-8 rounded-2xl relative group hover:-translate-y-2 transition-transform duration-300",children:[u.jsx("div",{className:"absolute top-8 right-8 text-teal-100 opacity-50 group-hover:opacity-100 transition-opacity",children:u.jsx(Hc,{size:48})}),u.jsx("div",{className:"flex gap-1 mb-4 text-yellow-400",children:[...Array(he.rating||5)].map((ve,Re)=>u.jsx(cl,{size:16,fill:"currentColor"},Re))}),u.jsxs("p",{className:"text-gray-600 mb-6 leading-relaxed relative z-10",children:['"',he.comment,'"']}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-10 h-10 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center font-bold",children:he.studentName.charAt(0)}),u.jsxs("div",{children:[u.jsx("div",{className:"font-bold text-gray-900",children:he.studentName}),u.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:he.subject})]})]})]},he.id||me))}),u.jsx("div",{className:"text-center mt-8",children:u.jsx("button",{onClick:()=>G(!z),className:"px-6 py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700 transition-all shadow-md",children:z?"See Less":"See More Reviews"})})]})}),u.jsxs("section",{id:"booking",className:"py-20 px-6 bg-brand-light text-brand-navy relative overflow-hidden",children:[u.jsxs("div",{className:"max-w-4xl mx-auto text-center relative z-10",children:[u.jsx("h2",{className:"text-3xl font-bold mb-6 text-brand-navy",children:"Ready to Get Started?"}),u.jsx("p",{className:"text-xl text-gray-600 mb-10 max-w-2xl mx-auto",children:"Book a free 15-minute consultation to discuss your goals. Alternatively, existing students can book their next session directly below."}),u.jsx("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden mx-auto max-w-4xl min-h-[400px] p-8",children:u.jsx(eT,{onBook:U})})]}),u.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-purple-500 rounded-full blur-[80px] opacity-20"}),u.jsx("div",{className:"absolute bottom-0 left-0 w-64 h-64 bg-teal-500 rounded-full blur-[80px] opacity-20"})]}),u.jsx("section",{id:"faq",className:"py-20 px-6 bg-white",children:u.jsxs("div",{className:"max-w-3xl mx-auto",children:[u.jsxs("div",{className:"text-center mb-12",children:[u.jsx("h2",{className:"text-sm font-bold text-purple-600 uppercase tracking-widest mb-2",children:"Common Questions"}),u.jsx("h3",{className:"text-3xl font-bold text-brand-navy",children:"Everything You Need to Know"})]}),u.jsx("div",{className:"space-y-4",children:xe.map((he,me)=>u.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden hover:border-purple-200 transition-colors",children:[u.jsxs("button",{onClick:()=>ae(me),className:"w-full flex items-center justify-between p-6 bg-white hover:bg-gray-50 transition-colors text-left",children:[u.jsx("span",{className:"font-bold text-lg text-gray-800",children:he.q}),e===me?u.jsx(a_,{className:"text-purple-600"}):u.jsx(T2,{className:"text-gray-400"})]}),e===me&&u.jsx("div",{className:"p-6 pt-0 bg-gray-50 text-gray-600 leading-relaxed border-t border-gray-100",children:he.a})]},me))})]})}),u.jsxs("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:[u.jsxs("div",{className:"max-w-6xl mx-auto grid md:grid-cols-4 gap-8 mb-8",children:[u.jsxs("div",{className:"col-span-2",children:[u.jsxs("div",{className:"flex items-center gap-2 text-white font-bold text-xl mb-4",children:[u.jsx(Au,{}),u.jsx("span",{children:"Davina's Tutoring Platform"})]}),u.jsx("p",{className:"text-sm leading-relaxed max-w-xs",children:"Empowering students to achieve their best through personalized, interactive online tutoring."})]}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-white font-bold mb-4",children:"Quick Links"}),u.jsxs("ul",{className:"space-y-2 text-sm",children:[u.jsx("li",{children:u.jsx("button",{onClick:()=>de("about"),className:"hover:text-purple-400",children:"About Me"})}),u.jsx("li",{children:u.jsx("button",{onClick:()=>de("reviews"),className:"hover:text-purple-400",children:"Reviews"})}),u.jsx("li",{children:u.jsx("button",{onClick:()=>de("booking"),className:"hover:text-purple-400",children:"Book Session"})}),u.jsx("li",{children:u.jsx("button",{onClick:()=>de("faq"),className:"hover:text-purple-400",children:"FAQ"})})]})]}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-white font-bold mb-4",children:"Contact"}),u.jsxs("ul",{className:"space-y-2 text-sm",children:[u.jsx("li",{children:"davina.potter@outlook.com"}),u.jsx("li",{children:"Mon-Fri: 9am - 7pm"})]})]})]}),u.jsxs("div",{className:"border-t border-gray-800 pt-8 text-center text-xs flex flex-col md:flex-row justify-between items-center gap-4",children:[u.jsx("span",{children:" 2026 Davina's Tutoring Platform. All rights reserved."}),u.jsxs("div",{className:"flex gap-4",children:[u.jsx("a",{href:"/privacy",className:"hover:text-purple-400 underline",children:"Privacy Policy"}),u.jsx("a",{href:"/terms",className:"hover:text-purple-400 underline",children:"Terms of Service"}),u.jsx("a",{href:"/cookie-policy",className:"hover:text-purple-400 underline",children:"Cookie Policy"})]})]})]}),n&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto pt-8 pb-8",onClick:()=>r(!1),children:u.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 relative animate-in zoom-in-95 duration-200",onClick:he=>he.stopPropagation(),children:[u.jsx("button",{onClick:()=>r(!1),className:"absolute top-4 right-4 p-2 text-gray-400 hover:bg-gray-100 rounded-full transition-colors",children:u.jsx("span",{className:"text-xl",children:""})}),u.jsx("h2",{className:"text-2xl font-bold text-center mb-8 text-gray-800",children:"Choose Portal"}),u.jsxs("div",{className:"grid gap-4",children:[u.jsxs("button",{onClick:()=>s("/teacher"),className:"flex items-center gap-4 p-4 border-2 border-transparent hover:border-purple-500 bg-purple-50 rounded-2xl group transition-all",children:[u.jsx("div",{className:"bg-white p-3 rounded-xl shadow-sm group-hover:bg-purple-600 group-hover:text-white transition-colors",children:u.jsx(Au,{size:24,className:"text-purple-600 group-hover:text-white"})}),u.jsxs("div",{className:"text-left",children:[u.jsx("h3",{className:"font-bold text-gray-900",children:"Teacher Login"}),u.jsx("p",{className:"text-xs text-gray-500",children:"Manage lessons & students"})]}),u.jsx(Jl,{className:"ml-auto text-gray-300 group-hover:text-purple-600"})]}),u.jsxs("button",{onClick:()=>{r(!1),d(!0)},className:"flex items-center gap-4 p-4 border-2 border-transparent hover:border-teal-500 bg-teal-50 rounded-2xl group transition-all",children:[u.jsx("div",{className:"bg-white p-3 rounded-xl shadow-sm group-hover:bg-teal-500 group-hover:text-white transition-colors",children:u.jsx(Pu,{size:24,className:"text-teal-600 group-hover:text-white"})}),u.jsxs("div",{className:"text-left",children:[u.jsx("h3",{className:"font-bold text-gray-900",children:"Student Login"}),u.jsx("p",{className:"text-xs text-gray-500",children:"Join your lesson"})]}),u.jsx(Jl,{className:"ml-auto text-gray-300 group-hover:text-teal-600"})]}),u.jsxs("button",{onClick:()=>{r(!1),_(!0)},className:"flex items-center gap-4 p-4 border-2 border-transparent hover:border-blue-500 bg-blue-50 rounded-2xl group transition-all",children:[u.jsx("div",{className:"bg-white p-3 rounded-xl shadow-sm group-hover:bg-blue-500 group-hover:text-white transition-colors",children:u.jsx(rh,{size:24,className:"text-blue-600 group-hover:text-white"})}),u.jsxs("div",{className:"text-left",children:[u.jsx("h3",{className:"font-bold text-gray-900",children:"Parent Login"}),u.jsx("p",{className:"text-xs text-gray-500",children:"View your child's progress"})]}),u.jsx(Jl,{className:"ml-auto text-gray-300 group-hover:text-blue-600"})]})]})]})}),R&&u.jsx("div",{className:"fixed inset-0 bg-brand-navy/60 backdrop-blur-sm z-[100] flex items-center justify-center p-6",onClick:()=>{q(!1),Z("initial")},children:u.jsx("div",{className:"bg-white rounded-3xl shadow-2xl max-w-sm w-full overflow-hidden animate-in zoom-in-95 duration-300",onClick:he=>he.stopPropagation(),children:u.jsx("div",{className:"p-8 text-center",children:J==="initial"?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center text-purple-600 mx-auto mb-6",children:u.jsx(Au,{size:32})}),u.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Ready to Start?"}),u.jsx("p",{className:"text-gray-500 mb-8",children:"Choose how you'd like to begin your learning journey."}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("button",{onClick:()=>{q(!1),de("booking")},className:"w-full py-4 px-4 bg-white border-2 border-purple-100 hover:border-purple-600 rounded-2xl flex items-center gap-4 transition-all group text-left shadow-sm hover:shadow-md",children:[u.jsx("div",{className:"w-12 h-12 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center shrink-0",children:u.jsx(ei,{size:24})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("div",{className:"font-bold text-gray-900 group-hover:text-purple-700",children:"Free Consultation"}),u.jsx("div",{className:"text-xs text-gray-500",children:"15-minute intro session"})]}),u.jsx(Ef,{size:20,className:"text-gray-300 group-hover:text-purple-600"})]}),u.jsxs("button",{onClick:()=>Z("who-are-you"),className:"w-full py-4 px-4 bg-white border-2 border-teal-100 hover:border-teal-500 rounded-2xl flex items-center gap-4 transition-all group text-left shadow-sm hover:shadow-md",children:[u.jsx("div",{className:"w-12 h-12 bg-teal-100 text-teal-600 rounded-full flex items-center justify-center shrink-0",children:u.jsx(wg,{size:24})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("div",{className:"font-bold text-gray-900 group-hover:text-teal-700",children:"Book First Lesson"}),u.jsx("div",{className:"text-xs text-gray-500",children:"1-hour paid session"})]}),u.jsx(Ef,{size:20,className:"text-gray-300 group-hover:text-teal-600"})]}),u.jsxs("button",{onClick:()=>Z("who-are-you"),className:"w-full py-4 px-4 bg-white border-2 border-yellow-100 hover:border-yellow-500 rounded-2xl flex items-center gap-4 transition-all group text-left shadow-sm hover:shadow-md",children:[u.jsx("div",{className:"w-12 h-12 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center shrink-0",children:u.jsx(cl,{size:24})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("div",{className:"font-bold text-gray-900 group-hover:text-yellow-700",children:"Book 10 Hour Block"}),u.jsx("div",{className:"text-xs text-gray-500",children:"Discount for 10 lesson bundle"})]}),u.jsx(Ef,{size:20,className:"text-gray-300 group-hover:text-yellow-600"})]})]}),u.jsx("button",{onClick:()=>q(!1),className:"w-full py-2 mt-4 text-gray-400 font-medium hover:text-gray-600 text-sm",children:"Cancel"})]}):u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"w-16 h-16 bg-teal-100 rounded-2xl flex items-center justify-center text-teal-600 mx-auto mb-6",children:u.jsx(Pu,{size:32})}),u.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Who are you?"}),u.jsx("p",{className:"text-gray-500 mb-8",children:"Please select your role to continue."}),u.jsxs("div",{className:"space-y-4",children:[u.jsx("button",{onClick:()=>{q(!1),Z("initial"),d(!0),p("new")},className:"w-full py-4 bg-purple-600 text-white rounded-2xl font-bold hover:bg-purple-700 transition-all shadow-lg flex items-center justify-center gap-2",children:"I am a Student"}),u.jsx("button",{onClick:()=>{q(!1),Z("initial"),_(!0),Ce("new")},className:"w-full py-4 bg-teal-500 text-white rounded-2xl font-bold hover:bg-teal-600 transition-all shadow-lg flex items-center justify-center gap-2",children:"I am a New Parent (Register)"}),u.jsx("button",{onClick:()=>{q(!1),Z("initial"),_(!0),Ce("existing"),E("email")},className:"w-full py-4 bg-white border-2 border-teal-500 text-teal-600 rounded-2xl font-bold hover:bg-teal-50 transition-all shadow-md flex items-center justify-center gap-2",children:"I am an Existing Parent (Log In)"}),u.jsx("button",{onClick:()=>Z("initial"),className:"w-full py-2 text-gray-400 font-medium hover:text-gray-600 text-sm",children:"Back"})]})]})})})}),l&&u.jsx("div",{className:"fixed inset-0 bg-brand-navy/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:u.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-md w-full my-8 relative animate-in zoom-in-95 duration-200 max-h-[85vh] overflow-y-auto",children:[u.jsx("button",{onClick:()=>d(!1),className:"absolute top-6 right-6 text-gray-400 hover:text-gray-600 z-10",children:u.jsx(xh,{size:24})}),u.jsxs("div",{className:"p-8",children:[u.jsxs("div",{className:"flex items-center gap-3 text-purple-600 font-bold text-xl mb-8",children:[u.jsx(Au,{size:32}),u.jsx("span",{children:"Student Registration"})]}),u.jsxs("div",{className:"flex gap-4 mb-8 bg-gray-50 p-1 rounded-xl",children:[u.jsx("button",{onClick:()=>p("new"),className:`flex-1 py-4 rounded-xl font-bold text-sm transition-all ${h==="new"?"bg-white text-purple-600 shadow-sm":"text-gray-400 hover:text-gray-600"}`,children:"New Student"}),u.jsx("button",{onClick:()=>p("existing"),className:`flex-1 py-4 rounded-xl font-bold text-sm transition-all ${h==="existing"?"bg-white text-purple-600 shadow-sm":"text-gray-400 hover:text-gray-600"}`,children:"Existing Student"})]}),u.jsx("form",{onSubmit:async he=>{he.preventDefault(),b(!0);try{const me=new FormData(he.target),ve=(me.get("name")||"").toString().trim(),Re=(me.get("pin")||"").toString().trim(),Ke=me.get("email"),Ge=me.get("subject"),ke=await $r.getStudents();if(h==="existing"){if(!ve){$({type:"error",message:"Please enter your name."}),b(!1);return}const X=ke.find(Pe=>Pe.name.toLowerCase()===ve.toLowerCase());if(X){if(X.name.toLowerCase()==="sarah"&&Re==="1234"){M&&H("student",X),d(!1),b(!1),setTimeout(()=>s(`/student/${encodeURIComponent(X.name)}`),0);return}const Pe=JSON.parse(localStorage.getItem("tutor_student_pins")||"{}"),gt=X.pin||Pe[X.id]||(()=>{const vt=JSON.parse(localStorage.getItem("tutor_students")||"[]").find(st=>st.name.toLowerCase()===ve.toLowerCase());return vt?Pe[vt.id]:void 0})(),bt=Re?uf.SHA256(Re).toString():"";!gt||gt===bt||gt===Re?(M&&H("student",X),d(!1),b(!1),setTimeout(()=>s(`/student/${encodeURIComponent(X.name)}`),0)):(b(!1),$({type:"error",message:"Incorrect PIN."}))}else b(!1),$({type:"error",message:"Student not found. Please check your name or create a new account."})}else{if(!ve||!Ke||!Re)return;if(se===null){$({type:"error",message:"Please confirm your age."});return}const X=me.get("parentEmail");if(se&&!X){$({type:"error",message:"Parent/Guardian email is required for students under 16."});return}if(ke.some(St=>St.name.toLowerCase()===ve.toLowerCase())){$({type:"error",message:"A student with this name already exists. Please log in or use a different name."});return}const Pe=uf.SHA256(Re).toString();let gt=null;if(se&&X){const St=JSON.parse(localStorage.getItem("tutor_parents"))||[];let Pt=St.find(Ut=>Ut.email.toLowerCase()===X.toLowerCase());if(Pt)gt=Pt.id;else{gt=Date.now()+Math.random();const Ut={id:gt,email:X,pin:null,firstLogin:!0,linkedStudents:[],createdAt:new Date().toISOString()};St.push(Ut),localStorage.setItem("tutor_parents",JSON.stringify(St))}}const bt={name:ve.trim(),email:Ke.trim(),parentEmail:se?X:null,parentId:gt,isUnder16:se,pin:Pe,subject:Ge||"Not specified",sessionsCompleted:0,totalSpent:0,nextSession:null,status:"Active"};let Ye;try{Ye=await $r.createStudent({name:bt.name,email:bt.email})}catch(St){console.error("Student creation failed:",St);const Pt=St?.message||"Failed to create account. Please try again.";$({type:"error",message:Pt});return}const Et=JSON.parse(localStorage.getItem("tutor_student_pins")||"{}");Et[Ye.id]=Pe,localStorage.setItem("tutor_student_pins",JSON.stringify(Et));const vt=JSON.parse(localStorage.getItem("tutor_student_extras")||"{}");if(vt[Ye.id]={parentEmail:bt.parentEmail,parentId:bt.parentId,isUnder16:bt.isUnder16,subject:bt.subject,sessionsCompleted:bt.sessionsCompleted,totalSpent:bt.totalSpent,nextSession:bt.nextSession,status:bt.status},localStorage.setItem("tutor_student_extras",JSON.stringify(vt)),gt){const St=JSON.parse(localStorage.getItem("tutor_parents")||[]),Pt=St.findIndex(Ut=>Ut.id===gt);Pt!==-1&&(St[Pt].linkedStudents.includes(Ye.id)||St[Pt].linkedStudents.push(Ye.id),localStorage.setItem("tutor_parents",JSON.stringify(St)))}window.dispatchEvent(new Event("storage"));const st={...Ye,pin:Pe,...vt[Ye.id]};M&&H("student",st),d(!1),b(!1),s(`/student/${encodeURIComponent(ve)}`)}}catch(me){console.error("Student form error",me),b(!1),$({type:"error",message:me?.message||"Something went wrong. Please try again."})}},children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Student Name"}),u.jsx("input",{type:"text",name:"name",required:!0,placeholder:"e.g. Sarah Johnson",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none"})]}),h==="new"&&u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Subject"}),u.jsxs("select",{name:"subject",required:!0,className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none bg-white font-medium",children:[u.jsx("option",{value:"",children:"Select a subject..."}),u.jsx("option",{value:"KS3 Maths",children:"KS3 Maths"}),u.jsx("option",{value:"GCSE Maths",children:"GCSE Maths"}),u.jsx("option",{value:"GCSE Sociology",children:"GCSE Sociology"}),u.jsx("option",{value:"A-Level Sociology",children:"A-Level Sociology"})]})]}),h==="new"&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"animate-in slide-in-from-top-2",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-3",children:"Age Verification"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("label",{className:`flex items-center gap-3 p-3 border-2 rounded-xl cursor-pointer transition-all hover:bg-gray-50 ${se===!1?"border-purple-500 bg-purple-50":"border-gray-200"}`,children:[u.jsx("input",{type:"radio",name:"age",value:"16plus",checked:se===!1,onChange:()=>ce(!1),className:"w-5 h-5 text-purple-600 focus:ring-2 focus:ring-purple-500"}),u.jsx("span",{className:"text-sm font-medium text-gray-700",children:"I am 16 or older"})]}),u.jsxs("label",{className:`flex items-center gap-3 p-3 border-2 rounded-xl cursor-pointer transition-all hover:bg-gray-50 ${se===!0?"border-purple-500 bg-purple-50":"border-gray-200"}`,children:[u.jsx("input",{type:"radio",name:"age",value:"under16",checked:se===!0,onChange:()=>ce(!0),className:"w-5 h-5 text-purple-600 focus:ring-2 focus:ring-purple-500"}),u.jsx("span",{className:"text-sm font-medium text-gray-700",children:"I am under 16"})]})]})]}),u.jsxs("div",{className:"animate-in slide-in-from-top-2",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Email Address"}),u.jsx("input",{type:"email",name:"email",required:!0,placeholder:"e.g. sarah@example.com",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none"}),u.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"For notifications and receipts"})]}),se===!0&&u.jsxs("div",{className:"animate-in slide-in-from-top-2 bg-blue-50 border border-blue-200 rounded-xl p-4",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[u.jsx("span",{className:"text-xl",children:""}),u.jsx("label",{className:"block text-sm font-bold text-gray-700",children:"Parent/Guardian Email"})]}),u.jsx("input",{type:"email",name:"parentEmail",required:se,placeholder:"e.g. parent@example.com",className:"w-full px-4 py-3 border border-blue-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none bg-white"}),u.jsxs("p",{className:"text-xs text-blue-600 mt-2 flex items-start gap-1",children:[u.jsx("span",{children:""}),u.jsx("span",{children:"Your parent will receive copies of all booking confirmations and payment receipts"})]})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:h==="new"?"Create 4-Digit PIN":"Enter PIN"}),u.jsx("input",{type:"password",name:"pin",required:h==="new",maxLength:"4",pattern:h==="new"?"[0-9]{4}":void 0,placeholder:"",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none text-center text-2xl tracking-widest font-mono"})]}),h==="new"&&u.jsxs("div",{className:"space-y-3",children:[se===!0&&u.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4 animate-in slide-in-from-top-2",children:u.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[u.jsx("input",{type:"checkbox",required:se,className:"mt-1 w-5 h-5 text-orange-600 focus:ring-2 focus:ring-orange-500 rounded"}),u.jsxs("span",{className:"text-sm text-gray-700 flex-1",children:["My parent/guardian consents to me using this platform and has reviewed the ",u.jsx("a",{href:"/privacy",className:"text-purple-600 underline",target:"_blank",children:"Privacy Policy"})," and ",u.jsx("a",{href:"/terms",className:"text-purple-600 underline",target:"_blank",children:"Terms of Service"}),"."]})]})}),u.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-xl p-4 animate-in slide-in-from-top-2",children:u.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[u.jsx("input",{type:"checkbox",required:!0,className:"mt-1 w-5 h-5 text-purple-600 focus:ring-2 focus:ring-purple-500 rounded"}),u.jsx("span",{className:"text-sm text-gray-700 flex-1",children:"I consent to my data being processed in accordance with the Privacy Policy."})]})})]}),u.jsx("button",{type:"submit",disabled:g,className:`w-full py-3 text-white rounded-xl font-bold transition-all shadow-md hover:shadow-lg disabled:opacity-70 disabled:cursor-wait ${h==="new"?"bg-purple-600 hover:bg-purple-700":"bg-teal-500 hover:bg-teal-600"}`,children:g?"Signing in":h==="new"?"Create Account & Book":"Log In to Dashboard"})]})}),u.jsx("button",{onClick:()=>{d(!1),w(!0)},className:"w-full mt-4 text-sm text-gray-400 hover:text-gray-600 font-semibold",children:"Forgot PIN?"})]})]})}),x&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-start justify-center p-4 overflow-y-auto pt-8 pb-8",onClick:()=>w(!1),children:u.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 relative",onClick:he=>he.stopPropagation(),children:[u.jsx("button",{onClick:()=>w(!1),className:"absolute top-4 right-4 p-2 text-gray-400 hover:bg-gray-100 rounded-full transition-colors",children:u.jsx("span",{className:"text-xl",children:""})}),u.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Recover Your PIN"}),u.jsx("p",{className:"text-gray-500 mb-6",children:"Enter your name and email to view your PIN"}),u.jsxs("form",{onSubmit:he=>{he.preventDefault();const me=new FormData(he.target),ve=me.get("name"),Re=me.get("email"),Ge=(JSON.parse(localStorage.getItem("tutor_students"))||[]).find(ke=>ke.name.toLowerCase()===ve.toLowerCase()&&ke.email.toLowerCase()===Re.toLowerCase());Ge?(w(!1),$({type:"success",message:`Your PIN is: ${Ge.pin}

Please save it somewhere safe!`}),d(!0)):$({type:"error",message:"No account found with that name and email combination."})},children:[u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Your Name"}),u.jsx("input",{type:"text",name:"name",required:!0,placeholder:"e.g. Sarah Johnson",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none transition-all"})]}),u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Email Address"}),u.jsx("input",{type:"email",name:"email",required:!0,placeholder:"e.g. sarah@example.com",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none transition-all"}),u.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"The email you used during signup"})]}),u.jsx("button",{type:"submit",className:"w-full bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-xl font-bold transition-all shadow-md hover:shadow-lg",children:"Recover PIN"})]}),u.jsx("button",{onClick:()=>{w(!1),d(!0)},className:"w-full mt-4 text-sm text-gray-500 hover:text-gray-700",children:" Back to Login"})]})}),v&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-start justify-center p-4 overflow-y-auto pt-8 pb-8",onClick:()=>{_(!1),E("email")},children:u.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 relative animate-in zoom-in-95 duration-200",onClick:he=>he.stopPropagation(),children:[u.jsx("button",{onClick:()=>{_(!1),E("email")},className:"absolute top-4 right-4 p-2 text-gray-400 hover:bg-gray-100 rounded-full transition-colors",children:u.jsx("span",{className:"text-xl",children:""})}),u.jsxs("div",{className:"text-center mb-6",children:[u.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:u.jsx(rh,{size:32,className:"text-blue-600"})}),u.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Parent Portal"}),u.jsxs("p",{className:"text-gray-500 text-sm",children:[N==="email"&&"Enter your email to continue",N==="createPin"&&"Create your secure PIN",N==="enterPin"&&"Enter your PIN to log in"]})]}),u.jsxs("div",{className:"flex gap-4 mb-8 bg-gray-50 p-1 rounded-xl",children:[u.jsx("button",{onClick:()=>Ce("existing"),className:`flex-1 py-3 rounded-lg font-bold text-sm transition-all ${ye==="existing"?"bg-white text-purple-600 shadow-sm":"text-gray-400 hover:text-gray-600"}`,children:"Existing Parent"}),u.jsx("button",{onClick:()=>Ce("new"),className:`flex-1 py-3 rounded-lg font-bold text-sm transition-all ${ye==="new"?"bg-white text-purple-600 shadow-sm":"text-gray-400 hover:text-gray-600"}`,children:"New Parent"})]}),ye==="new"?u.jsxs("div",{className:"space-y-4",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 text-center mb-6",children:"Create Parent Account"}),u.jsxs("form",{onSubmit:async he=>{he.preventDefault();const me=new FormData(he.target),ve=me.get("parentName"),Re=me.get("studentName"),Ke=me.get("subject"),Ge=me.get("email"),ke=me.get("pin");if(!ve||!Re||!Ke||!Ge||!ke)return;const X=JSON.parse(localStorage.getItem("tutor_parents"))||[];if(X.some(Pe=>Pe.email.toLowerCase()===Ge.toLowerCase())){$({type:"error",message:"An account with this email already exists. Please log in."});return}try{const Pe={id:Date.now(),name:ve,email:Ge,pin:ke,linkedStudents:[],createdAt:new Date().toISOString()},bt=(await $r.getStudents()).find(Et=>Et.name.toLowerCase()===Re.trim().toLowerCase());let Ye;bt?(Ye={...bt,parentId:Pe.id,parentEmail:Ge},await $r.updateStudent(Ye.id,{parentId:Pe.id,parentEmail:Ge})):(Ye={id:(Date.now()+1).toString(),name:Re.trim(),email:Ge,parentEmail:Ge,parentId:Pe.id,isUnder16:!0,pin:uf.SHA256("0000").toString(),subject:Ke,sessionsCompleted:0,totalSpent:0,nextSession:null,status:"Active"},Ye=await $r.createStudent(Ye)),Pe.linkedStudents.push(Ye.id),X.push(Pe),localStorage.setItem("tutor_parents",JSON.stringify(X)),window.dispatchEvent(new Event("storage")),O(Pe),_(!1),M&&H("parent",{...Pe,name:Ye.name,id:Ye.id,parentId:Pe.id}),s(`/parent/${encodeURIComponent(Ge)}`),$({type:"success",message:"Account created and booking confirmed!"})}catch(Pe){console.error("Create parent account failed:",Pe),$({type:"error",message:"Failed to create account. Please try again."})}},children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Parent Name"}),u.jsx("input",{required:!0,name:"parentName",type:"text",placeholder:"Your Name",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Student Name"}),u.jsx("input",{required:!0,name:"studentName",type:"text",placeholder:"Child's Name",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none"})]}),le?u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Subject"}),u.jsxs("div",{className:"w-full px-4 py-3 border border-gray-200 bg-gray-50 rounded-xl text-gray-700 font-bold flex items-center justify-between",children:[u.jsx("span",{children:le}),u.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full uppercase",children:"Selected"})]}),u.jsx("input",{type:"hidden",name:"subject",value:le})]}):u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Subject"}),u.jsxs("select",{required:!0,name:"subject",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none bg-white",children:[u.jsx("option",{value:"",children:"Select a subject..."}),u.jsx("option",{value:"KS3 Maths",children:"KS3 Maths"}),u.jsx("option",{value:"GCSE Maths",children:"GCSE Maths"}),u.jsx("option",{value:"GCSE Sociology",children:"GCSE Sociology"}),u.jsx("option",{value:"A-Level Sociology",children:"A-Level Sociology"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Email Address"}),u.jsx("input",{required:!0,name:"email",type:"email",placeholder:"parent@example.com",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Create PIN (4 Digits)"}),u.jsx("input",{required:!0,name:"pin",type:"text",maxLength:"4",pattern:"[0-9]{4}",placeholder:"",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none text-center tracking-widest font-mono text-lg"}),u.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"You'll use this to log in securely."})]}),u.jsx("button",{type:"submit",className:"w-full py-4 bg-purple-600 text-white rounded-2xl font-bold hover:bg-purple-700 transition-all shadow-lg mt-4",children:"Create Account & Dashboard"})]})]}):u.jsxs(u.Fragment,{children:[N==="email"&&u.jsxs("form",{onSubmit:he=>{he.preventDefault();const ve=new FormData(he.target).get("email"),Ke=(JSON.parse(localStorage.getItem("tutor_parents"))||[]).find(Ge=>Ge.email.toLowerCase()===ve.toLowerCase());if(!Ke){$({type:"error",message:"No parent account found with this email. Please check your email or contact support."});return}T(ve),O(Ke),Ke.firstLogin||!Ke.pin?E("createPin"):E("enterPin")},children:[u.jsxs("div",{className:"mb-6",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Parent Email Address"}),u.jsx("input",{type:"email",name:"email",required:!0,placeholder:"e.g. parent@example.com",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none"}),u.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"The email you provided during your child's signup"})]}),u.jsx("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-bold transition-all shadow-md hover:shadow-lg",children:"Continue"})]}),N==="createPin"&&u.jsxs("form",{onSubmit:he=>{he.preventDefault();const me=new FormData(he.target),ve=me.get("firstName"),Re=me.get("pin"),Ke=me.get("confirmPin");if(!ve){$({type:"error",message:"Please enter your first name."});return}if(Re!==Ke){$({type:"error",message:"PINs do not match. Please try again."});return}const Ge=uf.SHA256(Re).toString(),ke=JSON.parse(localStorage.getItem("tutor_parents"))||[],X=ke.findIndex(Pe=>Pe.email.toLowerCase()===k.toLowerCase());X!==-1&&(ke[X].firstName=Mw(ve),ke[X].pin=Ge,ke[X].firstLogin=!1,localStorage.setItem("tutor_parents",JSON.stringify(ke)),_(!1),E("email"),s(`/parent/${encodeURIComponent(k)}`))},children:[u.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6",children:u.jsxs("p",{className:"text-sm text-blue-800",children:[u.jsx("strong",{children:"Welcome!"})," This is your first time logging in. Please create a 4-digit PIN to secure your account."]})}),u.jsxs("div",{className:"space-y-4 mb-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"First Name"}),u.jsx("input",{type:"text",name:"firstName",required:!0,placeholder:"e.g. Sarah",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Create 4-Digit PIN"}),u.jsx("input",{type:"password",name:"pin",required:!0,maxLength:"4",pattern:"[0-9]{4}",placeholder:"",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none text-center text-2xl tracking-widest font-mono"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Confirm PIN"}),u.jsx("input",{type:"password",name:"confirmPin",required:!0,maxLength:"4",pattern:"[0-9]{4}",placeholder:"",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none text-center text-2xl tracking-widest font-mono"})]})]}),u.jsx("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-bold transition-all shadow-md hover:shadow-lg",children:"Create PIN & Continue"})]}),N==="enterPin"&&u.jsxs("form",{onSubmit:he=>{he.preventDefault();const ve=new FormData(he.target).get("pin"),Re=uf.SHA256(ve).toString();if(P.pin===Re||P.pin===ve){if(M){const Ge=(JSON.parse(localStorage.getItem("tutor_students"))||[]).find(ke=>P.linkedStudents?.includes(ke.id));Ge?H("student",{...Ge,name:Ge.name,parentId:P.id}):H("parent",{...P,name:P.name||P.firstName})}_(!1),E("email"),s(`/parent/${encodeURIComponent(k)}`)}else $({type:"error",message:"Incorrect PIN. Please try again."})},children:[u.jsxs("div",{className:"mb-6",children:[u.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Welcome back! Please enter your PIN to access your parent portal."}),u.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Enter Your PIN"}),u.jsx("input",{type:"password",name:"pin",required:!0,maxLength:"4",pattern:"[0-9]{4}",placeholder:"",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none text-center text-2xl tracking-widest font-mono"})]}),u.jsx("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-bold transition-all shadow-md hover:shadow-lg",children:"Log In"}),u.jsx("button",{type:"button",onClick:()=>E("email"),className:"w-full mt-4 text-sm text-gray-500 hover:text-gray-700",children:" Use Different Email"})]})]})]})}),F&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[110] flex items-start justify-center p-4 overflow-y-auto pt-8 pb-8",onClick:()=>$(null),children:u.jsxs("div",{className:"bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full animate-in zoom-in-95 text-center",onClick:he=>he.stopPropagation(),children:[u.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4 ${F.type==="error"?"bg-red-100 text-red-600":"bg-green-100 text-green-600"}`,children:F.type==="error"?u.jsx(xh,{size:24}):u.jsx(Is,{size:24})}),u.jsx("p",{className:"text-gray-800 font-bold mb-6 text-lg whitespace-pre-wrap",children:F.message}),u.jsx("button",{onClick:()=>$(null),className:"w-full py-3 bg-gray-900 text-white rounded-xl font-bold hover:bg-black transition-all",children:"Okay"})]})})]})},nT=()=>{const[s,e]=Y.useState("idle"),[t,n]=Y.useState({current:0,total:0,status:""}),[r,i]=Y.useState([]),o=h=>i(p=>[...p,`${new Date().toLocaleTimeString()} - ${h}`]),l={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},d=async()=>{try{e("full_syncing"),i([]),o("Starting Full Migration...");const h=JSON.parse(localStorage.getItem("tutor_students")||"[]");o(`Found ${h.length} students locally.`);const p={};for(const v of h){const{data:_}=await ds.from("students").select("id").eq("email",`${v.name.replace(/\s+/g,"").toLowerCase()}@example.com`).maybeSingle();let N;if(_)N=_.id,o(`Student ${v.name} already exists (ID: ${N})`);else{const E=`${v.name.replace(/\s+/g,"").toLowerCase()}@example.com`;N=(await wf.create({name:v.name,email:E})).id,o(`Created student ${v.name} (ID: ${N})`)}p[v.id]=N}const g=JSON.parse(localStorage.getItem("tutor_bookings")||"[]");o(`Found ${g.length} bookings locally.`);for(const v of g){const _=p[v.studentId]||p[Object.keys(p).find(E=>E===v.studentId)];if(!_){o(`Skipping booking ${v.id} - Student not found in map.`);continue}const{data:N}=await ds.from("bookings").select("id").eq("date",v.date).eq("time",v.time).eq("student_id",_).maybeSingle();N||await vu.create({student_id:_,date:v.date,time:v.time,subject:v.subject,status:v.status,type:v.type,cost:v.cost,payment_status:v.paymentStatus?v.paymentStatus.toLowerCase():"due",notes:v.notes})}o("Bookings migrated.");const b=JSON.parse(localStorage.getItem("tutor_weekly_schedule")||"[]");o("Migrating Schedule...");const{error:x}=await ds.from("availability_slots").delete().gte("day_of_week",0);x&&o(`Warning clearing slots: ${x.message}`);for(const v of b){if(!v.active)continue;const _=l[v.day];for(const N of v.intervals)await wu.create({day_of_week:_,start_time:N.start,end_time:N.end,slot_type:"both",is_active:!0})}o("Schedule migrated.");const w=JSON.parse(localStorage.getItem("tutor_session_history")||"[]");o(`Found ${w.length} history items.`);for(const v of w){const _=p[v.studentId]||p[Object.keys(p).find(N=>N===v.studentId)];_?await L1.create({student_id:_,date:v.date,topic:v.topic,feedback_well:v.feedbackWell||v.feedback_well,feedback_improve:v.feedbackImprove||v.feedback_improve,next_steps:v.nextSteps||v.next_steps,cost:v.cost,payment_status:v.paymentStatus?v.paymentStatus.toLowerCase():"due",type:v.type||"lesson"}):o(`Skipping history item for student ${v.studentId} - Not found.`)}o("History migrated."),e("success"),o("MIGRATION COMPLETE ")}catch(h){console.error(h),e("error");const p=h&&h.message||String(h);p==="Failed to fetch"||p.includes("fetch")?o(`ERROR: Network error  "${p}". Check your internet connection, Supabase URL and anon key in .env, and that the Supabase project allows your app origin (CORS).`):o(`ERROR: ${p}`)}};return u.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[u.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[u.jsx(O6,{size:20,className:s==="full_syncing"?"animate-spin":""}),"Cloud Sync (Teacher)"]}),u.jsx("div",{className:"bg-blue-50 text-blue-800 p-4 rounded-xl mb-4 text-sm",children:u.jsxs("p",{className:"flex items-start gap-2",children:[u.jsx(To,{size:16,className:"mt-0.5 shrink-0"}),u.jsxs("span",{children:["Click ",u.jsx("strong",{children:"Sync to Cloud"})," below to upload your local data (Students, Schedule, Bookings, Session history) to the database. You can then access it from other devices. This does not run automatically.",u.jsx("br",{}),u.jsx("strong",{children:"Note:"})," This overrides the cloud schedule with your local schedule."]})]})}),u.jsx("button",{type:"button",onClick:d,disabled:s==="full_syncing",className:`w-full min-h-[48px] py-3 px-6 rounded-xl font-bold flex items-center justify-center gap-2 transition-all mb-4 border-2 ${s==="success"?"bg-green-500 border-green-600 text-white hover:bg-green-600":s==="full_syncing"?"bg-gray-300 border-gray-400 text-gray-600 cursor-wait":"bg-purple-600 border-purple-700 text-white hover:bg-purple-700 shadow-md"}`,children:s==="full_syncing"?u.jsx(u.Fragment,{children:"Syncing..."}):s==="success"?u.jsxs(u.Fragment,{children:[u.jsx(r_,{size:20})," Synced Successfully"]}):u.jsxs(u.Fragment,{children:[u.jsx(J6,{size:20})," Sync to Cloud"]})}),u.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:"Log"}),u.jsx("div",{className:"h-32 bg-gray-100 border border-gray-200 text-gray-700 font-mono text-xs p-3 rounded-xl overflow-y-auto",children:r.length===0?u.jsx("span",{className:"text-gray-400",children:"Ready to sync. Click the button above to start."}):r.map((h,p)=>u.jsx("div",{children:h},p))})]})},Fw="tutor_teacher_notes";function Uw({bookingId:s,initialValue:e}){const[t,n]=Y.useState(e),r=Y.useRef(null),i=o=>{try{const l=localStorage.getItem(Fw),d=l?JSON.parse(l):{};o?d[s]=o:delete d[s],localStorage.setItem(Fw,JSON.stringify(d))}catch{}};return Y.useEffect(()=>n(e),[s,e]),u.jsxs(u.Fragment,{children:[u.jsx("textarea",{className:"w-full text-gray-600 bg-purple-50 rounded-lg px-2 py-1.5 mt-0.5 border border-purple-100 min-h-[3rem] text-xs resize-y focus:border-purple-400 outline-none",placeholder:"Private notes  only you see these",value:t,onBlur:()=>i(t.trim()),onChange:o=>{const l=o.target.value;n(l),r.current&&clearTimeout(r.current),r.current=setTimeout(()=>i(l.trim()),400)}}),u.jsx("p",{className:"text-[10px] text-purple-400 mt-0.5 italic",children:"Saves automatically"})]})}const sT=()=>{ka();const[s,e]=Y.useState(()=>localStorage.getItem("teacher_dashboard_unlocked")==="true"),[t,n]=Y.useState(""),[r,i]=Y.useState(""),[o,l]=Y.useState("students"),[d,h]=Y.useState("student"),[p,g]=Y.useState([]),[b,x]=Y.useState(""),[w,v]=Y.useState({}),[_,N]=Y.useState(""),[E,k]=Y.useState(null),[T,P]=Y.useState([]),[O,F]=Y.useState(null),[$,z]=Y.useState(null),[G,R]=Y.useState([]),[q,J]=Y.useState(null),[Z,le]=Y.useState(""),[K,se]=Y.useState(""),[ce,ye]=Y.useState(""),[Ce,M]=Y.useState(""),[L,U]=Y.useState(""),[H,ae]=Y.useState(()=>{const te=[{day:"Monday",intervals:[{start:"09:00",end:"17:00"}],active:!0},{day:"Tuesday",intervals:[{start:"09:00",end:"17:00"}],active:!0},{day:"Wednesday",intervals:[{start:"09:00",end:"17:00"}],active:!0},{day:"Thursday",intervals:[{start:"09:00",end:"17:00"}],active:!0},{day:"Friday",intervals:[{start:"09:00",end:"15:00"}],active:!0},{day:"Saturday",intervals:[{start:"09:00",end:"18:00"}],active:!0},{day:"Sunday",intervals:[{start:"09:00",end:"18:00"}],active:!0}],Se=localStorage.getItem("tutor_weekly_schedule");if(Se)try{const Ve=JSON.parse(Se);return["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(Ie=>{const Ze=Ve.find(Ct=>Ct.day===Ie);return Ze?(Ze.intervals||(Ze.intervals=Ze.start&&Ze.end?[{start:Ze.start,end:Ze.end}]:[]),Ze):te.find(Ct=>Ct.day===Ie)})}catch(Ve){return console.error("Failed to parse schedule",Ve),te}return te}),[de,xe]=Y.useState(null),[he,me]=Y.useState([]),[ve,Re]=Y.useState([]),[Ke,Ge]=Y.useState(new Date),[ke,X]=Y.useState(null),[Pe,gt]=Y.useState(!1),[bt,Ye]=Y.useState(""),[Et,vt]=Y.useState([]),[st,St]=Y.useState([]),[Pt,Ut]=Y.useState(!1),[je,Me]=Y.useState({studentId:"",startDate:"",time:"",weeks:4,subject:"Maths GCSE"}),[Fe,ue]=Y.useState(!1),[Te,Oe]=Y.useState({studentId:"",date:"",time:"14:00",subject:"Maths GCSE"}),[ct,ft]=Y.useState(null),[wt,it]=Y.useState(0),At=te=>{if(!te)return"";const[Se,Ve]=te.split(":"),Ae=parseInt(Se,10),Ie=Ae>=12?"PM":"AM";return`${Ae%12||12}:${Ve} ${Ie}`},We=te=>te?te.split(" ").map(Se=>Se.charAt(0).toUpperCase()+Se.slice(1).toLowerCase()).join(" "):"",lt=["Maths KS3","Maths GCSE","Maths A-Level","Sociology GCSE"],pt=te=>{if(!te)return 30;const Se=String(te).toLowerCase();return Se.includes("ks3")?25:Se.includes("a-level")||Se.includes("alevel")||Se.includes("a level")||Se.includes("a-lvl")?40:30},en=(()=>{const te=[];for(let Se=7;Se<=22;Se++)for(let Ve=0;Ve<60&&!(Se===22&&Ve>0);Ve+=15){const Ae=Se.toString().padStart(2,"0"),Ie=Ve.toString().padStart(2,"0"),Ze=`${Ae}:${Ie}`;te.push({value:Ze,label:At(Ze)})}return te})(),[Mt,Bt]=Y.useState(null),[Yt,On]=Y.useState({newDate:"",newTime:"14:00",applyToSeries:!1}),[an,As]=Y.useState(null),[ut,re]=Y.useState(()=>{const te=new Date;return`${te.getFullYear()}-${String(te.getMonth()+1).padStart(2,"0")}`}),Qe=te=>{As({booking:te,mode:null})},mt=te=>{if(!an)return;const{booking:Se}=an;let Ve,Ae=[];te==="series"&&Se.recurringId?(Ae=st.filter(Ze=>Ze.recurringId===Se.recurringId&&Ze.status!=="cancelled"&&new Date(Ze.date)>=new Date(Se.date)),Ve=st.map(Ze=>Ze.recurringId===Se.recurringId&&new Date(Ze.date)>=new Date(Se.date)?{...Ze,status:"cancelled"}:Ze)):(Ae=[Se],Ve=st.map(Ze=>Ze.id===Se.id?{...Ze,status:"cancelled"}:Ze)),St(Ve),localStorage.setItem("tutor_bookings",JSON.stringify(Ve));const Ie=ve.map(Ze=>Ae.some(Lt=>Lt.date===Ze.date&&Lt.time===Ze.time)?{...Ze,bookedBy:null}:Ze);Re(Ie),localStorage.setItem("tutor_lesson_slots",JSON.stringify(Ie)),Ae.forEach(Ze=>{xr.sendCancellationNotice({student:Ze.student,email:"student@example.com",date:Ze.date,time:Ze.time,topic:Ze.subject||"Lesson"}).catch(Ct=>console.error("Email error:",Ct))}),window.dispatchEvent(new Event("storage")),xe({type:"success",message:te==="series"?"Entire series cancelled.":"Booking cancelled."}),As(null)},Xe=te=>{if(te.preventDefault(),!q)return;const Se=`${K} ${ce?"| To Improve: "+ce:""} ${Ce?"| Focus: "+Ce:""}`.trim(),Ve={id:q.roomId||Date.now().toString(),date:q.date||new Date().toISOString(),endTime:q.date||new Date().toISOString(),studentName:q.studentName,studentId:(q.studentName||"").toLowerCase().replace(/\s+/g,"_"),subject:Z,topic:Z,feedback:Se,feedback_well:K,feedback_improve:ce,feedback_focus:Ce,next_steps:L,nextSteps:L,cost:pt(Z),paymentStatus:"Due",type:"lesson",duration:"60"},Ae=JSON.parse(localStorage.getItem("tutor_session_history"))||[];Ae.push(Ve),localStorage.setItem("tutor_session_history",JSON.stringify(Ae)),vt(Ae);const Ie=G.filter(Ze=>Ze.roomId!==q.roomId||Ze.date!==q.date);R(Ie),localStorage.setItem("tutor_pending_feedback",JSON.stringify(Ie)),J(null),le(""),se(""),ye(""),M(""),U(""),window.dispatchEvent(new Event("storage"))};Y.useEffect(()=>{const te=async()=>{const Se=await $r.getStudents();g(Se);const Ve=await $r.getBookings();Ve.sort((Ot,Ft)=>new Date(Ot.date+"T"+Ot.time)-new Date(Ft.date+"T"+Ft.time)),St(Ve);const Ae=await $r.getSessionHistory();vt(Ae);const Ie=localStorage.getItem("tutor_weekly_schedule");if(Ie)try{const Ot=JSON.parse(Ie),ms=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(bn=>{const us=Ot.find(ja=>ja.day===bn),nr={day:bn,intervals:[{start:"09:00",end:bn==="Friday"?"15:00":"17:00"}],active:!0};return(bn==="Saturday"||bn==="Sunday")&&(nr.intervals=[{start:"09:00",end:"18:00"}]),us?{...nr,...us,day:bn}:nr});ae(ms)}catch{const Ft=await $r.getWeeklySchedule();ae(Ft)}else{const Ot=await $r.getWeeklySchedule();ae(Ot)}const Ze=JSON.parse(localStorage.getItem("tutor_parents"))||[];P(Ze);const Ct=JSON.parse(localStorage.getItem("tutor_slots"))||[],Lt=JSON.parse(localStorage.getItem("tutor_lesson_slots"))||[];me(Ct),Re(Lt);const fn=JSON.parse(localStorage.getItem("chat_messages_v2"))||{};v(fn);const Dn=JSON.parse(localStorage.getItem("tutor_pending_feedback")||"[]");R(Dn)};return te(),window.addEventListener("storage",te),()=>window.removeEventListener("storage",te)},[]),Y.useEffect(()=>{if(o==="messages"&&E){const te=E.threadKey,Se=JSON.parse(localStorage.getItem("chat_messages_v2"))||{},Ve=Se[te]||[];if(Ve.some(Ie=>Ie.sender!=="Davina"&&!Ie.read)){const Ie=Ve.map(Ct=>Ct.sender!=="Davina"?{...Ct,read:!0}:Ct),Ze={...Se,[te]:Ie};v(Ze),localStorage.setItem("chat_messages_v2",JSON.stringify(Ze)),window.dispatchEvent(new Event("storage"))}}},[o,E]);const et=new Date().getMonth(),kt=new Date().getFullYear(),Tt=new Date,Rt=Et.filter(te=>te.paymentStatus&&te.paymentStatus.toLowerCase()==="paid").reduce((te,Se)=>te+(Se.cost!==void 0?Number(Se.cost):Se.type==="consultation"?0:pt(Se.subject||Se.topic)),0),An=Et.filter(te=>!te.paymentStatus||te.paymentStatus.toLowerCase()!=="paid").reduce((te,Se)=>te+(Se.cost!==void 0?Number(Se.cost):Se.type==="consultation"?0:pt(Se.subject||Se.topic)),0),Pn=st.filter(te=>new Date(te.date+"T"+te.time)>Tt&&te.type!=="consultation"&&te.subject!=="Free Consultation"&&te.status!=="cancelled"),wn=Pn.reduce((te,Se)=>Se.paymentStatus==="In bundle"?te:te+(Se.cost!==void 0?Number(Se.cost):pt(Se.subject)),0),jt=[0,1,2].map(te=>{const Se=new Date(kt,et+te,1),Ve=Se.getMonth(),Ae=Se.getFullYear(),Ie=Se.toLocaleDateString("en-GB",{month:"long",year:"numeric"}),Ct=[...st,...Et].filter(Ot=>{if(Ot.status==="cancelled")return!1;const Ft=new Date(Ot.date);return Ft.getMonth()===Ve&&Ft.getFullYear()===Ae}),Lt=Ct.filter(Ot=>Ot.type==="lesson").length,fn=Ct.filter(Ot=>Ot.type==="consultation").length,Dn=Ct.reduce((Ot,Ft)=>Ft.type==="consultation"||Ft.cost===0?Ot:Ot+(Ft.cost!==void 0?Number(Ft.cost):pt(Ft.subject||Ft.topic)),0);return{monthName:Ie,projectedEarnings:Dn,bookedLessons:Lt,consultations:fn}}),dt=Et.filter(te=>{const Se=new Date(te.date);return te.paymentStatus?.toLowerCase()==="paid"&&Se.getMonth()===et&&Se.getFullYear()===kt}).reduce((te,Se)=>te+(Se.cost!==void 0?Number(Se.cost):Se.type==="consultation"?0:pt(Se.subject||Se.topic)),0),sn=jt[0].projectedEarnings,Un=jt[0].bookedLessons,er=An;Y.useEffect(()=>{$r.saveWeeklySchedule(H)},[H]);const tr=async te=>{if(te.preventDefault(),!b.trim())return;const Ve={name:We(b)};try{const Ae=await $r.createStudent(Ve),Ie=[...p,Ae];g(Ie),x(""),xe({type:"success",message:`${Ae.name} added to roster.`})}catch(Ae){console.error("Failed to add student:",Ae),xe({type:"error",message:"Failed to add student. Please try again."})}},Ns=async te=>{if(window.confirm("Are you sure you want to remove this student? All their local data will remain in bookings but they will be removed from your list."))try{await $r.deleteStudent(te);const Se=p.filter(Ve=>Ve.id!==te);g(Se)}catch(Se){console.error("Failed to remove student:",Se),xe({type:"error",message:"Failed to remove student."})}},Hr=(te,Se,Ve,Ae)=>{const Ie=[...H];Ie[te].intervals[Se][Ve]=Ae,ae(Ie)},Tr=te=>{const Se=[...H];Se[te].intervals.push({start:"09:00",end:"10:00"}),ae(Se)},Ci=(te,Se)=>{const Ve=[...H];Ve[te].intervals.splice(Se,1),ae(Ve)},Za=te=>{const Se=[...H];Se[te].active=!Se[te].active,ae(Se)},Ei=()=>{const te=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Se=[],Ve=new Date,Ae=30;for(let Ie=0;Ie<Ae;Ie++){const Ze=new Date(Ve);Ze.setDate(Ve.getDate()+Ie);const Ct=te[Ze.getDay()],Lt=H.find(fn=>fn.day===Ct);!Lt||!Lt.active||Lt.intervals.forEach(fn=>{const[Dn,Ot]=fn.start.split(":").map(Number),[Ft,ms]=fn.end.split(":").map(Number);for(let bn=Dn;bn<Ft&&!(bn===Ft&&ms<60);bn++){const us=`${String(bn).padStart(2,"0")}:${String(Ot).padStart(2,"0")}`,nr=Ze.toISOString().split("T")[0];ve.findIndex(Oo=>Oo.date===nr&&Oo.time===us)===-1&&Se.push({id:`gen-${nr}-${us}`,date:nr,time:us,bookedBy:null,generated:!0})}})}return Se};Y.useEffect(()=>{const te=Ei(),Se=[...ve,...te];localStorage.setItem("tutor_all_lesson_slots",JSON.stringify(Se)),console.log("Saved lesson slots to localStorage:",Se.length,"slots (Unified)"),window.dispatchEvent(new Event("storage"))},[ve,H]),[...ve,...Ei()];const Ds=(te,Se)=>{if(!te||!Se)return;const Ve={id:Date.now()+"L",date:te,time:Se,bookedBy:null};if(ve.some(Ie=>Ie.date===te&&Ie.time===Se)){xe({type:"error",message:"Slot already exists!"});return}const Ae=[...ve,Ve];Re(Ae),localStorage.setItem("tutor_lesson_slots",JSON.stringify(Ae)),window.dispatchEvent(new Event("storage")),Ye("")},pl=te=>{te.preventDefault(),t==="8138"?(e(!0),localStorage.setItem("teacher_dashboard_unlocked","true")):(i("Incorrect Code"),n(""))},ni=te=>{te.preventDefault();try{const{studentId:Se,startDate:Ve,time:Ae,weeks:Ie,subject:Ze}=je;if(!Se||!Ve||!Ae||!Ie){xe({type:"error",message:"Please fill in all required fields."});return}const Ct=p.find(bn=>bn.id==Se);if(!Ct){xe({type:"error",message:"Student not found."});return}const Lt=[],fn=[],Dn=Date.now().toString()+"-REC";let Ot=new Date(Ve);if(isNaN(Ot.getTime())){xe({type:"error",message:"Invalid start date."});return}for(let bn=0;bn<Ie;bn++){const us=Ot.toISOString().split("T")[0],nr=(ve||[]).find(ja=>ja.date===us&&ja.time===Ae);if(nr&&nr.bookedBy){xe({type:"error",message:`Conflict on Week ${bn+1} (${new Date(us).toLocaleDateString("en-GB")}): Slot already booked.`});return}Lt.push({id:`bk-${us}-${Ae}-${Date.now()}-${bn}`,student:Ct.name,studentId:Ct.id,date:us,time:Ae,subject:Ze||"Lesson",type:"lesson",status:"confirmed",recurringId:Dn,seriesIndex:bn+1,totalSeries:Ie,cost:Ie===10?bn===0?280:0:30,paymentStatus:Ie===10?bn===0?"Due":"In bundle":"Due"}),nr?fn.push({...nr,bookedBy:Ct.name}):fn.push({id:`gen-${us}-${Ae}`,date:us,time:Ae,bookedBy:Ct.name,generated:!1}),Ot.setDate(Ot.getDate()+7)}const Ft=[...st||[],...Lt];let ms=[...ve||[]];fn.forEach(bn=>{const us=ms.findIndex(nr=>nr.date===bn.date&&nr.time===bn.time);us>=0?ms[us]=bn:ms.push(bn)}),St(Ft),Re(ms),localStorage.setItem("tutor_bookings",JSON.stringify(Ft)),localStorage.setItem("tutor_lesson_slots",JSON.stringify(ms)),window.dispatchEvent(new Event("storage")),it(bn=>bn+1),Ut(!1),Me({studentId:"",startDate:"",time:"",weeks:4,subject:"Maths GCSE"}),xe({type:"success",message:`${Ie} lessons successfully booked!`})}catch(Se){console.error("Booking Error:",Se),xe({type:"error",message:"Error creating bookings: "+Se.message})}},ki=async te=>{te.preventDefault();const{studentId:Se,date:Ve,time:Ae,subject:Ie}=Te;if(!Se||!Ve||!Ae||!Ie){xe({type:"error",message:"Please fill in all fields."});return}const Ze=p.find(Ft=>String(Ft.id)===String(Se));if(!Ze){xe({type:"error",message:"Student not found."});return}const Ct=Ve.includes("T")?Ve.split("T")[0]:Ve,Lt=st.find(Ft=>Ft.date===Ct&&Ft.time===Ae&&Ft.status!=="cancelled");if(Lt){xe({type:"error",message:`Conflict: This time slot is already booked for ${Lt.student}.`});return}const fn={id:`bk-${Ct}-${Ae}-${Date.now()}`,student:Ze.name,studentId:Ze.id,date:Ct,time:Ae,subject:Ie,type:"lesson",status:"confirmed",recurringId:null,cost:30,paymentStatus:"Due"};try{await $r.createBooking(fn)}catch{const ms=[...st,fn];localStorage.setItem("tutor_bookings",JSON.stringify(ms)),window.dispatchEvent(new Event("storage"))}const Dn=[...st,fn],Ot=ve.map(Ft=>Ft.date===Ct&&Ft.time===Ae?{...Ft,bookedBy:Ze.name}:Ft);St(Dn),Re(Ot),localStorage.setItem("tutor_bookings",JSON.stringify(Dn)),localStorage.setItem("tutor_lesson_slots",JSON.stringify(Ot)),window.dispatchEvent(new Event("storage")),ue(!1),Oe({studentId:"",date:"",time:"14:00",subject:"Maths GCSE"}),xe({type:"success",message:`Lesson booked for ${Ze.name} on ${new Date(Ct).toLocaleDateString("en-GB")} at ${At(Ae)}.`})},gi=te=>{Bt(te),On({newDate:te.date,newTime:te.time,applyToSeries:!!te.recurringId})},Bo=te=>{if(!window.confirm(`Allow ${te.student} to pay later for this session?

This will grant them immediate access to the classroom.`))return;const Se=(JSON.parse(localStorage.getItem("tutor_session_history"))||[]).map(Ae=>Ae.id===te.id?{...Ae,paymentStatus:"Due (Exception)"}:Ae);localStorage.setItem("tutor_session_history",JSON.stringify(Se));const Ve=st.map(Ae=>Ae.id===te.id?{...Ae,paymentStatus:"Due (Exception)"}:Ae);St(Ve),localStorage.setItem("tutor_bookings",JSON.stringify(Ve)),window.dispatchEvent(new Event("storage")),xe({type:"success",message:`Exception granted for ${te.student}. They can now join the lesson.`})},gl=()=>{if(!Mt||!Yt.newDate||!Yt.newTime)return;const te=Yt.applyToSeries&&Mt.recurringId,Se=te?st.filter(Ie=>Ie.recurringId===Mt.recurringId&&new Date(Ie.date)>=new Date(Mt.date)):[Mt];let Ve=[];if(te){const Ie=new Date(`${Mt.date}T${Mt.time}`),Ct=new Date(`${Yt.newDate}T${Yt.newTime}`)-Ie;Se.forEach(Lt=>{const fn=new Date(`${Lt.date}T${Lt.time}`),Dn=new Date(fn.getTime()+Ct);Ve.push({...Lt,status:"pending_student_approval",teacherProposed:{originalDate:Lt.date,originalTime:Lt.time,newDate:Dn.toISOString().split("T")[0],newTime:`${String(Dn.getHours()).padStart(2,"0")}:${String(Dn.getMinutes()).padStart(2,"0")}`}})})}else Ve.push({...Mt,status:"pending_student_approval",teacherProposed:{originalDate:Mt.date,originalTime:Mt.time,newDate:Yt.newDate,newTime:Yt.newTime}});const Ae=st.map(Ie=>Ve.find(Ct=>Ct.id===Ie.id)||Ie);St(Ae),localStorage.setItem("tutor_bookings",JSON.stringify(Ae)),Ve.forEach(Ie=>{xr.sendRescheduleRequest(Ie,"teacher")}),Bt(null),window.dispatchEvent(new Event("storage"))},ml=te=>{ft({booking:te,action:"approve"})},tc=()=>{const te=ct.booking,Se=ve.map(Ae=>Ae.id===te.id?{...Ae,bookedBy:null}:Ae);Re(Se),localStorage.setItem("tutor_lesson_slots",JSON.stringify(Se));const Ve=st.map(Ae=>Ae.id===te.id?{...Ae,id:te.requestedSlotId,date:te.requestedDate,time:te.requestedTime,status:"confirmed",requestedDate:void 0,requestedTime:void 0,requestedSlotId:void 0,studentProposed:void 0}:Ae);St(Ve),localStorage.setItem("tutor_bookings",JSON.stringify(Ve)),window.dispatchEvent(new Event("storage")),xr.sendRescheduleResponse(te,"Approved"),ft(null)},si=te=>{ft({booking:te,action:"deny"})},la=()=>{const te=ct.booking,Se=ve.map(Ae=>Ae.id===te.requestedSlotId?{...Ae,bookedBy:null}:Ae);Re(Se),localStorage.setItem("tutor_lesson_slots",JSON.stringify(Se));const Ve=st.map(Ae=>Ae.id===te.id?{...Ae,status:"confirmed",requestedDate:void 0,requestedTime:void 0,requestedSlotId:void 0}:Ae);St(Ve),localStorage.setItem("tutor_bookings",JSON.stringify(Ve)),window.dispatchEvent(new Event("storage")),xr.sendRescheduleResponse(te,"Denied"),ft(null)},ji=te=>{const Se=te.getFullYear(),Ve=te.getMonth(),Ae=new Date(Se,Ve,1),Ie=new Date(Se,Ve+1,0),Ze=[],Ct=Ae.getDay()===0?6:Ae.getDay()-1;for(let Lt=0;Lt<Ct;Lt++)Ze.push(null);for(let Lt=1;Lt<=Ie.getDate();Lt++)Ze.push(new Date(Se,Ve,Lt));return Ze},zn=te=>{const Se=new Date(Ke);Se.setMonth(Se.getMonth()+te),Ge(Se)};return s?u.jsx("div",{className:"min-h-screen bg-brand-light flex justify-center p-8 font-sans",children:u.jsxs("div",{className:"max-w-5xl w-full space-y-8",children:[u.jsxs("div",{className:"flex items-center justify-between pb-6 border-b border-gray-200",children:[u.jsxs("div",{className:"flex items-center gap-3 text-purple-600",children:[u.jsx(Au,{size:40}),u.jsxs("div",{children:[u.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"Teacher Dashboard"}),u.jsx("p",{className:"text-gray-500",children:"Manage your students and availability"})]})]}),u.jsxs("button",{type:"button",onClick:te=>{te.preventDefault(),e(!1),localStorage.removeItem("teacher_dashboard_unlocked"),window.location.href="/"},className:"flex items-center gap-2 px-4 py-2 text-red-500 hover:bg-red-50 rounded-lg font-bold transition-colors",children:[u.jsx(Jl,{size:18,className:"rotate-180"})," Log Out"]})]}),u.jsxs("div",{className:"flex gap-4 border-b border-gray-200 overflow-x-auto scrollbar-none",children:[u.jsx("button",{onClick:()=>l("students"),className:`pb-4 px-4 font-bold text-lg transition-colors border-b-2 whitespace-nowrap ${o==="students"?"border-purple-600 text-purple-600":"border-transparent text-gray-400 hover:text-gray-600"}`,children:"Students"}),u.jsx("button",{onClick:()=>l("slots"),className:`pb-4 px-4 font-bold text-lg transition-colors border-b-2 whitespace-nowrap ${o==="slots"?"text-teal-600 border-teal-500":"border-transparent text-gray-400 hover:text-gray-600"}`,children:"Availability"}),u.jsx("button",{onClick:()=>l("earnings"),className:`pb-4 px-4 font-bold text-lg transition-colors border-b-2 whitespace-nowrap ${o==="earnings"?"text-green-600 border-green-500":"border-transparent text-gray-400 hover:text-gray-600"}`,children:"Earnings"}),u.jsxs("button",{onClick:()=>l("messages"),className:`pb-4 px-4 font-bold text-lg transition-colors border-b-2 relative whitespace-nowrap overflow-visible ${o==="messages"?"text-blue-600 border-blue-500":"border-transparent text-gray-400 hover:text-gray-600"}`,children:["Messages",(()=>{const te=Object.values(w).reduce((Se,Ve)=>Se+(Ve||[]).filter(Ae=>Ae.sender!=="Davina"&&!Ae.read).length,0);return te>0?u.jsx("span",{className:"absolute -top-0.5 -right-0.5 min-w-[1.25rem] h-5 px-1 flex items-center justify-center bg-red-500 text-white text-xs font-bold rounded-full shrink-0 overflow-visible",children:te>9?"9+":te}):null})()]}),u.jsx("button",{onClick:()=>l("settings"),className:`pb-4 px-4 font-bold text-lg transition-colors border-b-2 ${o==="settings"?"text-gray-900 border-gray-900":"border-transparent text-gray-400 hover:text-gray-600"}`,children:"Settings"})]}),G.length>0&&u.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-2xl p-4 flex flex-wrap items-center justify-between gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Na,{className:"text-amber-600 shrink-0",size:22}),u.jsx("span",{className:"font-bold text-amber-800",children:"Lessons needing summary"}),u.jsx("span",{className:"text-amber-700 text-sm",children:"Complete the 4 end-of-lesson questions for these sessions."})]}),u.jsx("div",{className:"flex flex-wrap gap-2",children:G.map((te,Se)=>u.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-xl px-3 py-2 border border-amber-200",children:[u.jsxs("span",{className:"text-sm text-gray-700",children:[te.studentName||te.roomId,"  ",te.date?new Date(te.date).toLocaleDateString("en-GB"):""]}),u.jsx("button",{type:"button",onClick:()=>{J(te),le(""),se(""),ye(""),M(""),U("")},className:"py-1.5 px-3 bg-purple-600 text-white rounded-lg text-sm font-bold hover:bg-purple-700",children:"Complete notes"})]},Se))})]}),o==="students"?u.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[u.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[u.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg border border-purple-100 h-fit",children:[u.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[u.jsx(cf,{size:20,className:"text-purple-600"})," Add Student"]}),u.jsxs("form",{onSubmit:tr,autoComplete:"off",children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",htmlFor:"add-student-name",children:"Student Name"}),u.jsx("input",{id:"add-student-name",name:"studentName",type:"text",autoComplete:"off",value:b,onChange:te=>x(te.target.value),placeholder:"e.g. Alice",className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-600 focus:outline-none mb-4"}),de?.type==="error"&&de?.message?.toLowerCase().includes("student")&&u.jsx("p",{className:"text-red-600 text-sm font-semibold mb-3",children:de.message}),u.jsxs("button",{type:"submit",disabled:!b.trim(),className:"w-full py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700 transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:[u.jsx(cf,{size:18})," Add to Roster"]})]})]}),u.jsxs("div",{className:"md:col-span-2 space-y-4",children:[u.jsx("div",{className:"flex justify-between items-center mb-2",children:u.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[u.jsx(rh,{size:20,className:"text-teal-500"})," My Students",u.jsx("span",{className:"bg-gray-100 text-gray-500 px-2 py-0.5 rounded-full text-xs",children:p.length})]})}),p.length===0?u.jsx("div",{className:"bg-white border-2 border-dashed border-gray-100 rounded-2xl p-12 text-center text-gray-400",children:"No students added yet. Add your first student to get started!"}):u.jsx("div",{className:"grid gap-3",children:p.map(te=>{const Se=(JSON.parse(localStorage.getItem("tutor_parents"))||[]).find(Ot=>Ot.linkedStudents.includes(te.id)),Ve=st.filter(Ot=>(Ot.studentId===te.id||Ot.student===te.name||Ot.studentName===te.name)&&Ot.status!=="cancelled"),Ae=Ve.some(Ot=>[230,280,370].includes(Number(Ot.cost))),Ie={};Ve.forEach(Ot=>{Ot.recurringId&&(Ie[Ot.recurringId]||(Ie[Ot.recurringId]=[]),Ie[Ot.recurringId].push(Ot))});const Ze=Object.values(Ie).filter(Ot=>Ot.length===10).length,Ct=Et.filter(Ot=>(Ot.studentName===te.name||Ot.student===te.name)&&(Ot.paymentStatus==="Paid"||Ot.paymentStatus==="paid")),Lt=Math.min(10,Ct.length),fn=Ae?Math.max(0,10-Lt):null,Dn=te.subject||Ve[0]?.subject||Ve[0]?.topic;return u.jsxs("div",{className:"group bg-white p-5 rounded-2xl shadow-sm border border-gray-100 hover:border-purple-200 transition-all flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-50 to-purple-100 text-purple-600 rounded-2xl flex items-center justify-center font-bold text-2xl group-hover:scale-105 transition-transform shadow-sm",children:te.name?.charAt(0).toUpperCase()||"?"}),u.jsxs("div",{children:[u.jsxs("h3",{className:"font-bold text-gray-800 text-lg flex items-center gap-2 flex-wrap",children:[te.name,Dn&&u.jsx("span",{className:"text-[10px] font-bold text-purple-600 bg-purple-50 px-2 py-0.5 rounded border border-purple-100",children:Dn}),!Et.some(Ot=>(Ot.studentName===te.name||Ot.student===te.name)&&Ot.paymentStatus==="Paid")&&u.jsx("span",{className:"text-[10px] bg-green-100 text-green-700 font-black px-1.5 py-0.5 rounded animate-pulse",children:"NEW"}),u.jsxs("span",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-widest bg-gray-50 px-2 py-0.5 rounded border border-gray-100",children:["ID: ",te.id]})]}),Se?u.jsx("div",{className:"flex flex-col mt-1",children:u.jsxs("p",{className:"text-xs text-purple-600 font-bold flex items-center gap-1",children:[u.jsx(rh,{size:12})," Parent: ",Se.name]})}):u.jsx("p",{className:"text-xs text-gray-400 italic mt-1",children:"No parent linked"}),fn!==null&&u.jsxs("p",{className:"text-xs text-teal-600 font-bold mt-1",children:[fn," of 10 remaining",Ze>1?` ${Ze}`:""]})]})]}),u.jsxs("div",{className:"flex items-center gap-3 opacity-0 group-hover:opacity-100 transition-opacity",children:[u.jsx("button",{onClick:()=>z(te),className:"p-2 text-teal-600 hover:bg-teal-50 rounded-lg transition-colors",title:"Session notes",children:u.jsx(Na,{size:20})}),u.jsx("button",{onClick:()=>{l("messages"),h("student"),k({...te,threadKey:te.name})},className:"p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Message Student",children:u.jsx(Hc,{size:20})}),Se&&u.jsx("button",{onClick:()=>{l("messages"),h("parent"),k({name:Se.name,email:Se.email,id:Se.email,threadKey:`parent_${Se.email}`})},className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Message Parent",children:u.jsx(Sg,{size:20})}),u.jsx("button",{onClick:()=>Ns(te.id),className:"p-2 text-gray-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Remove Student",children:u.jsx(Kl,{size:18})})]})]},te.id)})})]})]}),u.jsxs("div",{className:"animate-in fade-in slide-in-from-bottom-8 duration-700",children:[u.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-4",children:[u.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[u.jsx(ei,{size:20,className:"text-purple-600"})," Upcoming Sessions"]}),(()=>{const te=new Date;`${te.getFullYear()}${String(te.getMonth()+1).padStart(2,"0")}`;const Se=st.filter(Ze=>new Date(Ze.date+"T"+Ze.time)>new Date&&Ze.status!=="cancelled"),Ve=[...new Set(Se.map(Ze=>{const Ct=new Date(Ze.date);return`${Ct.getFullYear()}-${String(Ct.getMonth()+1).padStart(2,"0")}`}))],Ae=Array.from({length:6},(Ze,Ct)=>{const Lt=new Date(te.getFullYear(),te.getMonth()+Ct,1);return`${Lt.getFullYear()}-${String(Lt.getMonth()+1).padStart(2,"0")}`}),Ie=[...new Set([...Ae,...Ve])].sort();return u.jsx("select",{value:ut,onChange:Ze=>re(Ze.target.value),className:"rounded-xl border-2 border-purple-100 px-4 py-2 font-bold text-sm text-gray-800 bg-white focus:border-purple-500",children:Ie.map(Ze=>{const[Ct,Lt]=Ze.split("-").map(Number);return u.jsx("option",{value:Ze,children:new Date(Ct,Lt-1,1).toLocaleDateString("en-GB",{month:"long",year:"numeric"})},Ze)})})})()]}),u.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-purple-100 overflow-hidden",children:(()=>{const[te,Se]=(ut||"").split("-").map(Number),Ve=st.filter(Ae=>{if(new Date(Ae.date+"T"+Ae.time)<=new Date||Ae.status==="cancelled")return!1;const Ie=new Date(Ae.date);return Ie.getFullYear()===te&&Ie.getMonth()+1===Se});return Ve.length===0?u.jsx("div",{className:"p-12 text-center text-gray-400 italic",children:"No upcoming sessions for this month."}):u.jsx("div",{className:"divide-y divide-gray-100",children:Ve.map((Ae,Ie)=>u.jsxs("div",{className:`p-4 transition-colors flex flex-col md:flex-row md:items-center justify-between gap-4 ${Ae.status==="pending_reschedule"?"bg-orange-50 hover:bg-orange-100 border-l-4 border-orange-400":"hover:bg-purple-50"}`,children:[u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsx("div",{className:`w-12 h-12 rounded-xl flex flex-col items-center justify-center font-bold text-white shadow-sm ${Ae.status==="pending_reschedule"||Ae.type==="consultation"?"bg-orange-400":"bg-purple-600"}`,children:Ae.status==="pending_reschedule"?u.jsx(To,{size:24}):u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"text-xs uppercase opacity-80",children:new Date(Ae.date).toLocaleDateString("en-GB",{weekday:"short"})}),u.jsx("span",{className:"text-lg",children:new Date(Ae.date).getDate()})]})}),u.jsxs("div",{children:[u.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[Ae.student,Ae.status==="pending_reschedule"&&u.jsx("span",{className:"text-xs bg-orange-200 text-orange-800 px-2 py-0.5 rounded-full",children:"Reschedule Request"})]}),Ae.status==="pending_reschedule"?u.jsxs("div",{className:"text-sm",children:[u.jsxs("div",{className:"text-gray-500 line-through text-xs",children:["Current: ",new Date(Ae.date).toLocaleDateString("en-GB")," at ",At(Ae.time)]}),u.jsxs("div",{className:"text-orange-700 font-bold",children:["Requested: ",new Date(Ae.requestedDate).toLocaleDateString("en-GB")," at ",At(Ae.requestedTime)]})]}):u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mt-1 text-xs",children:u.jsx("span",{className:"font-black text-gray-400 uppercase tracking-widest",children:"Lesson type"})}),u.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[u.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-2",children:[u.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-bold uppercase ${Ae.type==="consultation"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`,children:Ae.type==="consultation"?"FREE MEETING":(Ae.subject||Ae.topic||"Lesson").toUpperCase()}),new Date(Ae.date).toLocaleDateString("en-GB")," at ",At(Ae.time)]}),Ae.type!=="consultation"&&u.jsx("div",{className:"flex items-center",title:Ae.paymentStatus?.toLowerCase()==="paid"?"Paid":"Payment Due",children:Ae.paymentStatus?.toLowerCase()==="paid"?u.jsx(Is,{size:16,className:"text-green-500"}):u.jsx(To,{size:16,className:"text-orange-500"})})]}),u.jsxs("div",{className:"mt-1 text-xs",children:[u.jsx("span",{className:"font-black text-gray-400 uppercase tracking-widest",children:"Notes for teacher"}),u.jsx("p",{className:"text-gray-600 bg-gray-50 rounded-lg px-2 py-1.5 mt-0.5 border border-gray-100 min-h-[2rem]",children:Ae.lessonNotes||""})]}),u.jsxs("div",{className:"mt-1 text-xs",children:[u.jsx("span",{className:"font-black text-gray-400 uppercase tracking-widest",children:"My comments (private)"}),u.jsx(Uw,{bookingId:Ae.id,initialValue:(()=>{try{const Ze=localStorage.getItem("tutor_teacher_notes");return(Ze?JSON.parse(Ze):{})[Ae.id]||""}catch{return""}})()})]})]})]})]}),u.jsx("div",{className:"flex items-center gap-2",children:Ae.status==="pending_reschedule"?u.jsxs(u.Fragment,{children:[u.jsxs("button",{onClick:()=>ml(Ae),className:"bg-green-500 text-white px-3 py-2 rounded-lg font-bold hover:bg-green-600 shadow-md transition-all flex items-center gap-1 text-sm",title:"Approve",children:[u.jsx(r_,{size:16})," Approve"]}),u.jsxs("button",{onClick:()=>si(Ae),className:"bg-red-500 text-white px-3 py-2 rounded-lg font-bold hover:bg-red-600 shadow-md transition-all flex items-center gap-1 text-sm",title:"Deny",children:[u.jsx(xh,{size:16})," Deny"]})]}):Ae.status==="pending_student_approval"?u.jsx("span",{className:"text-xs font-bold text-orange-500 bg-orange-100 px-3 py-2 rounded-lg",children:"Pending Student Approval"}):u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:()=>gi(Ae),className:"bg-gray-100 text-gray-600 px-3 py-2 rounded-lg font-bold hover:bg-gray-200 transition-all flex items-center gap-2 text-sm",title:"Reschedule",children:u.jsx(ei,{size:16})}),(()=>{const Ze=Ae.recurringId?st.filter(Dn=>Dn.recurringId===Ae.recurringId&&Dn.status!=="cancelled").sort((Dn,Ot)=>new Date(Dn.date+"T"+Dn.time)-new Date(Ot.date+"T"+Ot.time)):[],Ct=Ze.length===10&&Ze[0]&&(Ze[0].paymentStatus||"").toLowerCase()==="paid",Lt=Ze.length===10,fn=Ae.type==="consultation"||Ae.paymentStatus==="Due (Exception)"||(Lt?Ct:Ae.paymentStatus?.toLowerCase()==="paid"||Ae.paymentStatus==="Due");return u.jsxs("button",{onClick:()=>fn&&(()=>{const Dn=`${window.location.origin}/session/${Ae.id}?host=true&name=${encodeURIComponent(Ae.student)}&type=${Ae.type||"lesson"}`;window.open(Dn,"_blank")})(),disabled:!fn,title:fn?void 0:"Initial payment for this pack required before starting",className:`px-3 py-2 rounded-lg font-bold shadow-md transition-all flex items-center gap-1 text-sm ${fn?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:[u.jsx(dl,{size:16})," ",Ae.type==="consultation"?"Start Meeting":"Start Lesson"]})})(),Ae.paymentStatus?.toLowerCase()!=="paid"&&Ae.paymentStatus?.toLowerCase()!=="due (exception)"&&Ae.type!=="consultation"&&u.jsxs("button",{onClick:()=>Bo(Ae),className:"bg-orange-100 text-orange-600 px-3 py-2 rounded-lg font-bold hover:bg-orange-200 transition-all flex items-center gap-1 text-sm",title:"Allow student to join before paying",children:[u.jsx(Ru,{size:16})," Allow Pay Later"]}),u.jsxs("button",{onClick:()=>Qe(Ae),className:"bg-red-100 text-red-600 px-3 py-2 rounded-lg font-bold hover:bg-red-200 transition-all flex items-center gap-1 text-sm",children:[u.jsx(xh,{size:16})," Cancel"]})]})})]},Ie))})})()})]})]}):o==="slots"?u.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 animate-in slide-in-from-right-4 duration-300",children:[u.jsxs("div",{className:"flex justify-between items-start mb-6",children:[u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Availability Calendar"}),u.jsx("p",{className:"text-gray-500",children:"Manage your lesson slots and bookings."})]}),u.jsxs("div",{className:"flex flex-col gap-2",children:[u.jsxs("button",{onClick:()=>ue(!0),className:"flex items-center gap-2 px-4 py-2 bg-teal-100 hover:bg-teal-200 text-teal-700 rounded-lg font-bold transition-colors whitespace-nowrap",children:[u.jsx(cf,{size:18})," Book Individual Lesson"]}),u.jsxs("button",{onClick:()=>Ut(!0),className:"flex items-center gap-2 px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg font-bold transition-colors whitespace-nowrap",children:[u.jsx(ll,{size:18})," Book Recurring Lessons"]}),u.jsxs("button",{onClick:()=>gt(!0),className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-bold transition-colors whitespace-nowrap",children:[u.jsx(D2,{size:18})," Availability"]})]})]}),u.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[u.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[u.jsx("h3",{className:"text-xl font-bold text-gray-800",children:Ke.toLocaleDateString("en-GB",{month:"long",year:"numeric"})}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>zn(-1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:u.jsx(i_,{size:24,className:"text-gray-600"})}),u.jsx("button",{onClick:()=>zn(1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:u.jsx(Ef,{size:24,className:"text-gray-600"})})]})]}),u.jsx("div",{className:"grid grid-cols-7 border-b border-gray-100",children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(te=>u.jsx("div",{className:"p-4 text-center text-xs font-bold text-gray-400 uppercase bg-gray-50 border-r border-gray-100 last:border-r-0",children:te},te))}),u.jsx("div",{className:"grid grid-cols-7",children:ji(Ke).map((te,Se)=>{if(!te)return u.jsx("div",{className:"bg-gray-50/30 border-r border-gray-100 border-b min-h-[120px]"},Se);const Ve=te.toISOString().split("T")[0],Ae=st.filter(Ft=>Ft.date===Ve&&Ft.status!=="cancelled"),Ie=ve.filter(Ft=>Ft.date===Ve),Ze=Ie.filter(Ft=>!Ft.bookedBy&&!Ae.some(ms=>ms.time===Ft.time)),Ct=Ie.filter(Ft=>Ft.bookedBy&&!Ae.some(ms=>ms.time===Ft.time)).map(Ft=>({id:Ft.id,date:Ft.date,time:Ft.time,student:Ft.bookedBy,status:"confirmed_fallback",isFallback:!0})),Lt=[...Ae,...Ct],fn=new Date().toDateString()===te.toDateString(),Dn=te<new Date().setHours(0,0,0,0),Ot=Ft=>{const ms=["bg-blue-100 text-blue-800 border-blue-200","bg-green-100 text-green-800 border-green-200","bg-purple-100 text-purple-800 border-purple-200","bg-pink-100 text-pink-800 border-pink-200","bg-orange-100 text-orange-800 border-orange-200","bg-teal-100 text-teal-800 border-teal-200","bg-indigo-100 text-indigo-800 border-indigo-200"];let bn=0;for(let us=0;us<Ft.length;us++)bn=Ft.charCodeAt(us)+((bn<<5)-bn);return ms[Math.abs(bn)%ms.length]};return u.jsxs("div",{onClick:()=>X(te),className:`relative min-h-[120px] p-2 border-r border-b border-gray-100 transition-colors cursor-pointer group hover:bg-purple-50 ${fn?"bg-purple-50/30":""}`,children:[u.jsxs("div",{className:"flex justify-between items-start mb-2",children:[u.jsx("span",{className:`text-sm font-bold ${fn?"bg-purple-600 text-white w-7 h-7 flex items-center justify-center rounded-full":"text-gray-700"}`,children:te.getDate()}),Dn&&u.jsx("span",{className:"text-[10px] text-gray-300 font-bold uppercase",children:"Past"})]}),u.jsxs("div",{className:"space-y-1 overflow-hidden",children:[Lt.slice(0,3).map(Ft=>u.jsxs("div",{onClick:ms=>{ms.stopPropagation(),Ft.isFallback||gi(Ft)},className:`text-[10px] px-2 py-1 rounded truncate font-bold border transition-all cursor-pointer hover:scale-105 ${Ot(Ft.student)}`,title:Ft.isFallback?"Fallback Data":"Click to Reschedule",children:[At(Ft.time)," ",Ft.type==="consultation"?"FREE: ":"LESSON: ",Ft.student]},Ft.id)),Ze.slice(0,Math.max(0,3-Lt.length)).map(Ft=>u.jsxs("div",{className:"text-[10px] px-2 py-1 rounded truncate font-bold bg-white text-purple-400 border border-purple-200 border-dashed hover:bg-purple-50 hover:border-purple-300 transition-colors",children:[At(Ft.time)," Open"]},Ft.id)),Lt.length+Ze.length>3&&u.jsxs("div",{className:"text-[10px] text-gray-400 font-bold pl-1",children:["+",Lt.length+Ze.length-3," more"]})]})]},Se)})})]}),u.jsxs("div",{className:"mt-8 p-4 bg-blue-50 text-blue-800 rounded-xl flex items-start gap-3",children:[u.jsx("div",{className:"text-2xl",children:""}),u.jsxs("div",{className:"text-sm",children:[u.jsx("p",{className:"font-bold",children:"How Availability Works:"}),u.jsxs("p",{children:["1. ",u.jsx("strong",{children:"Weekly Schedule:"}),' Click "Schedule & Availability" to set your recurring weekly hours. This applies to ',u.jsx("strong",{children:"BOTH"})," Consultations and Lessons."]}),u.jsxs("p",{children:["2. ",u.jsx("strong",{children:"Smart Blocking:"})," Booking a 1-hour lesson automatically blocks the corresponding 15-min consultation slots, and vice-versa."]})]})]})]}):o==="earnings"?u.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[u.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-[#10b981] p-8 rounded-2xl shadow-lg text-white",children:[u.jsx("div",{className:"text-sm font-bold uppercase tracking-wider mb-4",children:"Earned This Month"}),u.jsxs("div",{className:"text-5xl font-black mb-2",children:["",dt]}),u.jsx("div",{className:"text-sm opacity-90 font-medium",children:"Received payments"})]}),u.jsxs("div",{className:"bg-[#a855f7] p-8 rounded-2xl shadow-lg text-white",children:[u.jsx("div",{className:"text-sm font-bold uppercase tracking-wider mb-4",children:"Projected This Month"}),u.jsxs("div",{className:"text-5xl font-black mb-2",children:["",sn]}),u.jsxs("div",{className:"text-sm opacity-90 font-medium",children:[Un," lessons booked"]})]}),u.jsxs("div",{className:"bg-[#f97316] p-8 rounded-2xl shadow-lg text-white",children:[u.jsx("div",{className:"text-sm font-bold uppercase tracking-wider mb-4",children:"Outstanding Balance"}),u.jsxs("div",{className:"text-5xl font-black mb-2",children:["",er]}),u.jsx("div",{className:"text-sm opacity-90 font-medium",children:"Money owed (Completed work)"})]})]}),u.jsxs("div",{className:"bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden",children:[u.jsxs("div",{className:"p-6 border-b border-gray-50 flex items-center gap-3",children:[u.jsx("div",{className:"bg-fuchsia-50 p-2 rounded-lg",children:u.jsx(w1,{className:"text-fuchsia-600",size:24})}),u.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Financial Summary"})]}),u.jsxs("div",{className:"p-8 space-y-6",children:[u.jsxs("div",{className:"flex items-center justify-between group",children:[u.jsx("span",{className:"text-gray-500 font-medium",children:"Total Paid (All Time)"}),u.jsxs("span",{className:"text-2xl font-black text-[#10b981]",children:["",Rt]})]}),u.jsx("div",{className:"h-px bg-gray-50"}),u.jsxs("div",{className:"flex items-center justify-between group",children:[u.jsx("span",{className:"text-gray-500 font-medium",children:"Upcoming / Booked Lessons"}),u.jsxs("div",{className:"text-right",children:[u.jsxs("span",{className:"text-2xl font-black text-[#6366f1]",children:["",wn]}),u.jsxs("span",{className:"text-sm text-gray-400 ml-2 font-bold",children:["(",Pn.length," lessons)"]})]})]}),u.jsx("div",{className:"h-px bg-gray-50"}),u.jsxs("div",{className:"flex items-center justify-between group",children:[u.jsx("span",{className:"text-gray-500 font-medium",children:"Total Predicted Revenue (Paid + Upcoming)"}),u.jsxs("span",{className:"text-2xl font-black text-purple-600",children:["",Rt+wn]})]})]})]}),u.jsxs("div",{className:"bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden",children:[u.jsxs("div",{className:"p-6 border-b border-gray-50 flex flex-wrap items-center justify-between gap-4",children:[u.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-3",children:[u.jsx(dl,{className:"text-indigo-500"})," Upcoming Scheduled Lessons"]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("select",{value:ut,onChange:te=>re(te.target.value),className:"rounded-xl border-2 border-gray-100 px-4 py-2 font-bold text-sm text-gray-800 bg-white focus:border-indigo-500",children:(()=>{const te=new Date;`${te.getFullYear()}${String(te.getMonth()+1).padStart(2,"0")}`;const Se=new Set(Pn.map(Ie=>{const Ze=new Date(Ie.date);return`${Ze.getFullYear()}-${String(Ze.getMonth()+1).padStart(2,"0")}`})),Ve=Array.from({length:6},(Ie,Ze)=>{const Ct=new Date(te.getFullYear(),te.getMonth()+Ze,1);return`${Ct.getFullYear()}-${String(Ct.getMonth()+1).padStart(2,"0")}`});return[...new Set([...Ve,...Se])].sort().map(Ie=>{const[Ze,Ct]=Ie.split("-").map(Number);return u.jsx("option",{value:Ie,children:new Date(Ze,Ct-1,1).toLocaleDateString("en-GB",{month:"long",year:"numeric"})},Ie)})})()}),u.jsxs("span",{className:"bg-indigo-50 text-indigo-600 text-xs font-bold px-3 py-1 rounded-full",children:[(()=>{const[te,Se]=(ut||"").split("-").map(Number);return Pn.filter(Ve=>{const Ae=new Date(Ve.date);return Ae.getFullYear()===te&&Ae.getMonth()+1===Se}).length})()," Lessons"]})]})]}),u.jsx("div",{className:"p-0",children:(()=>{const[te,Se]=(ut||"").split("-").map(Number),Ve=Pn.filter(Ae=>{const Ie=new Date(Ae.date);return Ie.getFullYear()===te&&Ie.getMonth()+1===Se});return Ve.length===0?u.jsx("div",{className:"p-12 text-center text-gray-400 italic",children:"No upcoming sessions for this month."}):u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"w-full",children:[u.jsx("thead",{children:u.jsxs("tr",{className:"bg-gray-50/50 text-left border-b border-gray-50",children:[u.jsx("th",{className:"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Date & Time"}),u.jsx("th",{className:"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Student"}),u.jsx("th",{className:"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Subject"}),u.jsx("th",{className:"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"My notes (private)"}),u.jsx("th",{className:"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest text-right",children:"Fee"}),u.jsx("th",{className:"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest text-right",children:"Actions"})]})}),u.jsx("tbody",{className:"divide-y divide-gray-50",children:Ve.map(Ae=>u.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[u.jsxs("td",{className:"px-6 py-4",children:[u.jsx("div",{className:"font-bold text-gray-900",children:new Date(Ae.date).toLocaleDateString("en-GB",{day:"numeric",month:"short"})}),u.jsx("div",{className:"text-xs text-indigo-500 font-medium uppercase tracking-tighter",children:Ae.time})]}),u.jsx("td",{className:"px-6 py-4",children:u.jsxs("div",{className:"flex flex-col gap-0.5",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"font-bold text-gray-700",children:Ae.student}),Ae.type!=="consultation"&&(()=>{const Ie=Ae.recurringId?st.filter(Lt=>Lt.recurringId===Ae.recurringId&&Lt.status!=="cancelled").sort((Lt,fn)=>new Date(Lt.date+"T"+Lt.time)-new Date(fn.date+"T"+fn.time)):[],Ct=Ie.length===10&&Ie[0]&&(Ie[0].paymentStatus||"").toLowerCase()==="paid"?"Paid in bulk":"Awaiting initial payment";return u.jsx("span",{title:Ae.paymentStatus?.toLowerCase()==="paid"?"Paid":Ae.paymentStatus==="In bundle"?Ct:"Payment Due",children:Ae.paymentStatus?.toLowerCase()==="paid"?u.jsx(Is,{size:14,className:"text-green-500"}):Ae.paymentStatus==="In bundle"?u.jsx("span",{className:"text-[10px] text-teal-600 font-bold",children:Ct}):u.jsx(To,{size:14,className:"text-orange-500"})})})()]}),(()=>{if(!Ae.recurringId)return null;const Ie=st.filter(Lt=>Lt.recurringId===Ae.recurringId&&Lt.status!=="cancelled").sort((Lt,fn)=>new Date(Lt.date+"T"+Lt.time)-new Date(fn.date+"T"+fn.time));if(Ie.length!==10)return null;const Ze=Ie.findIndex(Lt=>Lt.id===Ae.id),Ct=Ze>=0?Ze+1:null;return Ct?u.jsxs("span",{className:"text-xs text-teal-600 font-bold",children:["Lesson ",Ct,"/10"]}):null})()]})}),u.jsx("td",{className:"px-6 py-4 text-sm font-bold text-purple-600",children:Ae.subject||Ae.topic||"Lesson"}),u.jsx("td",{className:"px-6 py-2 align-top max-w-[200px]",children:u.jsx(Uw,{bookingId:Ae.id,initialValue:(()=>{try{const Ie=localStorage.getItem("tutor_teacher_notes");return(Ie?JSON.parse(Ie):{})[Ae.id]||""}catch{return""}})()})}),u.jsx("td",{className:"px-6 py-4 text-right",children:u.jsxs("span",{className:"font-black text-gray-900",children:["",Ae.paymentStatus==="In bundle"||Ae.cost===0?0:Ae.cost??pt(Ae.subject||Ae.topic)]})}),u.jsx("td",{className:"px-6 py-4 text-right",children:u.jsx("button",{onClick:()=>Qe(Ae),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all",title:"Cancel Booking",children:u.jsx(Kl,{size:16})})})]},Ae.id))})]})})})()})]}),u.jsxs("div",{children:[u.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-6 flex items-center gap-3",children:[u.jsx(ll,{className:"text-purple-600"})," 3-Month Revenue Projection"]}),u.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:jt.map((te,Se)=>u.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-sm border border-gray-100 hover:border-purple-200 transition-all group relative overflow-hidden",children:[Se===0&&u.jsx("div",{className:"absolute top-4 right-4 bg-purple-50 text-purple-600 text-[10px] font-black px-2 py-0.5 rounded-full uppercase tracking-widest border border-purple-100",children:"Current"}),u.jsx("h3",{className:"font-bold text-gray-900 text-lg mb-6",children:te.monthName}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"text-sm font-medium text-gray-400",children:"Booked Lessons"}),u.jsx("span",{className:"font-black text-gray-700",children:te.bookedLessons})]}),u.jsxs("div",{className:"flex justify-between items-center text-teal-600",children:[u.jsx("span",{className:"text-sm font-medium text-teal-600/60",children:"Consultations"}),u.jsx("span",{className:"font-black",children:te.consultations})]}),u.jsxs("div",{className:"pt-4 mt-2 border-t border-gray-50 flex justify-between items-end",children:[u.jsx("span",{className:"text-sm font-bold text-gray-900",children:"Projected"}),u.jsxs("span",{className:"text-3xl font-black text-purple-600",children:["",te.projectedEarnings]})]})]})]},Se))})]}),u.jsxs("div",{className:"bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden",children:[u.jsx("div",{className:"p-6 border-b border-gray-50 flex items-center justify-between",children:u.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-3 font-display",children:[u.jsx(ei,{className:"text-blue-500"})," Recent Sessions"]})}),u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"w-full",children:[u.jsx("thead",{children:u.jsxs("tr",{className:"bg-gray-50/50",children:[u.jsx("th",{className:"px-6 py-4 text-left text-xs font-black text-gray-400 uppercase tracking-widest",children:"Date"}),u.jsx("th",{className:"px-6 py-4 text-left text-xs font-black text-gray-400 uppercase tracking-widest",children:"Student"}),u.jsx("th",{className:"px-6 py-4 text-left text-xs font-black text-gray-400 uppercase tracking-widest",children:"Amount"}),u.jsx("th",{className:"px-6 py-4 text-left text-xs font-black text-gray-400 uppercase tracking-widest",children:"Status"}),u.jsx("th",{className:"px-6 py-4 text-right text-xs font-black text-gray-400 uppercase tracking-widest",children:"Action"})]})}),u.jsx("tbody",{className:"divide-y divide-gray-50",children:Et.length===0?u.jsx("tr",{children:u.jsx("td",{colSpan:"5",className:"px-6 py-12 text-center text-gray-400 font-medium",children:"No completed sessions yet."})}):Et.slice(-10).reverse().map((te,Se)=>u.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[u.jsx("td",{className:"px-6 py-4 text-sm font-bold text-gray-600",children:new Date(te.date).toLocaleDateString("en-GB")}),u.jsx("td",{className:"px-6 py-4 text-sm font-black text-gray-900",children:te.studentName||te.student}),u.jsxs("td",{className:"px-6 py-4 text-sm font-black text-gray-900",children:["",te.cost||30]}),u.jsx("td",{className:"px-6 py-4",children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest shadow-sm ${te.paymentStatus==="Paid"?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"}`,children:te.paymentStatus||"Due"}),te.paymentStatus!=="Paid"&&te.paymentStatus!=="Due (Exception)"&&u.jsx("button",{onClick:()=>Bo(te),className:"p-1 text-orange-400 hover:text-orange-600 transition-colors",title:"Allow Pay Later",children:u.jsx(Ru,{size:14})})]})}),u.jsx("td",{className:"px-6 py-4 text-right",children:u.jsxs("button",{className:"text-xs font-bold text-purple-600 hover:text-purple-700 underline flex items-center gap-1 ml-auto",children:["View Details ",u.jsx(Jl,{size:12})]})})]},Se))})]})})]})]}):o==="messages"?u.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4 duration-300",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[u.jsx(Hc,{className:"text-blue-500"})," Messages"]}),u.jsxs("div",{className:"bg-gray-100 p-1 rounded-xl flex gap-1",children:[u.jsx("button",{onClick:()=>{h("student"),k(null)},className:`px-4 py-2 rounded-lg text-sm font-bold transition-all ${d==="student"?"bg-white text-purple-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Students"}),u.jsx("button",{onClick:()=>{h("parent"),k(null)},className:`px-4 py-2 rounded-lg text-sm font-bold transition-all ${d==="parent"?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Parents"})]})]}),u.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden flex",style:{height:"600px"},children:[u.jsxs("div",{className:"w-1/3 border-r border-gray-200 overflow-y-auto",children:[u.jsx("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:u.jsx("h3",{className:"font-bold text-gray-700 text-sm uppercase",children:d==="student"?"Students":"Parents"})}),d==="student"?p.length===0?u.jsx("div",{className:"p-8 text-center text-gray-400 italic text-sm",children:"No students yet"}):u.jsx("div",{className:"divide-y divide-gray-100",children:p.map(te=>{const Se=te.name,Ve=(w[Se]||[]).filter(Ae=>Ae.sender!=="Davina"&&!Ae.read).length;return u.jsx("button",{onClick:()=>k({...te,threadKey:Se}),className:`w-full p-4 text-left hover:bg-gray-50 transition-colors ${E?.id===te.id?"bg-purple-50 border-l-4 border-purple-500":""}`,children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-10 h-10 bg-purple-100 text-purple-700 rounded-full flex items-center justify-center font-bold",children:te.name.charAt(0).toUpperCase()}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"font-bold text-gray-800 truncate",children:te.name}),u.jsx("span",{className:"text-[9px] font-black text-purple-600 bg-purple-50 px-1.5 py-0.5 rounded uppercase",children:"Student"})]}),u.jsx("div",{className:"text-xs text-gray-500 truncate",children:(w[Se]||[]).length>0?w[Se][w[Se].length-1].message:"No messages yet"})]}),Ve>0&&u.jsx("span",{className:"bg-red-500 text-white text-[10px] min-w-[1.25rem] h-5 px-1.5 py-0.5 rounded-full font-bold flex items-center justify-center",title:`${Ve} unread from student`,children:Ve})]})},te.id)})}):(()=>{const te=JSON.parse(localStorage.getItem("tutor_parents"))||[];return te.length===0?u.jsx("div",{className:"p-8 text-center text-gray-400 italic text-sm",children:"No parents yet"}):u.jsx("div",{className:"divide-y divide-gray-100",children:te.map(Se=>{const Ve=`parent_${Se.email}`,Ae=(w[Ve]||[]).filter(Ie=>Ie.sender!=="Davina"&&!Ie.read).length;return u.jsx("button",{onClick:()=>k({name:Se.name,firstName:Se.firstName,email:Se.email,id:Se.email,threadKey:Ve}),className:`w-full p-4 text-left hover:bg-gray-50 transition-colors ${E?.id===Se.email?"bg-blue-50 border-l-4 border-blue-500":""}`,children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-10 h-10 bg-blue-100 text-blue-700 rounded-full flex items-center justify-center font-bold",children:Se.name?.charAt(0).toUpperCase()||"?"}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"font-bold text-gray-800 truncate",children:Se.firstName||Se.name}),u.jsx("span",{className:"text-[9px] font-black text-blue-600 bg-blue-50 px-1.5 py-0.5 rounded uppercase",children:"Parent"})]}),u.jsxs("div",{className:"text-[10px] text-blue-600 font-bold uppercase tracking-wider mb-1",children:["Child: ",p.filter(Ie=>Se.linkedStudents.includes(Ie.id)).map(Ie=>Ie.name).join(", ")||"Unknown"]}),u.jsx("div",{className:"text-xs text-gray-500 truncate",children:(w[Ve]||[]).length>0?w[Ve][w[Ve].length-1].message:"No messages yet"})]}),Ae>0&&u.jsx("span",{className:"bg-red-500 text-white text-[10px] min-w-[1.25rem] h-5 px-1.5 py-0.5 rounded-full font-bold flex items-center justify-center",title:`${Ae} unread from parent`,children:Ae})]})},Se.email)})})})()]}),u.jsx("div",{className:"flex-1 flex flex-col",children:E?u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"p-4 bg-gray-50 border-b border-gray-200 flex items-center gap-3",children:[u.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold ${d==="parent"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:E.name?.charAt(0).toUpperCase()||"?"}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-bold text-gray-800",children:[E.firstName||E.name||(d==="parent"?"No name set":"Student")," ",d==="parent"&&"(Parent)"]}),u.jsx("div",{className:"text-[10px] text-blue-600 font-bold uppercase tracking-widest",children:d==="parent"?`Child: ${p.filter(te=>T.find(Se=>Se.email===E.id)?.linkedStudents.includes(te.id)).map(te=>te.name).join(", ")||"?"}`:`Student ID: ${E.id}`})]})]}),E?.threadKey?.startsWith("parent_")&&(()=>{try{const te=E.threadKey.replace("parent_",""),Se=localStorage.getItem("tutor_parent_notes")||"{}",Ae=JSON.parse(Se)[te]?.note?.trim();return Ae?u.jsxs("div",{className:"mx-6 mt-4 p-4 bg-blue-50 border border-blue-100 rounded-xl",children:[u.jsx("p",{className:"text-xs font-bold text-blue-700 uppercase tracking-wider mb-1",children:"Parent's note for you"}),u.jsx("p",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:Ae})]}):null}catch{return null}})(),u.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 bg-gray-50",children:(w[E.threadKey]||[]).length===0?u.jsx("div",{className:"h-full flex items-center justify-center text-gray-400 italic",children:"No messages yet. Start the conversation!"}):w[E.threadKey]?.map((te,Se)=>u.jsx("div",{className:`flex ${te.sender==="Davina"?"justify-end":"justify-start"} mb-4`,children:u.jsxs("div",{className:`max-w-[70%] px-4 py-3 rounded-2xl shadow-sm ${te.sender==="Davina"?"bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-br-md":"bg-white border-2 border-gray-100 text-gray-800 rounded-bl-md"}`,children:[u.jsx("div",{className:`text-xs font-bold mb-2 ${te.sender==="Davina"?"text-purple-100":"text-gray-500"}`,children:te.sender==="Davina"?"You":te.senderName||te.sender}),u.jsx("div",{className:"text-base leading-relaxed",children:te.message}),u.jsx("div",{className:`text-xs mt-2 ${te.sender==="Davina"?"text-purple-100":"text-gray-400"}`,children:new Date(te.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},Se))}),u.jsx("div",{className:"p-4 bg-white border-t border-gray-200",children:u.jsxs("div",{className:"flex gap-2",children:[u.jsx("input",{type:"text",value:_,onChange:te=>N(te.target.value),onKeyPress:te=>{if(te.key==="Enter"&&_.trim()&&E){const Se={sender:"Davina",message:_,timestamp:new Date().toISOString()},Ve={...w,[E.threadKey]:[...w[E.threadKey]||[],Se]};v(Ve),localStorage.setItem("chat_messages_v2",JSON.stringify(Ve));const Ae=_;N(""),window.dispatchEvent(new Event("storage")),E.email&&xr.sendMessageNotification("Davina",E.email,Ae)}},placeholder:"Type your message...",className:"flex-1 px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-500 outline-none"}),u.jsx("button",{onClick:()=>{if(_.trim()&&E){const te={sender:"Davina",message:_,timestamp:new Date().toISOString()},Se={...w,[E.threadKey]:[...w[E.threadKey]||[],te]};v(Se),localStorage.setItem("chat_messages_v2",JSON.stringify(Se));const Ve=_;N(""),window.dispatchEvent(new Event("storage")),E.email&&xr.sendMessageNotification("Davina",E.email,Ve)}},className:"bg-purple-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-purple-700 transition-all",children:"Send"})]})})]}):u.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-400 italic",children:"Select a student to start messaging"})})]})]}):o==="settings"?u.jsxs("div",{className:"animate-in slide-in-from-right-4 duration-300",children:[u.jsx("div",{className:"flex items-center justify-between mb-8",children:u.jsxs("div",{children:[u.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[u.jsx(D2,{className:"text-gray-600"})," Settings & Data"]}),u.jsx("p",{className:"text-gray-500",children:"Manage your data and cloud synchronization."})]})}),u.jsxs("div",{className:"max-w-2xl space-y-6",children:[u.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg border border-gray-100",children:[u.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-2 flex items-center gap-2",children:[u.jsx(rh,{size:20,className:"text-purple-600"})," Student lesson type"]}),u.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Set the lesson type (and pricing) for each student. This updates what they see on their dashboard. If they chose wrong at signup, change it here."}),u.jsxs("div",{className:"space-y-3",children:[p.map(te=>u.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-xl border border-gray-100",children:[u.jsx("span",{className:"font-bold text-gray-800 min-w-[120px]",children:te.name}),u.jsx("select",{value:lt.includes(te.subject)?te.subject:lt[0],onChange:Se=>{const Ve=Se.target.value,Ie=JSON.parse(localStorage.getItem("tutor_students")||"[]").map(Lt=>Lt.id===te.id?{...Lt,subject:Ve}:Lt);localStorage.setItem("tutor_students",JSON.stringify(Ie)),g(Ie);const Ct=JSON.parse(localStorage.getItem("tutor_bookings")||"[]").map(Lt=>(Lt.student===te.name||Lt.studentName===te.name)&&Lt.status!=="cancelled"?{...Lt,subject:Ve}:Lt);localStorage.setItem("tutor_bookings",JSON.stringify(Ct)),St(Ct),window.dispatchEvent(new Event("storage"))},className:"flex-1 max-w-[220px] rounded-xl border-2 border-purple-100 px-3 py-2 font-bold text-gray-800 focus:border-purple-500 outline-none",children:lt.map(Se=>u.jsxs("option",{value:Se,children:[Se,"  ",pt(Se),"/hr"]},Se))}),u.jsxs("span",{className:"text-xs text-gray-500",children:["",pt(lt.includes(te.subject)?te.subject:lt[0]),"/hr"]})]},te.id)),p.length===0&&u.jsx("p",{className:"text-gray-400 italic text-sm",children:"No students yet. Add students in the Students tab."})]})]}),u.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-lg border border-gray-100",children:u.jsx(nT,{})}),u.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg border border-red-100",children:[u.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-2",children:"Clear all test data"}),u.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Remove all students, parents, bookings, lesson slots, chats and session history from this browser and (if using Supabase) from the database. Dashboards will stay the same but will be empty."}),u.jsx("button",{type:"button",onClick:async()=>{if(!window.confirm("Permanently delete ALL students, parents, bookings, slots, chats and session history? This cannot be undone."))return;["tutor_students","tutor_parents","tutor_bookings","tutor_lesson_slots","tutor_slots","tutor_all_lesson_slots","chat_messages_v2","tutor_student_pins","tutor_student_extras","tutor_session_history"].forEach(Se=>localStorage.removeItem(Se)),g([]),P([]),St([]),Re([]),me([]),v({}),vt([]),k(null),F(null);try{if($r.isUsingBackend){const Se=await $r.getStudents();for(const Ve of Se)await $r.deleteStudent(Ve.id).catch(()=>{})}}catch{}window.dispatchEvent(new Event("storage")),xe({type:"success",message:"All test data cleared."})},className:"px-4 py-2 bg-red-100 text-red-700 rounded-xl font-bold hover:bg-red-200 transition-colors",children:"Clear all data"})]})]})]}):null,ke&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-start justify-center p-4 overflow-y-auto pt-8 pb-8",onClick:()=>X(null),children:u.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-2xl max-w-2xl w-full animate-in zoom-in-95",onClick:te=>te.stopPropagation(),children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h3",{className:"text-xl font-bold text-gray-900",children:ke.toLocaleDateString("en-GB",{weekday:"long",month:"long",day:"numeric"})}),u.jsx("button",{onClick:()=>X(null),className:"p-2 hover:bg-gray-100 rounded-full text-gray-400",children:""})]}),u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase mb-3",children:"Booked Lessons"}),u.jsx("div",{className:"space-y-2",children:(()=>{const te=ke.toISOString().split("T")[0],Se=st.filter(Ie=>Ie.date===te&&Ie.status!=="cancelled"),Ve=ve.filter(Ie=>Ie.date===te&&Ie.bookedBy&&!Se.some(Ze=>Ze.time===Ie.time)).map(Ie=>({id:Ie.id,date:Ie.date,time:Ie.time,student:Ie.bookedBy,status:"confirmed_fallback",isFallback:!0})),Ae=[...Se,...Ve];return Ae.length===0?u.jsx("p",{className:"text-sm text-gray-400 italic text-center py-2",children:"No bookings for this date."}):Ae.map(Ie=>u.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-xl border border-purple-100",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-bold text-gray-800 flex items-center gap-2",children:[Ie.student,Ie.isFallback&&u.jsx("span",{className:"text-[10px] bg-gray-200 text-gray-600 px-1.5 py-0.5 rounded font-bold",children:"Slot"}),!Ie.isFallback&&Ie.bookingFor&&u.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-bold ${Ie.bookingFor==="pupil"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:Ie.bookingFor==="pupil"?" Pupil":" Parent"})]}),u.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[u.jsx(ei,{size:12})," ",At(Ie.time),!Ie.isFallback&&Ie.status==="pending_reschedule"&&u.jsx("span",{className:"text-orange-500 font-bold ml-1",children:"(Rescheduling)"})]})]}),u.jsx("div",{className:"flex gap-2",children:Ie.isFallback?u.jsx("button",{onClick:()=>{if(window.confirm(`Remove this lesson slot with ${Ie.student}?`)){const Ze=ve.map(Ct=>Ct.id===Ie.id?{...Ct,bookedBy:null}:Ct);Re(Ze),localStorage.setItem("tutor_lesson_slots",JSON.stringify(Ze)),window.dispatchEvent(new Event("storage")),X(null)}},className:"bg-red-100 text-red-600 border border-red-200 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-red-600 hover:text-white transition-all shadow-sm",children:"Remove"}):u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:()=>{X(null),gi(Ie)},className:"bg-white text-purple-600 border border-purple-200 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-purple-600 hover:text-white transition-all shadow-sm",children:"Reschedule"}),u.jsx("button",{onClick:()=>{if(window.confirm(`Cancel lesson with ${Ie.student}?`)){const Ze=st.map(Ct=>Ct.id===Ie.id?{...Ct,status:"cancelled"}:Ct);St(Ze),localStorage.setItem("tutor_bookings",JSON.stringify(Ze)),window.dispatchEvent(new Event("storage")),xr.sendCancellationNotice(Ie,"teacher"),X(null)}},className:"bg-red-100 text-red-600 border border-red-200 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-red-600 hover:text-white transition-all shadow-sm",children:"Cancel"}),Ie.recurringId&&u.jsx("button",{onClick:()=>{if(window.confirm(`Delete ALL future lessons in this series for ${Ie.student}?`)){const Ze=new Date,Ct=st.filter(fn=>fn.recurringId===Ie.recurringId&&new Date(fn.date+"T"+fn.time)>=Ze),Lt=st.filter(fn=>!Ct.find(Dn=>Dn.id===fn.id));St(Lt),localStorage.setItem("tutor_bookings",JSON.stringify(Lt)),window.dispatchEvent(new Event("storage")),xr.sendCancellationNotice({...Ie,subject:`${Ie.subject} (Entire Series Cancelled)`},"teacher"),X(null)}},className:"bg-red-600 text-white border border-red-600 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-red-700 transition-all shadow-sm",children:"Cancel Series"})]})})]},Ie.id))})()}),u.jsx("div",{className:"h-px bg-gray-100 my-4"})]}),u.jsxs("div",{className:"pt-6 border-t border-gray-100",children:[u.jsx("h4",{className:"text-sm font-bold text-gray-800 mb-4",children:"Book New Lesson"}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-[10px] font-bold text-gray-400 uppercase mb-1",children:"Select Student"}),u.jsxs("select",{id:"studentSelect",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm font-bold bg-white outline-none focus:border-purple-600",children:[u.jsx("option",{value:"",children:"Select..."}),p.map(te=>u.jsx("option",{value:te.name,children:te.name},te.id))]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-[10px] font-bold text-gray-400 uppercase mb-1",children:"Time"}),u.jsx("select",{id:"bookingTime",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm font-bold bg-white outline-none focus:border-purple-600",defaultValue:"14:00",children:en.map(te=>u.jsx("option",{value:te.value,children:te.label},te.value))})]}),u.jsxs("div",{className:"col-span-2",children:[u.jsx("label",{className:"block text-[10px] font-bold text-gray-400 uppercase mb-1",children:"Subject / Topic"}),u.jsx("input",{id:"bookingSubject",type:"text",placeholder:"e.g. Algebra Revision",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm font-bold bg-white outline-none focus:border-purple-600"})]}),u.jsxs("div",{className:"col-span-2 flex items-center gap-3 bg-fuchsia-50/50 p-4 rounded-xl border border-fuchsia-100",children:[u.jsx("input",{id:"bookingRecurring",type:"checkbox",className:"w-5 h-5 rounded border-gray-300 text-fuchsia-600 focus:ring-fuchsia-500"}),u.jsx("label",{htmlFor:"bookingRecurring",className:"text-sm font-bold text-fuchsia-900",children:"Recurring Weekly (10 Weeks)"})]}),u.jsxs("button",{onClick:()=>{const te=document.getElementById("studentSelect").value,Se=document.getElementById("bookingTime").value,Ve=document.getElementById("bookingSubject").value,Ae=document.getElementById("bookingRecurring").checked;if(!te||!Se){alert("Please select a student and time");return}const Ie=[],Ze=new Date(ke),Ct=Ae?10:1,Lt=Ae?Date.now().toString():null;for(let Dn=0;Dn<Ct;Dn++){const Ot=new Date(Ze);Ot.setDate(Ze.getDate()+Dn*7),Ie.push({id:(Date.now()+Dn).toString(),student:te,date:Ot.toISOString().split("T")[0],time:Se,subject:Ve||"Individual Lesson",type:"lesson",status:"pending_approval",notes:"",recurringId:Lt,proposedBy:"teacher"})}const fn=[...st,...Ie];St(fn),localStorage.setItem("tutor_bookings",JSON.stringify(fn)),window.dispatchEvent(new Event("storage")),alert(Ae?`10 recurring lessons proposed for ${te}!`:`Lesson proposed for ${te}!`)},className:"col-span-2 py-2.5 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-xl font-bold shadow-md hover:from-purple-700 hover:to-purple-800 transition-all flex items-center justify-center gap-2",children:[u.jsx(cf,{size:18})," Propose Lesson"]})]})]}),u.jsx("div",{className:"h-px bg-gray-100 mb-6"}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase mb-3 text-center",children:"Add 1-Hour Open Slot"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs("select",{value:bt,onChange:te=>Ye(te.target.value),className:"flex-1 px-4 py-2 border border-gray-200 rounded-xl focus:border-purple-600 outline-none font-bold text-center appearance-none",children:[u.jsx("option",{value:"",children:"Select Time"}),en.map(te=>u.jsx("option",{value:te.value,children:te.label},te.value))]}),u.jsx("button",{onClick:()=>Ds(ke.toISOString().split("T")[0],bt),className:"bg-purple-600 text-white px-4 py-2 rounded-xl font-bold hover:bg-purple-700 transition-colors",children:"Add Slot"})]})]})]})]})}),Pe&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-start justify-center p-4 text-left overflow-y-auto pt-8 pb-8",onClick:te=>te.target===te.currentTarget&&gt(!1),children:u.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-2xl w-full flex flex-col animate-in zoom-in-95 max-h-[90vh]",onClick:te=>te.stopPropagation(),children:[u.jsxs("div",{className:"p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50 shrink-0",children:[u.jsxs("div",{children:[u.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Consultation Hours (Weekly)"}),u.jsx("p",{className:"text-sm text-gray-500",children:"Auto-generates 15-min consultation slots. Scroll for Saturday & Sunday."})]}),u.jsx("button",{type:"button",onClick:()=>gt(!1),className:"p-2 hover:bg-gray-200 rounded-full text-gray-400",children:""})]}),u.jsx("div",{className:"overflow-y-auto p-6 custom-scrollbar min-h-0 flex-1",children:H.map((te,Se)=>u.jsx("div",{className:`p-4 border-b border-gray-50 last:border-0 transition-colors ${te.active?"bg-white":"bg-gray-50/50 rounded-xl"}`,children:u.jsxs("div",{className:"flex items-start gap-4",children:[u.jsxs("div",{className:"w-32 flex items-center gap-3 pt-2",children:[u.jsx("button",{onClick:()=>Za(Se),className:`w-10 h-6 rounded-full transition-colors relative ${te.active?"bg-purple-600":"bg-gray-300"}`,children:u.jsx("div",{className:`absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform ${te.active?"translate-x-4":"translate-x-0"}`})}),u.jsx("span",{className:`font-bold ${te.active?"text-gray-900":"text-gray-400"}`,children:te.day})]}),te.active?u.jsxs("div",{className:"flex-1 space-y-2",children:[te.intervals.map((Ve,Ae)=>u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(ei,{size:16,className:"text-gray-400"}),u.jsx("select",{value:Ve.start,onChange:Ie=>Hr(Se,Ae,"start",Ie.target.value),className:"border border-gray-200 rounded-lg px-3 py-1.5 text-sm focus:ring-2 focus:ring-purple-500 outline-none",children:en.map(Ie=>u.jsx("option",{value:Ie.value,children:Ie.label},Ie.value))}),u.jsx("span",{className:"text-gray-400",children:"-"}),u.jsx("select",{value:Ve.end,onChange:Ie=>Hr(Se,Ae,"end",Ie.target.value),className:"border border-gray-200 rounded-lg px-3 py-1.5 text-sm focus:ring-2 focus:ring-purple-500 outline-none",children:en.map(Ie=>u.jsx("option",{value:Ie.value,children:Ie.label},Ie.value))}),u.jsx("button",{onClick:()=>Ci(Se,Ae),className:"p-1.5 text-gray-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:u.jsx(Kl,{size:14})})]},Ae)),u.jsxs("button",{onClick:()=>Tr(Se),className:"text-xs font-bold text-teal-600 hover:text-teal-700 flex items-center gap-1 mt-1",children:[u.jsx(cf,{size:14})," Add Shift"]})]}):u.jsx("span",{className:"text-sm text-gray-400 italic pt-2",children:"Unavailable"})]})},te.day))}),u.jsx("div",{className:"p-4 border-t border-gray-100 bg-gray-50 flex justify-end",children:u.jsx("button",{type:"button",onClick:()=>gt(!1),className:"px-6 py-2 bg-gray-900 text-white rounded-xl font-bold hover:bg-gray-800 transition-colors",children:"Done"})})]})}),Pt&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-start justify-center p-4 overflow-y-auto pt-8 pb-8",onClick:()=>Ut(!1),children:u.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-xl max-w-sm w-full animate-in zoom-in-95",onClick:te=>te.stopPropagation(),children:[u.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Book Recurring Lessons"}),u.jsxs("form",{onSubmit:ni,className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Student"}),u.jsxs("select",{className:"w-full px-4 py-2 rounded-xl border border-gray-200 outline-none focus:border-purple-600",value:je.studentId,required:!0,onChange:te=>Me({...je,studentId:te.target.value}),children:[u.jsx("option",{value:"",children:"Select Student"}),p.map(te=>u.jsx("option",{value:te.id,children:te.name},te.id))]})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Start Date"}),u.jsx("input",{type:"date",required:!0,className:"w-full px-4 py-2 rounded-xl border border-gray-200 outline-none focus:border-purple-600",value:je.startDate,onChange:te=>Me({...je,startDate:te.target.value})})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Time"}),u.jsxs("select",{required:!0,className:"w-full px-4 py-2 rounded-xl border border-gray-200 outline-none focus:border-purple-600 appearance-none",value:je.time,onChange:te=>Me({...je,time:te.target.value}),children:[u.jsx("option",{value:"",children:"Time"}),en.map(te=>u.jsx("option",{value:te.value,children:te.label},te.value))]})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Subject"}),u.jsxs("select",{className:"w-full px-4 py-2 rounded-xl border border-gray-200 outline-none focus:border-purple-600",value:je.subject,onChange:te=>Me({...je,subject:te.target.value}),children:[u.jsx("option",{value:"Maths KS3",children:"Maths KS3"}),u.jsx("option",{value:"Maths GCSE",children:"Maths GCSE"}),u.jsx("option",{value:"Sociology GCSE",children:"Sociology GCSE"}),u.jsx("option",{value:"Sociology A-Level",children:"Sociology A-Level"}),u.jsx("option",{value:"Other",children:"Other"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Duration"}),u.jsxs("select",{className:"w-full px-4 py-2 rounded-xl border border-gray-200 outline-none focus:border-purple-600",value:je.weeks,onChange:te=>Me({...je,weeks:Number(te.target.value)}),children:[u.jsx("option",{value:4,children:"4 Weeks"}),u.jsx("option",{value:8,children:"8 Weeks"}),u.jsx("option",{value:10,children:"10 Weeks"}),u.jsx("option",{value:12,children:"12 Weeks"})]}),je.weeks===10&&u.jsx("p",{className:"mt-1.5 text-xs text-gray-500 font-medium",children:"280 for 10 lessons"})]}),u.jsx("button",{type:"submit",className:"w-full py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700 transition-all mt-2",children:"Confirm Booking"})]})]})}),Fe&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-start justify-center p-4 overflow-y-auto pt-8 pb-8",onClick:()=>ue(!1),children:u.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-xl max-w-sm w-full animate-in zoom-in-95",onClick:te=>te.stopPropagation(),children:[u.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Book Individual Lesson"}),u.jsxs("form",{onSubmit:ki,className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Student"}),u.jsxs("select",{className:"w-full px-4 py-2 rounded-xl border border-gray-200 outline-none focus:border-teal-600",value:Te.studentId,required:!0,onChange:te=>Oe({...Te,studentId:te.target.value}),children:[u.jsx("option",{value:"",children:"Select Student"}),p.map(te=>u.jsx("option",{value:te.id,children:te.name},te.id))]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Subject"}),u.jsxs("select",{className:"w-full px-4 py-2 rounded-xl border border-gray-200 outline-none focus:border-teal-600",value:Te.subject,onChange:te=>Oe({...Te,subject:te.target.value}),children:[u.jsx("option",{value:"Maths KS3",children:"Maths KS3"}),u.jsx("option",{value:"Maths GCSE",children:"Maths GCSE"}),u.jsx("option",{value:"Sociology GCSE",children:"Sociology GCSE"}),u.jsx("option",{value:"Sociology A-Level",children:"Sociology A-Level"}),u.jsx("option",{value:"Other",children:"Other"})]})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Date"}),u.jsx("input",{type:"date",required:!0,className:"w-full px-4 py-2 rounded-xl border border-gray-200 outline-none focus:border-teal-600",value:Te.date,onChange:te=>Oe({...Te,date:te.target.value})})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Time"}),u.jsxs("select",{required:!0,className:"w-full px-4 py-2 rounded-xl border border-gray-200 outline-none focus:border-teal-600 appearance-none",value:Te.time,onChange:te=>Oe({...Te,time:te.target.value}),children:[u.jsx("option",{value:"",children:"Time"}),en.map(te=>u.jsx("option",{value:te.value,children:te.label},te.value))]})]})]}),u.jsx("button",{type:"submit",className:"w-full py-3 bg-teal-600 text-white rounded-xl font-bold hover:bg-teal-700 transition-all mt-2",children:"Confirm Booking"})]})]})}),Mt&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-start justify-center p-4 overflow-y-auto pt-8 pb-8",onClick:()=>Bt(null),children:u.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-xl max-w-sm w-full animate-in zoom-in-95",onClick:te=>te.stopPropagation(),children:[u.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-1",children:"Reschedule Lesson"}),u.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Propose a new time for ",Mt.student,"."]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg text-sm",children:[u.jsx("span",{className:"block text-xs uppercase font-bold text-purple-400",children:"Current"}),u.jsxs("span",{className:"font-bold text-purple-900",children:[new Date(Mt.date).toLocaleDateString("en-GB")," at ",At(Mt.time)]})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"New Date"}),u.jsx("input",{type:"date",className:"w-full px-4 py-2 rounded-xl border border-gray-200 outline-none focus:border-purple-600",value:Yt.newDate,onChange:te=>On({...Yt,newDate:te.target.value})})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"New Time"}),u.jsx("select",{className:"w-full px-4 py-2 rounded-xl border border-gray-200 outline-none focus:border-purple-600 appearance-none",value:Yt.newTime,onChange:te=>On({...Yt,newTime:te.target.value}),children:en.map(te=>u.jsx("option",{value:te.value,children:te.label},te.value))})]})]}),Mt.recurringId&&u.jsxs("div",{className:"flex items-center gap-2 p-3 border border-gray-100 rounded-xl bg-gray-50/50",children:[u.jsx("input",{type:"checkbox",id:"series",checked:Yt.applyToSeries,onChange:te=>On({...Yt,applyToSeries:te.target.checked}),className:"w-5 h-5 accent-purple-600"}),u.jsxs("label",{htmlFor:"series",className:"text-sm text-gray-600",children:[u.jsx("span",{className:"font-bold block text-gray-800",children:"Apply to Series"}),"Shift all future lessons in this block"]})]}),u.jsxs("div",{className:"flex flex-col gap-2",children:[u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>Bt(null),className:"flex-1 py-3 text-gray-500 font-bold hover:bg-gray-100 rounded-xl transition-all",children:"Back"}),u.jsx("button",{onClick:gl,className:"flex-1 py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700 transition-all",children:"Send Proposal"})]}),u.jsx("button",{onClick:()=>{Qe(Mt)},className:"w-full py-2.5 text-red-600 font-bold hover:bg-red-50 rounded-xl transition-all border border-red-100 mt-2",children:"Cancel Lesson Entirely"})]})]})]})}),ct&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-start justify-center p-4 overflow-y-auto pt-8 pb-8",onClick:()=>ft(null),children:u.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-xl max-w-sm w-full animate-in zoom-in-95 text-center",onClick:te=>te.stopPropagation(),children:[u.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 ${ct.action==="approve"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:ct.action==="approve"?u.jsx(Is,{size:32}):u.jsx(To,{size:32})}),u.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:ct.action==="approve"?"Approve Reschedule?":"Deny Reschedule?"}),u.jsx("p",{className:"text-gray-500 mb-6 text-sm",children:ct.action==="approve"?`Confirm change to ${new Date(ct.booking.requestedDate).toLocaleDateString("en-GB")} at ${At(ct.booking.requestedTime)}?`:"Are you sure you want to deny this request? The new slot will be freed."}),u.jsxs("div",{className:"flex gap-3",children:[u.jsx("button",{onClick:()=>ft(null),className:"flex-1 py-3 text-gray-500 font-bold hover:bg-gray-100 rounded-xl transition-all",children:"Cancel"}),u.jsx("button",{onClick:ct.action==="approve"?tc:la,className:`flex-1 py-3 text-white rounded-xl font-bold transition-all shadow-md ${ct.action==="approve"?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"}`,children:ct.action==="approve"?"Confirm Approval":"Confirm Denial"})]})]})}),an&&(()=>{const te=st.filter(Ve=>Ve.recurringId===an.booking.recurringId&&Ve.status!=="cancelled"),Se=te.length===10&&te[0]&&(te[0].paymentStatus||"").toLowerCase()==="paid";return u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[150] flex items-center justify-center p-4",onClick:()=>As(null),children:u.jsx("div",{className:"bg-white p-8 rounded-3xl shadow-2xl max-w-sm w-full animate-in zoom-in-95 text-center",onClick:Ve=>Ve.stopPropagation(),children:Se?u.jsxs(u.Fragment,{children:[u.jsx(To,{className:"mx-auto text-amber-500 mb-4",size:40}),u.jsx("h3",{className:"text-xl font-black mb-2",children:"Bulk paid slot"}),u.jsx("p",{className:"text-gray-600 mb-6 font-bold text-sm",children:"You cannot cancel a bulk paid slot. Please reschedule to a new time instead. Refunds are not available for individual sessions in a paid pack."}),u.jsxs("div",{className:"flex flex-col gap-3",children:[u.jsx("button",{onClick:()=>{gi(an.booking),As(null)},className:"w-full py-3 bg-teal-600 text-white rounded-xl font-black uppercase tracking-widest text-xs hover:bg-teal-700 transition-all",children:"Reschedule instead"}),u.jsx("button",{onClick:()=>As(null),className:"w-full py-3 text-gray-400 font-black uppercase tracking-widest text-xs",children:"Keep Session"})]})]}):u.jsxs(u.Fragment,{children:[u.jsx(Kl,{className:"mx-auto text-red-500 mb-4",size:40}),u.jsx("h3",{className:"text-xl font-black mb-2",children:"Cancel Lesson?"}),u.jsx("p",{className:"text-gray-500 mb-6 font-bold text-sm",children:an.booking.recurringId?"This session is part of a recurring series. Would you like to cancel just this one, or the entire series?":`Are you sure you want to cancel the session for ${an.booking.student} on ${new Date(an.booking.date).toLocaleDateString("en-GB")} at ${an.booking.time}?`}),u.jsxs("div",{className:"flex flex-col gap-3",children:[an.booking.recurringId?u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:()=>mt("single"),className:"w-full py-3 bg-red-100 text-red-600 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-red-200 transition-all",children:"Cancel Just This One"}),u.jsx("button",{onClick:()=>mt("series"),className:"w-full py-3 bg-red-600 text-white rounded-xl font-black shadow-lg uppercase tracking-widest text-xs hover:bg-red-700 transition-all",children:"Cancel Entire Series"})]}):u.jsx("button",{onClick:()=>mt("single"),className:"w-full py-3 bg-red-600 text-white rounded-xl font-black shadow-lg uppercase tracking-widest text-xs",children:"Confirm Cancellation"}),u.jsx("button",{onClick:()=>As(null),className:"w-full py-3 text-gray-400 font-black uppercase tracking-widest text-xs",children:"Keep Session"})]})]})})})})(),q&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[200] flex items-center justify-center p-4",children:u.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto m-4",children:[u.jsxs("div",{className:"p-6 border-b border-gray-100",children:[u.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Complete lesson summary"}),u.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[q.studentName,"  ",q.date?new Date(q.date).toLocaleDateString("en-GB"):""]})]}),u.jsxs("form",{onSubmit:Xe,className:"p-6 space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Topics Covered"}),u.jsx("input",{required:!0,type:"text",value:Z,onChange:te=>le(te.target.value),className:"w-full px-4 py-2 rounded-xl border border-gray-200 bg-gray-50 focus:border-purple-500 outline-none",placeholder:"e.g. Algebra Basics"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"What went well?"}),u.jsx("textarea",{required:!0,value:K,onChange:te=>se(te.target.value),className:"w-full px-4 py-2 rounded-xl border border-gray-200 bg-gray-50 focus:border-green-500 outline-none h-24 text-sm",placeholder:"Great focus today..."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Improvements?"}),u.jsx("textarea",{required:!0,value:ce,onChange:te=>ye(te.target.value),className:"w-full px-4 py-2 rounded-xl border border-gray-200 bg-gray-50 focus:border-amber-500 outline-none h-24 text-sm",placeholder:"Practice more..."})]})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Focus"}),u.jsx("textarea",{value:Ce,onChange:te=>M(te.target.value),className:"w-full px-4 py-2 rounded-xl border border-gray-200 bg-gray-50 focus:border-blue-500 outline-none h-24 text-sm",placeholder:"Key topics focused on..."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Homework/Next Steps"}),u.jsx("textarea",{value:L,onChange:te=>U(te.target.value),className:"w-full px-4 py-2 rounded-xl border border-gray-200 bg-gray-50 focus:border-purple-500 outline-none h-24 text-sm",placeholder:"E.g. Focus on quadratic equations"})]})]}),u.jsxs("div",{className:"flex gap-3 pt-2",children:[u.jsx("button",{type:"submit",className:"flex-1 py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700",children:"Save lesson summary"}),u.jsx("button",{type:"button",onClick:()=>{J(null),le(""),se(""),ye(""),M(""),U("")},className:"py-3 px-4 text-gray-500 hover:text-gray-700 font-bold rounded-xl border border-gray-200",children:"Cancel"})]})]})]})}),$&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[200] flex items-center justify-center p-4",onClick:()=>z(null),children:u.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[80vh] overflow-hidden flex flex-col",onClick:te=>te.stopPropagation(),children:[u.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[u.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[u.jsx(Na,{size:20,className:"text-teal-600"})," Session notes  ",$.name]}),u.jsx("button",{onClick:()=>z(null),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg",children:""})]}),u.jsx("div",{className:"p-4 overflow-y-auto space-y-4",children:(()=>{const Se=JSON.parse(localStorage.getItem("tutor_session_history")||"[]").filter(Ve=>(Ve.studentName||Ve.student||"").toLowerCase()===($.name||"").toLowerCase()).reverse();return Se.length===0?u.jsx("p",{className:"text-gray-500 text-sm",children:"No session notes yet."}):Se.map((Ve,Ae)=>u.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl border border-gray-100 text-left",children:[u.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase tracking-wider",children:Ve.date?new Date(Ve.date).toLocaleDateString("en-GB"):"Session"}),u.jsx("p",{className:"font-bold text-gray-900 mt-1",children:Ve.topic||Ve.subject||"Lesson"}),Ve.next_steps&&u.jsxs("p",{className:"text-sm text-gray-700 mt-2",children:[u.jsx("span",{className:"font-semibold text-gray-500",children:"Next steps:"})," ",Ve.next_steps]}),Ve.feedback_well&&u.jsxs("p",{className:"text-sm text-gray-700 mt-1",children:[u.jsx("span",{className:"font-semibold text-gray-500",children:"Went well:"})," ",Ve.feedback_well]}),Ve.feedback_improve&&u.jsxs("p",{className:"text-sm text-gray-700 mt-1",children:[u.jsx("span",{className:"font-semibold text-gray-500",children:"To improve:"})," ",Ve.feedback_improve]})]},Ve.id||Ae))})()})]})}),de&&u.jsx("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-[200] animate-in slide-in-from-bottom-10",children:u.jsxs("div",{className:`px-8 py-4 rounded-full shadow-2xl flex items-center gap-3 border-2 ${de.type==="error"?"bg-red-500 border-red-400 text-white":"bg-purple-600 border-purple-500 text-white"}`,children:[de.type==="error"?u.jsx(To,{size:20}):u.jsx(Is,{size:20}),u.jsx("span",{className:"font-bold text-sm tracking-tight",children:de.message}),u.jsx("button",{onClick:()=>xe(null),className:"ml-2 opacity-50 text-xl font-bold",children:""})]})})]})}):u.jsx("div",{className:"min-h-screen bg-brand-light flex items-center justify-center p-4 font-sans",children:u.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm text-center border border-purple-100",children:[u.jsx("div",{className:"bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6",children:u.jsx(Ru,{size:32,className:"text-purple-600"})}),u.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Teacher Access"}),u.jsx("p",{className:"text-gray-500 mb-6",children:"Please enter your 4-digit code."}),u.jsxs("form",{onSubmit:pl,children:[u.jsx("input",{type:"password",maxLength:"4",value:t,onChange:te=>n(te.target.value),className:"w-full text-center text-3xl font-bold tracking-[0.5em] py-3 rounded-xl border border-gray-200 focus:border-purple-600 focus:outline-none mb-4",placeholder:"",autoFocus:!0}),r&&u.jsx("p",{className:"text-red-500 text-sm font-bold mb-4",children:r}),u.jsx("button",{type:"submit",className:"w-full py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700 transition-all",children:"Unlock Dashboard"})]}),u.jsx("button",{onClick:()=>window.location.href="/",className:"mt-6 text-purple-600 hover:text-purple-800 text-sm font-bold hover:underline",children:"Back to Home"})]})})},rT=()=>{const s=ka(),[e]=n_(),t=e.get("join"),n=h=>h?h.split(" ").map(p=>p.charAt(0).toUpperCase()+p.slice(1).toLowerCase()).join(" "):"",[r,i]=Y.useState(""),[o,l]=Y.useState(t||""),d=h=>{if(h.preventDefault(),!r.trim()||!o.trim())return;const p=o.trim().split("/").pop().replace("?host=true","");s(`/session/${p}?student=${encodeURIComponent(n(r.trim()))}`)};return u.jsx("div",{className:"min-h-screen bg-brand-light flex flex-col items-center justify-center p-6 text-brand-navy font-sans",children:u.jsxs("div",{className:"max-w-md w-full bg-white p-8 rounded-3xl shadow-xl border border-gray-100 animate-in zoom-in-95 duration-300",children:[u.jsxs("div",{className:"text-center mb-8",children:[u.jsx("div",{className:"w-16 h-16 bg-teal-100 rounded-full flex items-center justify-center mx-auto mb-4 text-teal-600",children:u.jsx(Pu,{size:32})}),u.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Student Login"}),u.jsx("p",{className:"text-gray-500",children:"Enter your name and session ID to join."})]}),u.jsxs("form",{onSubmit:d,className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Your Name"}),u.jsx("input",{type:"text",value:r,onChange:h=>i(h.target.value),placeholder:"e.g. Alice",className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-teal-500 focus:outline-none bg-gray-50",autoFocus:!t})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Session Update ID"}),u.jsx("input",{type:"text",value:o,onChange:h=>l(h.target.value),placeholder:"e.g. X7K9P2",className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-teal-500 focus:outline-none bg-gray-50 font-mono",readOnly:!!t})]}),u.jsxs("button",{type:"submit",disabled:!r.trim()||!o.trim(),className:"w-full py-4 bg-teal-500 hover:bg-teal-600 text-white rounded-xl font-bold text-lg shadow-md transition-all disabled:opacity-50 flex items-center justify-center gap-2 mt-4",children:["Join Lesson ",u.jsx(Jl,{size:20})]}),u.jsxs("button",{type:"button",onClick:()=>{r.trim()?s(`/student-dashboard?student=${encodeURIComponent(n(r.trim()))}`):alert("Please enter your name first.")},className:"w-full py-4 bg-white border-2 border-teal-500 text-teal-600 hover:bg-teal-50 rounded-xl font-bold text-lg shadow-sm transition-all flex items-center justify-center gap-2",children:[u.jsx(Pu,{size:20})," View Dashboard"]}),u.jsx("button",{type:"button",onClick:()=>s("/"),className:"w-full py-2 text-gray-400 hover:text-gray-600 text-sm font-bold",children:"Cancel"})]})]})})},zw=()=>{const s=ka(),{studentName:e}=gb(),[t,n]=Y.useState(e||new URLSearchParams(window.location.search).get("student")||"Guest"),[r,i]=Y.useState(""),[o,l]=Y.useState([]),[d,h]=Y.useState([]),[p,g]=Y.useState([]),[b,x]=Y.useState("overview"),[w,v]=Y.useState(!1),[_,N]=Y.useState(""),[E,k]=Y.useState(""),[T,P]=Y.useState(!1),[O,F]=Y.useState(null),[$,z]=Y.useState(null),[G,R]=Y.useState(!1),[q,J]=Y.useState(!1),[Z,le]=Y.useState(null),[K,se]=Y.useState(!1),[ce,ye]=Y.useState(null),[Ce,M]=Y.useState(()=>localStorage.getItem("dismissed_cancelled_banner")==="true"),[L,U]=Y.useState(null),[H,ae]=Y.useState(null),[de,xe]=Y.useState(()=>{const re=new Date;return`${re.getFullYear()}-${String(re.getMonth()+1).padStart(2,"0")}`}),[he,me]=Y.useState(null),[ve,Re]=Y.useState([]),[Ke,Ge]=Y.useState(30),[ke,X]=Y.useState(""),[Pe,gt]=Y.useState(null),[bt,Ye]=Y.useState(0),[Et,vt]=Y.useState(""),[st,St]=Y.useState(null),[Pt,Ut]=Y.useState(null),[je,Me]=Y.useState("weekly"),Fe=Y.useMemo(()=>JSON.parse(localStorage.getItem("tutor_students")||"[]").find(Qe=>Qe.name===t)?.subject,[t]),ue=re=>{if(!re)return"GCSE";const Qe=re.toLowerCase();return Qe.includes("ks3")?"KS3":Qe.includes("gcse")||Qe.includes("secondary")?"GCSE":Qe.includes("a-level")||Qe.includes("a level")||Qe.includes("alevel")||Qe.includes("a-lvl")?"A-Level":"GCSE"},Te=re=>ue(re)==="A-Level"?370:280;Y.useEffect(()=>{const re=()=>{const mt=(JSON.parse(localStorage.getItem("tutor_session_history"))||[]).filter(dt=>dt.studentName&&dt.studentName.toLowerCase().includes(e.toLowerCase())||dt.student&&dt.student.toLowerCase().includes(e.toLowerCase()));l(mt.sort((dt,sn)=>new Date(sn.date+"T"+sn.time)-new Date(dt.date+"T"+dt.time)));const et=(JSON.parse(localStorage.getItem("tutor_students"))||[]).find(dt=>dt.name.toLowerCase()===t.toLowerCase());if(et){i(et.id);const dt=et.subject||"";dt.includes("KS3")?Ge(25):dt.includes("GCSE")?Ge(30):dt.includes("A-Level")||dt.includes("A Level")?Ge(40):Ge(30)}const kt=JSON.parse(localStorage.getItem("tutor_bookings"))||[],Tt=dt=>(dt||"").toLowerCase().replace(/\s+/g,"").trim(),Rt=Tt(e),An=kt.filter(dt=>{const sn=Rt&&(Tt(dt.student)===Rt||Tt(dt.studentName)===Rt||Tt(dt.student).includes(Rt)||Tt(dt.studentName).includes(Rt)||dt.student&&dt.student.toLowerCase().includes((e||"").toLowerCase())||dt.studentName&&dt.studentName.toLowerCase().includes((e||"").toLowerCase())),Un=et&&(dt.studentId===et.id||dt.student_id===et.id);return sn||Un});h(An.sort((dt,sn)=>new Date(dt.date+"T"+dt.time)-new Date(sn.date+"T"+sn.time)));const Pn=JSON.parse(localStorage.getItem("chat_messages_v2"))||{};Re(Pn[e]||[]);const jt=(JSON.parse(localStorage.getItem("tutor_all_lesson_slots"))||[]).filter(dt=>!dt.bookedBy&&new Date(dt.date+"T"+dt.time)>new Date);g(jt.sort((dt,sn)=>new Date(dt.date+"T"+dt.time)-new Date(sn.date+"T"+sn.time)))};return re(),window.addEventListener("storage",re),()=>window.removeEventListener("storage",re)},[e,t]),Y.useEffect(()=>{if(b==="messages"&&e){const re=JSON.parse(localStorage.getItem("chat_messages_v2"))||{},Qe=re[e]||[];if(Qe.some(Xe=>Xe.sender==="Davina"&&!Xe.read)){const Xe=Qe.map(kt=>kt.sender==="Davina"?{...kt,read:!0}:kt),et={...re,[e]:Xe};localStorage.setItem("chat_messages_v2",JSON.stringify(et)),Re(Xe),window.dispatchEvent(new Event("storage"))}}},[b,e]);const Oe=re=>{const Qe=re.paymentStatus?.toLowerCase()==="paid",mt=re.paymentStatus==="Due (Exception)",Xe=re.paymentStatus==="In bundle",et=re.type==="consultation";if(!Qe&&!mt&&!Xe&&!et){me({type:"error",message:"Please pay for this lesson before starting. You can pay in the Invoices tab."}),x("invoices");return}s(`/session/${re.id}?student=${encodeURIComponent(e)}`)},ct=re=>{const mt=(JSON.parse(localStorage.getItem("tutor_bookings"))||[]).map(Xe=>re.recurringId&&Xe.recurringId===re.recurringId?{...Xe,status:"confirmed"}:Xe.id===re.id?{...Xe,status:"confirmed"}:Xe);localStorage.setItem("tutor_bookings",JSON.stringify(mt)),window.dispatchEvent(new Event("storage")),me({type:"success",message:"Lesson(s) approved and confirmed!"})},ft=re=>{if(!window.confirm("Are you sure you want to deny this lesson proposal?"))return;const mt=(JSON.parse(localStorage.getItem("tutor_bookings"))||[]).map(Xe=>re.recurringId&&Xe.recurringId===re.recurringId?{...Xe,status:"cancelled"}:Xe.id===re.id?{...Xe,status:"cancelled"}:Xe);localStorage.setItem("tutor_bookings",JSON.stringify(mt)),window.dispatchEvent(new Event("storage")),me({type:"info",message:"Lesson proposal denied."})},wt=re=>{U(re)},it=re=>{if(re&&re.preventDefault(),!ce)return;const Qe=d.map(mt=>mt.id===ce.booking.id?{...mt,subject:(ce.currentSubject||"").trim()||void 0,lessonNotes:(ce.currentLessonNotes||"").trim()||void 0}:mt);h(Qe),localStorage.setItem("tutor_bookings",JSON.stringify(Qe)),window.dispatchEvent(new Event("storage")),ye(null)},At=re=>{const Qe=new Date().toISOString(),Xe=JSON.parse(localStorage.getItem("tutor_session_history")||"[]").map(An=>An.id===re?{...An,paymentStatus:"Paid",paymentDate:Qe}:An);localStorage.setItem("tutor_session_history",JSON.stringify(Xe));const et=JSON.parse(localStorage.getItem("tutor_bookings")||"[]"),Tt=et.find(An=>An.id===re)?.recurringId,Rt=et.map(An=>An.id===re||Tt&&An.recurringId===Tt?{...An,paymentStatus:"Paid",paymentDate:Qe}:An);localStorage.setItem("tutor_bookings",JSON.stringify(Rt)),window.dispatchEvent(new Event("storage"))},We=re=>{z(null),F(re);const mt=(JSON.parse(localStorage.getItem("tutor_students"))||[]).find(Xe=>Xe.name===t);N(mt?.subject||"KS3 Maths"),k(""),P(!1),Me("weekly"),v(!0)},lt=()=>{if(!$&&!_.trim()){me({type:"error",message:"Please enter what you'd like to cover."});return}const Qe=(JSON.parse(localStorage.getItem("tutor_lesson_slots"))||[]).map(Xe=>Xe.id===O.id?{...Xe,bookedBy:t}:Xe);localStorage.setItem("tutor_lesson_slots",JSON.stringify(Qe));const mt=JSON.parse(localStorage.getItem("tutor_bookings"))||[];if($){const Xe=mt.map(et=>et.id===$.id?{...et,status:"pending_reschedule",requestedDate:O.date,requestedTime:O.time,requestedSlotId:O.id}:et);localStorage.setItem("tutor_bookings",JSON.stringify(Xe)),xr.sendRescheduleRequest({...$,requestedDate:O.date,requestedTime:O.time},"student").then(()=>{xr.sendRescheduleResponseToTeacher({...$,date:O.date,time:O.time},"Proposed by Student")}),me({type:"success",message:"Reschedule Request Sent!"}),v(!1)}else{const Xe={id:O.id,date:O.date,time:O.time,student:t,studentId:r,subject:_,lessonNotes:(E||"").trim()||void 0,type:T?je==="pack"?"pack":"weekly":"lesson",bookedAt:new Date().toISOString(),status:"confirmed",paymentStatus:"Due",cost:T&&je==="pack"?Te(_):Ke};if(T){const et=[],kt=`recurring_${Date.now()}`;for(let Tt=0;Tt<10;Tt++){const Rt=new Date(O.date);Rt.setDate(Rt.getDate()+Tt*7),et.push({...Xe,id:`${O.id}_${Tt}_${Date.now()}`,date:Rt.toISOString().split("T")[0],recurringId:kt,lessonNotes:(E||"").trim()||void 0,paymentStatus:Tt===0?"Due":je==="pack"?"In bundle":"Upcoming",cost:Tt===0?je==="pack"?Te(_):Ke:je==="pack"?0:Ke})}localStorage.setItem("tutor_bookings",JSON.stringify([...mt,...et]))}else localStorage.setItem("tutor_bookings",JSON.stringify([...mt,Xe]));try{const et=JSON.parse(localStorage.getItem("tutor_students")||"[]"),kt=et.map(Tt=>(Tt.name===t||Tt.id===r)&&!Tt.subject?{...Tt,subject:_}:Tt);kt.some((Tt,Rt)=>Tt!==et[Rt])&&localStorage.setItem("tutor_students",JSON.stringify(kt))}catch{}xr.sendNewBookingNotificationToTeacher({...Xe,recurringId:T?`recurring_${Date.now()}`:void 0}),me({type:"success",message:T?"10-Week Lesson Bundle Booked!":"Lesson Booked!"}),v(!1)}window.dispatchEvent(new Event("storage")),x("overview")},pt=re=>{gt(re),Ye(0),vt(""),se(!0)},It=()=>{if(!Pe||!bt)return;const re={id:Date.now(),studentName:t,date:new Date().toISOString(),rating:bt,comment:Et,lessonId:Pe.id,subject:Pe.subject},Qe=JSON.parse(localStorage.getItem("tutor_public_reviews"))||[];localStorage.setItem("tutor_public_reviews",JSON.stringify([...Qe,re]));const Xe=(JSON.parse(localStorage.getItem("tutor_session_history"))||[]).map(et=>et.id===Pe.id?{...et,hasReview:!0}:et);localStorage.setItem("tutor_session_history",JSON.stringify(Xe)),se(!1),window.dispatchEvent(new Event("storage")),me({type:"success",message:"Thank you for your review!"})},en=re=>{z(re),R(!0)},Mt=()=>{R(!1),x("booking")},Bt=()=>{if(!ke.trim())return;const re={sender:t,message:ke,timestamp:new Date().toISOString()},Qe=JSON.parse(localStorage.getItem("chat_messages_v2"))||{},mt=Qe[e]||[],Xe={...Qe,[e]:[...mt,re]};localStorage.setItem("chat_messages_v2",JSON.stringify(Xe)),Re([...mt,re]);const et=ke.trim();X(""),window.dispatchEvent(new Event("storage")),xr.sendMessageNotification(t,Su,et.slice(0,200)).catch(()=>{})},Yt=(re=!1)=>{if(!Pt)return;const Qe=Pt,mt=JSON.parse(localStorage.getItem("tutor_bookings"))||[];let Xe,et=[];re&&Qe.recurringId?(Xe=mt.map(Rt=>Rt.recurringId===Qe.recurringId&&new Date(Rt.date)>=new Date(Qe.date)?{...Rt,status:"cancelled"}:Rt),et=mt.filter(Rt=>Rt.recurringId===Qe.recurringId&&new Date(Rt.date)>=new Date(Qe.date))):(Xe=mt.map(Rt=>Rt.id===Qe.id?{...Rt,status:"cancelled"}:Rt),et=[Qe]),localStorage.setItem("tutor_bookings",JSON.stringify(Xe));const Tt=(JSON.parse(localStorage.getItem("tutor_all_lesson_slots"))||[]).map(Rt=>et.some(An=>An.date===Rt.date&&An.time===Rt.time)?{...Rt,bookedBy:null}:Rt);localStorage.setItem("tutor_all_lesson_slots",JSON.stringify(Tt)),et.forEach(Rt=>{xr.sendCancellationNotice(Rt,"student")}),window.dispatchEvent(new Event("storage")),me({type:"success",message:re?"Entire series cancelled.":"Lesson cancelled."}),Ut(null)},On=(re,Qe)=>{const Xe=(JSON.parse(localStorage.getItem("tutor_bookings"))||[]).map(et=>et.id===re.id?Qe?{...et,status:"confirmed",date:re.teacherProposed.newDate,time:re.teacherProposed.newTime,teacherProposed:void 0}:{...et,status:"confirmed",teacherProposed:void 0}:et);localStorage.setItem("tutor_bookings",JSON.stringify(Xe)),window.dispatchEvent(new Event("storage")),xr.sendRescheduleResponseToTeacher(re,Qe?"Accepted":"Declined"),me({type:"success",message:Qe?"Reschedule Accepted!":"Reschedule Declined."})},an=d.find(re=>new Date(re.date+"T"+re.time)>new Date&&re.status!=="cancelled");[...d,...o].filter(re=>(re.paymentStatus==="Due"||re.paymentStatus?.toLowerCase()==="due")&&re.type!=="consultation").length;const ut=ve.filter(re=>re.sender==="Davina"&&!re.read).length;return u.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col font-sans text-gray-800",children:[u.jsx("nav",{className:"bg-white sticky top-0 z-50 border-b border-gray-200",children:u.jsxs("div",{className:"max-w-7xl mx-auto px-6 h-16 flex justify-between items-center",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-8 h-8 bg-teal-100 flex items-center justify-center text-teal-600 rounded-lg",children:u.jsx(w1,{size:20})}),u.jsx("h1",{className:"text-lg font-black text-teal-600 tracking-tight",children:"Student dashboard for Davinas Tutoring Platform"})]}),u.jsxs("div",{className:"flex items-center gap-6",children:[u.jsxs("span",{className:"font-bold text-gray-500 hidden md:block text-sm",children:["Welcome, ",t]}),u.jsxs("button",{onClick:()=>s("/"),className:"text-red-400 hover:text-red-500 flex items-center gap-2 text-xs font-bold bg-red-50 px-3 py-1.5 rounded-lg transition-all",children:[u.jsx(vb,{size:14})," Sign Out"]})]})]})}),u.jsxs("main",{className:"flex-1 max-w-7xl mx-auto w-full p-4 md:p-6 space-y-6",children:[d.some(re=>re.status==="pending_student_approval")&&u.jsxs("div",{className:"space-y-3",children:[u.jsxs("h2",{className:"text-base font-bold text-gray-800 flex items-center gap-2",children:[u.jsx(To,{className:"text-orange-500",size:18})," Action Required"]}),d.filter(re=>re.status==="pending_student_approval").map(re=>u.jsxs("div",{className:"bg-white border-l-4 border-orange-500 rounded-xl shadow-md p-4 flex flex-col md:flex-row items-center justify-between gap-4",children:[u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"font-bold text-gray-900 text-sm",children:"Reschedule Proposal"}),u.jsxs("p",{className:"text-gray-400 text-xs mt-1",children:["New time: ",new Date(re.teacherProposed.newDate).toLocaleDateString("en-GB")," at ",re.teacherProposed.newTime]})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs("button",{onClick:()=>On(re,!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg font-bold text-xs flex items-center gap-1.5 shadow-sm",children:[u.jsx(Is,{size:14})," Accept"]}),u.jsx("button",{onClick:()=>On(re,!1),className:"px-4 py-2 bg-white border border-gray-200 text-gray-500 rounded-lg font-bold text-xs",children:"Decline"})]})]},re.id))]}),u.jsxs("div",{className:"grid grid-cols-12 gap-6 items-start",children:[u.jsxs("div",{className:"col-span-12 lg:col-span-2 space-y-2",children:[u.jsxs("button",{onClick:()=>x("overview"),className:`w-full p-4 rounded-xl text-left font-black flex items-center gap-3 transition-all ${b==="overview"?"bg-teal-500 text-white shadow-lg":"bg-white text-gray-400 hover:bg-gray-50"}`,children:[u.jsx(w1,{size:20})," ",u.jsx("span",{className:"text-sm uppercase tracking-wider",children:"Overview"})]}),u.jsx("button",{onClick:()=>x("booking"),className:`w-full p-4 rounded-xl text-left font-black flex items-center justify-between transition-all ${b==="booking"?"bg-teal-500 text-white shadow-lg":"bg-white text-gray-400 hover:bg-gray-50"}`,children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(ll,{size:20})," ",u.jsx("span",{className:"text-sm uppercase tracking-wider",children:"Book"})]})}),u.jsxs("button",{onClick:()=>x("history"),className:`w-full p-4 rounded-xl text-left font-black flex items-center gap-3 transition-all ${b==="history"?"bg-teal-500 text-white shadow-lg":"bg-white text-gray-400 hover:bg-gray-50"}`,children:[u.jsx(ei,{size:20})," ",u.jsx("span",{className:"text-sm uppercase tracking-wider",children:"History"})]}),u.jsx("button",{onClick:()=>x("invoices"),className:`w-full p-4 rounded-xl text-left font-black flex items-center justify-between transition-all ${b==="invoices"?"bg-teal-500 text-white shadow-lg":"bg-white text-gray-400 hover:bg-gray-50"}`,children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(v1,{size:20})," ",u.jsx("span",{className:"text-sm uppercase tracking-wider",children:"Invoices"})]})}),u.jsxs("button",{onClick:()=>x("messages"),className:`w-full p-4 rounded-xl text-left font-black flex items-center justify-between transition-all ${b==="messages"?"bg-teal-500 text-white shadow-lg":"bg-white text-gray-400 hover:bg-gray-50"}`,children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(Hc,{size:20})," ",u.jsx("span",{className:"text-sm uppercase tracking-wider",children:"Messages"})]}),ut>0&&u.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-black ${b==="messages"?"bg-white text-teal-600":"bg-red-500 text-white"}`,children:ut})]})]}),u.jsxs("div",{className:"col-span-12 lg:col-span-10",children:[b==="overview"&&u.jsxs("div",{className:"space-y-8",children:[u.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-700 p-8 rounded-3xl shadow-xl text-white relative overflow-hidden group",children:[u.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32 blur-3xl group-hover:bg-white/20 transition-all duration-700"}),u.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row items-center justify-between gap-6",children:[u.jsxs("div",{className:"flex-1 text-center md:text-left",children:[u.jsxs("h3",{className:"text-teal-300 font-black uppercase tracking-[0.2em] text-[10px] mb-2 flex items-center gap-2 justify-center md:justify-start",children:[u.jsx(cl,{size:14,fill:"currentColor"})," Next Lesson Focus"]}),u.jsx("div",{className:"text-3xl md:text-4xl font-black mb-4 tracking-tight leading-tight min-h-[40px]",children:o.length>0&&o[0].next_steps&&!o[0].next_steps.toUpperCase().includes("SSSS")?o[0].next_steps:"N/A - No specific focus set"}),u.jsxs("div",{className:"flex items-center gap-3 text-purple-100 font-bold opacity-80 text-xs justify-center md:justify-start",children:[u.jsx(ll,{size:12})," ",u.jsxs("span",{children:["Next Lesson: ",an?`${new Date(an.date).toLocaleDateString("en-GB")} at ${an.time}`:"Not Scheduled"]})]})]}),u.jsxs("button",{onClick:()=>{an?Oe(an):x("booking")},className:"bg-white text-purple-600 px-8 py-3.5 rounded-2xl font-black flex items-center gap-3 hover:bg-teal-50 transition-all shadow-xl hover:scale-105 active:scale-95 text-lg",children:[an?"Start Lesson":"Book Lesson"," ",u.jsx(Jl,{size:18})]})]})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsx("div",{className:"flex items-center justify-between",children:u.jsxs("h2",{className:"text-xl font-black text-gray-900 tracking-tight flex items-center gap-3",children:[u.jsx(dl,{className:"text-teal-500",size:24})," Upcoming Lessons"]})}),d.filter(re=>new Date(re.date+"T"+re.time)>new Date&&re.status!=="cancelled").length===0?u.jsxs("div",{className:"text-center py-12 bg-white rounded-3xl border border-gray-100 shadow-sm",children:[u.jsx(ll,{size:48,className:"mx-auto mb-4 text-gray-100"}),u.jsx("p",{className:"text-gray-400 font-black text-xs uppercase tracking-widest",children:"No upcoming lessons"})]}):u.jsx("div",{className:"grid gap-4",children:d.filter(re=>new Date(re.date+"T"+re.time)>new Date&&re.status!=="cancelled").map(re=>u.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex flex-col lg:flex-row items-center justify-between gap-6 hover:shadow-xl transition-all duration-500 group",children:[u.jsxs("div",{className:"flex items-center gap-6 min-w-[200px]",children:[u.jsxs("div",{className:"bg-teal-50 text-teal-600 p-4 rounded-2xl text-center min-w-[80px] shadow-sm group-hover:bg-teal-500 group-hover:text-white transition-all duration-500",children:[u.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest mb-1",children:new Date(re.date).toLocaleDateString("en-GB",{month:"short"})}),u.jsx("div",{className:"text-2xl font-black",children:new Date(re.date).getDate()})]}),u.jsxs("div",{children:[u.jsx("div",{className:"font-black text-lg text-gray-900 tracking-tighter",children:new Date(re.date).toLocaleDateString("en-GB",{weekday:"long"})}),u.jsxs("div",{className:"text-gray-400 font-bold flex items-center gap-2 mt-0.5 text-sm",children:[u.jsx(ei,{size:16,className:"text-teal-500"})," ",re.time]}),u.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[u.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded ${re.status==="pending_approval"?"bg-purple-100 text-purple-700":re.type==="consultation"?"bg-blue-100 text-blue-700":(()=>{const Qe=(re.paymentStatus||"").toLowerCase()==="paid",mt=JSON.parse(localStorage.getItem("tutor_bookings")||"[]");if(re.recurringId){const Xe=mt.filter(et=>et.recurringId===re.recurringId&&et.status!=="cancelled").sort((et,kt)=>new Date(et.date+"T"+et.time)-new Date(kt.date+"T"+kt.time));if(Xe.length===10&&Xe[0]&&(Xe[0].paymentStatus||"").toLowerCase()!=="paid"&&Qe)return"bg-amber-100 text-amber-700"}if(Qe)return"bg-green-100 text-green-700";if(re.paymentStatus==="In bundle"){const Xe=mt.filter(kt=>kt.recurringId===re.recurringId&&kt.status!=="cancelled").sort((kt,Tt)=>new Date(kt.date+"T"+kt.time)-new Date(Tt.date+"T"+Tt.time));return Xe.length===10&&Xe[0]&&(Xe[0].paymentStatus||"").toLowerCase()==="paid"?"bg-green-100 text-green-700":"bg-teal-100 text-teal-700"}return re.paymentStatus==="Due"||re.paymentStatus==="Due (Exception)"?"bg-amber-100 text-amber-700":"bg-red-50 text-red-600"})()}`,children:re.status==="pending_approval"?"Pending Approval":re.type==="consultation"?"Free Consultation":(()=>{const Qe=re.paymentStatus||"";if(re.recurringId){const Xe=JSON.parse(localStorage.getItem("tutor_bookings")||"[]").filter(et=>et.recurringId===re.recurringId&&et.status!=="cancelled").sort((et,kt)=>new Date(et.date+"T"+et.time)-new Date(kt.date+"T"+kt.time));if(Xe.length===10&&Xe[0]){const et=(Xe[0].paymentStatus||"").toLowerCase()==="paid";return Qe==="Due"||Qe.toLowerCase()==="due"?"Awaiting initial payment":Qe==="In bundle"&&et?"Paid in bulk":"Awaiting initial payment"}}return Qe==="Due"||Qe.toLowerCase()==="due"?"Due":Qe==="In bundle"?"Awaiting initial payment":Qe==="Due (Exception)"?"Payment due":Qe==="Paid"||Qe.toLowerCase()==="paid"?"Paid":Qe||"Upcoming"})()}),re.recurringId&&(()=>{const mt=JSON.parse(localStorage.getItem("tutor_bookings")||"[]").filter(kt=>kt.recurringId===re.recurringId&&kt.status!=="cancelled").sort((kt,Tt)=>new Date(kt.date+"T"+kt.time)-new Date(Tt.date+"T"+Tt.time));if(mt.length!==10)return null;const Xe=mt.findIndex(kt=>kt.id===re.id),et=Xe>=0?Xe+1:null;return et?u.jsxs("span",{className:"text-[10px] text-teal-600 font-bold",children:["Lesson ",et,"/10"]}):null})()]})]})]}),u.jsxs("div",{className:"flex-1 w-full space-y-3",children:[u.jsxs("div",{children:[u.jsx("div",{className:"text-[10px] font-black text-teal-600 uppercase tracking-widest mb-1 ml-1",children:"Lesson type"}),u.jsxs("div",{onClick:()=>ye({booking:re,currentSubject:re.subject||Fe||"",currentLessonNotes:re.lessonNotes||""}),className:"bg-white px-4 py-3 rounded-xl border-2 border-dashed border-teal-200 flex items-center justify-between group cursor-pointer hover:border-teal-400 hover:bg-teal-50/30 transition-all",children:[u.jsx("p",{className:`text-sm font-bold tracking-tight ${re.subject||Fe?"text-purple-600":"text-teal-500 italic"}`,children:re.subject||Fe||"Click to set lesson type"}),u.jsx("div",{className:"text-teal-500 bg-teal-50 p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-all shadow-sm",children:u.jsx(Na,{size:16})})]})]}),u.jsxs("div",{children:[u.jsx("div",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1 ml-1",children:"Lesson notes (for teacher)"}),u.jsxs("div",{onClick:()=>ye({booking:re,currentSubject:re.subject||Fe||"",currentLessonNotes:re.lessonNotes||""}),className:"bg-white px-4 py-3 rounded-xl border border-dashed border-gray-200 flex items-center justify-between group cursor-pointer hover:border-teal-300 hover:bg-gray-50/50 transition-all min-h-[56px]",children:[u.jsx("p",{className:`text-sm font-medium tracking-tight ${re.lessonNotes?"text-gray-700":"text-gray-400 italic"}`,children:re.lessonNotes||"Click to add request or notes for your teacher"}),u.jsx("div",{className:"text-gray-400 bg-gray-100 p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-all",children:u.jsx(Na,{size:14})})]})]})]}),u.jsxs("div",{className:"flex flex-col items-center lg:items-end gap-3 min-w-[280px]",children:[u.jsx("div",{className:"flex items-center gap-2 w-full",children:re.status==="pending_approval"?u.jsxs(u.Fragment,{children:[u.jsxs("button",{onClick:()=>ct(re),className:"flex-1 bg-green-600 hover:bg-green-700 text-white px-5 py-3 rounded-xl font-black text-xs transition-all shadow-lg flex items-center justify-center gap-2 uppercase tracking-widest",children:["Approve ",re.recurringId&&"Series"]}),u.jsx("button",{onClick:()=>ft(re),className:"bg-red-50 text-red-600 px-5 py-3 rounded-xl font-black text-xs hover:bg-red-600 hover:text-white transition-all border border-red-100 uppercase tracking-widest",children:"Deny"})]}):u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:Qe=>{Qe.stopPropagation();const mt=Q8({date:re.date,time:re.time,subject:re.subject||"Tutoring Session"});window.open(mt,"_blank")},className:"flex items-center justify-center p-3 text-gray-400 hover:text-teal-600 hover:bg-teal-50 rounded-xl transition-all border border-gray-100",title:"Add to Calendar",children:u.jsx(ll,{size:18})}),(()=>{const mt=JSON.parse(localStorage.getItem("tutor_bookings")||"[]").filter(Tt=>Tt.recurringId===re.recurringId&&Tt.status!=="cancelled").sort((Tt,Rt)=>new Date(Tt.date+"T"+Tt.time)-new Date(Rt.date+"T"+Rt.time)),Xe=mt.length===10&&mt[0]&&(mt[0].paymentStatus||"").toLowerCase()==="paid",et=mt.length===10,kt=re.type==="consultation"||re.paymentStatus==="Due (Exception)"||(et?Xe:(re.paymentStatus||"").toLowerCase()==="paid"||re.paymentStatus==="Due");return u.jsxs("button",{onClick:()=>kt&&Oe(re),disabled:!kt,title:kt?"Start lesson":"Pay for the first lesson in the pack first",className:`flex-1 px-5 py-3 rounded-xl font-black text-xs transition-all shadow-lg flex items-center justify-center gap-2 uppercase tracking-widest ${kt?"bg-purple-600 hover:bg-purple-700 text-white":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[u.jsx(dl,{size:16})," Start Lesson"]})})()]})}),u.jsxs("div",{className:"flex items-center gap-2 w-full",children:[u.jsxs("button",{onClick:()=>en(re),className:"flex-1 py-2 text-xs font-black text-purple-600 bg-purple-50 hover:bg-purple-100 rounded-xl transition-all border border-purple-100 flex items-center justify-center gap-2 uppercase tracking-widest",children:[u.jsx(ei,{size:14})," Reschedule"]}),u.jsx("button",{onClick:()=>{Ut(re)},className:"p-2.5 text-gray-300 hover:text-red-500 hover:bg-red-50 rounded-xl transition-all border border-gray-100",title:"Cancel",children:u.jsx(Kl,{size:16})})]})]})]},re.id))})]})]}),b==="booking"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("h2",{className:"text-xl font-black text-gray-900 tracking-tight flex items-center gap-3",children:[u.jsx(ll,{className:"text-purple-600",size:24})," Book New Lesson"]}),p.length===0?u.jsxs("div",{className:"bg-white p-12 text-center rounded-3xl border border-gray-100 shadow-sm",children:[u.jsx(ei,{size:48,className:"mx-auto mb-4 text-gray-100"}),u.jsx("p",{className:"text-gray-400 font-black text-xs uppercase tracking-widest",children:"No slots found"})]}):u.jsx("div",{className:"grid gap-6",children:Object.entries(p.filter(re=>O?re.id===O.id:!0).reduce((re,Qe)=>{const mt=Qe.date;return re[mt]||(re[mt]=[]),re[mt].push(Qe),re},{})).map(([re,Qe])=>u.jsxs("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[u.jsxs("div",{className:"bg-gray-50/50 px-6 py-4 border-b border-gray-100 flex items-center justify-between",children:[u.jsx("h3",{className:"text-lg font-black text-gray-900",children:new Date(re).toLocaleDateString("en-GB",{weekday:"long",month:"long",day:"numeric"})}),u.jsxs("span",{className:"bg-white px-3 py-1 rounded-full text-[10px] font-black text-gray-400 shadow-sm",children:[Qe.length," SLOTS"]})]}),u.jsx("div",{className:"p-6",children:u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3",children:Qe.map(mt=>{const Xe=O?.id===mt.id;return u.jsx("button",{onClick:()=>Xe?F(null):We(mt),className:`p-4 rounded-xl font-black text-sm transition-all text-center shadow-sm border ${Xe?"bg-teal-500 border-teal-600 text-white":"bg-blue-50/80 border-blue-100 text-blue-700 hover:border-teal-500 hover:text-teal-600 hover:bg-teal-50/50"}`,children:new Date(`2000-01-01T${mt.time}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})},mt.id)})})})]},re))})]}),b==="history"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("h2",{className:"text-xl font-black text-gray-900 tracking-tight flex items-center gap-3",children:[u.jsx(ei,{className:"text-purple-600",size:24})," Learning History"]}),o.length===0?u.jsx("div",{className:"text-center py-12 bg-white rounded-3xl border border-gray-100 shadow-sm",children:u.jsx("p",{className:"text-gray-400 font-black text-xs uppercase tracking-widest",children:"No past sessions yet"})}):u.jsx("div",{className:"space-y-6 relative before:absolute before:left-[35px] before:top-4 before:bottom-4 before:w-0.5 before:bg-gray-100",children:o.map((re,Qe)=>u.jsxs("div",{className:"relative pl-16",children:[u.jsx("div",{className:"absolute left-[28px] top-6 w-4 h-4 bg-white border-2 border-purple-500 rounded-full z-10 shadow-sm"}),u.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:border-purple-200 transition-all overflow-hidden relative",children:[u.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start gap-4 mb-6",children:[u.jsxs("div",{children:[u.jsx("h4",{className:"text-lg font-black text-gray-900 mb-0.5",children:re.topic||re.subject||"Session"}),u.jsxs("div",{className:"flex items-center gap-2 text-gray-400 font-bold uppercase text-[10px] tracking-widest",children:[u.jsx("span",{children:new Date(re.date).toLocaleDateString("en-GB")}),u.jsx("span",{children:""}),u.jsxs("span",{children:[re.duration||"60"," MINS"]})]})]}),re.rating?u.jsx("div",{className:"flex gap-0.5 bg-yellow-50 px-3 py-1.5 rounded-lg",children:[...Array(5)].map((mt,Xe)=>u.jsx(cl,{size:14,className:Xe<re.rating?"text-yellow-400 fill-current":"text-gray-200"},Xe))}):u.jsx("button",{onClick:()=>pt(re),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-black text-[10px] uppercase tracking-widest",children:"Rate Lesson"})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[u.jsxs("div",{className:"bg-green-50 p-4 rounded-xl border border-green-100",children:[u.jsxs("h5",{className:"font-black text-green-700 text-[10px] uppercase tracking-widest mb-2 flex items-center gap-2",children:[u.jsx(Is,{size:14})," Went Well"]}),u.jsx("p",{className:"text-gray-700 font-semibold text-xs leading-relaxed",children:re.feedback_well||"No comment."})]}),u.jsxs("div",{className:"bg-orange-50 p-4 rounded-xl border border-orange-100",children:[u.jsxs("h5",{className:"font-black text-orange-700 text-[10px] uppercase tracking-widest mb-2 flex items-center gap-2",children:[u.jsx(Jl,{size:14})," To Improve"]}),u.jsx("p",{className:"text-gray-700 font-semibold text-xs leading-relaxed",children:re.feedback_improve||"No comment."})]}),u.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-100",children:[u.jsxs("h5",{className:"font-black text-blue-700 text-[10px] uppercase tracking-widest mb-2 flex items-center gap-2",children:[u.jsx(cl,{size:14})," Focus"]}),u.jsx("p",{className:"text-gray-700 font-semibold text-xs leading-relaxed",children:re.feedback_focus||"General improvement areas."})]}),u.jsxs("div",{className:"bg-purple-50 p-4 rounded-xl border border-purple-100",children:[u.jsxs("h5",{className:"font-black text-purple-700 text-[10px] uppercase tracking-widest mb-2 flex items-center gap-2",children:[u.jsx(Na,{size:14})," Next Steps"]}),u.jsx("p",{className:"text-gray-700 font-semibold text-xs leading-relaxed",children:re.next_steps||re.nextSteps||"Continue regular practice."})]})]}),re.lessonPdfBase64&&u.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:u.jsxs("a",{href:`data:application/pdf;base64,${re.lessonPdfBase64}`,download:`lesson-notes-${new Date(re.date).toISOString().split("T")[0]}.pdf`,className:"inline-flex items-center gap-2 text-teal-600 hover:text-teal-700 font-bold text-sm",children:[u.jsx(Na,{size:16})," Download lesson notes (PDF)"]})})]})]},Qe))})]}),b==="invoices"&&(()=>{const re=[...d,...o].sort((jt,dt)=>new Date(jt.date)-new Date(dt.date)),Qe=new Date,mt=`${Qe.getFullYear()}-${String(Qe.getMonth()+1).padStart(2,"0")}`,Xe=[...new Set(re.map(jt=>{const dt=new Date(jt.date);return`${dt.getFullYear()}-${String(dt.getMonth()+1).padStart(2,"0")}`}))],et=Array.from({length:6},(jt,dt)=>{const sn=new Date(Qe.getFullYear(),Qe.getMonth()+dt,1);return`${sn.getFullYear()}-${String(sn.getMonth()+1).padStart(2,"0")}`}),kt=[...new Set([...et,...Xe])].sort(),[Tt,Rt]=(de||mt).split("-").map(Number),An=re.filter(jt=>{const dt=new Date(jt.date);return dt.getFullYear()===Tt&&dt.getMonth()+1===Rt}),Pn=jt=>(jt.paymentStatus||"").toLowerCase()==="paid",wn=jt=>{if(jt.type==="consultation"||Pn(jt))return"Paid";if(jt.paymentStatus==="In bundle"){const er=JSON.parse(localStorage.getItem("tutor_bookings")||"[]").filter(Ns=>Ns.recurringId===jt.recurringId&&Ns.status!=="cancelled").sort((Ns,Hr)=>new Date(Ns.date+"T"+Ns.time)-new Date(Hr.date+"T"+Hr.time));return er.length===10&&er[0]&&(er[0].paymentStatus||"").toLowerCase()==="paid"?"Paid in bulk":"Awaiting initial payment"}const dt=JSON.parse(localStorage.getItem("tutor_bookings")||"[]");return(jt.recurringId?dt.filter(Un=>Un.recurringId===jt.recurringId&&Un.status!=="cancelled"):[]).length===10&&jt.paymentStatus==="Due"?"Awaiting initial payment":jt.paymentStatus||"Due"};return u.jsxs("div",{className:"space-y-6",children:[u.jsxs("h2",{className:"text-xl font-black text-gray-900 tracking-tight flex items-center gap-3",children:[u.jsx(v1,{className:"text-teal-600",size:24})," Invoices & Billing"]}),u.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[u.jsx("span",{className:"text-xs font-black text-gray-500 uppercase tracking-widest",children:"Month"}),u.jsx("select",{value:de,onChange:jt=>xe(jt.target.value),className:"rounded-xl border-2 border-gray-100 px-4 py-2 font-bold text-sm text-gray-800 bg-white focus:border-teal-500",children:kt.length===0?u.jsx("option",{value:"",children:"No sessions"}):kt.map(jt=>{const[dt,sn]=jt.split("-").map(Number),Un=new Date(dt,sn-1,1).toLocaleDateString("en-GB",{month:"long",year:"numeric"});return u.jsx("option",{value:jt,children:Un},jt)})})]}),u.jsxs("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[u.jsx("div",{className:"overflow-x-auto overflow-y-auto max-h-[60vh]",children:u.jsxs("table",{className:"w-full text-left",children:[u.jsx("thead",{className:"bg-gray-50/50 border-b border-gray-100 sticky top-0 z-10",children:u.jsxs("tr",{children:[u.jsx("th",{className:"p-4 font-black text-gray-400 text-[9px] uppercase tracking-widest",children:"Date"}),u.jsx("th",{className:"p-4 font-black text-gray-400 text-[9px] uppercase tracking-widest",children:"Description"}),u.jsx("th",{className:"p-4 font-black text-gray-400 text-[9px] uppercase tracking-widest",children:"Amount"}),u.jsx("th",{className:"p-4 font-black text-gray-400 text-[9px] uppercase tracking-widest",children:"Status"}),u.jsx("th",{className:"p-4 font-black text-gray-400 text-[9px] uppercase tracking-widest text-right",children:"Action"})]})}),u.jsx("tbody",{className:"divide-y divide-gray-50",children:An.map((jt,dt)=>{const sn=jt.type==="consultation",Un=Hr=>{const Tr=(Hr||"").toLowerCase();return Tr.includes("ks3")?25:Tr.includes("a-level")||Tr.includes("alevel")?40:30},er=sn?0:jt.cost!=null?jt.cost:Un(jt.subject),tr=sn?"Free Consultation":jt.subject||jt.topic||"Tutoring Session",Ns=wn(jt);return u.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[u.jsx("td",{className:"p-4",children:u.jsx("div",{className:"font-bold text-gray-900 text-xs",children:new Date(jt.date).toLocaleDateString("en-GB")})}),u.jsx("td",{className:"p-4",children:u.jsx("div",{className:"font-bold text-gray-600 text-xs",children:tr})}),u.jsxs("td",{className:"p-4 font-black text-gray-900 text-sm",children:["",er]}),u.jsx("td",{className:"p-4",children:u.jsx("span",{className:`px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest border ${Ns==="Paid"||Ns==="Paid in bulk"?"bg-green-100 text-green-700 border-green-200":Ns==="Awaiting initial payment"?"bg-amber-100 text-amber-700 border-amber-200":"bg-red-50 text-red-700 border-red-100"}`,children:Ns})}),u.jsx("td",{className:"p-4 text-right",children:Pn(jt)?u.jsx("button",{onClick:()=>ae(jt),className:"text-[10px] font-black text-gray-400 underline uppercase tracking-widest",children:"Receipt"}):u.jsx("button",{onClick:()=>wt(jt),className:"text-[10px] font-black text-teal-600 underline uppercase tracking-widest",children:"Pay via Stripe"})})]},jt.id||dt)})})]})}),An.length===0&&u.jsx("div",{className:"p-8 text-center text-gray-400 font-bold text-sm",children:"No sessions this month."})]})]})})(),b==="messages"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("h2",{className:"text-xl font-black text-gray-900 tracking-tight flex items-center gap-3",children:[u.jsx(Hc,{className:"text-teal-500",size:24})," Messaging"]}),u.jsxs("div",{className:"bg-white rounded-3xl border border-gray-100 shadow-lg overflow-hidden flex flex-col",style:{height:"600px"},children:[u.jsxs("div",{className:"p-6 bg-teal-500 text-white flex items-center gap-3 shadow-md",children:[u.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-md rounded-xl flex items-center justify-center font-black text-lg",children:"D"}),u.jsxs("div",{children:[u.jsx("div",{className:"font-black text-lg leading-none",children:"Davina (Your Tutor)"}),u.jsx("div",{className:"text-teal-100 text-[10px] font-bold uppercase tracking-widest mt-1",children:"Direct Message Channel"})]})]}),u.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 bg-gray-50/30",children:ve.length===0?u.jsx("div",{className:"h-full flex items-center justify-center text-gray-300 font-black uppercase tracking-[0.2em] italic text-xs",children:"No messages yet. Say hello!"}):ve.map((re,Qe)=>u.jsx("div",{className:`flex ${re.sender===t?"justify-end":"justify-start"}`,children:u.jsxs("div",{className:`max-w-[80%] p-4 rounded-2xl shadow-sm ${re.sender===t?"bg-teal-600 text-white rounded-br-md":"bg-white border border-gray-100 text-gray-800 rounded-bl-md"}`,children:[u.jsx("p",{className:"text-sm font-bold leading-relaxed",children:re.message}),u.jsx("div",{className:"text-[9px] mt-2 font-black uppercase opacity-60",children:new Date(re.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},Qe))}),u.jsx("div",{className:"p-6 bg-white border-t border-gray-100",children:u.jsxs("div",{className:"flex gap-3",children:[u.jsx("input",{type:"text",value:ke,onChange:re=>X(re.target.value),onKeyPress:re=>re.key==="Enter"&&Bt(),placeholder:"Type a message...",className:"flex-1 px-5 py-3 rounded-xl border-2 border-gray-50 bg-gray-50 focus:bg-white focus:border-teal-500 transition-all font-bold text-sm"}),u.jsx("button",{onClick:Bt,className:"bg-teal-500 text-white px-6 rounded-xl font-black uppercase tracking-widest text-xs transition-all shadow-md active:scale-95",children:"Send"})]})})]})]})]})]})]}),G&&$&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[150] flex items-center justify-center p-4",children:u.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-sm w-full p-8 text-center animate-in zoom-in-95",children:[u.jsx(ei,{className:"mx-auto text-purple-600 mb-4",size:40}),u.jsx("h3",{className:"text-xl font-black mb-2",children:"Reschedule Lesson?"}),u.jsx("p",{className:"text-gray-500 mb-6 font-bold text-sm",children:"Select a new time slot from the booking calendar. Your tutor will be notified of the change request."}),u.jsxs("div",{className:"flex flex-col gap-3",children:[u.jsx("button",{onClick:Mt,className:"w-full py-3 bg-purple-600 text-white rounded-xl font-black shadow-lg uppercase tracking-widest text-xs hover:bg-purple-700 transition-all",children:"Choose New Slot"}),u.jsx("button",{onClick:()=>R(!1),className:"w-full py-3 text-gray-400 font-black uppercase tracking-widest text-xs",children:"Nevermind"})]})]})}),w&&O&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4",children:u.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-y-auto max-h-[90vh] animate-in zoom-in-95",onClick:re=>re.stopPropagation(),children:[u.jsxs("div",{className:"bg-teal-600 p-6 text-white relative",children:[u.jsx("h3",{className:"text-xl font-black mb-1",children:$?"Confirm Reschedule":"Secure Your Lesson"}),u.jsxs("p",{className:"text-teal-100 font-bold opacity-80 uppercase tracking-widest text-[10px]",children:[new Date(O.date).toLocaleDateString("en-GB",{weekday:"long",month:"long",day:"numeric"})," at ",O.time]}),!$&&u.jsxs("div",{className:"absolute top-6 right-6 font-black text-2xl",children:["",ue(_)==="KS3"?25:ue(_)==="A-Level"?40:30]})]}),u.jsxs("div",{className:"p-6 space-y-4",children:[$&&u.jsxs("div",{className:"bg-purple-50 p-4 rounded-xl border border-purple-100",children:[u.jsx("h4",{className:"font-black text-purple-800 text-[10px] uppercase tracking-widest mb-1",children:"Current Lesson:"}),u.jsxs("p",{className:"text-gray-600 font-bold text-sm",children:[new Date($.date).toLocaleDateString("en-GB")," at ",$.time]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-teal-600 font-black uppercase tracking-widest text-[9px] mb-2 ml-1",children:"Lesson type"}),u.jsx("input",{type:"text",value:_,onChange:re=>N(re.target.value),placeholder:"e.g. KS3 Maths, GCSE Sociology",className:"w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-teal-500 transition-all font-bold text-sm bg-gray-50"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-gray-400 font-black uppercase tracking-widest text-[9px] mb-2 ml-1",children:"Lesson notes (optional  for your teacher)"}),u.jsx("textarea",{value:E,onChange:re=>k(re.target.value),placeholder:"e.g. Quadratic equations, essay structure, topics you want to cover...",className:"w-full border border-gray-200 rounded-xl p-4 focus:border-teal-500 transition-all font-medium text-sm min-h-[80px] bg-gray-50"})]}),!$&&u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{className:"bg-teal-50 p-4 rounded-xl border border-teal-100 flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("p",{className:"font-black text-teal-800 text-[10px] uppercase tracking-widest",children:"Enable Recurring?"}),u.jsx("p",{className:"text-gray-500 text-[10px] font-bold",children:"Secure this slot weekly"})]}),u.jsx("button",{onClick:()=>P(!T),className:`px-4 py-2 rounded-lg font-black text-[10px] uppercase tracking-widest transition-all border-2 ${T?"bg-teal-600 border-teal-600 text-white shadow-md":"bg-white border-gray-200 text-gray-400 hover:border-teal-500 hover:text-teal-500"}`,children:T?"Active":"Enable"})]}),T&&u.jsxs("div",{className:"bg-white p-4 rounded-xl border-2 border-teal-500 animate-in slide-in-from-top-2 space-y-4",children:[u.jsxs("div",{className:"flex items-center gap-2 text-teal-600",children:[u.jsx(cl,{size:16,fill:"currentColor"}),u.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Recurring Options"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.jsxs("button",{onClick:()=>Me("weekly"),className:`p-3 rounded-xl border-2 transition-all text-center ${je==="weekly"?"border-teal-600 bg-teal-50":"border-gray-100 hover:border-teal-200"}`,children:[u.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest mb-1",children:"Pay Weekly"}),u.jsxs("div",{className:"text-lg font-black text-teal-600",children:["",Ke]})]}),u.jsxs("button",{onClick:()=>Me("pack"),className:`p-3 rounded-xl border-2 transition-all text-center ${je==="pack"?"border-teal-600 bg-teal-50":"border-gray-100 hover:border-teal-200"}`,children:[u.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest mb-1",children:"Pay Upfront"}),u.jsxs("div",{className:"text-lg font-black text-teal-600",children:["",Te(_)]}),u.jsx("div",{className:"text-[8px] font-bold text-teal-500 uppercase mt-1",children:"10-Week Bundle"})]})]}),u.jsx("p",{className:"text-[11px] text-gray-700 font-bold leading-relaxed",children:je==="pack"?"Pay for all 10 sessions now and save! Subsequent sessions will be marked as Paid.":"Secure this slot for the next 9 weeks. You only pay for each lesson as it comes."}),je==="pack"&&u.jsxs("div",{className:"mt-3 p-3 rounded-xl bg-amber-50 border border-amber-200 text-left",children:[u.jsx("p",{className:"text-[10px] font-black text-amber-800 uppercase tracking-widest mb-1",children:"Refund & Administrative Fee Policy"}),u.jsx("p",{className:"text-[10px] text-amber-900 font-medium leading-relaxed",children:"A non-refundable administrative fee of 15.00 applies to all bundle purchases to cover secure payment processing and account setup. In the event of a requested refund for unused sessions, the refund will be calculated based on the remaining balance minus this administrative fee. Please note that used sessions are non-refundable."})]})]})]}),u.jsxs("div",{className:"flex gap-3",children:[u.jsx("button",{onClick:()=>v(!1),className:"flex-1 py-3 text-gray-400 font-black uppercase tracking-widest text-xs",children:"Cancel"}),u.jsxs("button",{onClick:lt,className:"flex-[2] bg-teal-600 text-white py-3 rounded-xl font-black shadow-lg uppercase tracking-widest text-xs",children:["Confirm ",$?"Change":"Booking"]})]})]})]})}),ce&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4",children:u.jsxs("div",{className:"bg-white p-8 rounded-3xl shadow-2xl max-w-lg w-full animate-in zoom-in-95 max-h-[90vh] overflow-y-auto",children:[u.jsx("h3",{className:"text-xl font-black tracking-tight mb-4 text-gray-900",children:"Lesson type & notes"}),u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{className:"block text-[10px] font-black text-teal-600 uppercase tracking-widest mb-2",children:"Lesson type"}),u.jsx("input",{type:"text",value:ce.currentSubject||"",onChange:re=>ye({...ce,currentSubject:re.target.value}),className:"w-full border-2 border-gray-100 rounded-xl px-4 py-3 font-bold text-gray-800 bg-gray-50 focus:border-teal-500 transition-all",placeholder:"e.g. KS3 Maths, GCSE Sociology"})]}),u.jsxs("div",{className:"mb-6",children:[u.jsx("label",{className:"block text-[10px] font-black text-gray-500 uppercase tracking-widest mb-2",children:"Lesson notes (for your teacher)"}),u.jsx("textarea",{value:ce.currentLessonNotes||"",onChange:re=>ye({...ce,currentLessonNotes:re.target.value}),className:"w-full border-2 border-gray-100 rounded-xl p-4 min-h-[120px] font-medium text-gray-800 bg-gray-50 focus:border-teal-500 transition-all",placeholder:"e.g. Quadratic equations, essay structure, topics you want to cover..."})]}),u.jsxs("div",{className:"flex gap-4",children:[u.jsx("button",{onClick:()=>ye(null),className:"flex-1 py-4 text-gray-400 font-black uppercase tracking-widest text-xs",children:"Discard"}),u.jsx("button",{onClick:it,className:"flex-[2] py-4 bg-teal-600 text-white rounded-2xl font-black shadow-lg uppercase tracking-widest text-xs",children:"Save"})]})]})}),K&&Pe&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4",children:u.jsxs("div",{className:"bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full text-center max-h-[90vh] overflow-y-auto",children:[u.jsx("h3",{className:"text-2xl font-black tracking-tight mb-6",children:"How was your lesson?"}),u.jsx("div",{className:"flex justify-center gap-1 mb-6",children:[1,2,3,4,5].map(re=>u.jsx("button",{onClick:()=>Ye(re),className:`p-1 transition-all ${bt>=re?"text-yellow-400":"text-gray-200"}`,children:u.jsx(cl,{size:32,fill:"currentColor"})},re))}),u.jsx("textarea",{value:Et,onChange:re=>vt(re.target.value),placeholder:"Describe your experience...",className:"w-full border border-gray-200 bg-gray-50 rounded-2xl p-5 min-h-[120px] mb-6 font-bold text-sm"}),u.jsx("button",{onClick:It,disabled:!bt,className:"w-full py-4 bg-yellow-400 text-gray-900 rounded-2xl font-black disabled:opacity-30 uppercase tracking-widest text-sm shadow-lg",children:"Submit Review"})]})}),he&&u.jsx("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-[200] animate-in slide-in-from-bottom-10",children:u.jsxs("div",{className:`px-8 py-4 rounded-full shadow-2xl flex items-center gap-3 border-2 ${he.type==="error"?"bg-red-500 border-red-400 text-white":"bg-teal-600 border-teal-500 text-white"}`,children:[he.type==="error"?u.jsx(To,{size:20}):u.jsx(Is,{size:20}),u.jsx("span",{className:"font-black text-sm tracking-tight",children:he.message}),u.jsx("button",{onClick:()=>me(null),className:"ml-2 opacity-50 text-xl",children:""})]})}),L&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[150] flex items-center justify-center p-4",children:u.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-sm w-full overflow-y-auto max-h-[90vh] text-center p-8",children:[u.jsx("h3",{className:"text-2xl font-black mb-6",children:"Make Payment"}),u.jsx("div",{className:"bg-gray-50 p-6 rounded-2xl mb-6",children:u.jsxs("div",{className:"text-3xl font-black text-gray-900",children:["",L.type==="consultation"?0:L.cost??(ue(_)==="KS3"?25:ue(_)==="A-Level"?40:30),".00"]})}),u.jsx("a",{href:(()=>{const re=(L.subject||"").toLowerCase(),Qe=re.includes("a-level")||re.includes("alevel")||re.includes("a level")||re.includes("a-lvl"),mt=re.includes("gcse");return L.type!=="consultation"&&(L.type==="pack"||L.cost>=230)?Qe?"https://buy.stripe.com/bJe9ATbUXed93oG4XNeIw03":mt?"https://buy.stripe.com/9AQ3cv9MT7OP5mE3cl":"https://buy.stripe.com/28EbJ17EHed97EW9e3eIw04":Qe?"https://buy.stripe.com/9B6fZhgbdd956ASdujeIw02":mt?"https://buy.stripe.com/14AdR9fjjclh8yQfZ1":"https://buy.stripe.com/eVq4gz3or5GDbVccqfeIw05"})(),target:"_blank",rel:"noopener noreferrer",className:"block w-full py-4 bg-teal-600 text-white rounded-2xl font-black shadow-lg uppercase tracking-widest text-xs",children:"Pay via Stripe"}),u.jsx("button",{onClick:()=>{At(L.id),U(null),me({type:"success",message:"Payment recorded!"})},className:"w-full py-3 text-gray-400 font-black uppercase tracking-widest text-[9px] mt-4",children:"Mark Paid Manually"}),u.jsx("button",{onClick:()=>U(null),className:"text-gray-400 font-black uppercase tracking-widest text-[9px] mt-4 block mx-auto",children:"Cancel"})]})}),H&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[150] flex items-center justify-center p-4",children:u.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-sm w-full p-8 max-h-[90vh] overflow-y-auto",children:[u.jsx("h3",{className:"text-2xl font-black mb-6 text-center",children:"Receipt"}),u.jsxs("div",{className:"space-y-3 border-t border-b border-dashed border-gray-200 py-4 mb-6 text-center",children:[u.jsxs("div",{className:"flex justify-between font-bold text-sm",children:[u.jsx("span",{className:"text-gray-400 uppercase text-[9px]",children:"Date"}),u.jsx("span",{children:new Date(H.date).toLocaleDateString("en-GB")})]}),u.jsxs("div",{className:"flex justify-between font-bold text-sm",children:[u.jsx("span",{className:"text-gray-400 uppercase text-[9px]",children:"Lesson"}),u.jsx("span",{children:H.subject||"Session"})]}),u.jsxs("div",{className:"flex justify-between font-black text-lg",children:[u.jsx("span",{className:"text-gray-400 uppercase text-[9px] font-bold",children:"Amount"}),u.jsxs("span",{className:"text-teal-600",children:["",H.type==="consultation"?0:H.cost??30,".00"]})]})]}),u.jsx("button",{onClick:()=>ae(null),className:"w-full py-4 bg-gray-900 text-white rounded-2xl font-black uppercase tracking-widest text-xs",children:"Close"})]})}),Pt&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[150] flex items-center justify-center p-4",children:u.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-sm w-full p-8 text-center max-h-[90vh] overflow-y-auto",children:[u.jsx(Kl,{className:"mx-auto text-red-500 mb-4",size:40}),u.jsx("h3",{className:"text-xl font-black mb-2",children:"Cancel Lesson?"}),u.jsx("p",{className:"text-gray-500 mb-2 font-bold text-sm",children:Pt.recurringId?"This session is part of a recurring series. Would you like to cancel just this one, or the entire series?":`Are you sure you want to cancel your session on ${new Date(Pt.date).toLocaleDateString("en-GB")} at ${Pt.time}?`}),Pt.recurringId&&(()=>{const Qe=JSON.parse(localStorage.getItem("tutor_bookings")||"[]").filter(Xe=>Xe.recurringId===Pt.recurringId&&Xe.status!=="cancelled").sort((Xe,et)=>new Date(Xe.date+"T"+Xe.time)-new Date(et.date+"T"+et.time));return Qe.length===10&&Qe[0]&&(Qe[0].paymentStatus||"").toLowerCase()==="paid"?u.jsx("p",{className:"text-amber-700 text-sm font-medium mb-4 bg-amber-50 rounded-xl p-3",children:"Part of a paid pack  no refund for individual lessons. Consider rescheduling instead."}):null})(),u.jsxs("div",{className:"flex flex-col gap-3",children:[Pt.recurringId?u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:()=>Yt(!1),className:"w-full py-3 bg-red-100 text-red-600 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-red-200 transition-all",children:"Cancel Just This One"}),u.jsx("button",{onClick:()=>Yt(!0),className:"w-full py-3 bg-red-600 text-white rounded-xl font-black shadow-lg uppercase tracking-widest text-xs hover:bg-red-700 transition-all",children:"Cancel Entire Series"})]}):u.jsx("button",{onClick:()=>Yt(),className:"w-full py-3 bg-red-600 text-white rounded-xl font-black shadow-lg uppercase tracking-widest text-xs",children:"Cancel Session"}),u.jsx("button",{onClick:()=>{Ut(null),en(Pt)},className:"w-full py-3 bg-blue-50 text-blue-600 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-blue-100",children:"Reschedule instead"}),u.jsx("button",{onClick:()=>Ut(null),className:"w-full py-3 text-gray-400 font-black uppercase tracking-widest text-xs",children:"Keep Session"})]})]})})]})},iT=()=>{const s=ka(),e=(ue,Te=null)=>{const Oe=(Te||ue?.subject||"").toLowerCase();return Oe.includes("a-level")||Oe.includes("alevel")||Oe.includes("a level")||Oe.includes("a-lvl")?"A-Level":Oe.includes("gcse")?"GCSE":"KS3"},{parentEmail:t}=gb(),[n,r]=Y.useState(null),[i,o]=Y.useState([]),[l,d]=Y.useState(null),[h,p]=Y.useState([]),[g,b]=Y.useState([]),[x,w]=Y.useState("overview"),[v,_]=Y.useState(null),[N,E]=Y.useState(!1),[k,T]=Y.useState([]),[P,O]=Y.useState(""),[F,$]=Y.useState("options"),[z,G]=Y.useState("single"),[R,q]=Y.useState("once"),[J,Z]=Y.useState([]),[le,K]=Y.useState(null),[se,ce]=Y.useState([]),[ye,Ce]=Y.useState(!1),[M,L]=Y.useState(null),[U,H]=Y.useState(""),[ae,de]=Y.useState(null),[xe,he]=Y.useState(null),[me,ve]=Y.useState(()=>{const ue=new Date;return`${ue.getFullYear()}-${String(ue.getMonth()+1).padStart(2,"0")}`}),Re="tutor_parent_notes",[Ke,Ge]=Y.useState(""),[ke,X]=Y.useState(()=>{const ue=new Date;return`${ue.getFullYear()}-${String(ue.getMonth()+1).padStart(2,"0")}`}),[,Pe]=Y.useState(0);Y.useEffect(()=>{const ue=Te=>{Te.key==="chat_messages_v2"&&Pe(Oe=>Oe+1)};return window.addEventListener("storage",ue),()=>window.removeEventListener("storage",ue)},[]),Y.useEffect(()=>{const ue=()=>{const Oe=(JSON.parse(localStorage.getItem("tutor_parents"))||[]).find(wt=>wt.email.toLowerCase()===decodeURIComponent(t).toLowerCase());if(!Oe){s("/");return}r(Oe);const ft=(JSON.parse(localStorage.getItem("tutor_students"))||[]).filter(wt=>Oe.linkedStudents.includes(wt.id));o(ft),ft.length>0&&!l&&d(ft[0])};return ue(),window.addEventListener("storage",ue),()=>window.removeEventListener("storage",ue)},[t,s]);const gt=()=>{if(!l)return;const Te=(JSON.parse(localStorage.getItem("tutor_session_history"))||[]).filter(it=>it.studentId===l.id||it.studentName.toLowerCase()===l.name.toLowerCase());p(Te.reverse());const ct=(JSON.parse(localStorage.getItem("tutor_bookings"))||[]).filter(it=>(it.studentId===l.id||it.student.toLowerCase()===l.name.toLowerCase()||it.parentId===n.id&&it.bookingFor==="parent")&&it.status!=="cancelled"),ft=new Date,wt=ct.filter(it=>new Date(it.date+"T"+it.time)>=ft).sort((it,At)=>new Date(it.date+"T"+it.time)-new Date(At.date+"T"+At.time));b(wt)};Y.useEffect(()=>(gt(),window.addEventListener("storage",gt),()=>window.removeEventListener("storage",gt)),[l]),Y.useEffect(()=>{l?.subject&&H(l.subject)},[l]);const bt=ue=>{const Oe=(JSON.parse(localStorage.getItem("tutor_bookings"))||[]).map(ct=>ue.recurringId&&ct.recurringId===ue.recurringId?{...ct,status:"confirmed"}:ct.id===ue.id?{...ct,status:"confirmed"}:ct);localStorage.setItem("tutor_bookings",JSON.stringify(Oe)),window.dispatchEvent(new Event("storage")),ue.status==="pending_reschedule"?xr.sendRescheduleResponseToTeacher(ue,"Accepted"):xr.sendNewBookingNotificationToTeacher({...ue,student:ue.student||l?.name}),_({type:"success",message:"Lesson(s) approved and confirmed!"})},Ye=ue=>{L(ue),$("select"),G("single"),w("book")},Et=ue=>{if(!l)return;const Te=ue.paymentStatus?.toLowerCase()==="paid",Oe=ue.paymentStatus==="Due (Exception)",ct=ue.paymentStatus==="In bundle",ft=ue.type==="consultation";if(!Te&&!Oe&&!ct&&!ft){_({type:"error",message:"Please pay for this lesson before starting. You can pay in the Invoices tab."}),w("invoices");return}s(`/session/${ue.id}?student=${encodeURIComponent(l.name)}`)},vt=(ue=!1)=>{if(!ae)return;const Te=ae,Oe=JSON.parse(localStorage.getItem("tutor_bookings"))||[];let ct,ft=[];ue&&Te.recurringId?(ct=Oe.map(At=>At.recurringId===Te.recurringId&&new Date(At.date)>=new Date(Te.date)?{...At,status:"cancelled"}:At),ft=Oe.filter(At=>At.recurringId===Te.recurringId&&new Date(At.date)>=new Date(Te.date))):(ct=Oe.map(At=>At.id===Te.id?{...At,status:"cancelled"}:At),ft=[Te]),localStorage.setItem("tutor_bookings",JSON.stringify(ct));const it=(JSON.parse(localStorage.getItem("tutor_all_lesson_slots"))||[]).map(At=>ft.some(We=>We.date===At.date&&We.time===At.time)?{...At,bookedBy:null}:At);localStorage.setItem("tutor_all_lesson_slots",JSON.stringify(it)),ft.forEach(At=>{xr.sendCancellationNotice(At,"student")}),window.dispatchEvent(new Event("storage")),gt(),_({type:"info",message:ue?"Entire series cancelled.":"Lesson cancelled successfully."}),de(null)};Y.useEffect(()=>{const ue=JSON.parse(localStorage.getItem("tutor_all_lesson_slots"))||[],Te=JSON.parse(localStorage.getItem("tutor_bookings"))||[],Oe=ue.filter(ct=>!ct.bookedBy&&!Te.some(ft=>ft.date===ct.date&&ft.time===ct.time&&ft.status!=="cancelled"));Z(Oe)},[x]),Y.useEffect(()=>{if(!n)return;const ue=()=>{const Te=JSON.parse(localStorage.getItem("chat_messages_v2"))||{},Oe=`parent_${n.email}`;T(Te[Oe]||[])};return ue(),window.addEventListener("storage",ue),()=>window.removeEventListener("storage",ue)},[n]),Y.useEffect(()=>{if(x==="messages"&&n){const ue=JSON.parse(localStorage.getItem("chat_messages_v2"))||{},Te=`parent_${n.email}`,Oe=ue[Te]||[];if(Oe.some(ft=>ft.sender==="Davina"&&!ft.read)){const ft=Oe.map(wt=>wt.sender==="Davina"?{...wt,read:!0}:wt);ue[Te]=ft,localStorage.setItem("chat_messages_v2",JSON.stringify(ue)),T(ft),window.dispatchEvent(new Event("storage"))}}},[x,n]),Y.useEffect(()=>{const ue=n?.email||t||"";if(ue)try{const Te=localStorage.getItem(Re),Oe=Te?JSON.parse(Te):{};Ge(Oe[ue]&&Oe[ue].note||"")}catch{}},[n,t]);const st=ue=>{const Te=n?.email||t||"";if(Te)try{const Oe=localStorage.getItem(Re)||"{}",ct=JSON.parse(Oe);ct[Te]={note:ue||"",updated:new Date().toISOString()},localStorage.setItem(Re,JSON.stringify(ct))}catch{}},St=Y.useRef(null);Y.useEffect(()=>(St.current&&clearTimeout(St.current),St.current=setTimeout(()=>{st(Ke)},500),()=>{St.current&&clearTimeout(St.current)}),[Ke]);const Pt=()=>{if(!P.trim()||!n)return;const ue=JSON.parse(localStorage.getItem("chat_messages_v2"))||{},Te=`parent_${n.email}`,Oe=ue[Te]||[],ct={id:Date.now(),sender:n.email,senderName:n.email,message:P.trim(),timestamp:new Date().toISOString(),read:!1},ft=[...Oe,ct];ue[Te]=ft,localStorage.setItem("chat_messages_v2",JSON.stringify(ue)),T(ft);const wt=P.trim();O(""),window.dispatchEvent(new Event("storage")),xr.sendMessageNotification(n.name,"davina.potter@outlook.com",wt)},Ut=ue=>{if(ue.type==="consultation")return 0;if(ue.cost!=null&&ue.cost!==void 0)return Number(ue.cost);const Te=e(l,ue.subject);return Te==="A-Level"?40:Te==="KS3"?25:30},je=ue=>{const Te=e(l,ue);return Te==="A-Level"?370:Te==="KS3"?230:280},Fe=l?(()=>{const ue=h.length,Te=[],Oe=new Set,ct={};g.forEach(it=>{it.recurringId&&(ct[it.recurringId]||(ct[it.recurringId]=[]),ct[it.recurringId].push(it))}),Object.keys(ct).forEach(it=>{const At=ct[it].sort((We,lt)=>new Date(We.date+"T"+We.time)-new Date(lt.date+"T"+lt.time));if(At.length===10){const We=At[0];if((We.paymentStatus||"").toLowerCase()!=="paid"){Oe.add(it);const lt=We.cost!=null&&We.cost!==void 0?Number(We.cost):je(We.subject);Te.push({id:it,subject:We.subject,cost:lt,date:We.date,paymentStatus:"Due",type:"pack",label:"10-lesson pack"})}}}),g.forEach(it=>{it.type!=="consultation"&&(it.recurringId&&Oe.has(it.recurringId)||(!it.recurringId||!ct[it.recurringId]||ct[it.recurringId].length!==10)&&(it.paymentStatus||"").toLowerCase()==="due"&&Te.push({...it,cost:Ut(it)}))}),h.forEach(it=>{it.type!=="consultation"&&(it.paymentStatus||"").toLowerCase()==="due"&&Te.push({...it,cost:Ut(it)})}),Te.sort((it,At)=>new Date(it.date||0)-new Date(At.date||0));const ft=Te.reduce((it,At)=>it+(Number(At.cost)||Ut(At)),0),wt=g.length>0?g[0]:null;return{completed:ue,unpaidCount:Te.length,totalDue:ft,nextLesson:wt,unpaidInvoices:Te}})():{completed:0,unpaidCount:0,totalDue:0,nextLesson:null,unpaidInvoices:[]};return n?u.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col font-sans text-gray-800",children:[u.jsx("nav",{className:"bg-white sticky top-0 z-50 border-b border-gray-200",children:u.jsxs("div",{className:"max-w-6xl mx-auto px-6 h-20 flex justify-between items-center",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-10 h-10 bg-blue-100 flex items-center justify-center text-blue-600 rounded-full",children:u.jsx(rh,{size:24})}),u.jsxs("div",{children:[u.jsx("h1",{className:"text-xl font-bold text-blue-600 tracking-tight",children:"Parent Portal"}),u.jsx("p",{className:"text-xs text-gray-500",children:"Davina's Tutoring Platform"})]})]}),u.jsxs("div",{className:"flex items-center gap-6",children:[u.jsxs("div",{className:"hidden md:block text-right",children:[u.jsx("p",{className:"font-bold text-gray-700 text-sm",children:n.email}),u.jsx("p",{className:"text-xs text-gray-400",children:"Parent Account"})]}),u.jsxs("button",{onClick:()=>s("/"),className:"text-red-400 hover:text-red-500 flex items-center gap-2 text-sm font-bold",children:[u.jsx(vb,{size:16})," Sign Out"]})]})]})}),u.jsxs("main",{className:"flex-1 max-w-6xl mx-auto w-full p-6 space-y-6",children:[u.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:u.jsxs("div",{children:[u.jsxs("h2",{className:"text-3xl font-black text-gray-900 leading-tight",children:["Welcome back, ",n?.firstName||n?.name?.split(" ")[0]||"Parent","!"]}),u.jsx("p",{className:"text-gray-500 font-medium",children:"Manage your children's tutoring sessions and payments."})]})}),i.length>0&&u.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[u.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[u.jsx(Pu,{size:20,className:"text-blue-600"}),"My Children"]}),u.jsx("div",{className:"grid gap-3",children:i.map(ue=>u.jsxs("button",{onClick:()=>d(ue),className:`flex items-center justify-between p-4 rounded-xl border-2 transition-all ${l?.id===ue.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300 bg-white"}`,children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-400 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-lg",children:ue.name.charAt(0)}),u.jsxs("div",{className:"text-left",children:[u.jsx("p",{className:"font-bold text-gray-900",children:ue.name}),u.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[u.jsx("p",{className:"text-xs text-gray-400 font-medium",children:ue.email}),u.jsx("span",{className:"text-[10px] font-black uppercase text-blue-600 bg-blue-50 px-2 py-0.5 rounded-md border border-blue-100",children:ue.subject})]})]})]}),l?.id===ue.id&&u.jsx(Is,{className:"text-blue-600",size:24})]},ue.id))})]}),i.length===0&&u.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-8 text-center",children:[u.jsx(Pu,{size:48,className:"text-blue-400 mx-auto mb-4"}),u.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"No Students Linked"}),u.jsx("p",{className:"text-gray-600",children:"Your account hasn't been linked to any students yet."})]}),l&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 mb-2",children:[u.jsxs("h2",{className:"text-2xl font-black text-slate-800",children:["Dashboard for ",l.name]}),u.jsx("div",{className:"px-4 py-1.5 bg-blue-600 text-white rounded-full text-[10px] font-black uppercase tracking-widest shadow-md",children:l.subject})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[u.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx(wg,{className:"text-purple-500",size:24}),u.jsx("span",{className:"text-3xl font-bold text-gray-900",children:Fe.completed})]}),u.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Sessions Completed"})]}),u.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx(ll,{className:"text-teal-500",size:24}),u.jsx("span",{className:"text-3xl font-bold text-gray-900",children:g.length})]}),u.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Upcoming Lessons"})]}),u.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx(Na,{className:"text-orange-500",size:24}),u.jsx("span",{className:"text-3xl font-bold text-gray-900",children:Fe.unpaidCount})]}),u.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Unpaid Invoices"})]}),u.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx(L6,{className:"text-red-500",size:24}),u.jsxs("span",{className:"text-3xl font-bold text-gray-900",children:["",Fe.totalDue]})]}),u.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Outstanding Balance"})]})]}),Fe.totalDue>0&&u.jsxs("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 rounded-2xl shadow-lg p-6 text-white text-center md:text-left flex flex-col md:flex-row items-center justify-between gap-4",children:[u.jsxs("div",{children:[u.jsx("h3",{className:"text-xl font-bold mb-1",children:"Outstanding Balance"}),u.jsx("p",{className:"text-orange-100 text-sm",children:"Pay now to keep learning on track"}),u.jsxs("p",{className:"text-3xl font-bold mt-2",children:["",Fe.totalDue]})]}),u.jsx("a",{href:(()=>{const ue=e(l);return Fe.totalDue>=280?ue==="A-Level"?"https://buy.stripe.com/5kA6oLe0Y6GHchG4gn":ue==="KS3"?"https://buy.stripe.com/28EbJ17EHed97EW9e3eIw04":"https://buy.stripe.com/eVqbJ1bUX1qnbVcdujeIw01":ue==="A-Level"?"https://buy.stripe.com/bJe9ATbUXed93oG4XNeIw03":ue==="KS3"?"https://buy.stripe.com/eVq4gz3or5GDbVccqfeIw05":"https://buy.stripe.com/14A3cv5wzglh1gyai7eIw00"})(),target:"_blank",rel:"noopener noreferrer",className:"bg-white text-orange-600 px-8 py-3 rounded-xl font-bold hover:shadow-xl transition-all",children:"Pay Outstanding via Stripe"})]}),u.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200",children:[u.jsx("div",{className:"border-b border-gray-200 px-6 py-3",children:u.jsx("div",{className:"flex gap-6 overflow-x-auto",children:["overview","upcoming","book","messages","invoices"].map(ue=>u.jsxs("button",{onClick:()=>w(ue),className:`py-3 px-4 font-bold transition-all border-b-2 whitespace-nowrap relative ${x===ue?"border-blue-600 text-blue-600":"border-transparent text-gray-400 hover:text-gray-600"}`,children:[ue==="book"?"Book Lesson":ue.charAt(0).toUpperCase()+ue.slice(1),ue==="messages"&&(()=>{const Te=n?`parent_${n.email}`:"",ft=(JSON.parse(localStorage.getItem("chat_messages_v2")||"{}")[Te]||[]).filter(wt=>wt.sender!==n?.email&&!wt.read).length;return ft>0?u.jsx("span",{className:"absolute -top-0.5 -right-0.5 min-w-[1.25rem] h-5 px-1 flex items-center justify-center bg-red-500 text-white text-xs font-bold rounded-full",children:ft>9?"9+":ft}):null})()]},ue))})}),u.jsxs("div",{className:"p-6",children:[x==="overview"&&u.jsxs("div",{className:"space-y-6",children:[Fe.nextLesson&&u.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-6 text-white flex flex-col sm:flex-row items-center justify-between gap-4",children:[u.jsxs("div",{children:[u.jsx("h3",{className:"text-sm font-bold uppercase tracking-wider text-blue-100 mb-1",children:"Next Lesson"}),u.jsx("p",{className:"text-xl font-bold",children:Fe.nextLesson.subject||"Session"}),u.jsxs("p",{className:"text-blue-100 text-sm mt-1",children:[new Date(Fe.nextLesson.date).toLocaleDateString("en-GB")," at ",Fe.nextLesson.time]})]}),(()=>{const ue=JSON.parse(localStorage.getItem("tutor_bookings")||"[]"),Te=Fe.nextLesson.recurringId?ue.filter(wt=>wt.recurringId===Fe.nextLesson.recurringId&&wt.status!=="cancelled").sort((wt,it)=>new Date(wt.date+"T"+wt.time)-new Date(it.date+"T"+it.time)):[],Oe=Te.length===10&&Te[0]&&(Te[0].paymentStatus||"").toLowerCase()==="paid",ct=Te.length===10,ft=Fe.nextLesson.type==="consultation"||Fe.nextLesson.paymentStatus==="Due (Exception)"||(ct?Oe:Fe.nextLesson.paymentStatus?.toLowerCase()==="paid"||Fe.nextLesson.paymentStatus==="Due");return u.jsxs("button",{onClick:()=>Et(Fe.nextLesson),className:`px-6 py-3 rounded-xl font-bold flex items-center gap-2 transition-all shrink-0 ${ft?"bg-white text-blue-600 hover:shadow-lg":"bg-white/30 text-blue-100 cursor-not-allowed"}`,disabled:!ft,title:ft?"Start lesson as "+l.name:"Pay for the first lesson in the pack in Invoices first",children:[u.jsx(dl,{size:20})," Start Lesson"]})})()]}),u.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Recent Session History"}),h.length>0?u.jsx("div",{className:"space-y-3",children:h.map(ue=>u.jsx("div",{className:"p-4 bg-gray-50 rounded-xl border border-gray-200",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex-1",children:[u.jsx("p",{className:"font-bold text-gray-900",children:ue.subject}),u.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[new Date(ue.endTime||ue.date).toLocaleDateString("en-GB"),"  ",ue.duration||"60"," mins"]}),u.jsxs("div",{className:"mt-3 space-y-2",children:[ue.feedback_well&&u.jsxs("div",{className:"bg-green-50 p-2 rounded-lg border border-green-100",children:[u.jsx("p",{className:"text-[10px] font-bold text-green-800 uppercase mb-0.5",children:"Went Well"}),u.jsx("p",{className:"text-xs text-gray-700",children:ue.feedback_well})]}),ue.lessonPdfBase64&&u.jsxs("a",{href:`data:application/pdf;base64,${ue.lessonPdfBase64}`,download:`lesson-notes-${new Date(ue.date).toISOString().split("T")[0]}.pdf`,className:"inline-flex items-center gap-1.5 text-blue-600 hover:text-blue-700 font-bold text-xs",children:[u.jsx(Na,{size:14})," Download lesson notes (PDF)"]})]})]}),ue.rating&&u.jsxs("div",{className:"flex items-center gap-1 text-yellow-500",children:[u.jsx(cl,{size:16,fill:"currentColor"}),u.jsxs("span",{className:"font-bold",children:[ue.rating,"/5"]})]})]})},ue.id))}):u.jsx("p",{className:"text-gray-500 text-center py-8",children:"No session history yet"}),u.jsx("h3",{className:"text-lg font-bold text-gray-800 mt-8",children:"Note for teacher"}),u.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Leave a message for the teacher (e.g. goals, concerns). Only the teacher will see this."}),u.jsx("textarea",{className:"w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:border-blue-500 outline-none min-h-[80px] text-gray-800",placeholder:"e.g. Please focus on algebra this week...",value:Ke,onChange:ue=>Ge(ue.target.value),onBlur:()=>st(Ke)}),u.jsx("p",{className:"text-[10px] text-blue-500 mt-1 italic",children:"Saves automatically when you click away"})]}),x==="book"&&u.jsx("div",{className:"space-y-8",children:F==="options"?u.jsxs("div",{className:"space-y-4",children:[u.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-2",children:"Booking Options"}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"p-6 bg-white rounded-2xl border-2 border-slate-100 hover:border-blue-500 transition-all flex flex-col md:flex-row items-center justify-between gap-4",children:[u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsx("div",{className:"p-3 bg-blue-50 rounded-xl",children:u.jsx(wg,{className:"text-blue-600",size:24})}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("p",{className:"font-bold text-slate-900 text-lg",children:"Single Lesson"}),u.jsx("span",{className:"bg-slate-100 text-slate-600 text-[10px] font-black px-2 py-0.5 rounded-full uppercase",children:"Pay-as-you-go"})]}),u.jsxs("p",{className:"text-xs text-slate-500 font-bold",children:["",e(l)==="A-Level"?"40":e(l)==="KS3"?"25":"30"," per session"]})]})]}),u.jsx("button",{onClick:()=>{$("select"),G("single")},className:"w-full md:w-auto px-8 py-3 bg-slate-900 text-white rounded-xl font-black hover:bg-slate-800 transition-all shadow-md text-sm uppercase tracking-widest",children:"Book Single Time"})]}),u.jsxs("div",{className:"p-6 bg-white rounded-2xl border-2 border-slate-100 hover:border-teal-500 transition-all flex flex-col md:flex-row items-center justify-between gap-4",children:[u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsx("div",{className:"p-3 bg-teal-50 rounded-xl",children:u.jsx(ei,{className:"text-teal-600",size:24})}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("p",{className:"font-bold text-slate-900 text-lg",children:"Recurring Lesson"}),u.jsx("span",{className:"bg-teal-100 text-teal-700 text-[10px] font-black px-2 py-0.5 rounded-full uppercase",children:"Pay Weekly"})]}),u.jsx("p",{className:"text-xs text-slate-500 font-bold",children:"Secure a weekly slot. Pay as you go."})]})]}),u.jsx("button",{onClick:()=>{$("select"),G("weekly")},className:"w-full md:w-auto px-8 py-3 bg-teal-600 text-white rounded-xl font-black hover:bg-teal-700 transition-all shadow-md text-sm uppercase tracking-widest",children:"Secure Weekly Slot"})]}),u.jsxs("div",{className:"p-6 bg-white rounded-2xl border-2 border-slate-100 hover:border-purple-500 transition-all flex flex-col md:flex-row items-center justify-between gap-4",children:[u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsx("div",{className:"p-3 bg-purple-50 rounded-xl",children:u.jsx(cl,{className:"text-purple-600",size:24})}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("p",{className:"font-bold text-slate-900 text-lg",children:"10-Week Bundle"}),u.jsx("span",{className:"bg-purple-100 text-purple-700 text-[10px] font-black px-2 py-0.5 rounded-full uppercase",children:"Pay Upfront & Save"})]}),u.jsx("p",{className:"text-xs text-slate-500 font-bold",children:"Pay for 10 sessions now and save 20-30."}),u.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-amber-50 border border-amber-200 text-left max-w-md",children:[u.jsx("p",{className:"text-[9px] font-black text-amber-800 uppercase tracking-widest mb-0.5",children:"Refund & Administrative Fee Policy"}),u.jsx("p",{className:"text-[9px] text-amber-900 font-medium leading-relaxed",children:"A non-refundable 15.00 admin fee applies to bundle purchases. Refunds for unused sessions are calculated as remaining balance minus this fee. Used sessions are non-refundable."})]})]})]}),u.jsx("button",{onClick:()=>{$("select"),G("pack"),q("once")},className:"w-full md:w-auto px-8 py-3 bg-purple-600 text-white rounded-xl font-black hover:bg-purple-700 transition-all shadow-md text-sm uppercase tracking-widest",children:"Book Bundle & Save"})]})]})]}):u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Select Session Time"}),u.jsxs("button",{onClick:()=>$("options"),className:"text-sm font-bold text-gray-400 hover:text-blue-600 transition-all flex items-center gap-2",children:[u.jsx(Jl,{size:16,className:"rotate-180"})," Change Option"]})]}),u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:J.length===0?u.jsx("p",{className:"col-span-full text-center py-8 text-gray-400 font-bold",children:"No available slots found. Contact Davina to open more times."}):J.filter(ue=>le?ue.id===le.id:se.length>0?se.some(Te=>Te.id===ue.id):!0).map(ue=>{const Te=le?.id===ue.id||se.some(Oe=>Oe.id===ue.id);return u.jsxs("button",{onClick:()=>{z==="pack"&&R==="twice"?se.find(Oe=>Oe.id===ue.id)?ce(se.filter(Oe=>Oe.id!==ue.id)):se.length<2?ce([...se,ue]):ce([se[1],ue]):le?.id===ue.id?K(null):K(ue)},className:`p-4 rounded-xl border-2 transition-all text-left ${Te?"border-blue-600 bg-blue-50":"border-gray-100 hover:border-blue-200"}`,children:[u.jsx("p",{className:"font-bold text-gray-900 text-sm",children:new Date(ue.date).toLocaleDateString("en-GB",{weekday:"short",month:"short",day:"numeric"})}),u.jsx("p",{className:"text-lg font-black text-blue-600",children:ue.time})]},ue.id)})}),z==="pack"&&!M&&u.jsxs("div",{className:"p-4 rounded-2xl bg-amber-50 border border-amber-200 text-left mb-4",children:[u.jsx("p",{className:"text-[10px] font-black text-amber-800 uppercase tracking-widest mb-1",children:"Refund & Administrative Fee Policy"}),u.jsx("p",{className:"text-[10px] text-amber-900 font-medium leading-relaxed",children:"A non-refundable administrative fee of 15.00 applies to all bundle purchases to cover secure payment processing and account setup. In the event of a requested refund for unused sessions, the refund will be calculated based on the remaining balance minus this administrative fee. Please note that used sessions are non-refundable."})]}),(z==="pack"&&R==="twice"&&se.length===2||le)&&u.jsxs("div",{className:"bg-blue-600 p-6 rounded-2xl text-white flex flex-col md:flex-row items-center justify-between gap-6 shadow-xl",children:[u.jsxs("div",{className:"flex-1",children:[u.jsx("p",{className:"text-blue-100 font-bold uppercase text-[10px] tracking-widest mb-1",children:"Confirm Selection"}),u.jsx("h4",{className:"text-xl font-black",children:le?`${new Date(le.date).toLocaleDateString("en-GB",{month:"short",day:"numeric"})} at ${le.time}`:"Select Times"}),(z==="pack"||z==="weekly")&&!M&&u.jsx("p",{className:"mt-2 text-xs font-bold text-blue-100 bg-white/10 p-2 rounded-lg inline-block",children:" Lessons will recur weekly for 10 weeks at this time"}),M&&u.jsx("p",{className:"mt-2 text-xs font-bold text-blue-100",children:"You are requesting to move your lesson to this new time."})]}),u.jsx("button",{onClick:()=>{const ue=JSON.parse(localStorage.getItem("tutor_bookings"))||[],Te=JSON.parse(localStorage.getItem("tutor_all_lesson_slots"))||[];if(M){const We=ue.map(lt=>lt.id===M.id?{...lt,status:"pending_reschedule",requestedDate:le.date,requestedTime:le.time,requestedSlotId:le.id}:lt);localStorage.setItem("tutor_bookings",JSON.stringify(We)),xr.sendRescheduleRequest({...M,requestedDate:le.date,requestedTime:le.time,student:l.name},"parent"),_({type:"success",message:"Reschedule request sent to Davina!"}),L(null),K(null),$("options"),w("overview"),window.dispatchEvent(new Event("storage"));return}const Oe=z==="pack"||z==="weekly"?`rec_${Date.now()}`:null,ct=[],ft=[];if(Oe)for(let We=0;We<10;We++){const lt=new Date(le.date);lt.setDate(lt.getDate()+We*7);const pt=lt.toISOString().split("T")[0];ct.push({id:`${le.id}_${We}_${Date.now()}`,date:pt,time:le.time,student:l.name,studentId:l.id,subject:U,type:z,status:"confirmed",paymentStatus:We===0?"Due":z==="pack"?"In bundle":"Upcoming",cost:We===0?e(l,U)==="A-Level"?z==="pack"?370:40:e(l,U)==="KS3"?z==="pack"?230:25:z==="pack"?280:30:z==="weekly"?e(l,U)==="A-Level"?40:e(l,U)==="KS3"?25:30:0,recurringId:Oe}),ft.push({date:pt,time:le.time})}else ct.push({id:`${le.id}_${Date.now()}`,date:le.date,time:le.time,student:l.name,studentId:l.id,subject:U,type:"single",status:"confirmed",paymentStatus:"Due",cost:e(l,U)==="A-Level"?40:e(l,U)==="KS3"?25:30}),ft.push({date:le.date,time:le.time});localStorage.setItem("tutor_bookings",JSON.stringify([...ue,...ct]));try{const We=JSON.parse(localStorage.getItem("tutor_students")||"[]"),lt=We.map(pt=>(pt.id===l?.id||pt.name===l?.name)&&!pt.subject?{...pt,subject:U}:pt);lt.some((pt,It)=>pt!==We[It])&&localStorage.setItem("tutor_students",JSON.stringify(lt))}catch{}const wt=Te.map(We=>ft.some(lt=>lt.date===We.date&&lt.time===We.time)?{...We,bookedBy:l.name}:We);localStorage.setItem("tutor_all_lesson_slots",JSON.stringify(wt));const it=e(l,U);let At="";z==="pack"?At=it==="A-Level"?"https://buy.stripe.com/5kA6oLe0Y6GHchG4gn":it==="KS3"?"https://buy.stripe.com/28EbJ17EHed97EW9e3eIw04":"https://buy.stripe.com/eVqbJ1bUX1qnbVcdujeIw01":At=it==="A-Level"?"https://buy.stripe.com/bJe9ATbUXed93oG4XNeIw03":it==="KS3"?"https://buy.stripe.com/eVq4gz3or5GDbVccqfeIw05":"https://buy.stripe.com/14A3cv5wzglh1gyai7eIw00",window.open(At,"_blank"),_({type:"success",message:"Booking confirmed! Redirecting to payment..."}),K(null),$("options"),w("overview"),window.dispatchEvent(new Event("storage"))},className:"px-8 py-3 bg-white text-blue-600 rounded-xl font-black hover:bg-gray-50 transition-all shadow-lg",children:M?"Confirm Reschedule":"Confirm & Book"})]})]})}),x==="messages"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"flex items-center justify-between mb-4",children:[u.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Chat with Davina"}),u.jsxs("span",{className:"text-xs text-green-500 font-bold flex items-center gap-1.5",children:[u.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})," Davina is usually active"]})]}),u.jsxs("div",{className:"bg-gray-50 rounded-2xl border border-gray-100 flex flex-col h-[500px]",children:[u.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:k.length===0?u.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-8",children:[u.jsx(Hc,{size:32,className:"text-gray-300 mb-4"}),u.jsx("p",{className:"text-gray-500 font-bold",children:"No messages yet"})]}):k.map(ue=>u.jsx("div",{className:`flex ${ue.sender===n.email?"justify-end":"justify-start"}`,children:u.jsx("div",{className:`max-w-[80%] p-4 rounded-2xl shadow-sm ${ue.sender===n.email?"bg-blue-600 text-white rounded-tr-none":"bg-white text-gray-800 border-gray-100 rounded-tl-none"}`,children:u.jsx("p",{className:"text-sm",children:ue.message})})},ue.id))}),u.jsx("div",{className:"p-4 bg-white border-t rounded-b-2xl",children:u.jsxs("form",{onSubmit:ue=>{ue.preventDefault(),Pt()},className:"flex gap-2",children:[u.jsx("input",{type:"text",value:P,onChange:ue=>O(ue.target.value),placeholder:"Type a message...",className:"flex-1 px-4 py-2 bg-gray-50 border rounded-xl outline-none"}),u.jsx("button",{type:"submit",disabled:!P.trim(),className:"bg-blue-600 text-white px-6 py-2 rounded-xl font-bold",children:"Send"})]})})]})]}),x==="invoices"&&(()=>{const ue=[...g,...h].map(lt=>({...lt,date:lt.date||lt.sessionDate})).filter(lt=>lt.date),Te=new Date,Oe=`${Te.getFullYear()}-${String(Te.getMonth()+1).padStart(2,"0")}`,ct=[...new Set(ue.map(lt=>{const pt=new Date(lt.date);return`${pt.getFullYear()}-${String(pt.getMonth()+1).padStart(2,"0")}`}))],ft=Array.from({length:6},(lt,pt)=>{const It=new Date(Te.getFullYear(),Te.getMonth()+pt,1);return`${It.getFullYear()}-${String(It.getMonth()+1).padStart(2,"0")}`}),wt=[...new Set([...ft,...ct])].sort(),[it,At]=(me||Oe).split("-").map(Number),We=ue.filter(lt=>{const pt=new Date(lt.date);return pt.getFullYear()===it&&pt.getMonth()+1===At}).sort((lt,pt)=>new Date(lt.date)-new Date(pt.date));return u.jsxs("div",{className:"space-y-4",children:[u.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Invoices & History"}),u.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[u.jsx("span",{className:"text-xs font-black text-gray-500 uppercase tracking-widest",children:"Month"}),u.jsx("select",{value:me,onChange:lt=>ve(lt.target.value),className:"rounded-xl border-2 border-gray-100 px-4 py-2 font-bold text-sm text-gray-800 bg-white focus:border-blue-500",children:wt.map(lt=>{const[pt,It]=lt.split("-").map(Number),en=new Date(pt,It-1,1).toLocaleDateString("en-GB",{month:"long",year:"numeric"});return u.jsx("option",{value:lt,children:en},lt)})})]}),Fe.unpaidInvoices.filter(lt=>!lt.date||(()=>{const pt=new Date(lt.date);return pt.getFullYear()===it&&pt.getMonth()+1===At})()).length>0&&u.jsxs("div",{className:"space-y-2",children:[u.jsx("p",{className:"text-xs font-bold text-amber-700 uppercase",children:"Due this month"}),Fe.unpaidInvoices.filter(lt=>{const pt=lt.date?new Date(lt.date):new Date;return pt.getFullYear()===it&&pt.getMonth()+1===At}).map(lt=>{const pt=e(l,lt.subject),It=Ut(lt),Mt=lt.type==="pack"||It>=230?pt==="A-Level"?"https://buy.stripe.com/5kA6oLe0Y6GHchG4gn":pt==="KS3"?"https://buy.stripe.com/28EbJ17EHed97EW9e3eIw04":"https://buy.stripe.com/eVqbJ1bUX1qnbVcdujeIw01":pt==="A-Level"?"https://buy.stripe.com/bJe9ATbUXed93oG4XNeIw03":pt==="KS3"?"https://buy.stripe.com/eVq4gz3or5GDbVccqfeIw05":"https://buy.stripe.com/14A3cv5wzglh1gyai7eIw00",Bt=lt.subject||"Lesson";return u.jsxs("div",{className:"p-4 bg-orange-50 rounded-xl border-2 border-orange-100 flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-[10px] font-black text-orange-600 uppercase tracking-wider",children:"Lesson type"}),u.jsx("p",{className:"font-bold text-purple-600",children:Bt}),lt.type==="pack"&&u.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"10-lesson pack"}),u.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["",It,"  Due"]})]}),u.jsx("button",{onClick:()=>window.open(Mt,"_blank"),className:"bg-orange-600 text-white px-6 py-2 rounded-xl font-bold",children:"Pay Now"})]},lt.id)})]}),u.jsxs("div",{className:"bg-white rounded-2xl border border-gray-100 overflow-hidden",children:[u.jsx("div",{className:"overflow-x-auto overflow-y-auto max-h-[50vh]",children:u.jsxs("table",{className:"w-full text-left",children:[u.jsx("thead",{className:"bg-gray-50/50 border-b border-gray-100 sticky top-0",children:u.jsxs("tr",{children:[u.jsx("th",{className:"p-3 font-black text-gray-400 text-[9px] uppercase tracking-widest",children:"Date"}),u.jsx("th",{className:"p-3 font-black text-gray-400 text-[9px] uppercase tracking-widest",children:"Lesson type"}),u.jsx("th",{className:"p-3 font-black text-gray-400 text-[9px] uppercase tracking-widest",children:"Description"}),u.jsx("th",{className:"p-3 font-black text-gray-400 text-[9px] uppercase tracking-widest",children:"Status"})]})}),u.jsx("tbody",{className:"divide-y divide-gray-50",children:We.map((lt,pt)=>{const It=(lt.paymentStatus||"").toLowerCase()==="paid",en=lt.recurringId?JSON.parse(localStorage.getItem("tutor_bookings")||"[]").filter(an=>an.recurringId===lt.recurringId&&an.status!=="cancelled").sort((an,As)=>new Date(an.date+"T"+an.time)-new Date(As.date+"T"+As.time)):[],Mt=en.length===10&&en[0]&&(en[0].paymentStatus||"").toLowerCase()==="paid",Bt=lt.type==="consultation"||It?"Paid":lt.paymentStatus==="In bundle"?Mt?"Paid in bulk":"Awaiting initial payment":"Due",Yt=lt.subject||"",On=lt.lessonNotes||lt.topic||lt.subject||"";return u.jsxs("tr",{className:"hover:bg-gray-50/50",children:[u.jsx("td",{className:"p-3 font-bold text-gray-900 text-xs",children:new Date(lt.date).toLocaleDateString("en-GB")}),u.jsx("td",{className:"p-3 font-bold text-purple-600 text-xs",children:Yt}),u.jsx("td",{className:"p-3 font-medium text-gray-600 text-xs",children:On}),u.jsx("td",{className:"p-3",children:u.jsx("span",{className:`px-2 py-0.5 rounded-full text-[9px] font-black uppercase ${Bt==="Paid"||Bt==="Paid in bulk"?"bg-green-100 text-green-700":Bt==="Awaiting initial payment"?"bg-amber-100 text-amber-700":"bg-red-50 text-red-700"}`,children:Bt})})]},lt.id||pt)})})]})}),We.length===0&&u.jsx("div",{className:"p-6 text-center text-gray-400 font-bold text-sm",children:"No sessions this month."})]})]})})(),x==="upcoming"&&(()=>{const ue=new Date,Te=`${ue.getFullYear()}-${String(ue.getMonth()+1).padStart(2,"0")}`,Oe=[...new Set(g.map(We=>{const lt=new Date(We.date);return`${lt.getFullYear()}-${String(lt.getMonth()+1).padStart(2,"0")}`}))],ct=Array.from({length:6},(We,lt)=>{const pt=new Date(ue.getFullYear(),ue.getMonth()+lt,1);return`${pt.getFullYear()}-${String(pt.getMonth()+1).padStart(2,"0")}`}),ft=[...new Set([...ct,...Oe])].sort(),[wt,it]=(ke||Te).split("-").map(Number),At=g.filter(We=>{const lt=new Date(We.date);return lt.getFullYear()===wt&&lt.getMonth()+1===it}).sort((We,lt)=>new Date(We.date+"T"+We.time)-new Date(lt.date+"T"+lt.time));return u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[u.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Upcoming Lessons"}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-xs font-black text-gray-500 uppercase tracking-widest",children:"Month"}),u.jsx("select",{value:ke,onChange:We=>X(We.target.value),className:"rounded-xl border-2 border-gray-100 px-4 py-2 font-bold text-sm text-gray-800 bg-white focus:border-blue-500",children:ft.map(We=>{const[lt,pt]=We.split("-").map(Number),It=new Date(lt,pt-1,1).toLocaleDateString("en-GB",{month:"long",year:"numeric"});return u.jsx("option",{value:We,children:It},We)})})]})]}),At.map(We=>{const lt=JSON.parse(localStorage.getItem("tutor_bookings")||"[]"),pt=We.recurringId?lt.filter(On=>On.recurringId===We.recurringId&&On.status!=="cancelled").sort((On,an)=>new Date(On.date+"T"+On.time)-new Date(an.date+"T"+an.time)):[],It=pt.length===10&&pt.findIndex(On=>On.id===We.id)+1||null,en=pt.length===10&&pt[0]&&(pt[0].paymentStatus||"").toLowerCase()==="paid",Mt=(We.paymentStatus||"").toLowerCase()==="paid"&&(!We.recurringId||en),Bt=en?"Paid in bulk":"Awaiting initial payment",Yt=We.status==="pending_approval"?"Pending Approval":We.type==="consultation"?"Free Consultation":We.paymentStatus==="Due"?"Awaiting initial payment":We.paymentStatus==="In bundle"?Bt:We.paymentStatus==="Due (Exception)"?"Payment due":Mt?"Paid":We.recurringId&&!en?"Awaiting initial payment":We.paymentStatus||"Upcoming";return u.jsx("div",{className:"p-5 bg-white rounded-2xl border border-gray-100 shadow-sm",children:u.jsxs("div",{className:"flex justify-between items-center gap-4 flex-wrap",children:[u.jsxs("div",{className:"min-w-0 flex-1",children:[u.jsx("div",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1",children:"Lesson"}),u.jsx("p",{onClick:()=>he({lesson:We,currentNote:We.subject||""}),className:"font-bold text-gray-900 truncate cursor-pointer hover:text-blue-600 transition-colors py-1 rounded border border-transparent hover:border-blue-200 px-2 -mx-2",children:We.subject||l?.subject||"Click to set lesson type"}),u.jsxs("p",{className:"text-sm text-gray-500 mt-0.5",children:[new Date(We.date).toLocaleDateString("en-GB")," at ",We.time]}),u.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[It!=null&&u.jsxs("span",{className:"text-xs text-teal-600 font-bold",children:["Lesson ",It,"/10"]}),u.jsx("span",{className:`text-[9px] font-black uppercase tracking-widest px-1.5 py-0.5 rounded ${We.status==="pending_approval"?"bg-purple-100 text-purple-700":We.type==="consultation"?"bg-blue-100 text-blue-700":Mt?"bg-green-100 text-green-700":We.paymentStatus==="In bundle"?en?"bg-green-100 text-green-700":"bg-teal-100 text-teal-700":We.paymentStatus==="Due"||We.paymentStatus==="Due (Exception)"?"bg-amber-100 text-amber-700":"bg-red-50 text-red-600"}`,children:Yt})]})]}),u.jsx("div",{className:"flex gap-2",children:We.status==="pending_approval"?u.jsx("button",{onClick:()=>bt(We),className:"bg-green-600 text-white px-4 py-2 rounded-xl text-xs font-bold",children:"Approve"}):u.jsxs(u.Fragment,{children:[(()=>{const On=pt.length===10,an=We.type==="consultation"||We.paymentStatus==="Due (Exception)"||(On?en:We.paymentStatus?.toLowerCase()==="paid"||We.paymentStatus==="Due");return u.jsxs("button",{onClick:()=>Et(We),title:an?"Join as "+l.name:"Pay for the first lesson in the pack in Invoices first",className:`flex items-center gap-1 px-4 py-2 rounded-xl text-xs font-bold transition-all ${an?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,disabled:!an,children:[u.jsx(dl,{size:14})," Start Lesson"]})})(),u.jsx("button",{onClick:()=>Ye(We),className:"bg-blue-50 text-blue-600 px-4 py-2 rounded-xl text-xs font-bold hover:bg-blue-100 transition-all",children:"Reschedule"}),u.jsx("button",{onClick:()=>de(We),className:"bg-gray-100 text-gray-500 px-4 py-2 rounded-xl text-xs font-bold hover:bg-red-50 hover:text-red-500 transition-all",children:"Cancel"})]})})]})},We.id)}),At.length===0&&u.jsx("div",{className:"p-6 text-center text-gray-400 font-bold text-sm",children:"No upcoming lessons this month."})]})})()]})]})]})]}),v&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[200] flex items-center justify-center p-4",onClick:()=>_(null),children:u.jsxs("div",{className:"bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full text-center",onClick:ue=>ue.stopPropagation(),children:[u.jsx("div",{className:"w-16 h-16 bg-blue-50 text-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center",children:u.jsx(Is,{size:32})}),u.jsx("h3",{className:"text-xl font-bold mb-2",children:v.type==="success"?"Success!":"Notice"}),u.jsx("p",{className:"text-gray-600 mb-6",children:v.message}),u.jsx("button",{onClick:()=>_(null),className:"bg-gray-900 text-white px-10 py-3 rounded-xl font-bold",children:"Close"})]})}),ae&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[200] flex items-center justify-center p-4",children:u.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 text-center",onClick:ue=>ue.stopPropagation(),children:[u.jsx("h3",{className:"text-xl font-bold mb-2",children:"Cancel Lesson?"}),u.jsx("p",{className:"text-gray-600 mb-2",children:ae.recurringId?"This is part of a series. Cancel just this one or all future sessions?":"Are you sure you want to cancel this session?"}),ae.recurringId&&(()=>{const Te=JSON.parse(localStorage.getItem("tutor_bookings")||"[]").filter(ct=>ct.recurringId===ae.recurringId&&ct.status!=="cancelled").sort((ct,ft)=>new Date(ct.date+"T"+ct.time)-new Date(ft.date+"T"+ft.time));return Te.length===10&&Te[0]&&(Te[0].paymentStatus||"").toLowerCase()==="paid"?u.jsx("p",{className:"text-amber-700 text-sm font-medium mb-4 bg-amber-50 rounded-xl p-3",children:"Part of a paid pack  no refund for individual lessons. Consider rescheduling instead."}):null})(),u.jsxs("div",{className:"flex flex-col gap-3",children:[ae.recurringId?u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:()=>vt(!1),className:"py-3 bg-red-100 text-red-600 rounded-xl font-bold hover:bg-red-200",children:"Cancel Only This One"}),u.jsx("button",{onClick:()=>vt(!0),className:"py-3 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700",children:"Cancel Entire Series"})]}):u.jsx("button",{onClick:()=>vt(!1),className:"py-3 bg-red-600 text-white rounded-xl font-bold",children:"Cancel Session"}),u.jsx("button",{onClick:()=>{const ue=ae;de(null),Ye(ue)},className:"py-3 bg-blue-50 text-blue-600 rounded-xl font-bold hover:bg-blue-100",children:"Reschedule instead"}),u.jsx("button",{onClick:()=>de(null),className:"py-3 text-gray-400 font-bold",children:"Keep Session"})]})]})}),xe&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[200] flex items-center justify-center p-4",onClick:()=>he(null),children:u.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-lg w-full p-8",onClick:ue=>ue.stopPropagation(),children:[u.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Lesson (e.g. KS3 Maths, A-Level Sociology)"}),u.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"This will appear on the teacher dashboard."}),u.jsx("textarea",{value:xe.currentNote,onChange:ue=>he({...xe,currentNote:ue.target.value}),className:"w-full border-2 border-gray-100 rounded-xl p-4 min-h-[100px] font-bold text-gray-800 bg-gray-50 mb-6",placeholder:"e.g. KS3 Maths, A-Level Sociology"}),u.jsxs("div",{className:"flex gap-3",children:[u.jsx("button",{onClick:()=>{const Te=JSON.parse(localStorage.getItem("tutor_bookings")||"[]").map(Oe=>Oe.id===xe.lesson.id?{...Oe,subject:xe.currentNote.trim()||Oe.subject}:Oe);localStorage.setItem("tutor_bookings",JSON.stringify(Te)),he(null),gt(),_({type:"success",message:"Lesson updated. Teacher will see this."})},className:"flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700",children:"Save"}),u.jsx("button",{onClick:()=>he(null),className:"py-3 text-gray-400 font-bold",children:"Cancel"})]})]})})]}):u.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."})},Oi=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),R1=[.001,0,0,.001,0,0],Ix=1.35,wa={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Fc={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},zf="pdfjs_internal_editor_",Tn={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},Wn={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},aT={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},P1={TRIANGLES:1,LATTICE:2},Ur={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},ig={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Er={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Yd={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Gg={ERRORS:0,WARNINGS:1,INFOS:5},$f={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},hf={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},oT={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Vg=Gg.WARNINGS;function lT(s){Number.isInteger(s)&&(Vg=s)}function cT(){return Vg}function Wg(s){Vg>=Gg.INFOS&&console.info(`Info: ${s}`)}function Sn(s){Vg>=Gg.WARNINGS&&console.warn(`Warning: ${s}`)}function cs(s){throw new Error(s)}function ls(s,e){s||cs(e)}function uT(s){switch(s?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function k_(s,e=null,t=null){if(!s)return null;if(t&&typeof s=="string"&&(t.addDefaultProtocol&&s.startsWith("www.")&&s.match(/\./g)?.length>=2&&(s=`http://${s}`),t.tryConvertEncoding))try{s=mT(s)}catch{}const n=e?URL.parse(s,e):URL.parse(s);return uT(n)?n:null}function j_(s,e,t=!1){const n=URL.parse(s);return n?(n.hash=e,n.href):t&&k_(s,"http://example.com")?s.split("#",1)[0]+`${e?`#${e}`:""}`:""}function _n(s,e,t,n=!1){return Object.defineProperty(s,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}const $u=(function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e})();class $w extends $u{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Mx extends $u{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class B1 extends $u{constructor(e){super(e,"InvalidPDFException")}}class Cg extends $u{constructor(e,t,n){super(e,"ResponseException"),this.status=t,this.missing=n}}class dT extends $u{constructor(e){super(e,"FormatError")}}class Gc extends $u{constructor(e){super(e,"AbortException")}}function hT(s){(typeof s!="object"||s?.length===void 0)&&cs("Invalid argument for bytesToString");const e=s.length,t=8192;if(e<t)return String.fromCharCode.apply(null,s);const n=[];for(let r=0;r<e;r+=t){const i=Math.min(r+t,e),o=s.subarray(r,i);n.push(String.fromCharCode.apply(null,o))}return n.join("")}function Yg(s){typeof s!="string"&&cs("Invalid argument for stringToBytes");const e=s.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=s.charCodeAt(n)&255;return t}function fT(s){return String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255)}function pT(){const s=new Uint8Array(4);return s[0]=1,new Uint32Array(s.buffer,0,1)[0]===1}function gT(){try{return new Function(""),!0}catch{return!1}}class qr{static get isLittleEndian(){return _n(this,"isLittleEndian",pT())}static get isEvalSupported(){return _n(this,"isEvalSupported",gT())}static get isOffscreenCanvasSupported(){return _n(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return _n(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return _n(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return _n(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return _n(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){return _n(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Fx=Array.from(Array(256).keys(),s=>s.toString(16).padStart(2,"0"));class qt{static makeHexColor(e,t,n){return`#${Fx[e]}${Fx[t]}${Fx[n]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,n=0){const r=e[n],i=e[n+1];e[n]=r*t[0]+i*t[2]+t[4],e[n+1]=r*t[1]+i*t[3]+t[5]}static applyTransformToBezier(e,t,n=0){const r=t[0],i=t[1],o=t[2],l=t[3],d=t[4],h=t[5];for(let p=0;p<6;p+=2){const g=e[n+p],b=e[n+p+1];e[n+p]=g*r+b*o+d,e[n+p+1]=g*i+b*l+h}}static applyInverseTransform(e,t){const n=e[0],r=e[1],i=t[0]*t[3]-t[1]*t[2];e[0]=(n*t[3]-r*t[2]+t[2]*t[5]-t[4]*t[3])/i,e[1]=(-n*t[1]+r*t[0]+t[4]*t[1]-t[5]*t[0])/i}static axialAlignedBoundingBox(e,t,n){const r=t[0],i=t[1],o=t[2],l=t[3],d=t[4],h=t[5],p=e[0],g=e[1],b=e[2],x=e[3];let w=r*p+d,v=w,_=r*b+d,N=_,E=l*g+h,k=E,T=l*x+h,P=T;if(i!==0||o!==0){const O=i*p,F=i*b,$=o*g,z=o*x;w+=$,N+=$,_+=z,v+=z,E+=O,P+=O,T+=F,k+=F}n[0]=Math.min(n[0],w,_,v,N),n[1]=Math.min(n[1],E,T,k,P),n[2]=Math.max(n[2],w,_,v,N),n[3]=Math.max(n[3],E,T,k,P)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const n=e[0],r=e[1],i=e[2],o=e[3],l=n**2+r**2,d=n*i+r*o,h=i**2+o**2,p=(l+h)/2,g=Math.sqrt(p**2-(l*h-d**2));t[0]=Math.sqrt(p+g||1),t[1]=Math.sqrt(p-g||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>r)return null;const i=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return i>o?null:[n,i,r,o]}static pointBoundingBox(e,t,n){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}static rectBoundingBox(e,t,n,r,i){i[0]=Math.min(i[0],e,n),i[1]=Math.min(i[1],t,r),i[2]=Math.max(i[2],e,n),i[3]=Math.max(i[3],t,r)}static#e(e,t,n,r,i,o,l,d,h,p){if(h<=0||h>=1)return;const g=1-h,b=h*h,x=b*h,w=g*(g*(g*e+3*h*t)+3*b*n)+x*r,v=g*(g*(g*i+3*h*o)+3*b*l)+x*d;p[0]=Math.min(p[0],w),p[1]=Math.min(p[1],v),p[2]=Math.max(p[2],w),p[3]=Math.max(p[3],v)}static#t(e,t,n,r,i,o,l,d,h,p,g,b){if(Math.abs(h)<1e-12){Math.abs(p)>=1e-12&&this.#e(e,t,n,r,i,o,l,d,-g/p,b);return}const x=p**2-4*g*h;if(x<0)return;const w=Math.sqrt(x),v=2*h;this.#e(e,t,n,r,i,o,l,d,(-p+w)/v,b),this.#e(e,t,n,r,i,o,l,d,(-p-w)/v,b)}static bezierBoundingBox(e,t,n,r,i,o,l,d,h){h[0]=Math.min(h[0],e,l),h[1]=Math.min(h[1],t,d),h[2]=Math.max(h[2],e,l),h[3]=Math.max(h[3],t,d),this.#t(e,n,i,l,t,r,o,d,3*(-e+3*(n-i)+l),6*(e-2*n+i),3*(n-e),h),this.#t(e,n,i,l,t,r,o,d,3*(-t+3*(r-o)+d),6*(t-2*r+o),3*(r-t),h)}}function mT(s){return decodeURIComponent(escape(s))}let Ux=null,qw=null;function xT(s){return Ux||(Ux=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,qw=new Map([["","t"]])),s.replaceAll(Ux,(e,t,n)=>t?t.normalize("NFKC"):qw.get(n))}function T_(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const s=new Uint8Array(32);return crypto.getRandomValues(s),hT(s)}const eh="pdfjs_internal_id_";function bT(s,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[n,r,...i]=t;if(!s(n)&&!Number.isInteger(n)||!e(r))return!1;const o=i.length;let l=!0;switch(r.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;l=!1;break;default:return!1}for(const d of i)if(!(typeof d=="number"||l&&d===null))return!1;return!0}function fi(s,e,t){return Math.min(Math.max(s,e),t)}typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(s){return s.reduce((e,t)=>e+t,0)});class qf{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};function r(i){if(!i)return;let o=null;const l=i.name;if(l==="#text")o=i.value;else if(qf.shouldBuildText(l))i?.attributes?.textContent?o=i.attributes.textContent:i.value&&(o=i.value);else return;if(o!==null&&t.push({str:o}),!!i.children)for(const d of i.children)r(d)}return r(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class D_{static setupStorage(e,t,n,r,i){const o=r.getValue(t,{value:null});switch(n.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),i==="print")break;e.addEventListener("input",l=>{r.setValue(t,{value:l.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(o.value===n.attributes.xfaOn?e.setAttribute("checked",!0):o.value===n.attributes.xfaOff&&e.removeAttribute("checked"),i==="print")break;e.addEventListener("change",l=>{r.setValue(t,{value:l.target.checked?l.target.getAttribute("xfaOn"):l.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),i==="print")break;e.addEventListener("input",l=>{r.setValue(t,{value:l.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const l of n.children)l.attributes.value===o.value?l.attributes.selected=!0:l.attributes.hasOwnProperty("selected")&&delete l.attributes.selected}e.addEventListener("input",l=>{const d=l.target.options,h=d.selectedIndex===-1?"":d[d.selectedIndex].value;r.setValue(t,{value:h})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:r,linkService:i}){const{attributes:o}=t,l=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${r}`);for(const[d,h]of Object.entries(o))if(h!=null)switch(d){case"class":h.length&&e.setAttribute(d,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!l||d!=="href"&&d!=="newWindow")&&e.setAttribute(d,h)}l&&i.addLinkAttributes(e,o.href,o.newWindow),n&&o.dataId&&this.setupStorage(e,o.dataId,t,n)}static render(e){const t=e.annotationStorage,n=e.linkService,r=e.xfaHtml,i=e.intent||"display",o=document.createElement(r.name);r.attributes&&this.setAttributes({html:o,element:r,intent:i,linkService:n});const l=i!=="richText",d=e.div;if(d.append(o),e.viewport){const g=`matrix(${e.viewport.transform.join(",")})`;d.style.transform=g}l&&d.setAttribute("class","xfaLayer xfaFont");const h=[];if(r.children.length===0){if(r.value){const g=document.createTextNode(r.value);o.append(g),l&&qf.shouldBuildText(r.name)&&h.push(g)}return{textDivs:h}}const p=[[r,-1,o]];for(;p.length>0;){const[g,b,x]=p.at(-1);if(b+1===g.children.length){p.pop();continue}const w=g.children[++p.at(-1)[1]];if(w===null)continue;const{name:v}=w;if(v==="#text"){const N=document.createTextNode(w.value);h.push(N),x.append(N);continue}const _=w?.attributes?.xmlns?document.createElementNS(w.attributes.xmlns,v):document.createElement(v);if(x.append(_),w.attributes&&this.setAttributes({html:_,element:w,storage:t,intent:i,linkService:n}),w.children?.length>0)p.push([w,-1,_]);else if(w.value){const N=document.createTextNode(w.value);l&&qf.shouldBuildText(v)&&h.push(N),_.append(N)}}for(const g of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))g.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Hl="http://www.w3.org/2000/svg";class bh{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function Zf(s,e="text"){if(Sf(s,document.baseURI)){const t=await fetch(s);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{const r=new XMLHttpRequest;r.open("GET",s,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(r.response);return}t(r.responseText);return}n(new Error(r.statusText))}},r.send(null)})}class Qf{constructor({viewBox:e,userUnit:t,scale:n,rotation:r,offsetX:i=0,offsetY:o=0,dontFlip:l=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=r,this.offsetX=i,this.offsetY=o,n*=t;const d=(e[2]+e[0])/2,h=(e[3]+e[1])/2;let p,g,b,x;switch(r%=360,r<0&&(r+=360),r){case 180:p=-1,g=0,b=0,x=1;break;case 90:p=0,g=1,b=1,x=0;break;case 270:p=0,g=-1,b=-1,x=0;break;case 0:p=1,g=0,b=0,x=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}l&&(b=-b,x=-x);let w,v,_,N;p===0?(w=Math.abs(h-e[1])*n+i,v=Math.abs(d-e[0])*n+o,_=(e[3]-e[1])*n,N=(e[2]-e[0])*n):(w=Math.abs(d-e[0])*n+i,v=Math.abs(h-e[1])*n+o,_=(e[2]-e[0])*n,N=(e[3]-e[1])*n),this.transform=[p*n,g*n,b*n,x*n,w-p*n*d-b*n*h,v-g*n*d-x*n*h],this.width=_,this.height=N}get rawDims(){const e=this.viewBox;return _n(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:r=this.offsetY,dontFlip:i=!1}={}){return new Qf({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}convertToViewportPoint(e,t){const n=[e,t];return qt.applyTransform(n,this.transform),n}convertToViewportRectangle(e){const t=[e[0],e[1]];qt.applyTransform(t,this.transform);const n=[e[2],e[3]];return qt.applyTransform(n,this.transform),[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){const n=[e,t];return qt.applyInverseTransform(n,this.transform),n}}class Nb extends $u{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Kg(s){const e=s.length;let t=0;for(;t<e&&s[t].trim()==="";)t++;return s.substring(t,t+5).toLowerCase()==="data:"}function Cb(s){return typeof s=="string"&&/\.pdf$/i.test(s)}function yT(s){return[s]=s.split(/[#?]/,1),s.substring(s.lastIndexOf("/")+1)}function vT(s,e="document.pdf"){if(typeof s!="string")return e;if(Kg(s))return Sn('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const n=(l=>{try{return new URL(l)}catch{try{return new URL(decodeURIComponent(l))}catch{try{return new URL(l,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(l),"https://foo.bar")}catch{return null}}}}})(s);if(!n)return e;const r=l=>{try{let d=decodeURIComponent(l);return d.includes("/")?(d=d.split("/").at(-1),d.test(/^\.pdf$/i)?d:l):d}catch{return l}},i=/\.pdf$/i,o=n.pathname.split("/").at(-1);if(i.test(o))return r(o);if(n.searchParams.size>0){const l=Array.from(n.searchParams.values()).reverse();for(const h of l)if(i.test(h))return r(h);const d=Array.from(n.searchParams.keys()).reverse();for(const h of d)if(i.test(h))return r(h)}if(n.hash){const d=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(d)return r(d[0])}return e}class Hw{started=Object.create(null);times=[];time(e){e in this.started&&Sn(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Sn(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:r,end:i}of this.times)e.push(`${n.padEnd(t)} ${i-r}ms
`);return e.join("")}}function Sf(s,e){const t=e?URL.parse(s,e):URL.parse(s);return t?.protocol==="http:"||t?.protocol==="https:"}function Xa(s){s.preventDefault()}function hr(s){s.preventDefault(),s.stopPropagation()}function wT(s){console.log("Deprecated API usage: "+s)}class O1{static#e;static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;this.#e||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=this.#e.exec(e);if(!t)return null;const n=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let i=parseInt(t[3],10);i=i>=1&&i<=31?i:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let l=parseInt(t[5],10);l=l>=0&&l<=59?l:0;let d=parseInt(t[6],10);d=d>=0&&d<=59?d:0;const h=t[7]||"Z";let p=parseInt(t[8],10);p=p>=0&&p<=23?p:0;let g=parseInt(t[9],10)||0;return g=g>=0&&g<=59?g:0,h==="-"?(o+=p,l+=g):h==="+"&&(o-=p,l-=g),new Date(Date.UTC(n,r,i,o,l,d))}}function ST(s,{scale:e=1,rotation:t=0}){const{width:n,height:r}=s.attributes.style,i=[0,0,parseInt(n),parseInt(r)];return new Qf({viewBox:i,userUnit:1,scale:e,rotation:t})}function e0(s){if(s.startsWith("#")){const e=parseInt(s.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return s.startsWith("rgb(")?s.slice(4,-1).split(",").map(e=>parseInt(e)):s.startsWith("rgba(")?s.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Sn(`Not a valid color format: "${s}"`),[0,0,0])}function _T(s){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of s.keys()){e.style.color=t;const n=window.getComputedStyle(e).color;s.set(t,e0(n))}e.remove()}function Zs(s){const{a:e,b:t,c:n,d:r,e:i,f:o}=s.getTransform();return[e,t,n,r,i,o]}function nl(s){const{a:e,b:t,c:n,d:r,e:i,f:o}=s.getTransform().invertSelf();return[e,t,n,r,i,o]}function Ou(s,e,t=!1,n=!0){if(e instanceof Qf){const{pageWidth:r,pageHeight:i}=e.rawDims,{style:o}=s,l=qr.isCSSRoundSupported,d=`var(--total-scale-factor) * ${r}px`,h=`var(--total-scale-factor) * ${i}px`,p=l?`round(down, ${d}, var(--scale-round-x))`:`calc(${d})`,g=l?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!t||e.rotation%180===0?(o.width=p,o.height=g):(o.width=g,o.height=p)}n&&s.setAttribute("data-main-rotation",e.rotation)}class hl{constructor(){const{pixelRatio:e}=hl;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,n,r,i=-1){let o=1/0,l=1/0,d=1/0;n=hl.capPixels(n,i),n>0&&(o=Math.sqrt(n/(e*t))),r!==-1&&(l=r/e,d=r/t);const h=Math.min(o,l,d);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,n):n}return e}}const I1=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class AT{static get isDarkMode(){return _n(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class NT{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:n}=window.getComputedStyle(e);return e.remove(),_n(this,"commentForegroundColor",e0(n))}}function CT(s,e,t,n){n=Math.min(Math.max(n??1,0),1);const r=255*(1-n);return s=Math.round(s*n+r),e=Math.round(e*n+r),t=Math.round(t*n+r),[s,e,t]}function Gw(s,e){const t=s[0]/255,n=s[1]/255,r=s[2]/255,i=Math.max(t,n,r),o=Math.min(t,n,r),l=(i+o)/2;if(i===o)e[0]=e[1]=0;else{const d=i-o;switch(e[1]=l<.5?d/(i+o):d/(2-i-o),i){case t:e[0]=((n-r)/d+(n<r?6:0))*60;break;case n:e[0]=((r-t)/d+2)*60;break;case r:e[0]=((t-n)/d+4)*60;break}}e[2]=l}function M1(s,e){const t=s[0],n=s[1],r=s[2],i=(1-Math.abs(2*r-1))*n,o=i*(1-Math.abs(t/60%2-1)),l=r-i/2;switch(Math.floor(t/60)){case 0:e[0]=i+l,e[1]=o+l,e[2]=l;break;case 1:e[0]=o+l,e[1]=i+l,e[2]=l;break;case 2:e[0]=l,e[1]=i+l,e[2]=o+l;break;case 3:e[0]=l,e[1]=o+l,e[2]=i+l;break;case 4:e[0]=o+l,e[1]=l,e[2]=i+l;break;case 5:case 6:e[0]=i+l,e[1]=l,e[2]=o+l;break}}function Vw(s){return s<=.03928?s/12.92:((s+.055)/1.055)**2.4}function Ww(s,e,t){M1(s,t),t.map(Vw);const n=.2126*t[0]+.7152*t[1]+.0722*t[2];M1(e,t),t.map(Vw);const r=.2126*t[0]+.7152*t[1]+.0722*t[2];return n>r?(n+.05)/(r+.05):(r+.05)/(n+.05)}const Yw=new Map;function ET(s,e){const t=s[0]+s[1]*256+s[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let n=Yw.get(t);if(n)return n;const r=new Float32Array(9),i=r.subarray(0,3),o=r.subarray(3,6);Gw(s,o);const l=r.subarray(6,9);Gw(e,l);const d=l[2]<.5,h=d?12:4.5;if(o[2]=d?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),Ww(o,l,i)<h){let p,g;d?(p=o[2],g=1):(p=0,g=o[2]);const b=.005;for(;g-p>b;){const x=o[2]=(p+g)/2;d===Ww(o,l,i)<h?p=x:g=x}o[2]=d?g:p}return M1(o,i),n=qt.makeHexColor(Math.round(i[0]*255),Math.round(i[1]*255),Math.round(i[2]*255)),Yw.set(t,n),n}function L_({html:s,dir:e,className:t},n){const r=document.createDocumentFragment();if(typeof s=="string"){const i=document.createElement("p");i.dir=e||"auto";const o=s.split(/(?:\r\n?|\n)/);for(let l=0,d=o.length;l<d;++l){const h=o[l];i.append(document.createTextNode(h)),l<d-1&&i.append(document.createElement("br"))}r.append(i)}else D_.render({xfaHtml:s,div:r,intent:"richText"});r.firstElementChild.classList.add("richText",t),n.append(r)}function R_(s){const e=new Path2D;if(!s)return e;for(let t=0,n=s.length;t<n;)switch(s[t++]){case hf.moveTo:e.moveTo(s[t++],s[t++]);break;case hf.lineTo:e.lineTo(s[t++],s[t++]);break;case hf.curveTo:e.bezierCurveTo(s[t++],s[t++],s[t++],s[t++],s[t++],s[t++]);break;case hf.quadraticCurveTo:e.quadraticCurveTo(s[t++],s[t++],s[t++],s[t++]);break;case hf.closePath:e.closePath();break;default:Sn(`Unrecognized drawing path operator: ${s[t-1]}`);break}return e}class as{static#e=null;static#t=null;static#s=null;static#n=0;static#i=[];get pagesNumber(){return as.#n}set pagesNumber(e){as.#n!==e&&(as.#n=e,e===0&&(as.#t=null,as.#e=null))}addListener(e){as.#i.push(e)}removeListener(e){const t=as.#i.indexOf(e);t>=0&&as.#i.splice(t,1)}#a(){for(const e of as.#i)e()}#r(e){if(as.#t)return;const t=as.#n,n=new Uint32Array(3*t),r=as.#t=n.subarray(0,t),i=as.#e=n.subarray(t,2*t);if(e)for(let o=0;o<t;o++)r[o]=i[o]=o+1;as.#s=n.subarray(2*t)}movePages(e,t,n){this.#r(!0);const r=as.#t,i=as.#e;as.#s.set(i);const o=t.length,l=new Uint32Array(o);let d=0;for(let x=0;x<o;x++){const w=t[x]-1;l[x]=r[w],w<n&&(d+=1)}const h=as.#n;let p=n-d;const g=h-o;p=fi(p,0,g);for(let x=0,w=0;x<h;x++)e.has(x+1)||(r[w++]=r[x]);r.copyWithin(p+o,p,g),r.set(l,p);let b=!1;for(let x=0,w=h;x<w;x++){const v=r[x];b||=v!==x+1,i[v-1]=x+1}this.#a(),b||(this.pagesNumber=0)}hasBeenAltered(){return as.#t!==null}getPageMappingForSaving(){return{pageIndices:as.#e?as.#e.map(e=>e-1):null}}getPrevPageNumber(e){return as.#s[as.#t[e-1]-1]}getPageNumber(e){return as.#e?.[e-1]??e}getPageId(e){return as.#t?.[e-1]??e}static get instance(){return _n(this,"instance",new as)}getMapping(){return as.#t.subarray(0,this.pagesNumber)}}class Tf{#e=null;#t=null;#s;#n=null;#i=null;#a=null;#r=null;#o=null;static#c=null;constructor(e){this.#s=e,Tf.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const e=this.#e=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=this.#s._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",Xa,{signal:t}),e.addEventListener("pointerdown",Tf.#l,{signal:t}));const n=this.#n=document.createElement("div");n.className="buttons",e.append(n);const r=this.#s.toolbarPosition;if(r){const{style:i}=e,o=this.#s._uiManager.direction==="ltr"?1-r[0]:r[0];i.insetInlineEnd=`${100*o}%`,i.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return this.#e}static#l(e){e.stopPropagation()}#h(e){this.#s._focusEventsAllowed=!1,hr(e)}#d(e){this.#s._focusEventsAllowed=!0,hr(e)}#f(e){const t=this.#s._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",this.#h.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Xa,{signal:t}),!0)}hide(){this.#e.classList.add("hidden"),this.#t?.hideDropdown()}show(){this.#e.classList.remove("hidden"),this.#i?.shown(),this.#a?.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=this.#s,n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",Tf.#c[e]),this.#f(n)&&n.addEventListener("click",r=>{t.delete()},{signal:t._signal}),this.#n.append(n)}get#m(){const e=document.createElement("div");return e.className="divider",e}async addAltText(e){const t=await e.render();this.#f(t),this.#n.append(t,this.#m),this.#i=e}addComment(e,t=null){if(this.#a)return;const n=e.renderForToolbar();if(!n)return;this.#f(n);const r=this.#r=this.#m;t?(this.#n.insertBefore(n,t),this.#n.insertBefore(r,t)):this.#n.append(n,r),this.#a=e,e.toolbar=this}addColorPicker(e){if(this.#t)return;this.#t=e;const t=e.renderButton();this.#f(t),this.#n.append(t,this.#m)}async addEditSignatureButton(e){const t=this.#o=await e.renderEditButton(this.#s);this.#f(t),this.#n.append(t,this.#m)}removeButton(e){e==="comment"&&(this.#a?.removeToolbarCommentButton(),this.#a=null,this.#r?.remove(),this.#r=null)}async addButton(e,t){switch(e){case"colorPicker":t&&this.addColorPicker(t);break;case"altText":t&&await this.addAltText(t);break;case"editSignature":t&&await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":t&&this.addComment(t);break}}async addButtonBefore(e,t,n){if(!t&&e==="comment")return;const r=this.#n.querySelector(n);r&&e==="comment"&&this.addComment(t,r)}updateEditSignatureButton(e){this.#o&&(this.#o.title=e)}remove(){this.#e.remove(),this.#t?.destroy(),this.#t=null}}class kT{#e=null;#t=null;#s;constructor(e){this.#s=e}#n(){const e=this.#t=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar");const t=this.#s._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",Xa,{signal:t});const n=this.#e=document.createElement("div");return n.className="buttons",e.append(n),this.#s.hasCommentManager()&&this.#a("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#s.commentSelection("floating_button")}),this.#a("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#s.highlightSelection("floating_button")}),e}#i(e,t){let n=0,r=0;for(const i of e){const o=i.y+i.height;if(o<n)continue;const l=i.x+(t?i.width:0);if(o>n){r=l,n=o;continue}t?l>r&&(r=l):l<r&&(r=l)}return[t?1-r:r,n]}show(e,t,n){const[r,i]=this.#i(t,n),{style:o}=this.#t||=this.#n();e.append(this.#t),o.insetInlineEnd=`${100*r}%`,o.top=`calc(${100*i}% + var(--editor-toolbar-vert-offset))`}hide(){this.#t.remove()}#a(e,t,n,r){const i=document.createElement("button");i.classList.add("basic",e),i.tabIndex=0,i.setAttribute("data-l10n-id",t);const o=document.createElement("span");i.append(o),o.className="visuallyHidden",o.setAttribute("data-l10n-id",n);const l=this.#s._signal;l instanceof AbortSignal&&!l.aborted&&(i.addEventListener("contextmenu",Xa,{signal:l}),i.addEventListener("click",r,{signal:l})),this.#e.append(i)}}function P_(s,e,t){for(const n of t)e.addEventListener(n,s[n].bind(s))}class os{static#e=NaN;static#t=null;static#s=NaN;static#n=null;static initializeAndAddPointerId(e){(os.#t||=new Set).add(e)}static setPointer(e,t){os.#e||=t,os.#n??=e}static setTimeStamp(e){os.#s=e}static isSamePointerId(e){return os.#e===e}static isSamePointerIdOrRemove(e){return os.#e===e?!0:(os.#t?.delete(e),!1)}static isSamePointerType(e){return os.#n===e}static isInitializedAndDifferentPointerType(e){return os.#n!==null&&!os.isSamePointerType(e)}static isSameTimeStamp(e){return os.#s===e}static isUsingMultiplePointers(){return os.#t?.size>=1}static clearPointerType(){os.#n=null}static clearPointerIds(){os.#e=NaN,os.#t=null}static clearTimeStamp(){os.#s=NaN}}class jT{#e=0;get id(){return`${zf}${this.#e++}`}}class Eb{#e=T_();#t=0;#s=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=e;const i=r.decode().then(()=>(n.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return _n(this,"_isSVGFittingCanvas",i)}async#n(e,t){this.#s||=new Map;let n=this.#s.get(e);if(n===null)return null;if(n?.bitmap)return n.refCounter+=1,n;try{n||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let r;if(typeof t=="string"?(n.url=t,r=await Zf(t,"blob")):t instanceof File?r=n.file=t:t instanceof Blob&&(r=t),r.type==="image/svg+xml"){const i=Eb._isSVGFittingCanvas,o=new FileReader,l=new Image,d=new Promise((h,p)=>{l.onload=()=>{n.bitmap=l,n.isSvg=!0,h()},o.onload=async()=>{const g=n.svgUrl=o.result;l.src=await i?`${g}#svgView(preserveAspectRatio(none))`:g},l.onerror=o.onerror=p});o.readAsDataURL(r),await d}else n.bitmap=await createImageBitmap(r);n.refCounter=1}catch(r){Sn(r),n=null}return this.#s.set(e,n),n&&this.#s.set(n.id,n),n}async getFromFile(e){const{lastModified:t,name:n,size:r,type:i}=e;return this.#n(`${t}_${n}_${r}_${i}`,e)}async getFromUrl(e){return this.#n(e,e)}async getFromBlob(e,t){const n=await t;return this.#n(e,n)}async getFromId(e){this.#s||=new Map;const t=this.#s.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){this.#s||=new Map;let n=this.#s.get(e);if(n?.bitmap)return n.refCounter+=1,n;const r=new OffscreenCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),n={bitmap:r.transferToImageBitmap(),id:`image_${this.#e}_${this.#t++}`,refCounter:1,isSvg:!1},this.#s.set(e,n),this.#s.set(n.id,n),n}getSvgUrl(e){const t=this.#s.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#s||=new Map;const t=this.#s.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:n}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(n.width,n.height);r.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=r.convertToBlob()}n.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#e}_`)}}class TT{#e=[];#t=!1;#s;#n=-1;constructor(e=128){this.#s=e}add({cmd:e,undo:t,post:n,mustExec:r,type:i=NaN,overwriteIfSameType:o=!1,keepUndo:l=!1}){if(r&&e(),this.#t)return;const d={cmd:e,undo:t,post:n,type:i};if(this.#n===-1){this.#e.length>0&&(this.#e.length=0),this.#n=0,this.#e.push(d);return}if(o&&this.#e[this.#n].type===i){l&&(d.undo=this.#e[this.#n].undo),this.#e[this.#n]=d;return}const h=this.#n+1;h===this.#s?this.#e.splice(0,1):(this.#n=h,h<this.#e.length&&this.#e.splice(h)),this.#e.push(d)}undo(){if(this.#n===-1)return;this.#t=!0;const{undo:e,post:t}=this.#e[this.#n];e(),t?.(),this.#t=!1,this.#n-=1}redo(){if(this.#n<this.#e.length-1){this.#n+=1,this.#t=!0;const{cmd:e,post:t}=this.#e[this.#n];e(),t?.(),this.#t=!1}}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#e.length-1}cleanType(e){if(this.#n!==-1){for(let t=this.#n;t>=0;t--)if(this.#e[t].type!==e){this.#e.splice(t+1,this.#n-t),this.#n=t;return}this.#e.length=0,this.#n=-1}}destroy(){this.#e=null}}class t0{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=qr.platform;for(const[n,r,i={}]of e)for(const o of n){const l=o.startsWith("mac+");t&&l?(this.callbacks.set(o.slice(4),{callback:r,options:i}),this.allKeys.add(o.split("+").at(-1))):!t&&!l&&(this.callbacks.set(o,{callback:r,options:i}),this.allKeys.add(o.split("+").at(-1)))}}#e(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(this.#e(t));if(!n)return;const{callback:r,options:{bubbles:i=!1,args:o=[],checker:l=null}}=n;l&&!l(e,t)||(r.bind(e,...o,t)(),i||hr(t))}}class kb{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return _T(e),_n(this,"_colors",e)}convert(e){const t=e0(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,r]of this._colors)if(r.every((i,o)=>i===t[o]))return kb._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?qt.makeHexColor(...t):e}}class Vc{#e=new AbortController;#t=null;#s=null;#n=new Map;#i=new Map;#a=null;#r=null;#o=null;#c=new TT;#l=null;#h=null;#d=null;#f=0;#m=new Set;#g=null;#u=null;#p=new Set;_editorUndoBar=null;#x=!1;#y=!1;#b=!1;#N=null;#_=null;#w=null;#E=null;#v=!1;#A=null;#T=new jT;#k=!1;#j=!1;#I=!1;#L=null;#P=null;#M=null;#B=null;#H=null;#C=Tn.NONE;#S=new Set;#R=null;#F=null;#z=null;#W=null;#V=null;#Y={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#$=[0,0];#O=null;#G=null;#Z=null;#Q=null;#U=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=Vc.prototype,t=o=>o.#G.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),n=(o,{target:l})=>{if(l instanceof HTMLInputElement){const{type:d}=l;return d!=="text"&&d!=="number"}return!0},r=this.TRANSLATE_SMALL,i=this.TRANSLATE_BIG;return _n(this,"_keyboardManager",new t0([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&o.#G.contains(l)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&o.#G.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}]]))}constructor(e,t,n,r,i,o,l,d,h,p,g,b,x,w,v,_){const N=this._signal=this.#e.signal;this.#G=e,this.#Z=t,this.#Q=n,this.#a=r,this.#l=i,this.#F=o,this.#V=d,this._eventBus=l,l._on("editingaction",this.onEditingAction.bind(this),{signal:N}),l._on("pagechanging",this.onPageChanging.bind(this),{signal:N}),l._on("scalechanging",this.onScaleChanging.bind(this),{signal:N}),l._on("rotationchanging",this.onRotationChanging.bind(this),{signal:N}),l._on("setpreference",this.onSetPreference.bind(this),{signal:N}),l._on("switchannotationeditorparams",E=>this.updateParams(E.type,E.value),{signal:N}),l._on("pagesedited",this.onPagesEdited.bind(this),{signal:N}),window.addEventListener("pointerdown",()=>{this.#j=!0},{capture:!0,signal:N}),window.addEventListener("pointerup",()=>{this.#j=!1},{capture:!0,signal:N}),this.#ae(),this.#he(),this.#te(),this.#r=d.annotationStorage,this.#N=d.filterFactory,this.#z=h,this.#E=p||null,this.#x=g,this.#y=b,this.#b=x,this.#H=w||null,this.viewParameters={realScale:bh.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=v||null,this._supportsPinchToZoom=_!==!1,i?.setSidebarUiManager(this)}destroy(){this.#U?.resolve(),this.#U=null,this.#e?.abort(),this.#e=null,this._signal=null;for(const e of this.#i.values())e.destroy();this.#i.clear(),this.#n.clear(),this.#p.clear(),this.#B?.clear(),this.#t=null,this.#S.clear(),this.#c.destroy(),this.#a?.destroy(),this.#l?.destroy(),this.#F?.destroy(),this.#A?.hide(),this.#A=null,this.#M?.destroy(),this.#M=null,this.#s=null,this.#_&&(clearTimeout(this.#_),this.#_=null),this.#O&&(clearTimeout(this.#O),this.#O=null),this._editorUndoBar?.destroy(),this.#V=null}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#H}get useNewAltTextFlow(){return this.#y}get useNewAltTextWhenAddingImage(){return this.#b}get hcmFilter(){return _n(this,"hcmFilter",this.#z?this.#N.addHCMFilter(this.#z.foreground,this.#z.background):"none")}get direction(){return _n(this,"direction",getComputedStyle(this.#G).direction)}get _highlightColors(){return _n(this,"_highlightColors",this.#E?new Map(this.#E.split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return _n(this,"highlightColors",null);const t=new Map,n=!!this.#z;for(const[r,i]of e){const o=r.endsWith("_HCM");if(n&&o){t.set(r.replace("_HCM",""),i);continue}!n&&!o&&t.set(r,i)}return _n(this,"highlightColors",t)}get highlightColorNames(){return _n(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#d=e}setMainHighlightColorPicker(e){this.#M=e}editAltText(e,t=!1){this.#a?.editAltText(this,e,t)}hasCommentManager(){return!!this.#l}editComment(e,t,n,r){this.#l?.showDialog(this,e,t,n,r)}selectComment(e,t){this.#i.get(e)?.getEditorByUID(t)?.toggleComment(!0,!0)}updateComment(e){this.#l?.updateComment(e.getData())}updatePopupColor(e){this.#l?.updatePopupColor(e)}removeComment(e){this.#l?.removeComments([e.uid])}deleteComment(e,t){const n=()=>{e.comment=t},r=()=>{this._editorUndoBar?.show(n,"comment"),this.toggleComment(null),e.comment=null};this.addCommands({cmd:r,undo:n,mustExec:!0})}toggleComment(e,t,n=void 0){this.#l?.toggleCommentPopup(e,t,n)}makeCommentColor(e,t){return e&&this.#l?.makeCommentColor(e,t)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(e){if(this.#i.has(e-1))return;const{resolve:t,promise:n}=Promise.withResolvers(),r=i=>{i.pageNumber===e&&(this._eventBus._off("editorsrendered",r),t())};this._eventBus.on("editorsrendered",r),await n}getSignature(e){this.#F?.getSignature({uiManager:this,editor:e})}get signatureManager(){return this.#F}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){e==="enableNewAltTextWhenAddingImage"&&(this.#b=t)}onPagesEdited({pagesMapper:e}){for(const r of this.#n.values())r.updatePageIndex(e.getPrevPageNumber(r.pageIndex+1)-1);const t=this.#i,n=this.#i=new Map;for(const[r,i]of t){const o=e.getPrevPageNumber(r+1)-1;if(o===-1){i.destroy();continue}n.set(o,i),i.updatePageIndex(o)}}onPageChanging({pageNumber:e}){this.#f=e-1}focusMainContainer(){this.#G.focus()}findParent(e,t){for(const n of this.#i.values()){const{x:r,y:i,width:o,height:l}=n.div.getBoundingClientRect();if(e>=r&&e<=r+o&&t>=i&&t<=i+l)return n}return null}disableUserSelect(e=!1){this.#Z.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#p.add(e)}removeShouldRescale(e){this.#p.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*bh.PDF_TO_CSS_UNITS;for(const t of this.#p)t.onScaleChanging();this.#d?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#J({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#ee(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const n of this.#i.values())if(n.hasTextLayer(e))return n;return null}highlightSelection(e="",t=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:r,anchorOffset:i,focusNode:o,focusOffset:l}=n,d=n.toString(),p=this.#J(n).closest(".textLayer"),g=this.getSelectionBoxes(p);if(!g)return;n.empty();const b=this.#ee(p),x=this.#C===Tn.NONE,w=()=>{const v=b?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:g,anchorNode:r,anchorOffset:i,focusNode:o,focusOffset:l,text:d});x&&this.showAllEditors("highlight",!0,!0),t&&v?.editComment()};if(x){this.switchToMode(Tn.HIGHLIGHT,w);return}w()}commentSelection(e=""){this.highlightSelection(e,!0)}#re(){const e=document.getSelection();if(!e||e.isCollapsed)return;const n=this.#J(e).closest(".textLayer"),r=this.getSelectionBoxes(n);r&&(this.#A||=new kT(this),this.#A.show(n,r,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(e){if(!this.#r)return null;const t=`${zf}${e}`,n=this.#r.getRawValue(t);return n&&this.#r.remove(t),n}addToAnnotationStorage(e){!e.isEmpty()&&this.#r&&!this.#r.has(e.id)&&this.#r.setValue(e.id,e)}a11yAlert(e,t=null){const n=this.#Q;n&&(n.setAttribute("data-l10n-id",e),t?n.setAttribute("data-l10n-args",JSON.stringify(t)):n.removeAttribute("data-l10n-args"))}#ie(){const e=document.getSelection();if(!e||e.isCollapsed){this.#R&&(this.#A?.hide(),this.#R=null,this.#D({hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===this.#R)return;const r=this.#J(e).closest(".textLayer");if(!r){this.#R&&(this.#A?.hide(),this.#R=null,this.#D({hasSelectedText:!1}));return}if(this.#A?.hide(),this.#R=t,this.#D({hasSelectedText:!0}),!(this.#C!==Tn.HIGHLIGHT&&this.#C!==Tn.NONE)&&(this.#C===Tn.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#v=this.isShiftKeyDown,!this.isShiftKeyDown)){const i=this.#C===Tn.HIGHLIGHT?this.#ee(r):null;if(i?.toggleDrawing(),this.#j){const o=new AbortController,l=this.combinedSignal(o),d=h=>{h.type==="pointerup"&&h.button!==0||(o.abort(),i?.toggleDrawing(!0),h.type==="pointerup"&&this.#K("main_toolbar"))};window.addEventListener("pointerup",d,{signal:l}),window.addEventListener("blur",d,{signal:l})}else i?.toggleDrawing(!0),this.#K("main_toolbar")}}#K(e=""){this.#C===Tn.HIGHLIGHT?this.highlightSelection(e):this.#x&&this.#re()}#ae(){document.addEventListener("selectionchange",this.#ie.bind(this),{signal:this._signal})}#oe(){if(this.#w)return;this.#w=new AbortController;const e=this.combinedSignal(this.#w);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#le(){this.#w?.abort(),this.#w=null}blur(){if(this.isShiftKeyDown=!1,this.#v&&(this.#v=!1,this.#K("main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of this.#S)if(t.div.contains(e)){this.#P=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#P)return;const[e,t]=this.#P;this.#P=null,t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}#te(){if(this.#L)return;this.#L=new AbortController;const e=this.combinedSignal(this.#L);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#ce(){this.#L?.abort(),this.#L=null}#ue(){if(this.#h)return;this.#h=new AbortController;const e=this.combinedSignal(this.#h);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#de(){this.#h?.abort(),this.#h=null}#he(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#te(),this.setEditingState(!0)}removeEditListeners(){this.#ce(),this.setEditingState(!1)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of this.#u)if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const n of this.#u)if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const t=[];for(const n of this.#S){const r=n.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const i of t.items)for(const o of this.#u)if(o.isHandlingMimeForPasting(i.type)){o.paste(i,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(i){Sn(`paste: "${i.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const r=this.currentLayer;try{const i=[];for(const d of n){const h=await r.deserialize(d);if(!h)return;i.push(h)}const o=()=>{for(const d of i)this.#ne(d);this.#se(i)},l=()=>{for(const d of i)d.remove()};this.addCommands({cmd:o,undo:l,mustExec:!0})}catch(i){Sn(`paste: "${i.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),this.#C!==Tn.NONE&&!this.isEditorHandlingKeyboard&&Vc._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,this.#v&&(this.#v=!1,this.#K("main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#D(e){Object.entries(e).some(([n,r])=>this.#Y[n]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#Y,e)}),this.#C===Tn.HIGHLIGHT&&e.hasSelectedEditor===!1&&this.#q([[Wn.HIGHLIGHT_FREE,!0]]))}#q(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#oe(),this.#ue(),this.#D({isEditing:this.#C!==Tn.NONE,isEmpty:this.#X(),hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:this.#c.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#le(),this.#de(),this.#D({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#u){this.#u=e;for(const t of this.#u)this.#q(t.defaultPropertiesToUpdate)}}getId(){return this.#T.id}get currentLayer(){return this.#i.get(this.#f)}getLayer(e){return this.#i.get(e)}get currentPageIndex(){return this.#f}addLayer(e){this.#i.set(e.pageIndex,e),this.#k?e.enable():e.disable()}removeLayer(e){this.#i.delete(e.pageIndex)}async updateMode(e,t=null,n=!1,r=!1,i=!1,o=!1){if(this.#C!==e&&!(this.#U&&(await this.#U.promise,!this.#U))){if(this.#U=Promise.withResolvers(),this.#d?.commitOrRemove(),this.#C===Tn.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#C=e,e===Tn.NONE){this.setEditingState(!1),this.#pe();for(const l of this.#n.values())l.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#U.resolve();return}for(const l of this.#n.values())l.addStandaloneCommentButton();e===Tn.SIGNATURE&&await this.#F?.loadSignatures(),n&&os.clearPointerType(),this.setEditingState(!0),await this.#fe(),this.unselectAll();for(const l of this.#i.values())l.updateMode(e);if(e===Tn.POPUP){this.#s||=await this.#V.getAnnotationsByType(new Set(this.#u.map(h=>h._editorType)));const l=new Set,d=[];for(const h of this.#n.values()){const{annotationElementId:p,hasComment:g,deleted:b}=h;p&&l.add(p),g&&!b&&d.push(h.getData())}for(const h of this.#s){const{id:p,popupRef:g,contentsObj:b}=h;g&&b?.str&&!l.has(p)&&!this.#m.has(p)&&d.push(h)}this.#l?.showSidebar(d)}if(!t){r&&this.addNewEditorFromKeyboard(),this.#U.resolve();return}for(const l of this.#n.values())l.uid===t?(this.setSelected(l),o?l.editComment():i?l.enterInEditMode():l.focus()):l.unselect();this.#U.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==this.#C&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(this.#u){switch(e){case Wn.CREATE:this.currentLayer.addNewEditor(t);return;case Wn.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#W||=new Map).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const n of this.#S)n.updateParams(e,t);else for(const n of this.#u)n.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){for(const i of this.#n.values())i.editorType===e&&i.show(t);(this.#W?.get(Wn.HIGHLIGHT_SHOW_ALL)??!0)!==t&&this.#q([[Wn.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(this.#I!==e){this.#I=e;for(const t of this.#i.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}async#fe(){if(!this.#k){this.#k=!0;const e=[];for(const t of this.#i.values())e.push(t.enable());await Promise.all(e);for(const t of this.#n.values())t.enable()}}#pe(){if(this.unselectAll(),this.#k){this.#k=!1;for(const e of this.#i.values())e.disable();for(const e of this.#n.values())e.disable()}}*getEditors(e){for(const t of this.#n.values())t.pageIndex===e&&(yield t)}getEditor(e){return this.#n.get(e)}addEditor(e){this.#n.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#_&&clearTimeout(this.#_),this.#_=setTimeout(()=>{this.focusMainContainer(),this.#_=null},0)),this.#n.delete(e.id),e.annotationElementId&&this.#B?.delete(e.annotationElementId),this.unselect(e),(!e.annotationElementId||!this.#m.has(e.annotationElementId))&&this.#r?.remove(e.id)}addDeletedAnnotationElement(e){this.#m.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#m.has(e)}removeDeletedAnnotationElement(e){this.#m.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#ne(e){const t=this.#i.get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#q(e.propertiesToUpdate))}get#ge(){let e=null;for(e of this.#S);return e}updateUI(e){this.#ge===e&&this.#q(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#q(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#S.has(e)){this.#S.delete(e),e.unselect(),this.#D({hasSelectedEditor:this.hasSelection});return}this.#S.add(e),e.select(),this.#q(e.propertiesToUpdate),this.#D({hasSelectedEditor:!0})}setSelected(e){this.updateToolbar({mode:e.mode,editId:e.uid}),this.#d?.commitOrRemove();for(const t of this.#S)t!==e&&t.unselect();this.#S.clear(),this.#S.add(e),e.select(),this.#q(e.propertiesToUpdate),this.#D({hasSelectedEditor:!0})}isSelected(e){return this.#S.has(e)}get firstSelectedEditor(){return this.#S.values().next().value}unselect(e){e.unselect(),this.#S.delete(e),this.#D({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#S.size!==0}get isEnterHandled(){return this.#S.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#c.undo(),this.#D({hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#X()}),this._editorUndoBar?.hide()}redo(){this.#c.redo(),this.#D({hasSomethingToUndo:!0,hasSomethingToRedo:this.#c.hasSomethingToRedo(),isEmpty:this.#X()})}addCommands(e){this.#c.add(e),this.#D({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#X()})}cleanUndoStack(e){this.#c.cleanType(e)}#X(){if(this.#n.size===0)return!0;if(this.#n.size===1)for(const e of this.#n.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();const e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...this.#S],n=()=>{this._editorUndoBar?.show(r,t.length===1?t[0].editorType:t.length);for(const i of t)i.remove()},r=()=>{for(const i of t)this.#ne(i)};this.addCommands({cmd:n,undo:r,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#se(e){for(const t of this.#S)t.unselect();this.#S.clear();for(const t of e)t.isEmpty()||(this.#S.add(t),t.select());this.#D({hasSelectedEditor:this.hasSelection})}selectAll(){for(const e of this.#S)e.commit();this.#se(this.#n.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#C!==Tn.NONE))&&!this.#d?.commitOrRemove()&&this.hasSelection){for(const e of this.#S)e.unselect();this.#S.clear(),this.#D({hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;this.#$[0]+=e,this.#$[1]+=t;const[r,i]=this.#$,o=[...this.#S],l=1e3;this.#O&&clearTimeout(this.#O),this.#O=setTimeout(()=>{this.#O=null,this.#$[0]=this.#$[1]=0,this.addCommands({cmd:()=>{for(const d of o)this.#n.has(d.id)&&(d.translateInPage(r,i),d.translationDone())},undo:()=>{for(const d of o)this.#n.has(d.id)&&(d.translateInPage(-r,-i),d.translationDone())},mustExec:!1})},l);for(const d of o)d.translateInPage(e,t),d.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#g=new Map;for(const e of this.#S)this.#g.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#g)return!1;this.disableUserSelect(!1);const e=this.#g;this.#g=null;let t=!1;for(const[{x:r,y:i,pageIndex:o},l]of e)l.newX=r,l.newY=i,l.newPageIndex=o,t||=r!==l.savedX||i!==l.savedY||o!==l.savedPageIndex;if(!t)return!1;const n=(r,i,o,l)=>{if(this.#n.has(r.id)){const d=this.#i.get(l);d?r._setParentAndPosition(d,i,o):(r.pageIndex=l,r.x=i,r.y=o)}};return this.addCommands({cmd:()=>{for(const[r,{newX:i,newY:o,newPageIndex:l}]of e)n(r,i,o,l)},undo:()=>{for(const[r,{savedX:i,savedY:o,savedPageIndex:l}]of e)n(r,i,o,l)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#g)for(const n of this.#g.keys())n.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#S.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#C}isEditingMode(){return this.#C!==Tn.NONE}get imageManager(){return _n(this,"imageManager",new Eb)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let h=0,p=t.rangeCount;h<p;h++)if(!e.contains(t.getRangeAt(h).commonAncestorContainer))return null;const{x:n,y:r,width:i,height:o}=e.getBoundingClientRect();let l;switch(e.getAttribute("data-main-rotation")){case"90":l=(h,p,g,b)=>({x:(p-r)/o,y:1-(h+g-n)/i,width:b/o,height:g/i});break;case"180":l=(h,p,g,b)=>({x:1-(h+g-n)/i,y:1-(p+b-r)/o,width:g/i,height:b/o});break;case"270":l=(h,p,g,b)=>({x:1-(p+b-r)/o,y:(h-n)/i,width:b/o,height:g/i});break;default:l=(h,p,g,b)=>({x:(h-n)/i,y:(p-r)/o,width:g/i,height:b/o});break}const d=[];for(let h=0,p=t.rangeCount;h<p;h++){const g=t.getRangeAt(h);if(!g.collapsed)for(const{x:b,y:x,width:w,height:v}of g.getClientRects())w===0||v===0||d.push(l(b,x,w,v))}return d.length===0?null:d}addChangedExistingAnnotation({annotationElementId:e,id:t}){(this.#o||=new Map).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){this.#o?.delete(e)}renderAnnotationElement(e){const t=this.#o?.get(e.data.id);if(!t)return;const n=this.#r.getRawValue(t);n&&(this.#C===Tn.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}setMissingCanvas(e,t,n){const r=this.#B?.get(e);r&&(r.setCanvas(t,n),this.#B.delete(e))}addMissingCanvas(e,t){(this.#B||=new Map).set(e,t)}}class ol{#e=null;#t=!1;#s=null;#n=null;#i=null;#a=null;#r=!1;#o=null;#c=null;#l=null;#h=null;#d=!1;static#f=null;static _l10n=null;constructor(e){this.#c=e,this.#d=e._uiManager.useNewAltTextFlow,ol.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){ol._l10n??=e}async render(){const e=this.#s=document.createElement("button");e.className="altText",e.tabIndex="0";const t=this.#n=document.createElement("span");e.append(t),this.#d?(e.classList.add("new"),e.setAttribute("data-l10n-id",ol.#f.missing),t.setAttribute("data-l10n-id",ol.#f["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=this.#c._uiManager._signal;e.addEventListener("contextmenu",Xa,{signal:n}),e.addEventListener("pointerdown",i=>i.stopPropagation(),{signal:n});const r=i=>{i.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#d&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#m}})};return e.addEventListener("click",r,{capture:!0,signal:n}),e.addEventListener("keydown",i=>{i.target===e&&i.key==="Enter"&&(this.#r=!0,r(i))},{signal:n}),await this.#g(),e}get#m(){return this.#e&&"added"||this.#e===null&&this.guessedText&&"review"||"missing"}finish(){this.#s&&(this.#s.focus({focusVisible:this.#r}),this.#r=!1)}isEmpty(){return this.#d?this.#e===null:!this.#e&&!this.#t}hasData(){return this.#d?this.#e!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(e){this.#e===null&&(this.#l=e,this.#h=await ol._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#g())}toggleAltTextBadge(e=!1){if(!this.#d||this.#e){this.#o?.remove(),this.#o=null;return}if(!this.#o){const t=this.#o=document.createElement("div");t.className="noAltTextBadge",this.#c.div.append(t)}this.#o.classList.toggle("hidden",!e)}serialize(e){let t=this.#e;return!e&&this.#l===t&&(t=this.#h),{altText:t,decorative:this.#t,guessedText:this.#l,textWithDisclaimer:this.#h}}get data(){return{altText:this.#e,decorative:this.#t}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:r,cancel:i=!1}){n&&(this.#l=n,this.#h=r),!(this.#e===e&&this.#t===t)&&(i||(this.#e=e,this.#t=t),this.#g())}toggle(e=!1){this.#s&&(!e&&this.#a&&(clearTimeout(this.#a),this.#a=null),this.#s.disabled=!e)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#m}})}destroy(){this.#s?.remove(),this.#s=null,this.#n=null,this.#i=null,this.#o?.remove(),this.#o=null}async#g(){const e=this.#s;if(!e)return;if(this.#d){if(e.classList.toggle("done",!!this.#e),e.setAttribute("data-l10n-id",ol.#f[this.#m]),this.#n?.setAttribute("data-l10n-id",ol.#f[`${this.#m}-label`]),!this.#e){this.#i?.remove();return}}else{if(!this.#e&&!this.#t){e.classList.remove("done"),this.#i?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=this.#i;if(!t){this.#i=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${this.#c.id}`;const r=100,i=this.#c._uiManager._signal;i.addEventListener("abort",()=>{clearTimeout(this.#a),this.#a=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#a=setTimeout(()=>{this.#a=null,this.#i.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},r)},{signal:i}),e.addEventListener("mouseleave",()=>{this.#a&&(clearTimeout(this.#a),this.#a=null),this.#i?.classList.remove("show")},{signal:i})}this.#t?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=this.#e),t.parentNode||e.append(t),this.#c.getElementForAltText()?.setAttribute("aria-describedby",t.id)}}class rp{#e=null;#t=null;#s=!1;#n=null;#i=null;#a=null;#r=null;#o=null;#c=!1;#l=null;constructor(e){this.#n=e}renderForToolbar(){const e=this.#t=document.createElement("button");return e.className="comment",this.#h(e,!1)}renderForStandalone(){const e=this.#e=document.createElement("button");e.className="annotationCommentButton";const t=this.#n.commentButtonPosition;if(t){const{style:n}=e;n.insetInlineEnd=`calc(${100*(this.#n._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,n.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const r=this.#n.commentButtonColor;r&&(n.backgroundColor=r)}return this.#h(e,!0)}focusButton(){setTimeout(()=>{(this.#e??this.#t)?.focus()},0)}onUpdatedColor(){if(!this.#e)return;const e=this.#n.commentButtonColor;e&&(this.#e.style.backgroundColor=e),this.#n._uiManager.updatePopupColor(this.#n)}get commentButtonWidth(){return(this.#e?.getBoundingClientRect().width??0)/this.#n.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#e)return null;const{x:e,y:t,height:n}=this.#e.getBoundingClientRect(),{x:r,y:i,width:o,height:l}=this.#n.parent.boundingClientRect;return[(e-r)/o,(t+n-i)/l]}set commentPopupPositionInLayer(e){this.#l=e}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#e?.remove(),this.#e=null}removeToolbarCommentButton(){this.#t?.remove(),this.#t=null}setCommentButtonStates({selected:e,hasPopup:t}){this.#e&&(this.#e.classList.toggle("selected",e),this.#e.ariaExpanded=t)}#h(e,t){if(!this.#n._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[this.#n._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const n=this.#n._uiManager._signal;if(!(n instanceof AbortSignal)||n.aborted)return e;e.addEventListener("contextmenu",Xa,{signal:n}),t&&(e.addEventListener("focusin",i=>{this.#n._focusEventsAllowed=!1,hr(i)},{capture:!0,signal:n}),e.addEventListener("focusout",i=>{this.#n._focusEventsAllowed=!0,hr(i)},{capture:!0,signal:n})),e.addEventListener("pointerdown",i=>i.stopPropagation(),{signal:n});const r=i=>{i.preventDefault(),e===this.#t?this.edit():this.#n.toggleComment(!0)};return e.addEventListener("click",r,{capture:!0,signal:n}),e.addEventListener("keydown",i=>{i.target===e&&i.key==="Enter"&&(this.#s=!0,r(i))},{signal:n}),e.addEventListener("pointerenter",()=>{this.#n.toggleComment(!1,!0)},{signal:n}),e.addEventListener("pointerleave",()=>{this.#n.toggleComment(!1,!1)},{signal:n}),e}edit(e){const t=this.commentPopupPositionInLayer;let n,r;if(t)[n,r]=t;else{[n,r]=this.#n.commentButtonPosition;const{width:p,height:g,x:b,y:x}=this.#n;n=b+n*p,r=x+r*g}const i=this.#n.parent.boundingClientRect,{x:o,y:l,width:d,height:h}=i;this.#n._uiManager.editComment(this.#n,o+n*d,l+r*h,{...e,parentDimensions:i})}finish(){this.#t&&(this.#t.focus({focusVisible:this.#s}),this.#s=!1)}isDeleted(){return this.#c||this.#r===""}isEmpty(){return this.#r===null}hasBeenEdited(){return this.isDeleted()||this.#r!==this.#i}serialize(){return this.data}get data(){return{text:this.#r,richText:this.#a,date:this.#o,deleted:this.isDeleted()}}set data(e){if(e!==this.#r&&(this.#a=null),e===null){this.#r="",this.#c=!0;return}this.#r=e,this.#o=new Date,this.#c=!1}restoreData({text:e,richText:t,date:n}){this.#r=e,this.#a=t,this.#o=n,this.#c=!1}setInitialText(e,t=null){this.#i=e,this.data=e,this.#o=null,this.#a=t}shown(){}destroy(){this.#t?.remove(),this.#t=null,this.#e?.remove(),this.#e=null,this.#r="",this.#a=null,this.#o=null,this.#n=null,this.#s=!1,this.#c=!1}}class Xg{#e;#t=!1;#s=null;#n;#i;#a;#r;#o=null;#c;#l=null;#h;#d=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:r=null,onPinching:i=null,onPinchEnd:o=null,signal:l}){this.#e=e,this.#s=n,this.#n=t,this.#i=r,this.#a=i,this.#r=o,this.#h=new AbortController,this.#c=AbortSignal.any([l,this.#h.signal]),e.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#c})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/hl.pixelRatio}#f(e){if(this.#n?.())return;if(e.touches.length===1){if(this.#o)return;const r=this.#o=new AbortController,i=AbortSignal.any([this.#c,r.signal]),o=this.#e,l={capture:!0,signal:i,passive:!1},d=h=>{h.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};o.addEventListener("pointerdown",h=>{h.pointerType==="touch"&&(hr(h),d(h))},l),o.addEventListener("pointerup",d,l),o.addEventListener("pointercancel",d,l);return}if(!this.#d){this.#d=new AbortController;const r=AbortSignal.any([this.#c,this.#d.signal]),i=this.#e,o={signal:r,capture:!1,passive:!1};i.addEventListener("touchmove",this.#m.bind(this),o);const l=this.#g.bind(this);i.addEventListener("touchend",l,o),i.addEventListener("touchcancel",l,o),o.capture=!0,i.addEventListener("pointerdown",hr,o),i.addEventListener("pointermove",hr,o),i.addEventListener("pointercancel",hr,o),i.addEventListener("pointerup",hr,o),this.#i?.()}if(hr(e),e.touches.length!==2||this.#s?.()){this.#l=null;return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),this.#l={touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY}}#m(e){if(!this.#l||e.touches.length!==2)return;hr(e);let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);const{screenX:r,screenY:i}=t,{screenX:o,screenY:l}=n,d=this.#l,{touch0X:h,touch0Y:p,touch1X:g,touch1Y:b}=d,x=g-h,w=b-p,v=o-r,_=l-i,N=Math.hypot(v,_)||1,E=Math.hypot(x,w)||1;if(!this.#t&&Math.abs(E-N)<=Xg.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(d.touch0X=r,d.touch0Y=i,d.touch1X=o,d.touch1Y=l,!this.#t){this.#t=!0;return}const k=[(r+o)/2,(i+l)/2];this.#a?.(k,E,N)}#g(e){e.touches.length>=2||(this.#d&&(this.#d.abort(),this.#d=null,this.#r?.()),this.#l&&(hr(e),this.#l=null,this.#t=!1))}destroy(){this.#h?.abort(),this.#h=null,this.#o?.abort(),this.#o=null}}class cn{#e=null;#t=null;#s=null;#n=null;#i=null;#a=!1;#r=null;#o="";#c=null;#l=null;#h=null;#d=null;#f=null;#m="";#g=!1;#u=null;#p=!1;#x=!1;#y=!1;#b=null;#N=0;#_=0;#w=null;#E=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#v=!1;#A=cn._zIndex++;static _borderLineWidth=-1;static _colorManager=new kb;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const e=cn.prototype._resizeWithKeyboard,t=Vc.TRANSLATE_SMALL,n=Vc.TRANSLATE_BIG;return _n(this,"_resizerKeyboardManager",new t0([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],cn.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null,this.canAddComment=!0;const{rotation:t,rawDims:{pageWidth:n,pageHeight:r,pageX:i,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,r],this.pageTranslation=[i,o];const[l,d]=this.parentDimensions;this.x=e.x/l,this.y=e.y/d,this.isAttachedToDOM=!1,this.deleted=!1}updatePageIndex(e){this.pageIndex=e}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return _n(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new DT({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(cn._l10n??=e,cn._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),cn._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);cn._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){cs("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#v}set _isDraggable(e){this.#v=e,this.div?.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#A}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(this.#O(),this.#d?.remove(),this.#d=null),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#g?this.#g=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,r){const[i,o]=this.parentDimensions;[n,r]=this.screenToPageTranslation(n,r),this.x=(e+n)/i,this.y=(t+r)/o,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[n,r]=this.parentDimensions;this.setAt(e*n,t*r,this.width*n,this.height*r),this._onTranslated()}#T([e,t],n,r){[n,r]=this.screenToPageTranslation(n,r),this.x+=n/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#T(this.parentDimensions,e,t)}translateInPage(e,t){this.#u||=[this.x,this.y,this.width,this.height],this.#T(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){this.#u||=[this.x,this.y,this.width,this.height];const{div:n,parentDimensions:[r,i]}=this;if(this.x+=e/r,this.y+=t/i,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:g,y:b}=this.div.getBoundingClientRect();this.parent.findNewParent(this,g,b)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:l}=this;const[d,h]=this.getBaseTranslation();o+=d,l+=h;const{style:p}=n;p.left=`${(100*o).toFixed(2)}%`,p.top=`${(100*l).toFixed(2)}%`,this._onTranslating(o,l),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#u&&(this.#u[0]!==this.x||this.#u[1]!==this.y)}get _hasBeenResized(){return!!this.#u&&(this.#u[2]!==this.width||this.#u[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=cn,r=n/e,i=n/t;switch(this.rotation){case 90:return[-r,i];case 180:return[r,i];case 270:return[r,-i];default:return[-r,-i]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[n,r]}=this;let{x:i,y:o,width:l,height:d}=this;if(l*=n,d*=r,i*=n,o*=r,this._mustFixPosition)switch(e){case 0:i=fi(i,0,n-l),o=fi(o,0,r-d);break;case 90:i=fi(i,0,n-d),o=fi(o,l,r);break;case 180:i=fi(i,l,n),o=fi(o,d,r);break;case 270:i=fi(i,d,n),o=fi(o,0,r-l);break}this.x=i/=n,this.y=o/=r;const[h,p]=this.getBaseTranslation();i+=h,o+=p,t.left=`${(100*i).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}static#k(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return cn.#k(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return cn.#k(e,t,360-this.parentRotation)}#j(e){switch(e){case 90:{const[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(){const{div:{style:e},width:t,height:n}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*n).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#I(){if(this.#c)return;this.#c=document.createElement("div"),this.#c.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const r=document.createElement("div");this.#c.append(r),r.classList.add("resizer",n),r.setAttribute("data-resizer-name",n),r.addEventListener("pointerdown",this.#L.bind(this,n),{signal:t}),r.addEventListener("contextmenu",Xa,{signal:t}),r.tabIndex=-1}this.div.prepend(this.#c)}#L(e,t){t.preventDefault();const{isMac:n}=qr.platform;if(t.button!==0||t.ctrlKey&&n)return;this.#s?.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,this.#l=[t.screenX,t.screenY];const i=new AbortController,o=this._uiManager.combinedSignal(i);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#B.bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",hr,{passive:!1,signal:o}),window.addEventListener("contextmenu",Xa,{signal:o}),this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const l=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const h=()=>{i.abort(),this.parent.togglePointerEvents(!0),this.#s?.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=l,this.div.style.cursor=d,this.#M()};window.addEventListener("pointerup",h,{signal:o}),window.addEventListener("blur",h,{signal:o})}#P(e,t,n,r){this.width=n,this.height=r,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#M(){if(!this.#h)return;const{savedX:e,savedY:t,savedWidth:n,savedHeight:r}=this.#h;this.#h=null;const i=this.x,o=this.y,l=this.width,d=this.height;i===e&&o===t&&l===n&&d===r||this.addCommands({cmd:this.#P.bind(this,i,o,l,d),undo:this.#P.bind(this,e,t,n,r),mustExec:!0})}static _round(e){return Math.round(e*1e4)/1e4}#B(e,t){const[n,r]=this.parentDimensions,i=this.x,o=this.y,l=this.width,d=this.height,h=cn.MIN_SIZE/n,p=cn.MIN_SIZE/r,g=this.#j(this.rotation),b=(K,se)=>[g[0]*K+g[2]*se,g[1]*K+g[3]*se],x=this.#j(360-this.rotation),w=(K,se)=>[x[0]*K+x[2]*se,x[1]*K+x[3]*se];let v,_,N=!1,E=!1;switch(e){case"topLeft":N=!0,v=(K,se)=>[0,0],_=(K,se)=>[K,se];break;case"topMiddle":v=(K,se)=>[K/2,0],_=(K,se)=>[K/2,se];break;case"topRight":N=!0,v=(K,se)=>[K,0],_=(K,se)=>[0,se];break;case"middleRight":E=!0,v=(K,se)=>[K,se/2],_=(K,se)=>[0,se/2];break;case"bottomRight":N=!0,v=(K,se)=>[K,se],_=(K,se)=>[0,0];break;case"bottomMiddle":v=(K,se)=>[K/2,se],_=(K,se)=>[K/2,0];break;case"bottomLeft":N=!0,v=(K,se)=>[0,se],_=(K,se)=>[K,0];break;case"middleLeft":E=!0,v=(K,se)=>[0,se/2],_=(K,se)=>[K,se/2];break}const k=v(l,d),T=_(l,d);let P=b(...T);const O=cn._round(i+P[0]),F=cn._round(o+P[1]);let $=1,z=1,G,R;if(t.fromKeyboard)({deltaX:G,deltaY:R}=t);else{const{screenX:K,screenY:se}=t,[ce,ye]=this.#l;[G,R]=this.screenToPageTranslation(K-ce,se-ye),this.#l[0]=K,this.#l[1]=se}if([G,R]=w(G/n,R/r),N){const K=Math.hypot(l,d);$=z=Math.max(Math.min(Math.hypot(T[0]-k[0]-G,T[1]-k[1]-R)/K,1/l,1/d),h/l,p/d)}else E?$=fi(Math.abs(T[0]-k[0]-G),h,1)/l:z=fi(Math.abs(T[1]-k[1]-R),p,1)/d;const q=cn._round(l*$),J=cn._round(d*z);P=b(..._(q,J));const Z=O-P[0],le=F-P[1];this.#u||=[this.x,this.y,this.width,this.height],this.width=q,this.height=J,this.x=Z,this.y=le,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#s?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#x)return this._editToolbar;this._editToolbar=new Tf(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,n]of e)await this._editToolbar.addButton(t,n);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#s?.destroy()}addContainer(e){const t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#s||(ol.initialize(cn._l10n),this.#s=new ol(this),this.#e&&(this.#s.data=this.#e,this.#e=null)),this.#s}get altTextData(){return this.#s?.data}set altTextData(e){this.#s&&(this.#s.data=e)}get guessedAltText(){return this.#s?.guessedText}async setGuessedAltText(e){await this.#s?.setGuessedText(e)}serializeAltText(e){return this.#s?.serialize(e)}hasAltText(){return!!this.#s&&!this.#s.isEmpty()}hasAltTextData(){return this.#s?.hasData()??!1}focusCommentButton(){this.#n?.focusButton()}addCommentButton(){return this.canAddComment?this.#n||=new rp(this):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(this.#i){this._uiManager.isEditingMode()&&this.#i.classList.remove("hidden");return}this.hasComment&&(this.#i=this.#n.renderForStandalone(),this.div.append(this.#i))}}removeStandaloneCommentButton(){this.#n.removeStandaloneCommentButton(),this.#i=null}hideStandaloneCommentButton(){this.#i?.classList.add("hidden")}get comment(){if(!this.#n)return null;const{data:{richText:e,text:t,date:n,deleted:r}}=this.#n;return{text:t,richText:e,date:n,deleted:r,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){this.#n||=new rp(this),typeof e=="object"&&e!==null?this.#n.restoreData(e):this.#n.data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:n}){if(!t||(this.#n||=new rp(this),this.#n.setInitialText(e,n),!this.annotationElementId))return;const r=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);r&&this.updateFromAnnotationLayer(r)}get hasEditedComment(){return this.#n?.hasBeenEdited()}get hasDeletedComment(){return this.#n?.isDeleted()}get hasComment(){return!!this.#n&&!this.#n.isEmpty()&&!this.#n.isDeleted()}async editComment(e){this.#n||=new rp(this),this.#n.edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){this.#n.setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,r]=e.rect,[i]=this.pageDimensions,[o]=this.pageTranslation,l=o+i+1,d=r-100,h=l+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[l,d,h,r]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){this.#n.data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=this.#a?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),this.#z();const[t,n]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*n/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/n).toFixed(2)}%`);const[r,i]=this.getInitialTranslation();return this.translate(r,i),P_(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#E||=new Xg({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#H.bind(this),onPinching:this.#C.bind(this),onPinchEnd:this.#S.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),e}#H(){this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#s?.toggle(!1),this.parent.togglePointerEvents(!1)}#C(e,t,n){let i=.7*(n/t)+1-.7;if(i===1)return;const o=this.#j(this.rotation),l=(O,F)=>[o[0]*O+o[2]*F,o[1]*O+o[3]*F],[d,h]=this.parentDimensions,p=this.x,g=this.y,b=this.width,x=this.height,w=cn.MIN_SIZE/d,v=cn.MIN_SIZE/h;i=Math.max(Math.min(i,1/b,1/x),w/b,v/x);const _=cn._round(b*i),N=cn._round(x*i);if(_===b&&N===x)return;this.#u||=[p,g,b,x];const E=l(b/2,x/2),k=cn._round(p+E[0]),T=cn._round(g+E[1]),P=l(_/2,N/2);this.x=k-P[0],this.y=T-P[1],this.width=_,this.height=N,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#S(){this.#s?.toggle(!0),this.parent.togglePointerEvents(!0),this.#M()}pointerdown(e){const{isMac:t}=qr.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#g=!0,this._isDraggable){this.#F(e);return}this.#R(e)}#R(e){const{isMac:t}=qr.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#F(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1;const r=new AbortController,i=this._uiManager.combinedSignal(r),o={capture:!0,passive:!1,signal:i},l=h=>{r.abort(),this.#r=null,this.#g=!1,this._uiManager.endDragSession()||this.#R(h),n&&this._onStopDragging()};t&&(this.#N=e.clientX,this.#_=e.clientY,this.#r=e.pointerId,this.#o=e.pointerType,window.addEventListener("pointermove",h=>{n||(n=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:p,clientY:g,pointerId:b}=h;if(b!==this.#r){hr(h);return}const[x,w]=this.screenToPageTranslation(p-this.#N,g-this.#_);this.#N=p,this.#_=g,this._uiManager.dragSelectedEditors(x,w)},o),window.addEventListener("touchmove",hr,o),window.addEventListener("pointerdown",h=>{h.pointerType===this.#o&&(this.#E||h.isPrimary)&&l(h),hr(h)},o));const d=h=>{if(!this.#r||this.#r===h.pointerId){l(h);return}hr(h)};window.addEventListener("pointerup",d,{signal:i}),window.addEventListener("blur",d,{signal:i})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#b&&clearTimeout(this.#b),this.#b=setTimeout(()=>{this.#b=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){const r=this.parentScale,[i,o]=this.pageDimensions,[l,d]=this.pageTranslation,h=e/r,p=t/r,g=this.x*i,b=this.y*o,x=this.width*i,w=this.height*o;switch(n){case 0:return[g+h+l,o-b-p-w+d,g+h+x+l,o-b-p+d];case 90:return[g+p+l,o-b+h+d,g+p+w+l,o-b+h+x+d];case 180:return[g-h-x+l,o-b+p+d,g-h+l,o-b+p+w+d];case 270:return[g-p-w+l,o-b-h-x+d,g-p+l,o-b-h+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,r,i,o]=e,l=i-n,d=o-r;switch(this.rotation){case 0:return[n,t-o,l,d];case 90:return[n,t-r,d,l];case 180:return[i,t-r,l,d];case 270:return[i,t-o,d,l];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&cn._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#n?.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:n,opacity:r,deleted:i,richText:o},uid:l,pageIndex:d,creationDate:h,modificationDate:p}=this;return{id:l,pageIndex:d,rect:this.getPDFRect(),richText:o,contentsObj:{str:e},creationDate:h,modificationDate:n||p,popupRef:!i,color:t,opacity:r}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#x=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#x=!1,!0):!1}isInEditMode(){return this.#x}shouldGetKeyboardEvents(){return this.#y}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:n,right:r}=this.getClientDimensions(),{innerHeight:i,innerWidth:o}=window;return t<o&&r>0&&e<i&&n>0}#z(){if(this.#f||!this.div)return;this.#f=new AbortController;const e=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#z()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(e,t,n){const r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});r.rotation=e.rotation,r.#e=e.accessibilityData,r._isCopy=e.isCopy||!1;const[i,o]=r.pageDimensions,[l,d,h,p]=r.getRectInCurrentCoords(e.rect,o);return r.x=l/i,r.y=d/o,r.width=h/i,r.height=p/o,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#b&&(clearTimeout(this.#b),this.#b=null),this.#O(),this.removeEditToolbar(),this.#w){for(const e of this.#w.values())clearTimeout(e);this.#w=null}this.parent=null,this.#E?.destroy(),this.#E=null,this.#d?.remove(),this.#d=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#I(),this.#c.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[n,r,i,o]=this.getPDFRect();return[cn._round(n+(i-n)*e),cn._round(r+(o-r)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#n.commentPopupPositionInLayer}set commentPopupPosition(e){this.#n.commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return this.#n.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#n.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){this.#n?.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#c.children;if(!this.#t){this.#t=Array.from(t);const o=this.#W.bind(this),l=this.#V.bind(this),d=this._uiManager._signal;for(const h of this.#t){const p=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",o,{signal:d}),h.addEventListener("blur",l,{signal:d}),h.addEventListener("focus",this.#Y.bind(this,p),{signal:d}),h.setAttribute("data-l10n-id",cn._l10nResizer[p])}}const n=this.#t[0];let r=0;for(const o of t){if(o===n)break;r++}const i=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(i!==r){if(i<r)for(let l=0;l<r-i;l++)this.#c.append(this.#c.firstElementChild);else if(i>r)for(let l=0;l<i-r;l++)this.#c.firstElementChild.before(this.#c.lastElementChild);let o=0;for(const l of t){const h=this.#t[o++].getAttribute("data-resizer-name");l.setAttribute("data-l10n-id",cn._l10nResizer[h])}}this.#$(0),this.#y=!0,this.#c.firstElementChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#W(e){cn._resizerKeyboardManager.exec(this,e)}#V(e){this.#y&&e.relatedTarget?.parentNode!==this.#c&&this.#O()}#Y(e){this.#m=this.#y?e:""}#$(e){if(this.#t)for(const t of this.#t)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#y&&this.#B(this.#m,{deltaX:e,deltaY:t,fromKeyboard:!0})}#O(){this.#y=!1,this.#$(-1),this.#M()}_stopResizingWithKeyboard(){this.#O(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#s?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#c?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#s?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(e){this.#p=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#w||=new Map;const{action:n}=e;let r=this.#w.get(n);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),this.#w.delete(n),this.#w.size===0&&(this.#w=null)},cn._telemetryTimeout),this.#w.set(n,r);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#a=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#a=!0}updateFakeAnnotationElement(e){if(!this.#d&&!this.deleted){this.#d=e.addFakeAnnotation(this);return}if(this.deleted){this.#d.remove(),this.#d=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#d.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){const{firstElementChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}}class DT extends cn{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Kw=3285377520,Ga=4294901760,sl=65535;class B_{constructor(e){this.h1=e?e&4294967295:Kw,this.h2=e?e&4294967295:Kw}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let v=0,_=e.length;v<_;v++){const N=e.charCodeAt(v);N<=255?t[n++]=N:(t[n++]=N>>>8,t[n++]=N&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=n>>2,i=n-r*4,o=new Uint32Array(t.buffer,0,r);let l=0,d=0,h=this.h1,p=this.h2;const g=3432918353,b=461845907,x=g&sl,w=b&sl;for(let v=0;v<r;v++)v&1?(l=o[v],l=l*g&Ga|l*x&sl,l=l<<15|l>>>17,l=l*b&Ga|l*w&sl,h^=l,h=h<<13|h>>>19,h=h*5+3864292196):(d=o[v],d=d*g&Ga|d*x&sl,d=d<<15|d>>>17,d=d*b&Ga|d*w&sl,p^=d,p=p<<13|p>>>19,p=p*5+3864292196);switch(l=0,i){case 3:l^=t[r*4+2]<<16;case 2:l^=t[r*4+1]<<8;case 1:l^=t[r*4],l=l*g&Ga|l*x&sl,l=l<<15|l>>>17,l=l*b&Ga|l*w&sl,r&1?h^=l:p^=l}this.h1=h,this.h2=p}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Ga|e*36045&sl,t=t*4283543511&Ga|((t<<16|e>>>16)*2950163797&Ga)>>>16,e^=t>>>1,e=e*444984403&Ga|e*60499&sl,t=t*3301882366&Ga|((t<<16|e>>>16)*3120437893&Ga)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const F1=Object.freeze({map:null,hash:"",transfer:void 0});class jb{#e=!1;#t=null;#s=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=this.#n.get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return this.#n.get(e)}remove(e){const t=this.#n.get(e);if(t!==void 0&&(t instanceof cn&&this.#s.delete(t.annotationElementId),this.#n.delete(e),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const n of this.#n.values())if(n instanceof cn)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=this.#n.get(e);let r=!1;if(n!==void 0)for(const[i,o]of Object.entries(t))n[i]!==o&&(r=!0,n[i]=o);else r=!0,this.#n.set(e,t);r&&this.#i(),t instanceof cn&&((this.#s||=new Map).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return this.#n.has(e)}get size(){return this.#n.size}#i(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new O_(this)}get serializable(){if(this.#n.size===0)return F1;const e=new Map,t=new B_,n=[],r=Object.create(null);let i=!1;for(const[o,l]of this.#n){const d=l instanceof cn?l.serialize(!1,r):l;l.page&&(l.pageIndex=l.page._pageIndex,delete l.page),d&&(e.set(o,d),t.update(`${o}:${JSON.stringify(d)}`),i||=!!d.bitmap)}if(i)for(const o of e.values())o.bitmap&&n.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:F1}get editorStats(){let e=null;const t=new Map;let n=0,r=0;for(const i of this.#n.values()){if(!(i instanceof cn)){i.popup&&(i.popup.deleted?r+=1:n+=1);continue}i.isCommentDeleted?r+=1:i.hasEditedComment&&(n+=1);const o=i.telemetryFinalData;if(!o)continue;const{type:l}=o;t.has(l)||t.set(l,Object.getPrototypeOf(i).constructor),e||=Object.create(null);const d=e[l]||=new Map;for(const[h,p]of Object.entries(o)){if(h==="type")continue;let g=d.get(h);g||(g=new Map,d.set(h,g));const b=g.get(p)??0;g.set(p,b+1)}}if((r>0||n>0)&&(e||=Object.create(null),e.comments={deleted:r,edited:n}),!e)return null;for(const[i,o]of t)e[i]=o.computeTelemetryFinalData(e[i]);return e}resetModifiedIds(){this.#t=null}updateEditor(e,t){const n=this.#s?.get(e);return n?(n.updateFromAnnotationLayer(t),!0):!1}getEditor(e){return this.#s?.get(e)||null}get modifiedIds(){if(this.#t)return this.#t;const e=[];if(this.#s)for(const t of this.#s.values())t.serialize()&&e.push(t.annotationElementId);return this.#t={ids:new Set(e),hash:e.join(",")}}[Symbol.iterator](){return this.#n.entries()}}class O_ extends jb{#e;constructor(e){super();const{map:t,hash:n,transfer:r}=e.serializable,i=structuredClone(t,r?{transfer:r}:null);this.#e={map:i,hash:n,transfer:r}}get print(){cs("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}get modifiedIds(){return _n(this,"modifiedIds",{ids:new Set,hash:""})}}class LT{#e=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:n}){if(!(!e||this.#e.has(e.loadedName))){if(ls(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:r,src:i,style:o}=e,l=new FontFace(r,i,o);this.addNativeFontFace(l);try{await l.load(),this.#e.add(r),n?.(e)}catch{Sn(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(l)}return}cs("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(r){throw Sn(`Failed to load font '${n.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const r=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){const e=!!this._document?.fonts;return _n(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return _n(this,"isSyncFontLoadingSupported",Oi||qr.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(ls(!r.done,"completeRequest() cannot be called twice."),r.done=!0;n.length>0&&n[0].done;){const i=n.shift();setTimeout(i.callback,0)}}const{loadingRequests:n}=this,r={done:!1,complete:t,callback:e};return n.push(r),r}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return _n(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(T,P){return T.charCodeAt(P)<<24|T.charCodeAt(P+1)<<16|T.charCodeAt(P+2)<<8|T.charCodeAt(P+3)&255}function r(T,P,O,F){const $=T.substring(0,P),z=T.substring(P+O);return $+F+z}let i,o;const l=this._document.createElement("canvas");l.width=1,l.height=1;const d=l.getContext("2d");let h=0;function p(T,P){if(++h>30){Sn("Load test font never loaded."),P();return}if(d.font="30px "+T,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){P();return}setTimeout(p.bind(null,T,P))}const g=`lt${Date.now()}${this.loadTestFontId++}`;let b=this._loadTestFont;b=r(b,976,g.length,g);const w=16,v=1482184792;let _=n(b,w);for(i=0,o=g.length-3;i<o;i+=4)_=_-v+n(g,i)|0;i<g.length&&(_=_-v+n(g+"XXX",i)|0),b=r(b,w,4,fT(_));const N=`url(data:font/opentype;base64,${btoa(b)});`,E=`@font-face {font-family:"${g}";src:${N}}`;this.insertRule(E);const k=this._document.createElement("div");k.style.visibility="hidden",k.style.width=k.style.height="10px",k.style.position="absolute",k.style.top=k.style.left="0px";for(const T of[e.loadedName,g]){const P=this._document.createElement("span");P.textContent="Hi",P.style.fontFamily=T,k.append(P)}this._document.body.append(k),p(g,()=>{k.remove(),t.complete()})}}class RT{#e;constructor(e,t=null,n,r){this.compiledGlyphs=Object.create(null),this.#e=e,this._inspectFont=t,n&&Object.assign(this,n),r&&(this.charProcOperatorList=r)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${this.data.toBase64()});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const n=this.loadedName+"_path_"+t;let r;try{r=e.get(n)}catch(o){Sn(`getPathGenerator - ignoring character: "${o}".`)}const i=R_(r?.path);return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=i}get black(){return this.#e.black}get bold(){return this.#e.bold}get disableFontFace(){return this.#e.disableFontFace??!1}set disableFontFace(e){_n(this,"disableFontFace",!!e)}get fontExtraProperties(){return this.#e.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#e.isInvalidPDFjsFont}get isType3Font(){return this.#e.isType3Font}get italic(){return this.#e.italic}get missingFile(){return this.#e.missingFile}get remeasure(){return this.#e.remeasure}get vertical(){return this.#e.vertical}get ascent(){return this.#e.ascent}get defaultWidth(){return this.#e.defaultWidth}get descent(){return this.#e.descent}get bbox(){return this.#e.bbox}set bbox(e){_n(this,"bbox",e)}get fontMatrix(){return this.#e.fontMatrix}get fallbackName(){return this.#e.fallbackName}get loadedName(){return this.#e.loadedName}get mimetype(){return this.#e.mimetype}get name(){return this.#e.name}get data(){return this.#e.data}clearData(){this.#e.clearData()}get cssFontInfo(){return this.#e.cssFontInfo}get systemFontInfo(){return this.#e.systemFontInfo}get defaultVMetrics(){return this.#e.defaultVMetrics}}class ah{#e;#t;#s;static strings=["fontFamily","fontWeight","italicAngle"];static write(e){const t=new TextEncoder,n={};let r=0;for(const h of ah.strings){const p=t.encode(e[h]);n[h]=p,r+=4+p.length}const i=new ArrayBuffer(r),o=new Uint8Array(i),l=new DataView(i);let d=0;for(const h of ah.strings){const p=n[h],g=p.length;l.setUint32(d,g),o.set(p,d+4),d+=4+g}return ls(d===i.byteLength,"CssFontInfo.write: Buffer overflow"),i}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#s=new TextDecoder}#n(e){ls(e<ah.strings.length,"Invalid string index");let t=0;for(let r=0;r<e;r++)t+=this.#t.getUint32(t)+4;const n=this.#t.getUint32(t);return this.#s.decode(new Uint8Array(this.#e,t+4,n))}get fontFamily(){return this.#n(0)}get fontWeight(){return this.#n(1)}get italicAngle(){return this.#n(2)}}class oh{#e;#t;#s;static strings=["css","loadedName","baseFontName","src"];static write(e){const t=new TextEncoder,n={};let r=0;for(const b of oh.strings){const x=t.encode(e[b]);n[b]=x,r+=4+x.length}r+=4;let i,o,l=1+r;e.style&&(i=t.encode(e.style.style),o=t.encode(e.style.weight),l+=4+i.length+4+o.length);const d=new ArrayBuffer(l),h=new Uint8Array(d),p=new DataView(d);let g=0;p.setUint8(g++,e.guessFallback?1:0),p.setUint32(g,0),g+=4,r=0;for(const b of oh.strings){const x=n[b],w=x.length;r+=4+w,p.setUint32(g,w),h.set(x,g+4),g+=4+w}return p.setUint32(g-r-4,r),e.style&&(p.setUint32(g,i.length),h.set(i,g+4),g+=4+i.length,p.setUint32(g,o.length),h.set(o,g+4),g+=4+o.length),ls(g<=d.byteLength,"SubstitionInfo.write: Buffer overflow"),d.transferToFixedLength(g)}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#s=new TextDecoder}get guessFallback(){return this.#t.getUint8(0)!==0}#n(e){ls(e<oh.strings.length,"Invalid string index");let t=5;for(let r=0;r<e;r++)t+=this.#t.getUint32(t)+4;const n=this.#t.getUint32(t);return this.#s.decode(new Uint8Array(this.#e,t+4,n))}get css(){return this.#n(0)}get loadedName(){return this.#n(1)}get baseFontName(){return this.#n(2)}get src(){return this.#n(3)}get style(){let e=1;e+=4+this.#t.getUint32(e);const t=this.#t.getUint32(e),n=this.#s.decode(new Uint8Array(this.#e,e+4,t));e+=4+t;const r=this.#t.getUint32(e),i=this.#s.decode(new Uint8Array(this.#e,e+4,r));return{style:n,weight:i}}}class _s{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#e=Math.ceil(this.bools.length*2/8);static#t=this.#e+this.numbers.length*8;static#s=this.#t+1+8;static#n=this.#s+1+48;static#i=this.#n+1+6;#a;#r;#o;constructor({data:e,extra:t}){this.#a=e,this.#r=new TextDecoder,this.#o=new DataView(this.#a),t&&Object.assign(this,t)}#c(e){ls(e<_s.bools.length,"Invalid boolean index");const t=Math.floor(e/4),n=e*2%8,r=this.#o.getUint8(t)>>n&3;return r===0?void 0:r===2}get black(){return this.#c(0)}get bold(){return this.#c(1)}get disableFontFace(){return this.#c(2)}get fontExtraProperties(){return this.#c(3)}get isInvalidPDFjsFont(){return this.#c(4)}get isType3Font(){return this.#c(5)}get italic(){return this.#c(6)}get missingFile(){return this.#c(7)}get remeasure(){return this.#c(8)}get vertical(){return this.#c(9)}#l(e){return ls(e<_s.numbers.length,"Invalid number index"),this.#o.getFloat64(_s.#e+e*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let e=_s.#t;if(this.#o.getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<4;r++)n.push(this.#o.getInt16(e,!0)),e+=2;return n}get fontMatrix(){let e=_s.#s;if(this.#o.getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<6;r++)n.push(this.#o.getFloat64(e,!0)),e+=8;return n}get defaultVMetrics(){let e=_s.#n;if(this.#o.getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<3;r++)n.push(this.#o.getInt16(e,!0)),e+=2;return n}#h(e){ls(e<_s.strings.length,"Invalid string index");let t=_s.#i+4;for(let i=0;i<e;i++)t+=this.#o.getUint32(t)+4;const n=this.#o.getUint32(t),r=new Uint8Array(n);return r.set(new Uint8Array(this.#a,t+4,n)),this.#r.decode(r)}get fallbackName(){return this.#h(0)}get loadedName(){return this.#h(1)}get mimetype(){return this.#h(2)}get name(){return this.#h(3)}get data(){let e=_s.#i;const t=this.#o.getUint32(e);e+=4+t;const n=this.#o.getUint32(e);e+=4+n;const r=this.#o.getUint32(e);e+=4+r;const i=this.#o.getUint32(e);if(i!==0)return new Uint8Array(this.#a,e+4,i)}clearData(){let e=_s.#i;const t=this.#o.getUint32(e);e+=4+t;const n=this.#o.getUint32(e);e+=4+n;const r=this.#o.getUint32(e);e+=4+r;const i=this.#o.getUint32(e);new Uint8Array(this.#a,e+4,i).fill(0),this.#o.setUint32(e,0)}get cssFontInfo(){let e=_s.#i;const t=this.#o.getUint32(e);e+=4+t;const n=this.#o.getUint32(e);e+=4+n;const r=this.#o.getUint32(e);if(r===0)return null;const i=new Uint8Array(r);return i.set(new Uint8Array(this.#a,e+4,r)),new ah(i.buffer)}get systemFontInfo(){let e=_s.#i;const t=this.#o.getUint32(e);e+=4+t;const n=this.#o.getUint32(e);if(n===0)return null;const r=new Uint8Array(n);return r.set(new Uint8Array(this.#a,e+4,n)),new oh(r.buffer)}static write(e){const t=e.systemFontInfo?oh.write(e.systemFontInfo):null,n=e.cssFontInfo?ah.write(e.cssFontInfo):null,r=new TextEncoder,i={};let o=0;for(const v of _s.strings)i[v]=r.encode(e[v]),o+=4+i[v].length;const l=_s.#i+4+o+4+(t?t.byteLength:0)+4+(n?n.byteLength:0)+4+(e.data?e.data.length:0),d=new ArrayBuffer(l),h=new Uint8Array(d),p=new DataView(d);let g=0;const b=_s.bools.length;let x=0,w=0;for(let v=0;v<b;v++){const _=e[_s.bools[v]];x|=(_===void 0?0:_?2:1)<<w,w+=2,(w===8||v===b-1)&&(p.setUint8(g++,x),x=0,w=0)}ls(g===_s.#e,"FontInfo.write: Boolean properties offset mismatch");for(const v of _s.numbers)p.setFloat64(g,e[v]),g+=8;if(ls(g===_s.#t,"FontInfo.write: Number properties offset mismatch"),e.bbox){p.setUint8(g++,4);for(const v of e.bbox)p.setInt16(g,v,!0),g+=2}else p.setUint8(g++,0),g+=8;if(ls(g===_s.#s,"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){p.setUint8(g++,6);for(const v of e.fontMatrix)p.setFloat64(g,v,!0),g+=8}else p.setUint8(g++,0),g+=48;if(ls(g===_s.#n,"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){p.setUint8(g++,1);for(const v of e.defaultVMetrics)p.setInt16(g,v,!0),g+=2}else p.setUint8(g++,0),g+=6;ls(g===_s.#i,"FontInfo.write: DefaultVMetrics properties offset mismatch"),p.setUint32(_s.#i,0),g+=4;for(const v of _s.strings){const _=i[v],N=_.length;p.setUint32(g,N),h.set(_,g+4),g+=4+N}if(p.setUint32(_s.#i,g-_s.#i-4),!t)p.setUint32(g,0),g+=4;else{const v=t.byteLength;p.setUint32(g,v),ls(g+4+v<=d.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),h.set(new Uint8Array(t),g+4),g+=4+v}if(!n)p.setUint32(g,0),g+=4;else{const v=n.byteLength;p.setUint32(g,v),ls(g+4+v<=d.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),h.set(new Uint8Array(n),g+4),g+=4+v}return e.data===void 0?(p.setUint32(g,0),g+=4):(p.setUint32(g,e.data.length),h.set(e.data,g+4),g+=4+e.data.length),ls(g<=d.byteLength,"FontInfo.write: Buffer overflow"),d.transferToFixedLength(g)}}class Jr{static#e=0;static#t=1;static#s=2;static#n=3;static#i=4;static#a=8;static#r=12;static#o=16;constructor(e){this.buffer=e,this.view=new DataView(e),this.data=new Uint8Array(e)}static write(e){let t,n=null,r=[],i=[],o=[],l=[],d=null,h=null;switch(e[0]){case"RadialAxial":t=e[1]==="axial"?1:2,n=e[2],o=e[3],t===1?r.push(...e[4],...e[5]):r.push(e[4][0],e[4][1],e[6],e[5][0],e[5][1],e[7]);break;case"Mesh":t=3,d=e[1],r=e[2],i=e[3],l=e[4]||[],n=e[6],h=e[7];break;default:throw new Error(`Unsupported pattern type: ${e[0]}`)}const p=Math.floor(r.length/2),g=Math.floor(i.length/3),b=o.length,x=l.length;let w=0;for(const P of l)w+=1,w=Math.ceil(w/4)*4,w+=4+P.coords.length*4,w+=4+P.colors.length*4,P.verticesPerRow!==void 0&&(w+=4);const v=20+p*8+g*3+b*8+(n?16:0)+(h?3:0)+w,_=new ArrayBuffer(v),N=new DataView(_),E=new Uint8Array(_);N.setUint8(Jr.#e,t),N.setUint8(Jr.#t,n?1:0),N.setUint8(Jr.#s,h?1:0),N.setUint8(Jr.#n,d),N.setUint32(Jr.#i,p,!0),N.setUint32(Jr.#a,g,!0),N.setUint32(Jr.#r,b,!0),N.setUint32(Jr.#o,x,!0);let k=20;new Float32Array(_,k,p*2).set(r),k+=p*8,E.set(i,k),k+=g*3;for(const[P,O]of o)N.setFloat32(k,P,!0),k+=4,N.setUint32(k,parseInt(O.slice(1),16),!0),k+=4;if(n)for(const P of n)N.setFloat32(k,P,!0),k+=4;h&&(E.set(h,k),k+=3);for(let P=0;P<l.length;P++){const O=l[P];N.setUint8(k,O.type),k+=1,k=Math.ceil(k/4)*4,N.setUint32(k,O.coords.length,!0),k+=4,new Int32Array(_,k,O.coords.length).set(O.coords),k+=O.coords.length*4,N.setUint32(k,O.colors.length,!0),k+=4,new Int32Array(_,k,O.colors.length).set(O.colors),k+=O.colors.length*4,O.verticesPerRow!==void 0&&(N.setUint32(k,O.verticesPerRow,!0),k+=4)}return _}getIR(){const e=this.view,t=this.data[Jr.#e],n=!!this.data[Jr.#t],r=!!this.data[Jr.#s],i=e.getUint32(Jr.#i,!0),o=e.getUint32(Jr.#a,!0),l=e.getUint32(Jr.#r,!0),d=e.getUint32(Jr.#o,!0);let h=20;const p=new Float32Array(this.buffer,h,i*2);h+=i*8;const g=new Uint8Array(this.buffer,h,o*3);h+=o*3;const b=[];for(let _=0;_<l;++_){const N=e.getFloat32(h,!0);h+=4;const E=e.getUint32(h,!0);h+=4,b.push([N,`#${E.toString(16).padStart(6,"0")}`])}let x=null;if(n){x=[];for(let _=0;_<4;++_)x.push(e.getFloat32(h,!0)),h+=4}let w=null;r&&(w=new Uint8Array(this.buffer,h,3),h+=3);const v=[];for(let _=0;_<d;++_){const N=e.getUint8(h);h+=1,h=Math.ceil(h/4)*4;const E=e.getUint32(h,!0);h+=4;const k=new Int32Array(this.buffer,h,E);h+=E*4;const T=e.getUint32(h,!0);h+=4;const P=new Int32Array(this.buffer,h,T);h+=T*4;const O={type:N,coords:k,colors:P};N===P1.LATTICE&&(O.verticesPerRow=e.getUint32(h,!0),h+=4),v.push(O)}if(t===1)return["RadialAxial","axial",x,b,Array.from(p.slice(0,2)),Array.from(p.slice(2,4)),null,null];if(t===2)return["RadialAxial","radial",x,b,[p[0],p[1]],[p[3],p[4]],p[2],p[5]];if(t===3){const _=this.data[Jr.#n];let N=null;if(p.length>0){let E=p[0],k=p[0],T=p[1],P=p[1];for(let O=0;O<p.length;O+=2){const F=p[O],$=p[O+1];E=E>F?F:E,T=T>$?$:T,k=k<F?F:k,P=P<$?$:P}N=[E,T,k,P]}return["Mesh",_,p,g,v,N,x,w]}throw new Error(`Unsupported pattern kind: ${t}`)}}class PT{static write(e){let t,n;return qr.isFloat16ArraySupported?(n=new ArrayBuffer(e.length*2),t=new Float16Array(n)):(n=new ArrayBuffer(e.length*4),t=new Float32Array(n)),t.set(e),n}#e;constructor(e){this.#e=e}get path(){return qr.isFloat16ArraySupported?new Float16Array(this.#e):new Float32Array(this.#e)}}function BT(s){if(s instanceof URL)return s.href;if(typeof s=="string"){if(Oi)return s;const e=URL.parse(s,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function OT(s){if(Oi&&typeof Buffer<"u"&&s instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength)return s;if(typeof s=="string")return Yg(s);if(s instanceof ArrayBuffer||ArrayBuffer.isView(s)||typeof s=="object"&&!isNaN(s?.length))return new Uint8Array(s);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function ip(s){if(typeof s!="string")return null;if(s.endsWith("/"))return s;throw new Error(`Invalid factory url: "${s}" must include trailing slash.`)}const U1=s=>typeof s=="object"&&Number.isInteger(s?.num)&&s.num>=0&&Number.isInteger(s?.gen)&&s.gen>=0,IT=s=>typeof s=="object"&&typeof s?.name=="string",MT=bT.bind(null,U1,IT);class FT{#e=new Map;#t=Promise.resolve();postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};this.#t.then(()=>{for(const[r]of this.#e)r.call(this,n)})}addEventListener(e,t,n=null){let r=null;if(n?.signal instanceof AbortSignal){const{signal:i}=n;if(i.aborted){Sn("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);r=()=>i.removeEventListener("abort",o),i.addEventListener("abort",o)}this.#e.set(t,r)}removeEventListener(e,t){this.#e.get(t)?.(),this.#e.delete(t)}terminate(){for(const[,e]of this.#e)e?.();this.#e.clear()}}const ap={DATA:1,ERROR:2},Cr={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Xw(){}function sa(s){if(s instanceof Gc||s instanceof B1||s instanceof $w||s instanceof Cg||s instanceof Mx)return s;switch(s instanceof Error||typeof s=="object"&&s!==null||cs('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),s.name){case"AbortException":return new Gc(s.message);case"InvalidPDFException":return new B1(s.message);case"PasswordException":return new $w(s.message,s.code);case"ResponseException":return new Cg(s.message,s.status,s.missing);case"UnknownErrorException":return new Mx(s.message,s.details)}return new Mx(s.message,s.toString())}class _f{#e=new AbortController;constructor(e,t,n){this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",this.#t.bind(this),{signal:this.#e.signal})}#t({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#n(e);return}if(e.callback){const n=e.callbackId,r=this.callbackCapabilities[n];if(!r)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===ap.DATA)r.resolve(e.data);else if(e.callback===ap.ERROR)r.reject(sa(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const n=this.sourceName,r=e.sourceName,i=this.comObj;Promise.try(t,e.data).then(function(o){i.postMessage({sourceName:n,targetName:r,callback:ap.DATA,callbackId:e.callbackId,data:o})},function(o){i.postMessage({sourceName:n,targetName:r,callback:ap.ERROR,callbackId:e.callbackId,reason:sa(o)})});return}if(e.streamId){this.#s(e);return}t(e.data)}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const r=this.callbackId++,i=Promise.withResolvers();this.callbackCapabilities[r]=i;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},n)}catch(o){i.reject(o)}return i.promise}sendWithStream(e,t,n,r){const i=this.streamId++,o=this.sourceName,l=this.targetName,d=this.comObj;return new ReadableStream({start:h=>{const p=Promise.withResolvers();return this.streamControllers[i]={controller:h,startCall:p,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:o,targetName:l,action:e,streamId:i,data:t,desiredSize:h.desiredSize},r),p.promise},pull:h=>{const p=Promise.withResolvers();return this.streamControllers[i].pullCall=p,d.postMessage({sourceName:o,targetName:l,stream:Cr.PULL,streamId:i,desiredSize:h.desiredSize}),p.promise},cancel:h=>{ls(h instanceof Error,"cancel must have a valid reason");const p=Promise.withResolvers();return this.streamControllers[i].cancelCall=p,this.streamControllers[i].isClosed=!0,d.postMessage({sourceName:o,targetName:l,stream:Cr.CANCEL,streamId:i,reason:sa(h)}),p.promise}},n)}#s(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,i=this.comObj,o=this,l=this.actionHandler[e.action],d={enqueue(h,p=1,g){if(this.isCancelled)return;const b=this.desiredSize;this.desiredSize-=p,b>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),i.postMessage({sourceName:n,targetName:r,stream:Cr.ENQUEUE,streamId:t,chunk:h},g)},close(){this.isCancelled||(this.isCancelled=!0,i.postMessage({sourceName:n,targetName:r,stream:Cr.CLOSE,streamId:t}),delete o.streamSinks[t])},error(h){ls(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,i.postMessage({sourceName:n,targetName:r,stream:Cr.ERROR,streamId:t,reason:sa(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[t]=d,Promise.try(l,e.data,d).then(function(){i.postMessage({sourceName:n,targetName:r,stream:Cr.START_COMPLETE,streamId:t,success:!0})},function(h){i.postMessage({sourceName:n,targetName:r,stream:Cr.START_COMPLETE,streamId:t,reason:sa(h)})})}#n(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,i=this.comObj,o=this.streamControllers[t],l=this.streamSinks[t];switch(e.stream){case Cr.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(sa(e.reason));break;case Cr.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(sa(e.reason));break;case Cr.PULL:if(!l){i.postMessage({sourceName:n,targetName:r,stream:Cr.PULL_COMPLETE,streamId:t,success:!0});break}l.desiredSize<=0&&e.desiredSize>0&&l.sinkCapability.resolve(),l.desiredSize=e.desiredSize,Promise.try(l.onPull||Xw).then(function(){i.postMessage({sourceName:n,targetName:r,stream:Cr.PULL_COMPLETE,streamId:t,success:!0})},function(h){i.postMessage({sourceName:n,targetName:r,stream:Cr.PULL_COMPLETE,streamId:t,reason:sa(h)})});break;case Cr.ENQUEUE:if(ls(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case Cr.CLOSE:if(ls(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),this.#i(o,t);break;case Cr.ERROR:ls(o,"error should have stream controller"),o.controller.error(sa(e.reason)),this.#i(o,t);break;case Cr.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(sa(e.reason)),this.#i(o,t);break;case Cr.CANCEL:if(!l)break;const d=sa(e.reason);Promise.try(l.onCancel||Xw,d).then(function(){i.postMessage({sourceName:n,targetName:r,stream:Cr.CANCEL_COMPLETE,streamId:t,success:!0})},function(h){i.postMessage({sourceName:n,targetName:r,stream:Cr.CANCEL_COMPLETE,streamId:t,reason:sa(h)})}),l.sinkCapability.reject(d),l.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#i(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.#e?.abort(),this.#e=null}}class I_{#e=!1;constructor({enableHWA:e=!1}){this.#e=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!this.#e})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){cs("Abstract method `_createCanvas` called.")}}class UT extends I_{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}class M_{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){cs("Abstract method `_fetch` called.")}}class Jw extends M_{async _fetch(e){const t=await Zf(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Yg(t)}}class F_{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,r,i){return"none"}destroy(e=!1){}}class zT extends F_{#e;#t;#s;#n;#i;#a;#r=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#n=e,this.#i=t}get#o(){return this.#t||=new Map}get#c(){return this.#a||=new Map}get#l(){if(!this.#s){const e=this.#i.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const n=this.#i.createElementNS(Hl,"svg");n.setAttribute("width",0),n.setAttribute("height",0),this.#s=this.#i.createElementNS(Hl,"defs"),e.append(n),n.append(this.#s),this.#i.body.append(e)}return this.#s}#h(e){if(e.length===1){const d=e[0],h=new Array(256);for(let g=0;g<256;g++)h[g]=d[g]/255;const p=h.join(",");return[p,p,p]}const[t,n,r]=e,i=new Array(256),o=new Array(256),l=new Array(256);for(let d=0;d<256;d++)i[d]=t[d]/255,o[d]=n[d]/255,l[d]=r[d]/255;return[i.join(","),o.join(","),l.join(",")]}#d(e){if(this.#e===void 0){this.#e="";const t=this.#i.URL;t!==this.#i.baseURI&&(Kg(t)?Sn('#createUrl: ignore "data:"-URL for performance reasons.'):this.#e=j_(t,""))}return`url(${this.#e}#${e})`}addFilter(e){if(!e)return"none";let t=this.#o.get(e);if(t)return t;const[n,r,i]=this.#h(e),o=e.length===1?n:`${n}${r}${i}`;if(t=this.#o.get(o),t)return this.#o.set(e,t),t;const l=`g_${this.#n}_transfer_map_${this.#r++}`,d=this.#d(l);this.#o.set(e,d),this.#o.set(o,d);const h=this.#g(l);return this.#p(n,r,i,h),d}addHCMFilter(e,t){const n=`${e}-${t}`,r="base";let i=this.#c.get(r);if(i?.key===n||(i?(i.filter?.remove(),i.key=n,i.url="none",i.filter=null):(i={key:n,url:"none",filter:null},this.#c.set(r,i)),!e||!t))return i.url;const o=this.#y(e);e=qt.makeHexColor(...o);const l=this.#y(t);if(t=qt.makeHexColor(...l),this.#l.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return i.url;const d=new Array(256);for(let x=0;x<=255;x++){const w=x/255;d[x]=w<=.03928?w/12.92:((w+.055)/1.055)**2.4}const h=d.join(","),p=`g_${this.#n}_hcm_filter`,g=i.filter=this.#g(p);this.#p(h,h,h,g),this.#m(g);const b=(x,w)=>{const v=o[x]/255,_=l[x]/255,N=new Array(w+1);for(let E=0;E<=w;E++)N[E]=v+E/w*(_-v);return N.join(",")};return this.#p(b(0,5),b(1,5),b(2,5),g),i.url=this.#d(p),i.url}addAlphaFilter(e){let t=this.#o.get(e);if(t)return t;const[n]=this.#h([e]),r=`alpha_${n}`;if(t=this.#o.get(r),t)return this.#o.set(e,t),t;const i=`g_${this.#n}_alpha_map_${this.#r++}`,o=this.#d(i);this.#o.set(e,o),this.#o.set(r,o);const l=this.#g(i);return this.#x(n,l),o}addLuminosityFilter(e){let t=this.#o.get(e||"luminosity");if(t)return t;let n,r;if(e?([n]=this.#h([e]),r=`luminosity_${n}`):r="luminosity",t=this.#o.get(r),t)return this.#o.set(e,t),t;const i=`g_${this.#n}_luminosity_map_${this.#r++}`,o=this.#d(i);this.#o.set(e,o),this.#o.set(r,o);const l=this.#g(i);return this.#f(l),e&&this.#x(n,l),o}addHighlightHCMFilter(e,t,n,r,i){const o=`${t}-${n}-${r}-${i}`;let l=this.#c.get(e);if(l?.key===o||(l?(l.filter?.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},this.#c.set(e,l)),!t||!n))return l.url;const[d,h]=[t,n].map(this.#y.bind(this));let p=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),g=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[b,x]=[r,i].map(this.#y.bind(this));g<p&&([p,g,b,x]=[g,p,x,b]),this.#l.style.color="";const w=(N,E,k)=>{const T=new Array(256),P=(g-p)/k,O=N/255,F=(E-N)/(255*k);let $=0;for(let z=0;z<=k;z++){const G=Math.round(p+z*P),R=O+z*F;for(let q=$;q<=G;q++)T[q]=R;$=G+1}for(let z=$;z<256;z++)T[z]=T[$-1];return T.join(",")},v=`g_${this.#n}_hcm_${e}_filter`,_=l.filter=this.#g(v);return this.#m(_),this.#p(w(b[0],x[0],5),w(b[1],x[1],5),w(b[2],x[2],5),_),l.url=this.#d(v),l.url}destroy(e=!1){e&&this.#a?.size||(this.#s?.parentNode.parentNode.remove(),this.#s=null,this.#t?.clear(),this.#t=null,this.#a?.clear(),this.#a=null,this.#r=0)}#f(e){const t=this.#i.createElementNS(Hl,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#m(e){const t=this.#i.createElementNS(Hl,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#g(e){const t=this.#i.createElementNS(Hl,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#l.append(t),t}#u(e,t,n){const r=this.#i.createElementNS(Hl,t);r.setAttribute("type","discrete"),r.setAttribute("tableValues",n),e.append(r)}#p(e,t,n,r){const i=this.#i.createElementNS(Hl,"feComponentTransfer");r.append(i),this.#u(i,"feFuncR",e),this.#u(i,"feFuncG",t),this.#u(i,"feFuncB",n)}#x(e,t){const n=this.#i.createElementNS(Hl,"feComponentTransfer");t.append(n),this.#u(n,"feFuncA",e)}#y(e){return this.#l.style.color=e,e0(getComputedStyle(this.#l).getPropertyValue("color"))}}class U_{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){cs("Abstract method `_fetch` called.")}}class Zw extends U_{async _fetch(e){const t=await Zf(e,"arraybuffer");return new Uint8Array(t)}}class z_{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){cs("Abstract method `_fetch` called.")}}class Qw extends z_{async _fetch(e){const t=await Zf(e,"arraybuffer");return new Uint8Array(t)}}Oi&&Sn("Please use the `legacy` build in Node.js environments.");async function Tb(s){const t=await process.getBuiltinModule("fs").promises.readFile(s);return new Uint8Array(t)}class $T extends F_{}class qT extends I_{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class HT extends M_{async _fetch(e){return Tb(e)}}class GT extends U_{async _fetch(e){return Tb(e)}}class VT extends z_{async _fetch(e){return Tb(e)}}const zd="__forcedDependency",{floor:e5,ceil:t5}=Math;function op(s,e,t,n,r,i){s[e*4+0]=Math.min(s[e*4+0],t),s[e*4+1]=Math.min(s[e*4+1],n),s[e*4+2]=Math.max(s[e*4+2],r),s[e*4+3]=Math.max(s[e*4+3],i)}const z1=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class WT{#e;#t;constructor(e,t){this.#e=e,this.#t=t}get length(){return this.#e.length}isEmpty(e){return this.#e[e]===z1}minX(e){return this.#t[e*4+0]/256}minY(e){return this.#t[e*4+1]/256}maxX(e){return(this.#t[e*4+2]+1)/256}maxY(e){return(this.#t[e*4+3]+1)/256}}const lp=(s,e)=>{if(!s)return;let t=s.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},s.set(e,t)),t};class YT{#e={__proto__:null};#t={__proto__:null,transform:[],moveText:[],sameLineText:[],[zd]:[]};#s=new Map;#n=[];#i=[];#a=[[1,0,0,1,0,0]];#r=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#c=-1;#l=new Set;#h=new Map;#d=new Map;#f;#m;#g;#u;#p;constructor(e,t,n=!1){this.#f=e.width,this.#m=e.height,this.#x(t),n&&(this.#p=new Map)}growOperationsCount(e){e>=this.#u.length&&this.#x(e,this.#u)}#x(e,t){const n=new ArrayBuffer(e*4);this.#g=new Uint8ClampedArray(n),this.#u=new Uint32Array(n),t&&t.length>0?(this.#u.set(t),this.#u.fill(z1,t.length)):this.#u.fill(z1)}save(e){return this.#e={__proto__:this.#e},this.#t={__proto__:this.#t,transform:{__proto__:this.#t.transform},moveText:{__proto__:this.#t.moveText},sameLineText:{__proto__:this.#t.sameLineText},[zd]:{__proto__:this.#t[zd]}},this.#r={__proto__:this.#r},this.#n.push(e),this}restore(e){const t=Object.getPrototypeOf(this.#e);if(t===null)return this;this.#e=t,this.#t=Object.getPrototypeOf(this.#t),this.#r=Object.getPrototypeOf(this.#r);const n=this.#n.pop();return n!==void 0&&(lp(this.#p,e)?.dependencies.add(n),this.#u[e]=this.#u[n]),this}recordOpenMarker(e){return this.#n.push(e),this}getOpenMarker(){return this.#n.length===0?null:this.#n.at(-1)}recordCloseMarker(e){const t=this.#n.pop();return t!==void 0&&(lp(this.#p,e)?.dependencies.add(t),this.#u[e]=this.#u[t]),this}beginMarkedContent(e){return this.#i.push(e),this}endMarkedContent(e){const t=this.#i.pop();return t!==void 0&&(lp(this.#p,e)?.dependencies.add(t),this.#u[e]=this.#u[t]),this}pushBaseTransform(e){return this.#a.push(qt.multiplyByDOMMatrix(this.#a.at(-1),e.getTransform())),this}popBaseTransform(){return this.#a.length>1&&this.#a.pop(),this}recordSimpleData(e,t){return this.#e[e]=t,this}recordIncrementalData(e,t){return this.#t[e].push(t),this}resetIncrementalData(e,t){return this.#t[e].length=0,this}recordNamedData(e,t){return this.#s.set(e,t),this}recordSimpleDataFromNamed(e,t,n){this.#e[e]=this.#s.get(t)??n}recordFutureForcedDependency(e,t){return this.recordIncrementalData(zd,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in this.#e&&this.recordFutureForcedDependency(t,this.#e[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of this.#l)this.recordFutureForcedDependency(zd,e);return this}resetBBox(e){return this.#c!==e&&(this.#c=e,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0),this}recordClipBox(e,t,n,r,i,o){const l=qt.multiplyByDOMMatrix(this.#a.at(-1),t.getTransform()),d=[1/0,1/0,-1/0,-1/0];qt.axialAlignedBoundingBox([n,i,r,o],l,d);const h=qt.intersect(this.#r,d);return h?(this.#r[0]=h[0],this.#r[1]=h[1],this.#r[2]=h[2],this.#r[3]=h[3]):(this.#r[0]=this.#r[1]=1/0,this.#r[2]=this.#r[3]=-1/0),this}recordBBox(e,t,n,r,i,o){const l=this.#r;if(l[0]===1/0)return this;const d=qt.multiplyByDOMMatrix(this.#a.at(-1),t.getTransform());if(l[0]===-1/0)return qt.axialAlignedBoundingBox([n,i,r,o],d,this.#o),this;const h=[1/0,1/0,-1/0,-1/0];return qt.axialAlignedBoundingBox([n,i,r,o],d,h),this.#o[0]=Math.min(this.#o[0],Math.max(h[0],l[0])),this.#o[1]=Math.min(this.#o[1],Math.max(h[1],l[1])),this.#o[2]=Math.max(this.#o[2],Math.min(h[2],l[2])),this.#o[3]=Math.max(this.#o[3],Math.min(h[3],l[3])),this}recordCharacterBBox(e,t,n,r=1,i=0,o=0,l){const d=n.bbox;let h,p;if(d&&(h=d[2]!==d[0]&&d[3]!==d[1]&&this.#d.get(n),h!==!1&&(p=[0,0,0,0],qt.axialAlignedBoundingBox(d,n.fontMatrix,p),(r!==1||i!==0||o!==0)&&qt.scaleMinMax([r,0,0,-r,i,o],p),h)))return this.recordBBox(e,t,p[0],p[2],p[1],p[3]);if(!l)return this.recordFullPageBBox(e);const g=l();return d&&p&&h===void 0&&(h=p[0]<=i-g.actualBoundingBoxLeft&&p[2]>=i+g.actualBoundingBoxRight&&p[1]<=o-g.actualBoundingBoxAscent&&p[3]>=o+g.actualBoundingBoxDescent,this.#d.set(n,h),h)?this.recordBBox(e,t,p[0],p[2],p[1],p[3]):this.recordBBox(e,t,i-g.actualBoundingBoxLeft,i+g.actualBoundingBoxRight,o-g.actualBoundingBoxAscent,o+g.actualBoundingBoxDescent)}recordFullPageBBox(e){return this.#o[0]=Math.max(0,this.#r[0]),this.#o[1]=Math.max(0,this.#r[1]),this.#o[2]=Math.min(this.#f,this.#r[2]),this.#o[3]=Math.min(this.#m,this.#r[3]),this}getSimpleIndex(e){return this.#e[e]}recordDependencies(e,t){const n=this.#l,r=this.#e,i=this.#t;for(const o of t)o in this.#e?n.add(r[o]):o in i&&i[o].forEach(n.add,n);return this}recordNamedDependency(e,t){return this.#s.has(t)&&this.#l.add(this.#s.get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[zd]),this.#p){const n=lp(this.#p,e),{dependencies:r}=n;this.#l.forEach(r.add,r),this.#n.forEach(r.add,r),this.#i.forEach(r.add,r),r.delete(e),n.isRenderingOperation=!0}if(this.#c===e){const n=e5(this.#o[0]*256/this.#f),r=e5(this.#o[1]*256/this.#m),i=t5(this.#o[2]*256/this.#f),o=t5(this.#o[3]*256/this.#m);op(this.#g,e,n,r,i,o);for(const l of this.#l)l!==e&&op(this.#g,l,n,r,i,o);for(const l of this.#n)l!==e&&op(this.#g,l,n,r,i,o);for(const l of this.#i)l!==e&&op(this.#g,l,n,r,i,o);t||(this.#l.clear(),this.#c=-1)}return this}recordShowTextOperation(e,t=!1){const n=Array.from(this.#l);this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const r of n)this.recordIncrementalData("sameLineText",r);return this}bboxToClipBoxDropOperation(e,t=!1){return this.#c===e&&(this.#c=-1,this.#r[0]=Math.max(this.#r[0],this.#o[0]),this.#r[1]=Math.max(this.#r[1],this.#o[1]),this.#r[2]=Math.min(this.#r[2],this.#o[2]),this.#r[3]=Math.min(this.#r[3],this.#o[3]),t||this.#l.clear()),this}_takePendingDependencies(){const e=this.#l;return this.#l=new Set,e}_extractOperation(e){const t=this.#h.get(e);return this.#h.delete(e),t}_pushPendingDependencies(e){for(const t of e)this.#l.add(t)}take(){return this.#d.clear(),new WT(this.#u,this.#g)}takeDebugMetadata(){return this.#p}}class Eg{#e;#t;#s;#n=0;#i=0;constructor(e,t,n){if(e instanceof Eg&&e.#s===!!n)return e;this.#e=e,this.#t=t,this.#s=!!n}growOperationsCount(){throw new Error("Unreachable")}save(e){return this.#i++,this.#e.save(this.#t),this}restore(e){return this.#i>0&&(this.#e.restore(this.#t),this.#i--),this}recordOpenMarker(e){return this.#n++,this}getOpenMarker(){return this.#n>0?this.#t:this.#e.getOpenMarker()}recordCloseMarker(e){return this.#n--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return this.#e.pushBaseTransform(e),this}popBaseTransform(){return this.#e.popBaseTransform(),this}recordSimpleData(e,t){return this.#e.recordSimpleData(e,this.#t),this}recordIncrementalData(e,t){return this.#e.recordIncrementalData(e,this.#t),this}resetIncrementalData(e,t){return this.#e.resetIncrementalData(e,this.#t),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,n){return this.#e.recordSimpleDataFromNamed(e,t,this.#t),this}recordFutureForcedDependency(e,t){return this.#e.recordFutureForcedDependency(e,this.#t),this}inheritSimpleDataAsFutureForcedDependencies(e){return this.#e.inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#e.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return this.#s||this.#e.resetBBox(this.#t),this}recordClipBox(e,t,n,r,i,o){return this.#s||this.#e.recordClipBox(this.#t,t,n,r,i,o),this}recordBBox(e,t,n,r,i,o){return this.#s||this.#e.recordBBox(this.#t,t,n,r,i,o),this}recordCharacterBBox(e,t,n,r,i,o,l){return this.#s||this.#e.recordCharacterBBox(this.#t,t,n,r,i,o,l),this}recordFullPageBBox(e){return this.#s||this.#e.recordFullPageBBox(this.#t),this}getSimpleIndex(e){return this.#e.getSimpleIndex(e)}recordDependencies(e,t){return this.#e.recordDependencies(this.#t,t),this}recordNamedDependency(e,t){return this.#e.recordNamedDependency(this.#t,t),this}recordOperation(e){return this.#e.recordOperation(this.#t,!0),this}recordShowTextOperation(e){return this.#e.recordShowTextOperation(this.#t,!0),this}bboxToClipBoxDropOperation(e){return this.#s||this.#e.bboxToClipBoxDropOperation(this.#t,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const Va={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},pi={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function $1(s,e){if(!e)return;const t=e[2]-e[0],n=e[3]-e[1],r=new Path2D;r.rect(e[0],e[1],t,n),s.clip(r)}class Db{isModifyingCurrentTransform(){return!1}getPattern(){cs("Abstract method `getPattern` called.")}}class KT extends Db{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}isOriginBased(){return this._p0[0]===0&&this._p0[1]===0&&(!this.isRadial()||this._p1[0]===0&&this._p1[1]===0)}isRadial(){return this._type==="radial"}_createGradient(e,t=null){let n,r=this._p0,i=this._p1;if(t&&(r=r.slice(),i=i.slice(),qt.applyTransform(r,t),qt.applyTransform(i,t)),this._type==="axial")n=e.createLinearGradient(r[0],r[1],i[0],i[1]);else if(this._type==="radial"){let o=this._r0,l=this._r1;if(t){const d=new Float32Array(2);qt.singularValueDecompose2dScale(t,d),o*=d[0],l*=d[0]}n=e.createRadialGradient(r[0],r[1],o,i[0],i[1],l)}for(const o of this._colorStops)n.addColorStop(o[0],o[1]);return n}getPattern(e,t,n,r){let i;if(r===pi.STROKE||r===pi.FILL){if(this.isOriginBased()){let b=qt.transform(n,t.baseTransform);this.matrix&&(b=qt.transform(b,this.matrix));const x=.001,w=Math.hypot(b[0],b[1]),v=Math.hypot(b[2],b[3]),_=(b[0]*b[2]+b[1]*b[3])/(w*v);if(Math.abs(_)<x)if(this.isRadial()){if(Math.abs(w-v)<x)return this._createGradient(e,b)}else return this._createGradient(e,b)}const o=t.current.getClippedPathBoundingBox(r,Zs(e))||[0,0,0,0],l=Math.ceil(o[2]-o[0])||1,d=Math.ceil(o[3]-o[1])||1,h=t.cachedCanvases.getCanvas("pattern",l,d),p=h.context;p.clearRect(0,0,p.canvas.width,p.canvas.height),p.beginPath(),p.rect(0,0,p.canvas.width,p.canvas.height),p.translate(-o[0],-o[1]),n=qt.transform(n,[1,0,0,1,o[0],o[1]]),p.transform(...t.baseTransform),this.matrix&&p.transform(...this.matrix),$1(p,this._bbox),p.fillStyle=this._createGradient(p),p.fill(),i=e.createPattern(h.canvas,"no-repeat");const g=new DOMMatrix(n);i.setTransform(g)}else $1(e,this._bbox),i=this._createGradient(e);return i}}function zx(s,e,t,n,r,i,o,l){const d=e.coords,h=e.colors,p=s.data,g=s.width*4;let b;d[t+1]>d[n+1]&&(b=t,t=n,n=b,b=i,i=o,o=b),d[n+1]>d[r+1]&&(b=n,n=r,r=b,b=o,o=l,l=b),d[t+1]>d[n+1]&&(b=t,t=n,n=b,b=i,i=o,o=b);const x=(d[t]+e.offsetX)*e.scaleX,w=(d[t+1]+e.offsetY)*e.scaleY,v=(d[n]+e.offsetX)*e.scaleX,_=(d[n+1]+e.offsetY)*e.scaleY,N=(d[r]+e.offsetX)*e.scaleX,E=(d[r+1]+e.offsetY)*e.scaleY;if(w>=E)return;const k=h[i],T=h[i+1],P=h[i+2],O=h[o],F=h[o+1],$=h[o+2],z=h[l],G=h[l+1],R=h[l+2],q=Math.round(w),J=Math.round(E);let Z,le,K,se,ce,ye,Ce,M;for(let L=q;L<=J;L++){if(L<_){const xe=L<w?0:(w-L)/(w-_);Z=x-(x-v)*xe,le=k-(k-O)*xe,K=T-(T-F)*xe,se=P-(P-$)*xe}else{let xe;L>E?xe=1:_===E?xe=0:xe=(_-L)/(_-E),Z=v-(v-N)*xe,le=O-(O-z)*xe,K=F-(F-G)*xe,se=$-($-R)*xe}let U;L<w?U=0:L>E?U=1:U=(w-L)/(w-E),ce=x-(x-N)*U,ye=k-(k-z)*U,Ce=T-(T-G)*U,M=P-(P-R)*U;const H=Math.round(Math.min(Z,ce)),ae=Math.round(Math.max(Z,ce));let de=g*L+H*4;for(let xe=H;xe<=ae;xe++)U=(Z-xe)/(Z-ce),U<0?U=0:U>1&&(U=1),p[de++]=le-(le-ye)*U|0,p[de++]=K-(K-Ce)*U|0,p[de++]=se-(se-M)*U|0,p[de++]=255}}function XT(s,e,t){const n=e.coords,r=e.colors;let i,o;switch(e.type){case P1.LATTICE:const l=e.verticesPerRow,d=Math.floor(n.length/l)-1,h=l-1;for(i=0;i<d;i++){let p=i*l;for(let g=0;g<h;g++,p++)zx(s,t,n[p],n[p+1],n[p+l],r[p],r[p+1],r[p+l]),zx(s,t,n[p+l+1],n[p+1],n[p+l],r[p+l+1],r[p+1],r[p+l])}break;case P1.TRIANGLES:for(i=0,o=n.length;i<o;i+=3)zx(s,t,n[i],n[i+1],n[i+2],r[i],r[i+1],r[i+2]);break;default:throw new Error("illegal figure")}}class JT extends Db{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,n){const l=Math.floor(this._bounds[0]),d=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-l,p=Math.ceil(this._bounds[3])-d,g=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),b=Math.min(Math.ceil(Math.abs(p*e[1]*1.1)),3e3),x=h/g,w=p/b,v={coords:this._coords,colors:this._colors,offsetX:-l,offsetY:-d,scaleX:1/x,scaleY:1/w},_=g+4,N=b+4,E=n.getCanvas("mesh",_,N),k=E.context,T=k.createImageData(g,b);if(t){const O=T.data;for(let F=0,$=O.length;F<$;F+=4)O[F]=t[0],O[F+1]=t[1],O[F+2]=t[2],O[F+3]=255}for(const O of this._figures)XT(T,O,v);return k.putImageData(T,2,2),{canvas:E.canvas,offsetX:l-2*x,offsetY:d-2*w,scaleX:x,scaleY:w}}isModifyingCurrentTransform(){return!0}getPattern(e,t,n,r){$1(e,this._bbox);const i=new Float32Array(2);if(r===pi.SHADING)qt.singularValueDecompose2dScale(Zs(e),i);else if(this.matrix){qt.singularValueDecompose2dScale(this.matrix,i);const[l,d]=i;qt.singularValueDecompose2dScale(t.baseTransform,i),i[0]*=l,i[1]*=d}else qt.singularValueDecompose2dScale(t.baseTransform,i);const o=this._createMeshCanvas(i,r===pi.SHADING?null:this._background,t.cachedCanvases);return r!==pi.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class ZT extends Db{getPattern(){return"hotpink"}}function QT(s){switch(s[0]){case"RadialAxial":return new KT(s);case"Mesh":return new JT(s);case"Dummy":return new ZT}throw new Error(`Unknown IR type: ${s[0]}`)}const n5={COLORED:1,UNCOLORED:2};class Lb{static MAX_PATTERN_SIZE=3e3;constructor(e,t,n,r){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=n,this.baseTransform=r}createPatternCanvas(e,t){const{bbox:n,operatorList:r,paintType:i,tilingType:o,color:l,canvasGraphicsFactory:d}=this;let{xstep:h,ystep:p}=this;h=Math.abs(h),p=Math.abs(p),Wg("TilingType: "+o);const g=n[0],b=n[1],x=n[2],w=n[3],v=x-g,_=w-b,N=new Float32Array(2);qt.singularValueDecompose2dScale(this.matrix,N);const[E,k]=N;qt.singularValueDecompose2dScale(this.baseTransform,N);const T=E*N[0],P=k*N[1];let O=v,F=_,$=!1,z=!1;const G=Math.ceil(h*T),R=Math.ceil(p*P),q=Math.ceil(v*T),J=Math.ceil(_*P);G>=q?O=h:$=!0,R>=J?F=p:z=!0;const Z=this.getSizeAndScale(O,this.ctx.canvas.width,T),le=this.getSizeAndScale(F,this.ctx.canvas.height,P),K=e.cachedCanvases.getCanvas("pattern",Z.size,le.size),se=K.context,ce=d.createCanvasGraphics(se,t);if(ce.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(ce,i,l),se.translate(-Z.scale*g,-le.scale*b),ce.transform(0,Z.scale,0,0,le.scale,0,0),se.save(),ce.dependencyTracker?.save(),this.clipBbox(ce,g,b,x,w),ce.baseTransform=Zs(ce.ctx),ce.executeOperatorList(r),ce.endDrawing(),ce.dependencyTracker?.restore(),se.restore(),$||z){const ye=K.canvas;$&&(O=h),z&&(F=p);const Ce=this.getSizeAndScale(O,this.ctx.canvas.width,T),M=this.getSizeAndScale(F,this.ctx.canvas.height,P),L=Ce.size,U=M.size,H=e.cachedCanvases.getCanvas("pattern-workaround",L,U),ae=H.context,de=$?Math.floor(v/h):0,xe=z?Math.floor(_/p):0;for(let he=0;he<=de;he++)for(let me=0;me<=xe;me++)ae.drawImage(ye,L*he,U*me,L,U,0,0,L,U);return{canvas:H.canvas,scaleX:Ce.scale,scaleY:M.scale,offsetX:g,offsetY:b}}return{canvas:K.canvas,scaleX:Z.scale,scaleY:le.scale,offsetX:g,offsetY:b}}getSizeAndScale(e,t,n){const r=Math.max(Lb.MAX_PATTERN_SIZE,t);let i=Math.ceil(e*n);return i>=r?i=r:n=i/e,{scale:n,size:i}}clipBbox(e,t,n,r,i){const o=r-t,l=i-n;e.ctx.rect(t,n,o,l),qt.axialAlignedBoundingBox([t,n,r,i],Zs(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const r=e.ctx,i=e.current;switch(t){case n5.COLORED:const{fillStyle:o,strokeStyle:l}=this.ctx;r.fillStyle=i.fillColor=o,r.strokeStyle=i.strokeColor=l;break;case n5.UNCOLORED:r.fillStyle=r.strokeStyle=n,i.fillColor=i.strokeColor=n;break;default:throw new dT(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,n,r,i){let o=n;r!==pi.SHADING&&(o=qt.transform(o,t.baseTransform),this.matrix&&(o=qt.transform(o,this.matrix)));const l=this.createPatternCanvas(t,i);let d=new DOMMatrix(o);d=d.translate(l.offsetX,l.offsetY),d=d.scale(1/l.scaleX,1/l.scaleY);const h=e.createPattern(l.canvas,"repeat");return h.setTransform(d),h}}function eD({src:s,srcPos:e=0,dest:t,width:n,height:r,nonBlackColor:i=4294967295,inverseDecode:o=!1}){const l=qr.isLittleEndian?4278190080:255,[d,h]=o?[i,l]:[l,i],p=n>>3,g=n&7,b=s.length;t=new Uint32Array(t.buffer);let x=0;for(let w=0;w<r;w++){for(const _=e+p;e<_;e++){const N=e<b?s[e]:255;t[x++]=N&128?h:d,t[x++]=N&64?h:d,t[x++]=N&32?h:d,t[x++]=N&16?h:d,t[x++]=N&8?h:d,t[x++]=N&4?h:d,t[x++]=N&2?h:d,t[x++]=N&1?h:d}if(g===0)continue;const v=e<b?s[e++]:255;for(let _=0;_<g;_++)t[x++]=v&1<<7-_?h:d}return{srcPos:e,destPos:x}}const s5=16,r5=100,tD=15,i5=10,aa=16,$x=new DOMMatrix,_a=new Float32Array(2),th=new Float32Array([1/0,1/0,-1/0,-1/0]);function nD(s,e){if(s._removeMirroring)throw new Error("Context is already forwarding operations.");s.__originalSave=s.save,s.__originalRestore=s.restore,s.__originalRotate=s.rotate,s.__originalScale=s.scale,s.__originalTranslate=s.translate,s.__originalTransform=s.transform,s.__originalSetTransform=s.setTransform,s.__originalResetTransform=s.resetTransform,s.__originalClip=s.clip,s.__originalMoveTo=s.moveTo,s.__originalLineTo=s.lineTo,s.__originalBezierCurveTo=s.bezierCurveTo,s.__originalRect=s.rect,s.__originalClosePath=s.closePath,s.__originalBeginPath=s.beginPath,s._removeMirroring=()=>{s.save=s.__originalSave,s.restore=s.__originalRestore,s.rotate=s.__originalRotate,s.scale=s.__originalScale,s.translate=s.__originalTranslate,s.transform=s.__originalTransform,s.setTransform=s.__originalSetTransform,s.resetTransform=s.__originalResetTransform,s.clip=s.__originalClip,s.moveTo=s.__originalMoveTo,s.lineTo=s.__originalLineTo,s.bezierCurveTo=s.__originalBezierCurveTo,s.rect=s.__originalRect,s.closePath=s.__originalClosePath,s.beginPath=s.__originalBeginPath,delete s._removeMirroring},s.save=function(){e.save(),this.__originalSave()},s.restore=function(){e.restore(),this.__originalRestore()},s.translate=function(t,n){e.translate(t,n),this.__originalTranslate(t,n)},s.scale=function(t,n){e.scale(t,n),this.__originalScale(t,n)},s.transform=function(t,n,r,i,o,l){e.transform(t,n,r,i,o,l),this.__originalTransform(t,n,r,i,o,l)},s.setTransform=function(t,n,r,i,o,l){e.setTransform(t,n,r,i,o,l),this.__originalSetTransform(t,n,r,i,o,l)},s.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},s.rotate=function(t){e.rotate(t),this.__originalRotate(t)},s.clip=function(t){e.clip(t),this.__originalClip(t)},s.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},s.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},s.bezierCurveTo=function(t,n,r,i,o,l){e.bezierCurveTo(t,n,r,i,o,l),this.__originalBezierCurveTo(t,n,r,i,o,l)},s.rect=function(t,n,r,i){e.rect(t,n,r,i),this.__originalRect(t,n,r,i)},s.closePath=function(){e.closePath(),this.__originalClosePath()},s.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class sD{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let r;return this.cache[e]!==void 0?(r=this.cache[e],this.canvasFactory.reset(r,t,n)):(r=this.canvasFactory.create(t,n),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function cp(s,e,t,n,r,i,o,l,d,h){const[p,g,b,x,w,v]=Zs(s);if(g===0&&b===0){const E=o*p+w,k=Math.round(E),T=l*x+v,P=Math.round(T),O=(o+d)*p+w,F=Math.abs(Math.round(O)-k)||1,$=(l+h)*x+v,z=Math.abs(Math.round($)-P)||1;return s.setTransform(Math.sign(p),0,0,Math.sign(x),k,P),s.drawImage(e,t,n,r,i,0,0,F,z),s.setTransform(p,g,b,x,w,v),[F,z]}if(p===0&&x===0){const E=l*b+w,k=Math.round(E),T=o*g+v,P=Math.round(T),O=(l+h)*b+w,F=Math.abs(Math.round(O)-k)||1,$=(o+d)*g+v,z=Math.abs(Math.round($)-P)||1;return s.setTransform(0,Math.sign(g),Math.sign(b),0,k,P),s.drawImage(e,t,n,r,i,0,0,z,F),s.setTransform(p,g,b,x,w,v),[z,F]}s.drawImage(e,t,n,r,i,o,l,d,h);const _=Math.hypot(p,g),N=Math.hypot(b,x);return[_*d,N*h]}class a5{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=R1;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=Ur.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(e,t,n){n?.(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=th.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=pi.FILL,t=null){const n=this.minMax.slice();if(e===pi.STROKE){t||cs("Stroke bounding box must include transform."),qt.singularValueDecompose2dScale(t,_a);const r=_a[0]*this.lineWidth/2,i=_a[1]*this.lineWidth/2;n[0]-=r,n[1]-=i,n[2]+=r,n[3]+=i}return n}updateClipFromPath(){const e=qt.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(th,0)}getClippedPathBoundingBox(e=pi.FILL,t=null){return qt.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function o5(s,e){if(e instanceof ImageData){s.putImageData(e,0,0);return}const t=e.height,n=e.width,r=t%aa,i=(t-r)/aa,o=r===0?i:i+1,l=s.createImageData(n,aa);let d=0,h;const p=e.data,g=l.data;let b,x,w,v;if(e.kind===ig.GRAYSCALE_1BPP){const _=p.byteLength,N=new Uint32Array(g.buffer,0,g.byteLength>>2),E=N.length,k=n+7>>3,T=4294967295,P=qr.isLittleEndian?4278190080:255;for(b=0;b<o;b++){for(w=b<i?aa:r,h=0,x=0;x<w;x++){const O=_-d;let F=0;const $=O>k?n:O*8-7,z=$&-8;let G=0,R=0;for(;F<z;F+=8)R=p[d++],N[h++]=R&128?T:P,N[h++]=R&64?T:P,N[h++]=R&32?T:P,N[h++]=R&16?T:P,N[h++]=R&8?T:P,N[h++]=R&4?T:P,N[h++]=R&2?T:P,N[h++]=R&1?T:P;for(;F<$;F++)G===0&&(R=p[d++],G=128),N[h++]=R&G?T:P,G>>=1}for(;h<E;)N[h++]=0;s.putImageData(l,0,b*aa)}}else if(e.kind===ig.RGBA_32BPP){for(x=0,v=n*aa*4,b=0;b<i;b++)g.set(p.subarray(d,d+v)),d+=v,s.putImageData(l,0,x),x+=aa;b<o&&(v=n*r*4,g.set(p.subarray(d,d+v)),s.putImageData(l,0,x))}else if(e.kind===ig.RGB_24BPP)for(w=aa,v=n*w,b=0;b<o;b++){for(b>=i&&(w=r,v=n*w),h=0,x=v;x--;)g[h++]=p[d++],g[h++]=p[d++],g[h++]=p[d++],g[h++]=255;s.putImageData(l,0,b*aa)}else throw new Error(`bad image kind: ${e.kind}`)}function l5(s,e){if(e.bitmap){s.drawImage(e.bitmap,0,0);return}const t=e.height,n=e.width,r=t%aa,i=(t-r)/aa,o=r===0?i:i+1,l=s.createImageData(n,aa);let d=0;const h=e.data,p=l.data;for(let g=0;g<o;g++){const b=g<i?aa:r;({srcPos:d}=eD({src:h,srcPos:d,dest:p,width:n,height:b,nonBlackColor:0})),s.putImageData(l,0,g*aa)}}function ff(s,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of t)s[n]!==void 0&&(e[n]=s[n]);s.setLineDash!==void 0&&(e.setLineDash(s.getLineDash()),e.lineDashOffset=s.lineDashOffset)}function up(s){s.strokeStyle=s.fillStyle="#000000",s.fillRule="nonzero",s.globalAlpha=1,s.lineWidth=1,s.lineCap="butt",s.lineJoin="miter",s.miterLimit=10,s.globalCompositeOperation="source-over",s.font="10px sans-serif",s.setLineDash!==void 0&&(s.setLineDash([]),s.lineDashOffset=0);const{filter:e}=s;e!=="none"&&e!==""&&(s.filter="none")}function c5(s,e){if(e)return!0;qt.singularValueDecompose2dScale(s,_a);const t=Math.fround(hl.pixelRatio*bh.PDF_TO_CSS_UNITS);return _a[0]<=t&&_a[1]<=t}const rD=["butt","round","square"],iD=["miter","round","bevel"],aD={},u5={};class lh{constructor(e,t,n,r,i,{optionalContentConfig:o,markedContentStack:l=null},d,h,p){this.ctx=e,this.current=new a5(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=r,this.filterFactory=i,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=l||[],this.optionalContentConfig=o,this.cachedCanvases=new sD(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=d,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=p??null}getObject(e,t,n=null){return typeof t=="string"?(this.dependencyTracker?.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):n}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:r=null}){const i=this.ctx.canvas.width,o=this.ctx.canvas.height,l=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,i,o),this.ctx.fillStyle=l,n){const d=this.cachedCanvases.getCanvas("transparent",i,o);this.compositeCtx=this.ctx,this.transparentCanvas=d.canvas,this.ctx=d.context,this.ctx.save(),this.ctx.transform(...Zs(this.compositeCtx))}this.ctx.save(),up(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Zs(this.ctx)}executeOperatorList(e,t,n,r,i){const o=e.argsArray,l=e.fnArray;let d=t||0;const h=o.length;if(h===d)return d;const p=h-d>i5&&typeof n=="function",g=p?Date.now()+tD:0;let b=0;const x=this.commonObjs,w=this.objs;let v,_;for(;;){if(r!==void 0&&d===r.nextBreakPoint)return r.breakIt(d,n),d;if(!i||i(d))if(v=l[d],_=o[d]??null,v!==$f.dependency)_===null?this[v](d):this[v](d,..._);else for(const N of _){this.dependencyTracker?.recordNamedData(N,d);const E=N.startsWith("g_")?x:w;if(!E.has(N))return E.get(N,n),d}if(d++,d===h)return d;if(p&&++b>i5){if(Date.now()>g)return n(),d;b=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const n=e.width??e.displayWidth,r=e.height??e.displayHeight;let i=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),l=n,d=r,h="prescale1",p,g;for(;i>2&&l>1||o>2&&d>1;){let b=l,x=d;i>2&&l>1&&(b=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),i/=l/b),o>2&&d>1&&(x=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,o/=d/x),p=this.cachedCanvases.getCanvas(h,b,x),g=p.context,g.clearRect(0,0,b,x),g.drawImage(e,0,0,l,d,0,0,b,x),e=p.canvas,l=b,d=x,h=h==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:d}}_createMaskCanvas(e,t){const n=this.ctx,{width:r,height:i}=t,o=this.current.fillColor,l=this.current.patternFill,d=Zs(n);let h,p,g,b;if((t.bitmap||t.data)&&t.count>1){const G=t.bitmap||t.data.buffer;p=JSON.stringify(l?d:[d.slice(0,4),o]),h=this._cachedBitmapsMap.get(G),h||(h=new Map,this._cachedBitmapsMap.set(G,h));const R=h.get(p);if(R&&!l){const q=Math.round(Math.min(d[0],d[2])+d[4]),J=Math.round(Math.min(d[1],d[3])+d[5]);return this.dependencyTracker?.recordDependencies(e,Va.transformAndFill),{canvas:R,offsetX:q,offsetY:J}}g=R}g||(b=this.cachedCanvases.getCanvas("maskCanvas",r,i),l5(b.context,t));let x=qt.transform(d,[1/r,0,0,-1/i,0,0]);x=qt.transform(x,[1,0,0,1,0,-i]);const w=th.slice();qt.axialAlignedBoundingBox([0,0,r,i],x,w);const[v,_,N,E]=w,k=Math.round(N-v)||1,T=Math.round(E-_)||1,P=this.cachedCanvases.getCanvas("fillCanvas",k,T),O=P.context,F=v,$=_;O.translate(-F,-$),O.transform(...x),g||(g=this._scaleImage(b.canvas,nl(O)),g=g.img,h&&l&&h.set(p,g)),O.imageSmoothingEnabled=c5(Zs(O),t.interpolate),cp(O,g,0,0,g.width,g.height,0,0,r,i),O.globalCompositeOperation="source-in";const z=qt.transform(nl(O),[1,0,0,1,-F,-$]);return O.fillStyle=l?o.getPattern(n,this,z,pi.FILL,e):o,O.fillRect(0,0,r,i),h&&!l&&(this.cachedCanvases.delete("fillCanvas"),h.set(p,P.canvas)),this.dependencyTracker?.recordDependencies(e,Va.transformAndFill),{canvas:P.canvas,offsetX:Math.round(F),offsetY:Math.round($)}}setLineWidth(e,t){this.dependencyTracker?.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){this.dependencyTracker?.recordSimpleData("lineCap",e),this.ctx.lineCap=rD[t]}setLineJoin(e,t){this.dependencyTracker?.recordSimpleData("lineJoin",e),this.ctx.lineJoin=iD[t]}setMiterLimit(e,t){this.dependencyTracker?.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,n){this.dependencyTracker?.recordSimpleData("dash",e);const r=this.ctx;r.setLineDash!==void 0&&(r.setLineDash(t),r.lineDashOffset=n)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){for(const[n,r]of t)switch(n){case"LW":this.setLineWidth(e,r);break;case"LC":this.setLineCap(e,r);break;case"LJ":this.setLineJoin(e,r);break;case"ML":this.setMiterLimit(e,r);break;case"D":this.setDash(e,r[0],r[1]);break;case"RI":this.setRenderingIntent(e,r);break;case"FL":this.setFlatness(e,r);break;case"Font":this.setFont(e,r[0],r[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=r;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=r;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=r;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",e),this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(r);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,n=this.ctx.canvas.height,r="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(r,t,n);this.suspendedCtx=this.ctx;const o=this.ctx=i.context;o.setTransform(this.suspendedCtx.getTransform()),ff(this.suspendedCtx,o),nD(o,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ff(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,r){const i=r[0],o=r[1],l=r[2]-i,d=r[3]-o;l===0||d===0||(this.genericComposeSMask(t.context,n,l,d,t.subtype,t.backdrop,t.transferMap,i,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,r,i,o,l,d,h,p,g){let b=e.canvas,x=d-p,w=h-g;if(o)if(x<0||w<0||x+n>b.width||w+r>b.height){const _=this.cachedCanvases.getCanvas("maskExtension",n,r),N=_.context;N.drawImage(b,-x,-w),N.globalCompositeOperation="destination-atop",N.fillStyle=o,N.fillRect(0,0,n,r),N.globalCompositeOperation="source-over",b=_.canvas,x=w=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const _=new Path2D;_.rect(x,w,n,r),e.clip(_),e.globalCompositeOperation="destination-atop",e.fillStyle=o,e.fillRect(x,w,n,r),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),i==="Alpha"&&l?t.filter=this.filterFactory.addAlphaFilter(l):i==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(l));const v=new Path2D;v.rect(d,h,n,r),t.clip(v),t.globalCompositeOperation="destination-in",t.drawImage(b,x,w,n,r,d,h,n,r),t.restore()}save(e){this.inSMaskMode&&ff(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),this.dependencyTracker?.save(e)}restore(e){if(this.dependencyTracker?.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&ff(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,n,r,i,o,l){this.dependencyTracker?.recordIncrementalData("transform",e),this.ctx.transform(t,n,r,i,o,l),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n,r){let[i]=n;if(!r){i||=n[0]=new Path2D,this[t](e,i);return}if(this.dependencyTracker!==null){const o=t===$f.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,r[0]-o,r[2]+o,r[1]-o,r[3]+o).recordDependencies(e,["transform"])}i instanceof Path2D||(i=n[0]=R_(i)),qt.axialAlignedBoundingBox(r,Zs(this.ctx),this.current.minMax),this[t](e,i),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,n=!0){const r=this.ctx,i=this.current.strokeColor;if(r.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof i=="object"&&i?.getPattern){const o=i.isModifyingCurrentTransform()?r.getTransform():null;if(r.save(),r.strokeStyle=i.getPattern(r,this,nl(r),pi.STROKE,e),o){const l=new Path2D;l.addPath(t,r.getTransform().invertSelf().multiplySelf(o)),t=l}this.rescaleAndStroke(t,!1),r.restore()}else this.rescaleAndStroke(t,!0);this.dependencyTracker?.recordDependencies(e,Va.stroke),n&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(pi.STROKE,Zs(this.ctx))),r.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,n=!0){const r=this.ctx,i=this.current.fillColor,o=this.current.patternFill;let l=!1;if(o){const h=i.isModifyingCurrentTransform()?r.getTransform():null;if(this.dependencyTracker?.save(e),r.save(),r.fillStyle=i.getPattern(r,this,nl(r),pi.FILL,e),h){const p=new Path2D;p.addPath(t,r.getTransform().invertSelf().multiplySelf(h)),t=p}l=!0}const d=this.current.getClippedPathBoundingBox();this.contentVisible&&d!==null&&(this.pendingEOFill?(r.fill(t,"evenodd"),this.pendingEOFill=!1):r.fill(t)),this.dependencyTracker?.recordDependencies(e,Va.fill),l&&(r.restore(),this.dependencyTracker?.restore(e)),n&&this.consumePath(e,t,d)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){this.ctx.fill(t),this.dependencyTracker?.recordDependencies(e,Va.rawFillPath).recordOperation(e)}clip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=aD}eoClip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=u5}beginText(e){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:r}=this;t!==void 0&&r.recordFutureForcedDependency("textClip",r.getOpenMarker()).recordFutureForcedDependency("textClip",e),r.recordCloseMarker(e)}if(t!==void 0){const r=new Path2D,i=n.getTransform().invertSelf();for(const{transform:o,x:l,y:d,fontSize:h,path:p}of t)p&&r.addPath(p,new DOMMatrix(o).preMultiplySelf(i).translate(l,d).scale(h,-h));n.clip(r)}delete this.pendingTextPaths}setCharSpacing(e,t){this.dependencyTracker?.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){this.dependencyTracker?.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){this.dependencyTracker?.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){this.dependencyTracker?.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,n){this.dependencyTracker?.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const r=this.commonObjs.get(t),i=this.current;if(!r)throw new Error(`Can't find font for ${t}`);if(i.fontMatrix=r.fontMatrix||R1,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&Sn("Invalid font matrix for font "+t),n<0?(n=-n,i.fontDirection=-1):i.fontDirection=1,this.current.font=r,this.current.fontSize=n,r.isType3Font)return;const o=r.loadedName||"sans-serif",l=r.systemFontInfo?.css||`"${o}", ${r.fallbackName}`;let d="normal";r.black?d="900":r.bold&&(d="bold");const h=r.italic?"italic":"normal";let p=n;n<s5?p=s5:n>r5&&(p=r5),this.current.fontSizeScale=n/p,this.ctx.font=`${h} ${d} ${p}px ${l}`}setTextRenderingMode(e,t){this.dependencyTracker?.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){this.dependencyTracker?.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,n){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=n}setLeadingMoveText(e,t,n){this.setLeading(e,-n),this.moveText(e,t,n)}setTextMatrix(e,t){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",e);const{current:n}=this;n.textMatrix=t,n.textMatrixScale=Math.hypot(t[0],t[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(e){this.moveText(e,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}#s(e,t,n){const r=new Path2D;return r.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),r}paintChar(e,t,n,r,i,o){const l=this.ctx,d=this.current,h=d.font,p=d.textRenderingMode,g=d.fontSize/d.fontSizeScale,b=p&Ur.FILL_STROKE_MASK,x=!!(p&Ur.ADD_TO_PATH_FLAG),w=d.patternFill&&!h.missingFile,v=d.patternStroke&&!h.missingFile;let _;if((h.disableFontFace||x||w||v)&&!h.missingFile&&(_=h.getPathGenerator(this.commonObjs,t)),_&&(h.disableFontFace||w||v)){l.save(),l.translate(n,r),l.scale(g,-g),this.dependencyTracker?.recordCharacterBBox(e,l,h);let N;if(b===Ur.FILL||b===Ur.FILL_STROKE)if(i){N=l.getTransform(),l.setTransform(...i);const E=this.#s(_,N,i);l.fill(E)}else l.fill(_);if(b===Ur.STROKE||b===Ur.FILL_STROKE)if(o){N||=l.getTransform(),l.setTransform(...o);const{a:E,b:k,c:T,d:P}=N,O=qt.inverseTransform(o),F=qt.transform([E,k,T,P,0,0],O);qt.singularValueDecompose2dScale(F,_a),l.lineWidth*=Math.max(_a[0],_a[1])/g,l.stroke(this.#s(_,N,o))}else l.lineWidth/=g,l.stroke(_);l.restore()}else(b===Ur.FILL||b===Ur.FILL_STROKE)&&(l.fillText(t,n,r),this.dependencyTracker?.recordCharacterBBox(e,l,h,g,n,r,()=>l.measureText(t))),(b===Ur.STROKE||b===Ur.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(e,l,h,g,n,r,()=>l.measureText(t)).recordDependencies(e,Va.stroke),l.strokeText(t,n,r));x&&((this.pendingTextPaths||=[]).push({transform:Zs(l),x:n,y:r,fontSize:g,path:_}),this.dependencyTracker?.recordCharacterBBox(e,l,h,g,n,r))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let r=3;r<t.length;r+=4)if(t[r]>0&&t[r]<255){n=!0;break}return _n(this,"isFontSubpixelAAEnabled",n)}showText(e,t){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,Va.showText).resetBBox(e),this.current.textRenderingMode&Ur.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,r=n.font;if(r.isType3Font){this.showType3Text(e,t),this.dependencyTracker?.recordShowTextOperation(e);return}const i=n.fontSize;if(i===0){this.dependencyTracker?.recordOperation(e);return}const o=this.ctx,l=n.fontSizeScale,d=n.charSpacing,h=n.wordSpacing,p=n.fontDirection,g=n.textHScale*p,b=t.length,x=r.vertical,w=x?1:-1,v=r.defaultVMetrics,_=i*n.fontMatrix[0],N=n.textRenderingMode===Ur.FILL&&!r.disableFontFace&&!n.patternFill;o.save(),n.textMatrix&&o.transform(...n.textMatrix),o.translate(n.x,n.y+n.textRise),p>0?o.scale(g,-1):o.scale(g,1);let E,k;const T=n.textRenderingMode&Ur.FILL_STROKE_MASK,P=T===Ur.FILL||T===Ur.FILL_STROKE,O=T===Ur.STROKE||T===Ur.FILL_STROKE;if(P&&n.patternFill){o.save();const R=n.fillColor.getPattern(o,this,nl(o),pi.FILL,e);E=Zs(o),o.restore(),o.fillStyle=R}if(O&&n.patternStroke){o.save();const R=n.strokeColor.getPattern(o,this,nl(o),pi.STROKE,e);k=Zs(o),o.restore(),o.strokeStyle=R}let F=n.lineWidth;const $=n.textMatrixScale;if($===0||F===0?O&&(F=this.getSinglePixelWidth()):F/=$,l!==1&&(o.scale(l,l),F/=l),o.lineWidth=F,r.isInvalidPDFjsFont){const R=[];let q=0;for(const Z of t)R.push(Z.unicode),q+=Z.width;const J=R.join("");if(o.fillText(J,0,0),this.dependencyTracker!==null){const Z=o.measureText(J);this.dependencyTracker.recordBBox(e,this.ctx,-Z.actualBoundingBoxLeft,Z.actualBoundingBoxRight,-Z.actualBoundingBoxAscent,Z.actualBoundingBoxDescent).recordShowTextOperation(e)}n.x+=q*_*g,o.restore(),this.compose();return}let z=0,G;for(G=0;G<b;++G){const R=t[G];if(typeof R=="number"){z+=w*R*i/1e3;continue}let q=!1;const J=(R.isSpace?h:0)+d,Z=R.fontChar,le=R.accent;let K,se,ce=R.width;if(x){const M=R.vmetric||v,L=-(R.vmetric?M[1]:ce*.5)*_,U=M[2]*_;ce=M?-M[0]:ce,K=L/l,se=(z+U)/l}else K=z/l,se=0;let ye;if(r.remeasure&&ce>0){ye=o.measureText(Z);const M=ye.width*1e3/i*l;if(ce<M&&this.isFontSubpixelAAEnabled){const L=ce/M;q=!0,o.save(),o.scale(L,1),K/=L}else ce!==M&&(K+=(ce-M)/2e3*i/l)}if(this.contentVisible&&(R.isInFont||r.missingFile)){if(N&&!le)o.fillText(Z,K,se),this.dependencyTracker?.recordCharacterBBox(e,o,ye?{bbox:null}:r,i/l,K,se,()=>ye??o.measureText(Z));else if(this.paintChar(e,Z,K,se,E,k),le){const M=K+i*le.offset.x/l,L=se-i*le.offset.y/l;this.paintChar(e,le.fontChar,M,L,E,k)}}const Ce=x?ce*_-J*p:ce*_+J*p;z+=Ce,q&&o.restore()}x?n.y-=z:n.x+=z*g,o.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(e)}showType3Text(e,t){const n=this.ctx,r=this.current,i=r.font,o=r.fontSize,l=r.fontDirection,d=i.vertical?1:-1,h=r.charSpacing,p=r.wordSpacing,g=r.textHScale*l,b=r.fontMatrix||R1,x=t.length,w=r.textRenderingMode===Ur.INVISIBLE;let v,_,N,E;if(w||o===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),r.textMatrix&&n.transform(...r.textMatrix),n.translate(r.x,r.y+r.textRise),n.scale(g,l);const k=this.dependencyTracker;for(this.dependencyTracker=k?new Eg(k,e):null,v=0;v<x;++v){if(_=t[v],typeof _=="number"){E=d*_*o/1e3,this.ctx.translate(E,0),r.x+=E*g;continue}const T=(_.isSpace?p:0)+h,P=i.charProcOperatorList[_.operatorListId];P?this.contentVisible&&(this.save(),n.scale(o,o),n.transform(...b),this.executeOperatorList(P),this.restore()):Sn(`Type3 character "${_.operatorListId}" is not available.`);const O=[_.width,0];qt.applyTransform(O,b),N=O[0]*o+T,n.translate(N,0),r.x+=N*g}n.restore(),k&&(this.dependencyTracker=k)}setCharWidth(e,t,n){}setCharWidthAndBounds(e,t,n,r,i,o,l){const d=new Path2D;d.rect(r,i,o-r,l-i),this.ctx.clip(d),this.dependencyTracker?.recordBBox(e,this.ctx,r,o,i,l).recordClipBox(e,this.ctx,r,o,i,l),this.endPath(e)}getColorN_Pattern(e,t){let n;if(t[0]==="TilingPattern"){const r=this.baseTransform||Zs(this.ctx),i={createCanvasGraphics:(o,l)=>new lh(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new Eg(this.dependencyTracker,l,!0):null)};n=new Lb(t,this.ctx,i,r)}else n=this._getPattern(e,t[1],t[2]);return n}setStrokeColorN(e,...t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,n=null){let r;return this.cachedPatterns.has(t)?r=this.cachedPatterns.get(t):(r=QT(this.getObject(e,t)),this.cachedPatterns.set(t,r)),n&&(r.matrix=n),r}shadingFill(e,t){if(!this.contentVisible)return;const n=this.ctx;this.save(e);const r=this._getPattern(e,t);n.fillStyle=r.getPattern(n,this,nl(n),pi.SHADING,e);const i=nl(n);if(i){const{width:o,height:l}=n.canvas,d=th.slice();qt.axialAlignedBoundingBox([0,0,o,l],i,d);const[h,p,g,b]=d;this.ctx.fillRect(h,p,g-h,b-p)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,Va.transform).recordDependencies(e,Va.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){cs("Should not call beginInlineImage")}beginImageData(){cs("Should not call beginImageData")}paintFormXObjectBegin(e,t,n){if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=Zs(this.ctx),n)){qt.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[r,i,o,l]=n,d=new Path2D;d.rect(r,i,o-r,l-i),this.ctx.clip(d),this.dependencyTracker?.recordClipBox(e,this.ctx,r,o,i,l),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;t.isolated||Wg("TODO: Support non-isolated groups."),t.knockout&&Sn("Knockout groups not supported.");const r=Zs(n);if(t.matrix&&n.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let i=th.slice();qt.axialAlignedBoundingBox(t.bbox,Zs(n),i);const o=[0,0,n.canvas.width,n.canvas.height];i=qt.intersect(i,o)||[0,0,0,0];const l=Math.floor(i[0]),d=Math.floor(i[1]),h=Math.max(Math.ceil(i[2])-l,1),p=Math.max(Math.ceil(i[3])-d,1);this.current.startNewPathAndClipBox([0,0,h,p]);let g="groupAt"+this.groupLevel;t.smask&&(g+="_smask_"+this.smaskCounter++%2);const b=this.cachedCanvases.getCanvas(g,h,p),x=b.context;x.translate(-l,-d),x.transform(...r);let w=new Path2D;const[v,_,N,E]=t.bbox;if(w.rect(v,_,N-v,E-_),t.matrix){const k=new Path2D;k.addPath(w,new DOMMatrix(t.matrix)),w=k}x.clip(w),t.smask&&this.smaskStack.push({canvas:b.canvas,context:x,offsetX:l,offsetY:d,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(l,d),n.save()),ff(n,x),this.ctx=x,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(e,t){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,r=this.groupStack.pop();if(this.ctx=r,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const i=Zs(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...i);const o=th.slice();qt.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],i,o),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(e,t,n,r,i,o){if(this.#e(),up(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const l=n[2]-n[0],d=n[3]-n[1];if(o&&this.annotationCanvasMap){r=r.slice(),r[4]-=n[0],r[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=l,n[3]=d,qt.singularValueDecompose2dScale(Zs(this.ctx),_a);const{viewportScale:h}=this,p=Math.ceil(l*this.outputScaleX*h),g=Math.ceil(d*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(p,g);const{canvas:b,context:x}=this.annotationCanvas;this.annotationCanvasMap.set(t,b),this.annotationCanvas.savedCtx=this.ctx,this.ctx=x,this.ctx.save(),this.ctx.setTransform(_a[0],0,0,-_a[1],0,d*_a[1]),up(this.ctx)}else{up(this.ctx),this.endPath(e);const h=new Path2D;h.rect(n[0],n[1],l,d),this.ctx.clip(h)}}this.current=new a5(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...r),this.transform(e,...i)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){if(!this.contentVisible)return;const n=t.count;t=this.getObject(e,t.data,t),t.count=n;const r=this.ctx,i=this._createMaskCanvas(e,t),o=i.canvas;r.save(),r.setTransform(1,0,0,1,0,0),r.drawImage(o,i.offsetX,i.offsetY),this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,i.offsetX,i.offsetX+o.width,i.offsetY,i.offsetY+o.height).recordOperation(e),r.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n,r=0,i=0,o,l){if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const d=this.ctx;d.save();const h=Zs(d);d.transform(n,r,i,o,0,0);const p=this._createMaskCanvas(e,t);d.setTransform(1,0,0,1,p.offsetX-h[4],p.offsetY-h[5]),this.dependencyTracker?.resetBBox(e);for(let g=0,b=l.length;g<b;g+=2){const x=qt.transform(h,[n,r,i,o,l[g],l[g+1]]);d.drawImage(p.canvas,x[4],x[5]),this.dependencyTracker?.recordBBox(e,this.ctx,x[4],x[4]+p.canvas.width,x[5],x[5]+p.canvas.height)}d.restore(),this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageMaskXObjectGroup(e,t){if(!this.contentVisible)return;const n=this.ctx,r=this.current.fillColor,i=this.current.patternFill;this.dependencyTracker?.resetBBox(e).recordDependencies(e,Va.transformAndFill);for(const o of t){const{data:l,width:d,height:h,transform:p}=o,g=this.cachedCanvases.getCanvas("maskCanvas",d,h),b=g.context;b.save();const x=this.getObject(e,l,o);l5(b,x),b.globalCompositeOperation="source-in",b.fillStyle=i?r.getPattern(b,this,nl(n),pi.FILL,e):r,b.fillRect(0,0,d,h),b.restore(),n.save(),n.transform(...p),n.scale(1,-1),cp(n,g.canvas,0,0,d,h,0,-1,1,1),this.dependencyTracker?.recordBBox(e,n,0,d,0,h),n.restore()}this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const n=this.getObject(e,t);if(!n){Sn("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,n)}paintImageXObjectRepeat(e,t,n,r,i){if(!this.contentVisible)return;const o=this.getObject(e,t);if(!o){Sn("Dependent image isn't ready yet");return}const l=o.width,d=o.height,h=[];for(let p=0,g=i.length;p<g;p+=2)h.push({transform:[n,0,0,r,i[p],i[p+1]],x:0,y:0,w:l,h:d});this.paintInlineImageXObjectGroup(e,o,h)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:n,height:r}=e,i=this.cachedCanvases.getCanvas("inlineImage",n,r),o=i.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",i.canvas}paintInlineImageXObject(e,t){if(!this.contentVisible)return;const n=t.width,r=t.height,i=this.ctx;this.save(e);const{filter:o}=i;o!=="none"&&o!==""&&(i.filter="none"),i.scale(1/n,-1/r);let l;if(t.bitmap)l=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)l=t;else{const p=this.cachedCanvases.getCanvas("inlineImage",n,r).context;o5(p,t),l=this.applyTransferMapsToCanvas(p)}const d=this._scaleImage(l,nl(i));i.imageSmoothingEnabled=c5(Zs(i),t.interpolate),this.dependencyTracker?.resetBBox(e).recordBBox(e,i,0,n,-r,0).recordDependencies(e,Va.imageXObject).recordOperation(e),cp(i,d.img,0,0,d.paintWidth,d.paintHeight,0,-r,n,r),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,n){if(!this.contentVisible)return;const r=this.ctx;let i;if(t.bitmap)i=t.bitmap;else{const o=t.width,l=t.height,h=this.cachedCanvases.getCanvas("inlineImage",o,l).context;o5(h,t),i=this.applyTransferMapsToCanvas(h)}this.dependencyTracker?.resetBBox(e);for(const o of n)r.save(),r.transform(...o.transform),r.scale(1,-1),cp(r,i,o.x,o.y,o.w,o.h,0,-1,1,1),this.dependencyTracker?.recordBBox(e,r,0,1,-1,0),r.restore();this.dependencyTracker?.recordOperation(e),this.compose()}paintSolidColorImageMask(e){this.contentVisible&&(this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,Va.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,n){}beginMarkedContent(e,t){this.dependencyTracker?.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,n){this.dependencyTracker?.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){this.dependencyTracker?.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,n){const r=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const i=this.ctx;this.pendingClip?(r||(this.pendingClip===u5?i.clip(t,"evenodd"):i.clip(t)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):this.dependencyTracker?.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Zs(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:n,c:r,d:i}=this.ctx.getTransform();let o,l;if(n===0&&r===0){const d=Math.abs(t),h=Math.abs(i);if(d===h)if(e===0)o=l=1/d;else{const p=d*e;o=l=p<1?1/p:1}else if(e===0)o=1/d,l=1/h;else{const p=d*e,g=h*e;o=p<1?1/p:1,l=g<1?1/g:1}}else{const d=Math.abs(t*i-n*r),h=Math.hypot(t,n),p=Math.hypot(r,i);if(e===0)o=p/d,l=h/d;else{const g=e*d;o=p>g?p/g:1,l=h>g?h/g:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=l}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:n,current:{lineWidth:r}}=this,[i,o]=this.getScaleForStroking();if(i===o){n.lineWidth=(r||1)*i,n.stroke(e);return}const l=n.getLineDash();t&&n.save(),n.scale(i,o),$x.a=1/i,$x.d=1/o;const d=new Path2D;if(d.addPath(e,$x),l.length>0){const h=Math.max(i,o);n.setLineDash(l.map(p=>p/h)),n.lineDashOffset/=h}n.lineWidth=r||1,n.stroke(d),t&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const s in $f)lh.prototype[s]!==void 0&&(lh.prototype[$f[s]]=lh.prototype[s]);class ch{static#e=null;static#t="";static get workerPort(){return this.#e}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#e=e}static get workerSrc(){return this.#t}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#t=e}}class oD{#e;#t;constructor({parsedData:e,rawData:t}){this.#e=e,this.#t=t}getRaw(){return this.#t}get(e){return this.#e.get(e)??null}[Symbol.iterator](){return this.#e.entries()}}const Kd=Symbol("INTERNAL");class lD{#e=!1;#t=!1;#s=!1;#n=!0;constructor(e,{name:t,intent:n,usage:r,rbGroups:i}){this.#e=!!(e&wa.DISPLAY),this.#t=!!(e&wa.PRINT),this.name=t,this.intent=n,this.usage=r,this.rbGroups=i}get visible(){if(this.#s)return this.#n;if(!this.#n)return!1;const{print:e,view:t}=this.usage;return this.#e?t?.viewState!=="OFF":this.#t?e?.printState!=="OFF":!0}_setVisible(e,t,n=!1){e!==Kd&&cs("Internal method `_setVisible` called."),this.#s=n,this.#n=t}}class cD{#e=null;#t=new Map;#s=null;#n=null;constructor(e,t=wa.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#n=e.order;for(const n of e.groups)this.#t.set(n.id,new lD(t,n));if(e.baseState==="OFF")for(const n of this.#t.values())n._setVisible(Kd,!1);for(const n of e.on)this.#t.get(n)._setVisible(Kd,!0);for(const n of e.off)this.#t.get(n)._setVisible(Kd,!1);this.#s=this.getHash()}}#i(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let r=1;r<t;r++){const i=e[r];let o;if(Array.isArray(i))o=this.#i(i);else if(this.#t.has(i))o=this.#t.get(i).visible;else return Sn(`Optional content group not found: ${i}`),!0;switch(n){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return n==="And"}isVisible(e){if(this.#t.size===0)return!0;if(!e)return Wg("Optional content group not defined."),!0;if(e.type==="OCG")return this.#t.has(e.id)?this.#t.get(e.id).visible:(Sn(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#i(e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!this.#t.has(t))return Sn(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!this.#t.has(t))return Sn(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!this.#t.has(t))return Sn(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!this.#t.has(t))return Sn(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!1}return!0}return Sn(`Unknown optional content policy ${e.policy}.`),!0}return Sn(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){const r=this.#t.get(e);if(!r){Sn(`Optional content group not found: ${e}`);return}if(n&&t&&r.rbGroups.length)for(const i of r.rbGroups)for(const o of i)o!==e&&this.#t.get(o)?._setVisible(Kd,!1,!0);r._setVisible(Kd,!!t,!0),this.#e=null}setOCGState({state:e,preserveRB:t}){let n;for(const r of e){switch(r){case"ON":case"OFF":case"Toggle":n=r;continue}const i=this.#t.get(r);if(i)switch(n){case"ON":this.setVisibility(r,!0,t);break;case"OFF":this.setVisibility(r,!1,t);break;case"Toggle":this.setVisibility(r,!i.visible,t);break}}this.#e=null}get hasInitialVisibility(){return this.#s===null||this.getHash()===this.#s}getOrder(){return this.#t.size?this.#n?this.#n.slice():[...this.#t.keys()]:null}getGroup(e){return this.#t.get(e)||null}getHash(){if(this.#e!==null)return this.#e;const e=new B_;for(const[t,n]of this.#t)e.update(`${t}:${n.visible}`);return this.#e=e.hexdigest()}[Symbol.iterator](){return this.#t.entries()}}class Jg{#e=null;#t=null;_fullReader=null;_rangeReaders=new Set;_source=null;constructor(e,t,n){this._source=e,this.#e=t,this.#t=n}get _progressiveDataLength(){return this._fullReader?._loaded??0}getFullReader(){return ls(!this._fullReader,"BasePDFStream.getFullReader can only be called once."),this._fullReader=new this.#e(this)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new this.#t(this,e,t);return this._rangeReaders.add(n),n}cancelAllRequests(e){this._fullReader?.cancel(e);for(const t of new Set(this._rangeReaders))t.cancel(e)}}class Zg{onProgress=null;_contentLength=0;_filename=null;_headersCapability=Promise.withResolvers();_isRangeSupported=!1;_isStreamingSupported=!1;_loaded=0;_stream=null;constructor(e){this._stream=e}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){cs("Abstract method `read` called")}cancel(e){cs("Abstract method `cancel` called")}}class Qg{_stream=null;constructor(e,t,n){this._stream=e}async read(){cs("Abstract method `read` called")}cancel(e){cs("Abstract method `cancel` called")}}function d5(s){return s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer}class uD extends Jg{_progressiveDone=!1;_queuedChunks=[];constructor(e){super(e,dD,hD);const{pdfDataRangeTransport:t}=e,{initialData:n,progressiveDone:r}=t;if(n?.length>0){const i=d5(n);this._queuedChunks.push(i)}this._progressiveDone=r,t.addRangeListener((i,o)=>{this.#e(i,o)}),t.addProgressListener((i,o)=>{o!==void 0&&this._fullReader?.onProgress?.({loaded:i,total:o})}),t.addProgressiveReadListener(i=>{this.#e(void 0,i)}),t.addProgressiveDoneListener(()=>{this._fullReader?.progressiveDone(),this._progressiveDone=!0}),t.transportReady()}#e(e,t){const n=d5(t);if(e===void 0)this._fullReader?this._fullReader._enqueue(n):this._queuedChunks.push(n);else{const r=this._rangeReaders.keys().find(i=>i._begin===e);ls(r,"#onReceiveData - no `PDFDataTransportStreamRangeReader` instance found."),r._enqueue(n)}}getFullReader(){const e=super.getFullReader();return this._queuedChunks=null,e}getRangeReader(e,t){const n=super.getRangeReader(e,t);return n&&(n.onDone=()=>this._rangeReaders.delete(n),this._source.pdfDataRangeTransport.requestDataRange(e,t)),n}cancelAllRequests(e){super.cancelAllRequests(e),this._source.pdfDataRangeTransport.abort()}}class dD extends Zg{_done=!1;_queuedChunks=null;_requests=[];constructor(e){super(e);const{pdfDataRangeTransport:t,disableRange:n,disableStream:r}=e._source,{length:i,contentDispositionFilename:o}=t;this._queuedChunks=e._queuedChunks||[];for(const l of this._queuedChunks)this._loaded+=l.byteLength;this._done=e._progressiveDone,this._contentLength=i,this._isStreamingSupported=!r,this._isRangeSupported=!n,Cb(o)&&(this._filename=o),this._headersCapability.resolve()}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||=!0}}class hD extends Qg{onDone=null;_begin=-1;_done=!1;_queuedChunk=null;_requests=[];constructor(e,t,n){super(e,t,n),this._begin=t}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this.onDone?.()}}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this.onDone?.()}}function fD(s){let e=!0,t=n("filename\\*","i").exec(s);if(t){t=t[1];let p=l(t);return p=unescape(p),p=d(p),p=h(p),i(p)}if(t=o(s),t){const p=h(t);return i(p)}if(t=n("filename","i").exec(s),t){t=t[1];let p=l(t);return p=h(p),i(p)}function n(p,g){return new RegExp("(?:^|;)\\s*"+p+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',g)}function r(p,g){if(p){if(!/^[\x00-\xFF]+$/.test(g))return g;try{const b=new TextDecoder(p,{fatal:!0}),x=Yg(g);g=b.decode(x),e=!1}catch{}}return g}function i(p){return e&&/[\x80-\xff]/.test(p)&&(p=r("utf-8",p),e&&(p=r("iso-8859-1",p))),p}function o(p){const g=[];let b;const x=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(b=x.exec(p))!==null;){let[,v,_,N]=b;if(v=parseInt(v,10),v in g){if(v===0)break;continue}g[v]=[_,N]}const w=[];for(let v=0;v<g.length&&v in g;++v){let[_,N]=g[v];N=l(N),_&&(N=unescape(N),v===0&&(N=d(N))),w.push(N)}return w.join("")}function l(p){if(p.startsWith('"')){const g=p.slice(1).split('\\"');for(let b=0;b<g.length;++b){const x=g[b].indexOf('"');x!==-1&&(g[b]=g[b].slice(0,x),g.length=b+1),g[b]=g[b].replaceAll(/\\(.)/g,"$1")}p=g.join('"')}return p}function d(p){const g=p.indexOf("'");if(g===-1)return p;const b=p.slice(0,g),w=p.slice(g+1).replace(/^[^']*'/,"");return r(b,w)}function h(p){return!p.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(p)?p:p.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(g,b,x,w){if(x==="q"||x==="Q")return w=w.replaceAll("_"," "),w=w.replaceAll(/=([0-9a-fA-F]{2})/g,function(v,_){return String.fromCharCode(parseInt(_,16))}),r(b,w);try{w=atob(w)}catch{}return r(b,w)})}return""}function $_(s,e){const t=new Headers;if(!s||!e||typeof e!="object")return t;for(const n in e){const r=e[n];r!==void 0&&t.append(n,r)}return t}function em(s){return URL.parse(s)?.origin??null}function q_({responseHeaders:s,isHttp:e,rangeChunkSize:t,disableRange:n}){const r={allowRangeRequests:!1,suggestedLength:void 0},i=parseInt(s.get("Content-Length"),10);return!Number.isInteger(i)||(r.suggestedLength=i,i<=2*t)||n||!e||s.get("Accept-Ranges")!=="bytes"||(s.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function H_(s){const e=s.get("Content-Disposition");if(e){let t=fD(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Cb(t))return t}return null}function tm(s,e){return new Cg(`Unexpected server response (${s}) while retrieving PDF "${e}".`,s,s===404||s===0&&e.startsWith("file:"))}function G_(s,e){if(s!==e)throw new Error(`Expected range response-origin "${s}" to match "${e}".`)}function V_(s,e,t,n){return fetch(s,{method:"GET",headers:e,signal:n.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"})}function W_(s,e){if(s!==200&&s!==206)throw tm(s,e)}function Y_(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:(Sn(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}class pD extends Jg{_responseOrigin=null;constructor(e){super(e,gD,mD),this.isHttp=/^https?:/i.test(e.url),this.headers=$_(this.isHttp,e.httpHeaders)}}class gD extends Zg{_abortController=new AbortController;_reader=null;constructor(e){super(e);const{disableRange:t,disableStream:n,length:r,rangeChunkSize:i,url:o,withCredentials:l}=e._source;this._contentLength=r,this._isStreamingSupported=!n,this._isRangeSupported=!t;const d=new Headers(e.headers);V_(o,d,l,this._abortController).then(h=>{e._responseOrigin=em(h.url),W_(h.status,o),this._reader=h.body.getReader();const p=h.headers,{allowRangeRequests:g,suggestedLength:b}=q_({responseHeaders:p,isHttp:e.isHttp,rangeChunkSize:i,disableRange:t});this._isRangeSupported=g,this._contentLength=b||this._contentLength,this._filename=H_(p),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Gc("Streaming is disabled.")),this._headersCapability.resolve()}).catch(this._headersCapability.reject)}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Y_(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class mD extends Qg{_abortController=new AbortController;_readCapability=Promise.withResolvers();_reader=null;constructor(e,t,n){super(e,t,n);const{url:r,withCredentials:i}=e._source,o=new Headers(e.headers);o.append("Range",`bytes=${t}-${n-1}`),V_(r,o,i,this._abortController).then(l=>{const d=em(l.url);G_(d,e._responseOrigin),W_(l.status,r),this._reader=l.body.getReader(),this._readCapability.resolve()}).catch(this._readCapability.reject)}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:{value:Y_(e),done:!1}}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}const qx=200,h5=206;function xD(s){return typeof s!="string"?s:Yg(s).buffer}class bD extends Jg{#e=new WeakMap;_responseOrigin=null;constructor(e){super(e,yD,vD),this.url=e.url,this.isHttp=/^https?:/i.test(this.url),this.headers=$_(this.isHttp,e.httpHeaders)}_request(e){const t=new XMLHttpRequest,n={validateStatus:null,onHeadersReceived:e.onHeadersReceived,onDone:e.onDone,onError:e.onError,onProgress:e.onProgress};this.#e.set(t,n),t.open("GET",this.url),t.withCredentials=this._source.withCredentials;for(const[r,i]of this.headers)t.setRequestHeader(r,i);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),n.validateStatus=r=>r===h5||r===qx):n.validateStatus=r=>r===qx,t.responseType="arraybuffer",ls(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>e.onError(t.status),t.onreadystatechange=this.#s.bind(this,t),t.onprogress=this.#t.bind(this,t),t.send(null),t}#t(e,t){this.#e.get(e)?.onProgress?.(t)}#s(e,t){const n=this.#e.get(e);if(!n||(e.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),e.readyState!==4)||!this.#e.has(e))return;if(this.#e.delete(e),e.status===0&&this.isHttp){n.onError(e.status);return}const r=e.status||qx;if(!n.validateStatus(r)){n.onError(e.status);return}const i=xD(e.response);if(r===h5){const o=e.getResponseHeader("Content-Range");/bytes (\d+)-(\d+)\/(\d+)/.test(o)?n.onDone(i):(Sn('Missing or invalid "Content-Range" header.'),n.onError(0))}else i?n.onDone(i):n.onError(e.status)}_abortRequest(e){this.#e.has(e)&&(this.#e.delete(e),e.abort())}getRangeReader(e,t){const n=super.getRangeReader(e,t);return n&&(n.onClosed=()=>this._rangeReaders.delete(n)),n}}class yD extends Zg{_cachedChunks=[];_done=!1;_requests=[];_storedError=null;constructor(e){super(e);const{length:t}=e._source;this._contentLength=t,this._fullRequestXhr=e._request({onHeadersReceived:this.#e.bind(this),onDone:this.#t.bind(this),onError:this.#s.bind(this),onProgress:this.#n.bind(this)})}#e(){const e=this._stream,{disableRange:t,rangeChunkSize:n}=e._source,r=this._fullRequestXhr;e._responseOrigin=em(r.responseURL);const i=r.getAllResponseHeaders(),o=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(h=>{const[p,...g]=h.split(": ");return[p,g.join(": ")]}):[]),{allowRangeRequests:l,suggestedLength:d}=q_({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:n,disableRange:t});l&&(this._isRangeSupported=!0),this._contentLength=d||this._contentLength,this._filename=H_(o),this._isRangeSupported&&e._abortRequest(r),this._headersCapability.resolve()}#t(e){if(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._cachedChunks.push(e),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}#s(e){this._storedError=tm(e,this._stream.url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}#n(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._abortRequest(this._fullRequestXhr),this._fullRequestXhr=null}}class vD extends Qg{onClosed=null;_done=!1;_queuedChunk=null;_requests=[];_storedError=null;constructor(e,t,n){super(e,t,n),this._requestXhr=e._request({begin:t,end:n,onHeadersReceived:this.#e.bind(this),onDone:this.#t.bind(this),onError:this.#s.bind(this),onProgress:null})}#e(){const e=em(this._requestXhr?.responseURL);try{G_(e,this._stream._responseOrigin)}catch(t){this._storedError=t,this.#s(0)}}#t(e){this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this.onClosed?.()}#s(e){this._storedError??=tm(e,this._stream.url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._abortRequest(this._requestXhr),this.onClosed?.()}}const wD=/^[a-z][a-z0-9\-+.]+:/i;function SD(s){if(wD.test(s))return new URL(s);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(s))}function K_(s){const{Readable:e}=process.getBuiltinModule("stream");return typeof e.toWeb=="function"?e.toWeb(s):process.getBuiltinModule("module").createRequire(import.meta.url)("node-readable-to-web-readable-stream").makeDefaultReadableStreamFromNodeReadable(s)}function X_(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:(Sn(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}class _D extends Jg{constructor(e){super(e,AD,ND),this.url=SD(e.url),ls(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs.")}}class AD extends Zg{_reader=null;constructor(e){super(e);const{disableRange:t,disableStream:n,length:r,rangeChunkSize:i}=e._source;this._contentLength=r,this._isStreamingSupported=!n,this._isRangeSupported=!t;const o=e.url,l=process.getBuiltinModule("fs");l.promises.lstat(o).then(d=>{const h=l.createReadStream(o),p=K_(h);this._reader=p.getReader();const{size:g}=d;g<=2*i&&(this._isRangeSupported=!1),this._contentLength=g,!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Gc("Streaming is disabled.")),this._headersCapability.resolve()}).catch(d=>{d.code==="ENOENT"&&(d=tm(0,o.href)),this._headersCapability.reject(d)})}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:X_(e),done:!1})}cancel(e){this._reader?.cancel(e)}}class ND extends Qg{_readCapability=Promise.withResolvers();_reader=null;constructor(e,t,n){super(e,t,n);const r=e.url,i=process.getBuiltinModule("fs");try{const o=i.createReadStream(r,{start:t,end:n-1}),l=K_(o);this._reader=l.getReader(),this._readCapability.resolve()}catch(o){this._readCapability.reject(o)}}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:{value:X_(e),done:!1}}cancel(e){this._reader?.cancel(e)}}const pf=Symbol("INITIAL_DATA");class J_{#e=Object.create(null);#t(e){return this.#e[e]||={...Promise.withResolvers(),data:pf}}get(e,t=null){if(t){const r=this.#t(e);return r.promise.then(()=>t(r.data)),null}const n=this.#e[e];if(!n||n.data===pf)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=this.#e[e];return!!t&&t.data!==pf}delete(e){const t=this.#e[e];return!t||t.data===pf?!1:(delete this.#e[e],!0)}resolve(e,t=null){const n=this.#t(e);n.data=t,n.resolve()}clear(){for(const e in this.#e){const{data:t}=this.#e[e];t?.bitmap?.close()}this.#e=Object.create(null)}*[Symbol.iterator](){for(const e in this.#e){const{data:t}=this.#e[e];t!==pf&&(yield[e,t])}}}const CD=1e5,f5=30;class Sa{#e=Promise.withResolvers();#t=null;#s=!1;#n=!!globalThis.FontInspector?.enabled;#i=null;#a=null;#r=0;#o=0;#c=null;#l=null;#h=0;#d=0;#f=Object.create(null);#m=[];#g=null;#u=[];#p=new WeakMap;#x=null;static#y=new Map;static#b=new Map;static#N=new WeakMap;static#_=null;static#w=new Set;constructor({textContentSource:e,container:t,viewport:n}){if(e instanceof ReadableStream)this.#g=e;else if(typeof e=="object")this.#g=new ReadableStream({start(d){d.enqueue(e),d.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#t=this.#l=t,this.#d=n.scale*hl.pixelRatio,this.#h=n.rotation,this.#a={div:null,properties:null,ctx:null};const{pageWidth:r,pageHeight:i,pageX:o,pageY:l}=n.rawDims;this.#x=[1,0,0,-1,-o,l+i],this.#o=r,this.#r=i,Sa.#j(),t.style.setProperty("--min-font-size",Sa.#_),Ou(t,n),this.#e.promise.finally(()=>{Sa.#w.delete(this),this.#a=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=qr.platform;return _n(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{this.#c.read().then(({value:t,done:n})=>{if(n){this.#e.resolve();return}this.#i??=t.lang,Object.assign(this.#f,t.styles),this.#E(t.items),e()},this.#e.reject)};return this.#c=this.#g.getReader(),Sa.#w.add(this),e(),this.#e.promise}update({viewport:e,onBefore:t=null}){const n=e.scale*hl.pixelRatio,r=e.rotation;if(r!==this.#h&&(t?.(),this.#h=r,Ou(this.#l,{rotation:r})),n!==this.#d){t?.(),this.#d=n;const i={div:null,properties:null,ctx:Sa.#T(this.#i)};for(const o of this.#u)i.properties=this.#p.get(o),i.div=o,this.#A(i)}}cancel(){const e=new Gc("TextLayer task cancelled.");this.#c?.cancel(e).catch(()=>{}),this.#c=null,this.#e.reject(e)}get textDivs(){return this.#u}get textContentItemsStr(){return this.#m}#E(e){if(this.#s)return;this.#a.ctx??=Sa.#T(this.#i);const t=this.#u,n=this.#m;for(const r of e){if(t.length>CD){Sn("Ignoring additional textDivs for performance reasons."),this.#s=!0;return}if(r.str===void 0){if(r.type==="beginMarkedContentProps"||r.type==="beginMarkedContent"){const i=this.#t;this.#t=document.createElement("span"),this.#t.classList.add("markedContent"),r.id&&this.#t.setAttribute("id",`${r.id}`),r.tag==="Artifact"&&(this.#t.ariaHidden=!0),i.append(this.#t)}else r.type==="endMarkedContent"&&(this.#t=this.#t.parentNode);continue}n.push(r.str),this.#v(r)}}#v(e){const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#u.push(t);const r=qt.transform(this.#x,e.transform);let i=Math.atan2(r[1],r[0]);const o=this.#f[e.fontName];o.vertical&&(i+=Math.PI/2);let l=this.#n&&o.fontSubstitution||o.fontFamily;l=Sa.fontFamilyMap.get(l)||l;const d=Math.hypot(r[2],r[3]),h=d*Sa.#I(l,o,this.#i);let p,g;i===0?(p=r[4],g=r[5]-h):(p=r[4]+h*Math.sin(i),g=r[5]-h*Math.cos(i));const b=t.style;b.left=`${(100*p/this.#o).toFixed(2)}%`,b.top=`${(100*g/this.#r).toFixed(2)}%`,b.setProperty("--font-height",`${d.toFixed(2)}px`),b.fontFamily=l,n.fontSize=d,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#n&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),i!==0&&(n.angle=i*(180/Math.PI));let x=!1;if(e.str.length>1)x=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const w=Math.abs(e.transform[0]),v=Math.abs(e.transform[3]);w!==v&&Math.max(w,v)/Math.min(w,v)>1.5&&(x=!0)}if(x&&(n.canvasWidth=o.vertical?e.height:e.width),this.#p.set(t,n),this.#a.div=t,this.#a.properties=n,this.#A(this.#a),n.hasText&&this.#t.append(t),n.hasEOL){const w=document.createElement("br");w.setAttribute("role","presentation"),this.#t.append(w)}}#A(e){const{div:t,properties:n,ctx:r}=e,{style:i}=t;if(n.canvasWidth!==0&&n.hasText){const{fontFamily:o}=i,{canvasWidth:l,fontSize:d}=n;Sa.#k(r,d*this.#d,o);const{width:h}=r.measureText(t.textContent);h>0&&i.setProperty("--scale-x",l*this.#d/h)}n.angle!==0&&i.setProperty("--rotate",`${n.angle}deg`)}static cleanup(){if(!(this.#w.size>0)){this.#y.clear();for(const{canvas:e}of this.#b.values())e.remove();this.#b.clear()}}static#T(e=null){let t=this.#b.get(e||="");if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#b.set(e,t),this.#N.set(t,{size:0,family:""})}return t}static#k(e,t,n){const r=this.#N.get(e);t===r.size&&n===r.family||(e.font=`${t}px ${n}`,r.size=t,r.family=n)}static#j(){if(this.#_!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#_=e.getBoundingClientRect().height,e.remove()}static#I(e,t,n){const r=this.#y.get(e);if(r)return r;const i=this.#T(n);i.canvas.width=i.canvas.height=f5,this.#k(i,f5,e);const o=i.measureText(""),l=o.fontBoundingBoxAscent,d=Math.abs(o.fontBoundingBoxDescent);i.canvas.width=i.canvas.height=0;let h=.8;return l?h=l/(l+d):(qr.platform.isFirefox&&Sn("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?h=t.ascent:t.descent&&(h=1+t.descent)),this.#y.set(e,h),h}}const ED=100;function Z_(s={}){typeof s=="string"||s instanceof URL?s={url:s}:(s instanceof ArrayBuffer||ArrayBuffer.isView(s))&&(s={data:s});const e=new Rb,{docId:t}=e,n=s.url?BT(s.url):null,r=s.data?OT(s.data):null,i=s.httpHeaders||null,o=s.withCredentials===!0,l=s.password??null,d=s.range instanceof Q_?s.range:null,h=Number.isInteger(s.rangeChunkSize)&&s.rangeChunkSize>0?s.rangeChunkSize:2**16;let p=s.worker instanceof Hf?s.worker:null;const g=s.verbosity,b=typeof s.docBaseUrl=="string"&&!Kg(s.docBaseUrl)?s.docBaseUrl:null,x=ip(s.cMapUrl),w=s.cMapPacked!==!1,v=s.CMapReaderFactory||(Oi?HT:Jw),_=ip(s.iccUrl),N=ip(s.standardFontDataUrl),E=s.StandardFontDataFactory||(Oi?GT:Zw),k=ip(s.wasmUrl),T=s.WasmFactory||(Oi?VT:Qw),P=s.stopAtErrors!==!0,O=Number.isInteger(s.maxImageSize)&&s.maxImageSize>-1?s.maxImageSize:-1,F=s.isEvalSupported!==!1,$=typeof s.isOffscreenCanvasSupported=="boolean"?s.isOffscreenCanvasSupported:!Oi,z=typeof s.isImageDecoderSupported=="boolean"?s.isImageDecoderSupported:!Oi&&(qr.platform.isFirefox||!globalThis.chrome),G=Number.isInteger(s.canvasMaxAreaInBytes)?s.canvasMaxAreaInBytes:-1,R=typeof s.disableFontFace=="boolean"?s.disableFontFace:Oi,q=s.fontExtraProperties===!0,J=s.enableXfa===!0,Z=s.ownerDocument||globalThis.document,le=s.disableRange===!0,K=s.disableStream===!0,se=s.disableAutoFetch===!0,ce=s.pdfBug===!0,ye=s.CanvasFactory||(Oi?qT:UT),Ce=s.FilterFactory||(Oi?$T:zT),M=s.enableHWA===!0,L=s.useWasm!==!1,U=d?d.length:s.length??NaN,H=typeof s.useSystemFonts=="boolean"?s.useSystemFonts:!Oi&&!R,ae=typeof s.useWorkerFetch=="boolean"?s.useWorkerFetch:!!(v===Jw&&E===Zw&&T===Qw&&x&&N&&k&&Sf(x,document.baseURI)&&Sf(N,document.baseURI)&&Sf(k,document.baseURI)),de=null;lT(g);const xe={canvasFactory:new ye({ownerDocument:Z,enableHWA:M}),filterFactory:new Ce({docId:t,ownerDocument:Z}),cMapReaderFactory:ae?null:new v({baseUrl:x,isCompressed:w}),standardFontDataFactory:ae?null:new E({baseUrl:N}),wasmFactory:ae?null:new T({baseUrl:k})};p||(p=Hf.create({verbosity:g,port:ch.workerPort}),e._worker=p);const he={docId:t,apiVersion:"5.4.624",data:r,password:l,disableAutoFetch:se,rangeChunkSize:h,length:U,docBaseUrl:b,enableXfa:J,evaluatorOptions:{maxImageSize:O,disableFontFace:R,ignoreErrors:P,isEvalSupported:F,isOffscreenCanvasSupported:$,isImageDecoderSupported:z,canvasMaxAreaInBytes:G,fontExtraProperties:q,useSystemFonts:H,useWasm:L,useWorkerFetch:ae,cMapUrl:x,iccUrl:_,standardFontDataUrl:N,wasmUrl:k}},me={ownerDocument:Z,pdfBug:ce,styleElement:de,enableHWA:M,loadingParams:{disableAutoFetch:se,enableXfa:J}};return p.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(p.destroyed)throw new Error("Worker was destroyed");const ve=p.messageHandler.sendWithPromise("GetDocRequest",he,r?[r.buffer]:null);let Re;if(d)Re=new uD({pdfDataRangeTransport:d,disableRange:le,disableStream:K});else if(!r){if(!n)throw new Error("getDocument - no `url` parameter provided.");const Ke=Sf(n)?pD:Oi?_D:bD;Re=new Ke({url:n,length:U,httpHeaders:i,withCredentials:o,rangeChunkSize:h,disableRange:le,disableStream:K})}return ve.then(Ke=>{if(e.destroyed)throw new Error("Loading aborted");if(p.destroyed)throw new Error("Worker was destroyed");const Ge=new _f(t,Ke,p.port),ke=new TD(Ge,e,Re,me,xe);e._transport=ke,Ge.send("Ready",null)})}).catch(e._capability.reject),e}class Rb{static#e=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${Rb.#e++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class Q_{#e=Promise.withResolvers();#t=[];#s=[];#n=[];#i=[];constructor(e,t,n=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=r}addRangeListener(e){this.#i.push(e)}addProgressListener(e){this.#n.push(e)}addProgressiveReadListener(e){this.#s.push(e)}addProgressiveDoneListener(e){this.#t.push(e)}onDataRange(e,t){for(const n of this.#i)n(e,t)}onDataProgress(e,t){this.#e.promise.then(()=>{for(const n of this.#n)n(e,t)})}onDataProgressiveRead(e){this.#e.promise.then(()=>{for(const t of this.#s)t(e)})}onDataProgressiveDone(){this.#e.promise.then(()=>{for(const e of this.#t)e()})}transportReady(){this.#e.resolve()}requestDataRange(e,t){cs("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class kD{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return _n(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(e){return this._transport.extractPages(e)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class jD{#e=!1;#t=as.instance;constructor(e,t,n,r=!1){this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=r?new Hw:null,this._pdfBug=r,this.commonObjs=n.commonObjs,this.objs=new J_,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}set pageNumber(e){this._pageIndex=e-1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:i=!1}={}){return new Qf({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return _n(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,canvas:t=e.canvas,viewport:n,intent:r="display",annotationMode:i=Fc.ENABLE,transform:o=null,background:l=null,optionalContentConfigPromise:d=null,annotationCanvasMap:h=null,pageColors:p=null,printAnnotationStorage:g=null,isEditing:b=!1,recordOperations:x=!1,operationsFilter:w=null}){this._stats?.time("Overall");const v=this._transport.getRenderingIntent(r,i,g,b),{renderingIntent:_,cacheKey:N}=v;this.#e=!1,d||=this._transport.getOptionalContentConfig(_);let E=this._intentStates.get(N);E||(E=Object.create(null),this._intentStates.set(N,E)),E.streamReaderCancelTimeout&&(clearTimeout(E.streamReaderCancelTimeout),E.streamReaderCancelTimeout=null);const k=!!(_&wa.PRINT);E.displayReadyCapability||(E.displayReadyCapability=Promise.withResolvers(),E.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(v));const T=!!(this._pdfBug&&globalThis.StepperManager?.enabled),P=!this.recordedBBoxes&&(x||T),O=z=>{if(E.renderTasks.delete(F),P){const G=F.gfx?.dependencyTracker.take();G&&(F.stepper&&F.stepper.setOperatorBBoxes(G,F.gfx.dependencyTracker.takeDebugMetadata()),x&&(this.recordedBBoxes=G))}k&&(this.#e=!0),this.#s(),z?(F.capability.reject(z),this._abortOperatorList({intentState:E,reason:z instanceof Error?z:new Error(z)})):F.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},F=new nh({callback:O,params:{canvas:t,canvasContext:e,dependencyTracker:P?new YT(t,E.operatorList.length,T):null,viewport:n,transform:o,background:l},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:E.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!k,pdfBug:this._pdfBug,pageColors:p,enableHWA:this._transport.enableHWA,operationsFilter:w});(E.renderTasks||=new Set).add(F);const $=F.task;return Promise.all([E.displayReadyCapability.promise,d]).then(([z,G])=>{if(this.destroyed){O();return}if(this._stats?.time("Rendering"),!(G.renderingIntent&_))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");F.initializeGraphics({transparency:z,optionalContentConfig:G}),F.operatorListChanged()}).catch(O),$}getOperatorList({intent:e="display",annotationMode:t=Fc.ENABLE,printAnnotationStorage:n=null,isEditing:r=!1}={}){function i(){l.operatorList.lastChunk&&(l.opListReadCapability.resolve(l.operatorList),l.renderTasks.delete(d))}const o=this._transport.getRenderingIntent(e,t,n,r,!0);let l=this._intentStates.get(o.cacheKey);l||(l=Object.create(null),this._intentStates.set(o.cacheKey,l));let d;return l.opListReadCapability||(d=Object.create(null),d.operatorListChanged=i,l.opListReadCapability=Promise.withResolvers(),(l.renderTasks||=new Set).add(d),l.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(o)),l.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageId:this.#t.getPageId(this._pageIndex+1)-1,pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>qf.textContent(n));const t=this.streamTextContent(e);return new Promise(function(n,r){function i(){o.read().then(function({value:d,done:h}){if(h){n(l);return}l.lang??=d.lang,Object.assign(l.styles,d.styles),l.items.push(...d.items),i()},r)}const o=t.getReader(),l={items:[],styles:Object.create(null),lang:null};i()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),this.#e=!1,Promise.all(e)}cleanup(e=!1){this.#e=!0;const t=this.#s();return e&&t&&(this._stats&&=new Hw),t}#s(){if(!this.#e||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}_startRenderPage(e,t){const n=this._intentStates.get(t);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let n=0,r=e.length;n<r;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&this.#s()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:r}){const{map:i,transfer:o}=n,d=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageId:this.#t.getPageId(this._pageIndex+1)-1,pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:i,modifiedIds:r},o).getReader(),h=this._intentStates.get(t);h.streamReader=d;const p=()=>{d.read().then(({value:g,done:b})=>{if(b){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(g,h),p())},g=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const b of h.renderTasks)b.operatorListChanged();this.#s()}if(h.displayReadyCapability)h.displayReadyCapability.reject(g);else if(h.opListReadCapability)h.opListReadCapability.reject(g);else throw g}})};p()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof Nb){let r=ED;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new Gc(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,i]of this._intentStates)if(i===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}var Uc,ko,Yl,Tu,Og,Du,Lu,Ii,ag,e4,t4,Af,gh,og;const Gs=class Gs{constructor({name:e=null,port:t=null,verbosity:n=cT()}={}){el(this,Ii);el(this,Uc,Promise.withResolvers());el(this,ko,null);el(this,Yl,null);el(this,Tu,null);if(this.name=e,this.destroyed=!1,this.verbosity=n,t){if(qs(Gs,Lu).has(t))throw new Error("Cannot use more than one PDFWorker per port.");qs(Gs,Lu).set(t,this),tl(this,Ii,e4).call(this,t)}else tl(this,Ii,t4).call(this)}get promise(){return qs(this,Uc).promise}get port(){return qs(this,Yl)}get messageHandler(){return qs(this,ko)}destroy(){this.destroyed=!0,qs(this,Tu)?.terminate(),na(this,Tu,null),qs(Gs,Lu).delete(qs(this,Yl)),na(this,Yl,null),qs(this,ko)?.destroy(),na(this,ko,null)}static create(e){const t=qs(this,Lu).get(e?.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Gs(e)}static get workerSrc(){if(ch.workerSrc)return ch.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return _n(this,"_setupFakeWorkerGlobal",(async()=>qs(this,gh,og)?qs(this,gh,og):(await import(this.workerSrc)).WorkerMessageHandler)())}};Uc=new WeakMap,ko=new WeakMap,Yl=new WeakMap,Tu=new WeakMap,Og=new WeakMap,Du=new WeakMap,Lu=new WeakMap,Ii=new WeakSet,ag=function(){qs(this,Uc).resolve(),qs(this,ko).send("configure",{verbosity:this.verbosity})},e4=function(e){na(this,Yl,e),na(this,ko,new _f("main","worker",e)),qs(this,ko).on("ready",()=>{}),tl(this,Ii,ag).call(this)},t4=function(){if(qs(Gs,Du)||qs(Gs,gh,og)){tl(this,Ii,Af).call(this);return}let{workerSrc:e}=Gs;try{Gs._isSameOrigin(window.location,e)||(e=Gs._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new _f("main","worker",t),r=()=>{i.abort(),n.destroy(),t.terminate(),this.destroyed?qs(this,Uc).reject(new Error("Worker was destroyed")):tl(this,Ii,Af).call(this)},i=new AbortController;t.addEventListener("error",()=>{qs(this,Tu)||r()},{signal:i.signal}),n.on("test",l=>{if(i.abort(),this.destroyed||!l){r();return}na(this,ko,n),na(this,Yl,t),na(this,Tu,t),tl(this,Ii,ag).call(this)}),n.on("ready",l=>{if(i.abort(),this.destroyed){r();return}try{o()}catch{tl(this,Ii,Af).call(this)}});const o=()=>{const l=new Uint8Array;n.send("test",l,[l.buffer])};o();return}catch{Wg("The worker has been disabled.")}tl(this,Ii,Af).call(this)},Af=function(){qs(Gs,Du)||(Sn("Setting up fake worker."),na(Gs,Du,!0)),Gs._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){qs(this,Uc).reject(new Error("Worker was destroyed"));return}const t=new FT;na(this,Yl,t);const n=`fake${h2(Gs,Og)._++}`,r=new _f(n+"_worker",n,t);e.setup(r,t),na(this,ko,new _f(n,n+"_worker",t)),tl(this,Ii,ag).call(this)}).catch(e=>{qs(this,Uc).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},gh=new WeakSet,og=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},el(Gs,gh),el(Gs,Og,0),el(Gs,Du,!1),el(Gs,Lu,new WeakMap),Oi&&(na(Gs,Du,!0),ch.workerSrc||="./pdf.worker.mjs"),Gs._isSameOrigin=(e,t)=>{const n=URL.parse(e);if(!n?.origin||n.origin==="null")return!1;const r=new URL(t,n);return n.origin===r.origin},Gs._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},Gs.fromPort=e=>{if(wT("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return Gs.create(e)};let Hf=Gs;class TD{downloadInfoCapability=Promise.withResolvers();#e=null;#t=new Map;#s=null;#n=new Map;#i=new Map;#a=new Map;#r=null;#o=as.instance;constructor(e,t,n,r,i){this.messageHandler=e,this.loadingTask=t,this.#s=n,this.commonObjs=new J_,this.fontLoader=new LT({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.enableHWA=r.enableHWA,this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=i.canvasFactory,this.filterFactory=i.filterFactory,this.cMapReaderFactory=i.cMapReaderFactory,this.standardFontDataFactory=i.standardFontDataFactory,this.wasmFactory=i.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this.setupMessageHandler(),this.#o.addListener(this.#c.bind(this))}#c(){const e=new Map,t=new Map;for(let n=0,r=this.#o.pagesNumber;n<r;n++){const i=this.#o.getPrevPageNumber(n+1)-1,o=this.#n.get(i);o&&e.set(n,o);const l=this.#i.get(i);l&&t.set(n,l)}this.#n=e,this.#i=t}#l(e,t=null){const n=this.#t.get(e);if(n)return n;const r=this.messageHandler.sendWithPromise(e,t);return this.#t.set(e,r),r}#h({loaded:e,total:t}){this.loadingTask.onProgress?.({loaded:e,total:t,percent:fi(Math.round(e/t*100),0,100)})}get annotationStorage(){return _n(this,"annotationStorage",new jb)}getRenderingIntent(e,t=Fc.ENABLE,n=null,r=!1,i=!1){let o=wa.DISPLAY,l=F1;switch(e){case"any":o=wa.ANY;break;case"display":break;case"print":o=wa.PRINT;break;default:Sn(`getRenderingIntent - invalid intent: ${e}`)}const d=o&wa.PRINT&&n instanceof O_?n:this.annotationStorage;switch(t){case Fc.DISABLE:o+=wa.ANNOTATIONS_DISABLE;break;case Fc.ENABLE:break;case Fc.ENABLE_FORMS:o+=wa.ANNOTATIONS_FORMS;break;case Fc.ENABLE_STORAGE:o+=wa.ANNOTATIONS_STORAGE,l=d.serializable;break;default:Sn(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(o+=wa.IS_EDITING),i&&(o+=wa.OPLIST);const{ids:h,hash:p}=d.modifiedIds,g=[o,l.hash,p];return{renderingIntent:o,cacheKey:g.join("_"),annotationStorageSerializable:l,modifiedIds:h}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const n of this.#n.values())e.push(n._destroy());this.#n.clear(),this.#i.clear(),this.#a.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),Sa.cleanup(),this.#s?.cancelAllRequests(new Gc("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,r)=>{ls(this.#s,"GetReader - no `BasePDFStream` instance available."),this.#e=this.#s.getFullReader(),this.#e.onProgress=i=>this.#h(i),r.onPull=()=>{this.#e.read().then(function({value:i,done:o}){if(o){r.close();return}ls(i instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(i),1,[i])}).catch(i=>{r.error(i)})},r.onCancel=i=>{this.#e.cancel(i),r.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async n=>{await this.#e.headersReady;const{isStreamingSupported:r,isRangeSupported:i,contentLength:o}=this.#e;return r&&i&&(this.#e.onProgress=null),{isStreamingSupported:r,isRangeSupported:i,contentLength:o}}),e.on("GetRangeReader",(n,r)=>{ls(this.#s,"GetRangeReader - no `BasePDFStream` instance available.");const i=this.#s.getRangeReader(n.begin,n.end);if(!i){r.close();return}r.onPull=()=>{i.read().then(function({value:o,done:l}){if(l){r.close();return}ls(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{r.error(o)})},r.onCancel=o=>{i.cancel(o),r.ready.catch(l=>{if(!this.destroyed)throw l})}}),e.on("GetDoc",({pdfInfo:n})=>{this.#o.pagesNumber=n.numPages,this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new kD(n,this))}),e.on("DocException",n=>{t._capability.reject(sa(n))}),e.on("PasswordRequest",n=>{this.#r=Promise.withResolvers();try{if(!t.onPassword)throw sa(n);const r=i=>{i instanceof Error?this.#r.reject(i):this.#r.resolve({password:i})};t.onPassword(r,n.code)}catch(r){this.#r.reject(r)}return this.#r.promise}),e.on("DataLoaded",n=>{this.#h({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;this.#n.get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,r,i])=>{if(this.destroyed||this.commonObjs.has(n))return null;switch(r){case"Font":if("error"in i){const g=i.error;Sn(`Error during font loading: ${g}`),this.commonObjs.resolve(n,g);break}const o=new _s(i),l=this._params.pdfBug&&globalThis.FontInspector?.enabled?(g,b)=>globalThis.FontInspector.fontAdded(g,b):null,d=new RT(o,l,i.extra,i.charProcOperatorList);this.fontLoader.bind(d).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!d.fontExtraProperties&&d.data&&d.clearData(),this.commonObjs.resolve(n,d)});break;case"CopyLocalImage":const{imageRef:h}=i;ls(h,"The imageRef must be defined.");for(const g of this.#n.values())for(const[,b]of g.objs)if(b?.ref===h)return b.dataLen?(this.commonObjs.resolve(n,structuredClone(b)),b.dataLen):null;break;case"FontPath":this.commonObjs.resolve(n,new PT(i));break;case"Image":this.commonObjs.resolve(n,i);break;case"Pattern":const p=new Jr(i);this.commonObjs.resolve(n,p.getIR());break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([n,r,i,o])=>{if(this.destroyed)return;const l=this.#n.get(r);if(!l.objs.has(n)){if(l._intentStates.size===0){o?.bitmap?.close();return}switch(i){case"Image":case"Pattern":l.objs.resolve(n,o);break;default:throw new Error(`Got unknown object type ${i}`)}}}),e.on("DocProgress",n=>{this.destroyed||this.#h(n)}),e.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const r=this[n.type];if(!r)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return r.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&Sn("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this.#e?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}extractPages(e){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:e})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this.#o.pagesNumber)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=this.#o.getPageId(e)-1,r=this.#i.get(t);if(r)return r;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:n}).then(o=>{if(this.destroyed)throw new Error("Transport destroyed");o.refStr&&this.#a.set(o.refStr,n);const l=new jD(t,o,this,this._params.pdfBug);return this.#n.set(t,l),l});return this.#i.set(t,i),i}async getPageIndex(e){if(!U1(e))throw new Error("Invalid pageIndex request.");const t=await this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen});return this.#o.getPageNumber(t+1)-1}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:this.#o.getPageId(e+1)-1,intent:t})}getFieldObjects(){return this.#l("GetFieldObjects")}hasJSActions(){return this.#l("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return this.#l("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:this.#o.getPageId(e+1)-1})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:this.#o.getPageId(e+1)-1})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#l("GetOptionalContentConfig").then(t=>new cD(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#t.get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(r=>({info:r[0],metadata:r[1]?new oD(r[1]):null,contentDispositionFilename:this.#e?.filename??null,contentLength:this.#e?.contentLength??null,hasStructTree:r[2]}));return this.#t.set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#n.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),Sa.cleanup()}}cachedPageNumber(e){if(!U1(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`,n=this.#a.get(t);return n>=0?this.#o.getPageNumber(n+1):null}}class DD{_internalRenderTask=null;onContinue=null;onError=null;constructor(e){this._internalRenderTask=e}get promise(){return this._internalRenderTask.capability.promise}cancel(e=0){this._internalRenderTask.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this._internalRenderTask.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this._internalRenderTask;return e.form||e.canvas&&t?.size>0}}class nh{#e=null;static#t=new WeakSet;constructor({callback:e,params:t,objs:n,commonObjs:r,annotationCanvasMap:i,operatorList:o,pageIndex:l,canvasFactory:d,filterFactory:h,useRequestAnimationFrame:p=!1,pdfBug:g=!1,pageColors:b=null,enableHWA:x=!1,operationsFilter:w=null}){this.callback=e,this.params=t,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=i,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=l,this.canvasFactory=d,this.filterFactory=h,this._pdfBug=g,this.pageColors=b,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=p===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new DD(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=x,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=w}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(nh.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");nh.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:r,background:i,dependencyTracker:o}=this.params,l=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new lh(l,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:r,viewport:n,transparency:e,background:i}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#e&&(window.cancelAnimationFrame(this.#e),this.#e=null),nh.#t.delete(this._canvas),e||=new Nb(`Rendering cancelled, page ${this._pageIndex+1}`,t),this.callback(e),this.task.onError?.(e)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#e=window.requestAnimationFrame(()=>{this.#e=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),nh.#t.delete(this._canvas),this.callback())))}}const LD="5.4.624",RD="384c6208b";class Ya{#e=null;#t=null;#s;#n=null;#i=!1;#a=!1;#r=null;#o;#c=null;#l=null;static#h=null;static get _keyboardManager(){return _n(this,"_keyboardManager",new t0([[["Escape","mac+Escape"],Ya.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Ya.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Ya.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Ya.prototype._moveToPrevious],[["Home","mac+Home"],Ya.prototype._moveToBeginning],[["End","mac+End"],Ya.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#a=!1,this.#r=e):this.#a=!0,this.#l=e?._uiManager||t,this.#o=this.#l._eventBus,this.#s=e?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",Ya.#h||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const e=this.#e=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",this.#r&&(e.ariaControls=`${this.#r.id}_colorpicker_dropdown`);const t=this.#l._signal;e.addEventListener("click",this.#g.bind(this),{signal:t}),e.addEventListener("keydown",this.#m.bind(this),{signal:t});const n=this.#t=document.createElement("span");return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=this.#s,e.append(n),e}renderMainDropdown(){const e=this.#n=this.#d();return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}#d(){const e=document.createElement("div"),t=this.#l._signal;e.addEventListener("contextmenu",Xa,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#r&&(e.id=`${this.#r.id}_colorpicker_dropdown`);for(const[n,r]of this.#l.highlightColors){const i=document.createElement("button");i.tabIndex="0",i.role="option",i.setAttribute("data-color",r),i.title=n,i.setAttribute("data-l10n-id",Ya.#h[n]);const o=document.createElement("span");i.append(o),o.className="swatch",o.style.backgroundColor=r,i.ariaSelected=r===this.#s,i.addEventListener("click",this.#f.bind(this,r),{signal:t}),e.append(i)}return e.addEventListener("keydown",this.#m.bind(this),{signal:t}),e}#f(e,t){t.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:Wn.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)}_colorSelectFromKeyboard(e){if(e.target===this.#e){this.#g(e);return}const t=e.target.getAttribute("data-color");t&&this.#f(t,e)}_moveToNext(e){if(!this.#p){this.#g(e);return}if(e.target===this.#e){this.#n.firstElementChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#n?.firstElementChild||e.target===this.#e){this.#p&&this._hideDropdownFromKeyboard();return}this.#p||this.#g(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#p){this.#g(e);return}this.#n.firstElementChild?.focus()}_moveToEnd(e){if(!this.#p){this.#g(e);return}this.#n.lastElementChild?.focus()}#m(e){Ya._keyboardManager.exec(this,e)}#g(e){if(this.#p){this.hideDropdown();return}if(this.#i=e.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#u.bind(this),{signal:this.#l.combinedSignal(this.#c)})),this.#e.ariaExpanded="true",this.#n){this.#n.classList.remove("hidden");return}const t=this.#n=this.#d();this.#e.append(t)}#u(e){this.#n?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#n?.classList.add("hidden"),this.#e.ariaExpanded="false",this.#c?.abort(),this.#c=null}get#p(){return this.#n&&!this.#n.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#a){if(!this.#p){this.#r?.unselect();return}this.hideDropdown(),this.#e.focus({preventScroll:!0,focusVisible:this.#i})}}updateColor(e){if(this.#t&&(this.#t.style.backgroundColor=e),!this.#n)return;const t=this.#l.highlightColors.values();for(const n of this.#n.children)n.ariaSelected=t.next().value===e.toUpperCase()}destroy(){this.#e?.remove(),this.#e=null,this.#t=null,this.#n?.remove(),this.#n=null}}class Gf{#e=null;#t=null;#s=null;static#n=null;constructor(e){this.#t=e,this.#s=e._uiManager,Gf.#n||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#e)return this.#e;const{editorType:e,colorType:t,color:n}=this.#t,r=this.#e=document.createElement("input");return r.type="color",r.value=n||"#000000",r.className="basicColorPicker",r.tabIndex=0,r.setAttribute("data-l10n-id",Gf.#n[e]),r.addEventListener("input",()=>{this.#s.updateParams(t,r.value)},{signal:this.#s._signal}),r}update(e){this.#e&&(this.#e.value=e)}destroy(){this.#e?.remove(),this.#e=null}hideDropdown(){}}function p5(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}function gf(s){return Math.max(0,Math.min(255,255*s))}class g5{static CMYK_G([e,t,n,r]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=gf(e),[e,e,e]}static G_HTML([e]){const t=p5(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(gf)}static RGB_HTML(e){return`#${e.map(p5).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,n+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,n,r]){return[gf(1-Math.min(1,e+r)),gf(1-Math.min(1,n+r)),gf(1-Math.min(1,t+r))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){const r=1-e,i=1-t,o=1-n,l=Math.min(r,i,o);return["CMYK",r,i,o,l]}}class PD{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),n||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){cs("Abstract method `_createSVG` called.")}}class kg extends PD{_createSVG(e){return document.createElementNS(Hl,e)}}const BD=9,Iu=new WeakSet,OD=new Date().getTimezoneOffset()*60*1e3;class Hx{static create(e){switch(e.data.annotationType){case Er.LINK:return new Pb(e);case Er.TEXT:return new MD(e);case Er.WIDGET:switch(e.data.fieldType){case"Tx":return new FD(e);case"Btn":return e.data.radioButton?new n4(e):e.data.checkBox?new zD(e):new $D(e);case"Ch":return new qD(e);case"Sig":return new UD(e)}return new qu(e);case Er.POPUP:return new q1(e);case Er.FREETEXT:return new s4(e);case Er.LINE:return new GD(e);case Er.SQUARE:return new VD(e);case Er.CIRCLE:return new WD(e);case Er.POLYLINE:return new r4(e);case Er.CARET:return new KD(e);case Er.INK:return new Bb(e);case Er.POLYGON:return new YD(e);case Er.HIGHLIGHT:return new i4(e);case Er.UNDERLINE:return new XD(e);case Er.SQUIGGLY:return new JD(e);case Er.STRIKEOUT:return new ZD(e);case Er.STAMP:return new a4(e);case Er.FILEATTACHMENT:return new QD(e);default:return new Qs(e)}}}class Qs{#e=null;#t=!1;#s=null;constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:r=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,this.hasOwnCommentButton=!1,t&&(this.contentElement=this.container=this._createContainer(n)),r&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e?.str||t?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Qs._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:e}=this,t=this.annotationStorage?.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const e=this.annotationStorage?.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:n,rect:r}=this.data;let i=-1/0,o=-1/0;if(t?.length>=8){for(let l=0;l<t.length;l+=8)t[l+1]>o?(o=t[l+1],i=t[l+2]):t[l+1]===o&&(i=Math.max(i,t[l+2]));return[i,o]}if(n?.length>=1){for(const l of n)for(let d=0,h=l.length;d<h;d+=2)l[d+1]>o?(o=l[d+1],i=l[d]):l[d+1]===o&&(i=Math.max(i,l[d]));if(i!==1/0)return[i,o]}return r?[r[2],r[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:i,pageY:o}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-i)/n,e[1]=100*(e[1]-o)/r,e}get commentText(){const{data:e}=this;return this.annotationStorage.getRawValue(`${zf}${e.id}`)?.popup?.contents||e.contentsObj?.str||""}set commentText(e){const{data:t}=this,n={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:n})||this.annotationStorage.setValue(`${zf}${t.id}`,{id:t.id,annotationType:t.annotationType,page:this.parent.page,popup:n,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){(this.#s?.popup||this.popup)?.remove(),this.#s=this.popup=null}updateEdited(e){if(!this.container)return;e.rect&&(this.#e||={rect:this.data.rect.slice(0)});const{rect:t,popup:n}=e;t&&this.#n(t);let r=this.#s?.popup||this.popup;!r&&n?.text&&(this._createPopup(n),r=this.#s.popup),r&&(r.updateEdited(e),n?.deleted&&(r.remove(),this.#s=null,this.popup=null))}resetEdited(){this.#e&&(this.#n(this.#e.rect),this.#s?.popup.resetEdited(),this.#e=null)}#n(e){const{container:{style:t},data:{rect:n,rotation:r},parent:{viewport:{rawDims:{pageWidth:i,pageHeight:o,pageX:l,pageY:d}}}}=this;n?.splice(0,4,...e),t.left=`${100*(e[0]-l)/i}%`,t.top=`${100*(o-e[3]+d)/o}%`,r===0?(t.width=`${100*(e[2]-e[0])/i}%`,t.height=`${100*(e[3]-e[1])/o}%`):this.setRotation(r)}_createContainer(e){const{data:t,parent:{page:n,viewport:r}}=this,i=document.createElement("section");i.setAttribute("data-annotation-id",t.id),!(this instanceof qu)&&!(this instanceof Pb)&&(i.tabIndex=0);const{style:o}=i;if(o.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(i.title=t.alternativeText),t.noRotate&&i.classList.add("norotate"),!t.rect||this instanceof q1){const{rotation:v}=t;return!t.hasOwnCanvas&&v!==0&&this.setRotation(v,i),i}const{width:l,height:d}=this;if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const v=t.borderStyle.horizontalCornerRadius,_=t.borderStyle.verticalCornerRadius;if(v>0||_>0){const E=`calc(${v}px * var(--total-scale-factor)) / calc(${_}px * var(--total-scale-factor))`;o.borderRadius=E}else if(this instanceof n4){const E=`calc(${l}px * var(--total-scale-factor)) / calc(${d}px * var(--total-scale-factor))`;o.borderRadius=E}switch(t.borderStyle.style){case Yd.SOLID:o.borderStyle="solid";break;case Yd.DASHED:o.borderStyle="dashed";break;case Yd.BEVELED:Sn("Unimplemented border style: beveled");break;case Yd.INSET:Sn("Unimplemented border style: inset");break;case Yd.UNDERLINE:o.borderBottomStyle="solid";break}const N=t.borderColor||null;N?(this.#t=!0,o.borderColor=qt.makeHexColor(N[0]|0,N[1]|0,N[2]|0)):o.borderWidth=0}const h=qt.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:p,pageHeight:g,pageX:b,pageY:x}=r.rawDims;o.left=`${100*(h[0]-b)/p}%`,o.top=`${100*(h[1]-x)/g}%`;const{rotation:w}=t;return t.hasOwnCanvas||w===0?(o.width=`${100*l/p}%`,o.height=`${100*d/g}%`):this.setRotation(w,i),i}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:r}=this.parent.viewport.rawDims;let{width:i,height:o}=this;e%180!==0&&([i,o]=[o,i]),t.style.width=`${100*i/n}%`,t.style.height=`${100*o/r}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,n,r)=>{const i=r.detail[t],o=i[0],l=i.slice(1);r.target.style[n]=g5[`${o}_HTML`](l),this.annotationStorage.setValue(this.data.id,{[n]:g5[`${o}_rgb`](l)})};return _n(this,"_commonActions",{display:t=>{const{display:n}=t.detail,r=n%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const r of Object.keys(t.detail))(e[r]||n[r])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[r,i]of Object.entries(t)){const o=n[r];if(o){const l={detail:{[r]:i},target:e};o(l),delete t[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,r,i]=this.data.rect.map(v=>Math.fround(v));if(e.length===8){const[v,_,N,E]=e.subarray(2,6);if(r===v&&i===_&&t===N&&n===E)return}const{style:o}=this.container;let l;if(this.#t){const{borderColor:v,borderWidth:_}=o;o.borderWidth=0,l=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${v}" stroke-width="${_}">`],this.container.classList.add("hasBorder")}const d=r-t,h=i-n,{svgFactory:p}=this,g=p.createElement("svg");g.classList.add("quadrilateralsContainer"),g.setAttribute("width",0),g.setAttribute("height",0),g.role="none";const b=p.createElement("defs");g.append(b);const x=p.createElement("clipPath"),w=`clippath_${this.data.id}`;x.setAttribute("id",w),x.setAttribute("clipPathUnits","objectBoundingBox"),b.append(x);for(let v=2,_=e.length;v<_;v+=8){const N=e[v],E=e[v+1],k=e[v+2],T=e[v+3],P=p.createElement("rect"),O=(k-t)/d,F=(i-E)/h,$=(N-k)/d,z=(E-T)/h;P.setAttribute("x",O),P.setAttribute("y",F),P.setAttribute("width",$),P.setAttribute("height",z),x.append(P),l?.push(`<rect vector-effect="non-scaling-stroke" x="${O}" y="${F}" width="${$}" height="${z}"/>`)}this.#t&&(l.push("</g></svg>')"),o.backgroundImage=l.join("")),this.container.append(g),this.container.style.clipPath=`url(#${w})`}_createPopup(e=null){const{data:t}=this;let n,r;e?(n={str:e.text},r=e.date):(n=t.contentsObj,r=t.modificationDate),this.#s=new q1({data:{color:t.color,titleObj:t.titleObj,modificationDate:r,contentsObj:n,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#s||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#s}render(){cs("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const n=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:i,id:o,exportValues:l}of r){if(i===-1||o===t)continue;const d=typeof l=="string"?l:null,h=document.querySelector(`[data-element-id="${o}"]`);if(h&&!Iu.has(h)){Sn(`_getElementsByName - element not allowed: ${o}`);continue}n.push({id:o,exportValue:d,domElement:h})}return n}for(const r of document.getElementsByName(e)){const{exportValue:i}=r,o=r.getAttribute("data-element-id");o!==t&&Iu.has(r)&&n.push({id:o,exportValue:i,domElement:r})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class ID extends Qs{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&this._createPopup(e.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class Pb extends Qs{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,n=document.createElement("a");n.setAttribute("data-element-id",e.id);let r=!1;return e.url?(t.addLinkAttributes(n,e.url,e.newWindow),r=!0):e.action?(this._bindNamedAction(n,e.action,e.overlaidText),r=!0):e.attachment?(this.#t(n,e.attachment,e.overlaidText,e.attachmentDest),r=!0):e.setOCGState?(this.#s(n,e.setOCGState,e.overlaidText),r=!0):e.dest?(this._bindLink(n,e.dest,e.overlaidText),r=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,e),r=!0),e.resetForm?(this._bindResetFormAction(n,e.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(n,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&(this.contentElement=n,this.container.append(n)),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t,n=""){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#e(),n&&(e.title=n)}_bindNamedAction(e,t,n=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),n&&(e.title=n),this.#e()}#t(e,t,n="",r=null){e.href=this.linkService.getAnchorUrl(""),t.description?e.title=t.description:n&&(e.title=n),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,r),!1),this.#e()}#s(e,t,n=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),n&&(e.title=n),this.#e()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(t.actions)){const i=n.get(r);i&&(e[i]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:r}}),!1))}t.overlaidText&&(e.title=t.overlaidText),e.onclick||(e.onclick=()=>!1),this.#e()}_bindResetFormAction(e,t){const n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){Sn('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),n||(e.onclick=()=>!1);return}e.onclick=()=>{n?.();const{fields:r,refs:i,include:o}=t,l=[];if(r.length!==0||i.length!==0){const p=new Set(i);for(const g of r){const b=this._fieldObjects[g]||[];for(const{id:x}of b)p.add(x)}for(const g of Object.values(this._fieldObjects))for(const b of g)p.has(b.id)===o&&l.push(b)}else for(const p of Object.values(this._fieldObjects))l.push(...p);const d=this.annotationStorage,h=[];for(const p of l){const{id:g}=p;switch(h.push(g),p.type){case"text":{const x=p.defaultValue||"";d.setValue(g,{value:x});break}case"checkbox":case"radiobutton":{const x=p.defaultValue===p.exportValues;d.setValue(g,{value:x});break}case"combobox":case"listbox":{const x=p.defaultValue||"";d.setValue(g,{value:x});break}default:continue}const b=document.querySelector(`[data-element-id="${g}"]`);if(b){if(!Iu.has(b)){Sn(`_bindResetFormAction - element not allowed: ${g}`);continue}}else continue;b.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}}),!1}}}class MD extends Qs{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(e),this.container}}class qu extends Qs{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return qr.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,r,i){n.includes("mouse")?e.addEventListener(n,o=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:i(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(n,o=>{if(n==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}i&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:i(o)}})})}_setEventListeners(e,t,n,r){for(const[i,o]of n)(o==="Action"||this.data.actions?.[o])&&((o==="Focus"||o==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,i,o,r),o==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):o==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":qt.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||BD,i=e.style;let o;const l=2,d=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-l),p=Math.round(h/(Ix*r))||1,g=h/p;o=Math.min(r,d(g/Ix))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-l);o=Math.min(r,d(h/Ix))}i.fontSize=`calc(${o}px * var(--total-scale-factor))`,i.color=qt.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(i.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class FD extends qu{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,r){const i=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=n),i.setValue(o.id,{[r]:n})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const r=e.getValue(t,{value:this.data.fieldValue});let i=r.value||"";const o=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;o&&i.length>o&&(i=i.slice(0,o));let l=r.formattedValue||this.data.textContent?.join(`
`)||null;l&&this.data.comb&&(l=l.replaceAll(/\s+/g,""));const d={userValue:i,formattedValue:l,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=l??i,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",l??i),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Iu.add(n),this.contentElement=n,n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:h,datetimeType:p,timeStep:g}=this.data,b=!!p&&this.enableScripting;h&&(n.title=h),this._setRequired(n,this.data.required),o&&(n.maxLength=o),n.addEventListener("input",w=>{e.setValue(t,{value:w.target.value}),this.setPropertyOnSiblings(n,"value",w.target.value,"value"),d.formattedValue=null}),n.addEventListener("resetform",w=>{const v=this.data.defaultFieldValue??"";n.value=d.userValue=v,d.formattedValue=null});let x=w=>{const{formattedValue:v}=d;v!=null&&(w.target.value=v),w.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",v=>{if(d.focused)return;const{target:_}=v;if(b&&(_.type=p,g&&(_.step=g)),d.userValue){const N=d.userValue;if(b)if(p==="time"){const E=new Date(N),k=[E.getHours(),E.getMinutes(),E.getSeconds()];_.value=k.map(T=>T.toString().padStart(2,"0")).join(":")}else _.value=new Date(N-OD).toISOString().split(p==="date"?"T":".",1)[0];else _.value=N}d.lastCommittedValue=_.value,d.commitKey=1,this.data.actions?.Focus||(d.focused=!0)}),n.addEventListener("updatefromsandbox",v=>{this.showElementAndHideCanvas(v.target);const _={value(N){d.userValue=N.detail.value??"",b||e.setValue(t,{value:d.userValue.toString()}),N.target.value=d.userValue},formattedValue(N){const{formattedValue:E}=N.detail;d.formattedValue=E,E!=null&&N.target!==document.activeElement&&(N.target.value=E);const k={formattedValue:E};b&&(k.value=E),e.setValue(t,k)},selRange(N){N.target.setSelectionRange(...N.detail.selRange)},charLimit:N=>{const{charLimit:E}=N.detail,{target:k}=N;if(E===0){k.removeAttribute("maxLength");return}k.setAttribute("maxLength",E);let T=d.userValue;!T||T.length<=E||(T=T.slice(0,E),k.value=d.userValue=T,e.setValue(t,{value:T}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:T,willCommit:!0,commitKey:1,selStart:k.selectionStart,selEnd:k.selectionEnd}}))}};this._dispatchEventFromSandbox(_,v)}),n.addEventListener("keydown",v=>{d.commitKey=1;let _=-1;if(v.key==="Escape"?_=0:v.key==="Enter"&&!this.data.multiLine?_=2:v.key==="Tab"&&(d.commitKey=3),_===-1)return;const{value:N}=v.target;d.lastCommittedValue!==N&&(d.lastCommittedValue=N,d.userValue=N,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:N,willCommit:!0,commitKey:_,selStart:v.target.selectionStart,selEnd:v.target.selectionEnd}}))});const w=x;x=null,n.addEventListener("blur",v=>{if(!d.focused||!v.relatedTarget)return;this.data.actions?.Blur||(d.focused=!1);const{target:_}=v;let{value:N}=_;if(b){if(N&&p==="time"){const E=N.split(":").map(k=>parseInt(k,10));N=new Date(2e3,0,1,E[0],E[1],E[2]||0).valueOf(),_.step=""}else N.includes("T")||(N=`${N}T00:00`),N=new Date(N).valueOf();_.type="text"}d.userValue=N,d.lastCommittedValue!==N&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:N,willCommit:!0,commitKey:d.commitKey,selStart:v.target.selectionStart,selEnd:v.target.selectionEnd}}),w(v)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",v=>{d.lastCommittedValue=null;const{data:_,target:N}=v,{value:E,selectionStart:k,selectionEnd:T}=N;let P=k,O=T;switch(v.inputType){case"deleteWordBackward":{const F=E.substring(0,k).match(/\w*[^\w]*$/);F&&(P-=F[0].length);break}case"deleteWordForward":{const F=E.substring(k).match(/^[^\w]*\w*/);F&&(O+=F[0].length);break}case"deleteContentBackward":k===T&&(P-=1);break;case"deleteContentForward":k===T&&(O+=1);break}v.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:E,change:_||"",willCommit:!1,selStart:P,selEnd:O}})}),this._setEventListeners(n,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],v=>v.target.value)}if(x&&n.addEventListener("blur",x),this.data.comb){const v=(this.data.rect[2]-this.data.rect[0])/o;n.classList.add("comb"),n.style.letterSpacing=`calc(${v}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class UD extends qu{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class zD extends qu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",e.setValue(n,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const i=document.createElement("input");return Iu.add(i),i.setAttribute("data-element-id",n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="checkbox",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.setAttribute("exportValue",t.exportValue),i.tabIndex=0,i.addEventListener("change",o=>{const{name:l,checked:d}=o.target;for(const h of this._getElementsByName(l,n)){const p=d&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=p),e.setValue(h.id,{value:p})}e.setValue(n,{value:d})}),i.addEventListener("resetform",o=>{const l=t.defaultFieldValue||"Off";o.target.checked=l===t.exportValue}),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",o=>{const l={value(d){d.target.checked=d.detail.value!=="Off",e.setValue(n,{value:d.target.checked})}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class n4 extends qu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof r=="string"&&(r=r!==t.buttonValue,e.setValue(n,{value:r})),r)for(const o of this._getElementsByName(t.fieldName,n))e.setValue(o.id,{value:!1});const i=document.createElement("input");if(Iu.add(i),i.setAttribute("data-element-id",n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="radio",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.tabIndex=0,i.addEventListener("change",o=>{const{name:l,checked:d}=o.target;for(const h of this._getElementsByName(l,n))e.setValue(h.id,{value:!1});e.setValue(n,{value:d})}),i.addEventListener("resetform",o=>{const l=t.defaultFieldValue;o.target.checked=l!=null&&l===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;i.addEventListener("updatefromsandbox",l=>{const d={value:h=>{const p=o===h.detail.value;for(const g of this._getElementsByName(h.target.name)){const b=p&&g.id===n;g.domElement&&(g.domElement.checked=b),e.setValue(g.id,{value:b})}}};this._dispatchEventFromSandbox(d,l)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],l=>l.target.checked)}return this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class $D extends Pb{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}}class qD extends qu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");Iu.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=0;let i=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",p=>{const g=this.data.defaultFieldValue;for(const b of r.options)b.selected=b.value===g});for(const p of this.data.options){const g=document.createElement("option");g.textContent=p.displayValue,g.value=p.exportValue,n.value.includes(p.exportValue)&&(g.setAttribute("selected",!0),i=!1),r.append(g)}let o=null;if(i){const p=document.createElement("option");p.value=" ",p.setAttribute("hidden",!0),p.setAttribute("selected",!0),r.prepend(p),o=()=>{p.remove(),r.removeEventListener("input",o),o=null},r.addEventListener("input",o)}const l=p=>{const g=p?"value":"textContent",{options:b,multiple:x}=r;return x?Array.prototype.filter.call(b,w=>w.selected).map(w=>w[g]):b.selectedIndex===-1?null:b[b.selectedIndex][g]};let d=l(!1);const h=p=>{const g=p.target.options;return Array.prototype.map.call(g,b=>({displayValue:b.textContent,exportValue:b.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",p=>{const g={value(b){o?.();const x=b.detail.value,w=new Set(Array.isArray(x)?x:[x]);for(const v of r.options)v.selected=w.has(v.value);e.setValue(t,{value:l(!0)}),d=l(!1)},multipleSelection(b){r.multiple=!0},remove(b){const x=r.options,w=b.detail.remove;x[w].selected=!1,r.remove(w),x.length>0&&Array.prototype.findIndex.call(x,_=>_.selected)===-1&&(x[0].selected=!0),e.setValue(t,{value:l(!0),items:h(b)}),d=l(!1)},clear(b){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),d=l(!1)},insert(b){const{index:x,displayValue:w,exportValue:v}=b.detail.insert,_=r.children[x],N=document.createElement("option");N.textContent=w,N.value=v,_?_.before(N):r.append(N),e.setValue(t,{value:l(!0),items:h(b)}),d=l(!1)},items(b){const{items:x}=b.detail;for(;r.length!==0;)r.remove(0);for(const w of x){const{displayValue:v,exportValue:_}=w,N=document.createElement("option");N.textContent=v,N.value=_,r.append(N)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:l(!0),items:h(b)}),d=l(!1)},indices(b){const x=new Set(b.detail.indices);for(const w of b.target.options)w.selected=x.has(w.index);e.setValue(t,{value:l(!0)}),d=l(!1)},editable(b){b.target.disabled=!b.detail.editable}};this._dispatchEventFromSandbox(g,p)}),r.addEventListener("input",p=>{const g=l(!0),b=l(!1);e.setValue(t,{value:g}),p.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:d,change:b,changeEx:g,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],p=>p.target.value)):r.addEventListener("input",function(p){e.setValue(t,{value:l(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class q1 extends Qs{constructor(e){const{data:t,elements:n,parent:r}=e,i=!!r._commentManager;if(super(e,{isRenderable:!i&&Qs._hasPopupData(t)}),this.elements=n,i&&Qs._hasPopupData(t)){const o=this.popup=this.#e();for(const l of n)l.popup=o}else this.popup=null}#e(){return new HD({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";const t=this.popup=this.#e(),n=[];for(const r of this.elements)r.popup=t,r.container.ariaHasPopup="dialog",n.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(r=>`${eh}${r}`).join(",")),this.container}}class HD{#e=null;#t=this.#H.bind(this);#s=this.#F.bind(this);#n=this.#R.bind(this);#i=this.#S.bind(this);#a=null;#r=null;#o=null;#c=null;#l=null;#h=null;#d=null;#f=!1;#m=null;#g=null;#u=null;#p=null;#x=null;#y=null;#b=null;#N=null;#_=null;#w=null;#E=!1;#v=null;#A=null;constructor({container:e,color:t,elements:n,titleObj:r,modificationDate:i,contentsObj:o,richText:l,parent:d,rect:h,parentRect:p,open:g,commentManager:b=null}){this.#r=e,this.#_=r,this.#o=o,this.#N=l,this.#h=d,this.#a=t,this.#b=h,this.#d=p,this.#l=n,this.#e=b,this.#v=n[0],this.#c=O1.toDateObject(i),this.trigger=n.flatMap(x=>x.getElementsToTriggerPopup()),b||(this.#T(),this.#r.hidden=!0,g&&this.#S())}#T(){if(this.#g)return;this.#g=new AbortController;const{signal:e}=this.#g;for(const t of this.trigger)t.addEventListener("click",this.#i,{signal:e}),t.addEventListener("pointerenter",this.#n,{signal:e}),t.addEventListener("pointerleave",this.#s,{signal:e}),t.classList.add("popupTriggerArea");for(const t of this.#l)t.container?.addEventListener("keydown",this.#t,{signal:e})}#k(){const e=this.#l.find(t=>t.hasCommentButton);e&&(this.#x=e._normalizePoint(e.commentButtonPosition))}renderCommentButton(){if(this.#p){this.#p.parentNode||this.#v.container.after(this.#p);return}if(this.#x||this.#k(),!this.#x)return;const{signal:e}=this.#g=new AbortController,t=this.#v.hasOwnCommentButton,n=()=>{this.#e.toggleCommentPopup(this,!0,void 0,!t)},r=()=>{this.#e.toggleCommentPopup(this,!1,!0,!t)},i=()=>{this.#e.toggleCommentPopup(this,!1,!1)};if(t){this.#p=this.#v.container;for(const o of this.trigger)o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.addEventListener("keydown",this.#t,{signal:e}),o.addEventListener("click",n,{signal:e}),o.addEventListener("pointerenter",r,{signal:e}),o.addEventListener("pointerleave",i,{signal:e}),o.classList.add("popupTriggerArea")}else{const o=this.#p=document.createElement("button");o.className="annotationCommentButton";const l=this.#v.container;o.style.zIndex=l.style.zIndex+1,o.tabIndex=0,o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#I(),this.#j(),o.addEventListener("keydown",this.#t,{signal:e}),o.addEventListener("click",n,{signal:e}),o.addEventListener("pointerenter",r,{signal:e}),o.addEventListener("pointerleave",i,{signal:e}),l.after(o)}}#j(){if(this.#v.extraPopupElement&&!this.#v.editor)return;this.#p||this.renderCommentButton();const[e,t]=this.#x,{style:n}=this.#p;n.left=`calc(${e}%)`,n.top=`calc(${t}% - var(--comment-button-dim))`}#I(){this.#v.extraPopupElement||(this.#p||this.renderCommentButton(),this.#p.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:e,opacity:t}=this.#v.commentData;return e?this.#h._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{this.#p?.focus()},0)}getData(){const{richText:e,color:t,opacity:n,creationDate:r,modificationDate:i}=this.#v.commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:n,creationDate:r,modificationDate:i}}get elementBeforePopup(){return this.#p}get comment(){return this.#A||=this.#v.commentText,this.#A}set comment(e){e!==this.comment&&(this.#v.commentText=this.#A=e)}focus(){this.#v.container?.focus()}get parentBoundingClientRect(){return this.#v.layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){this.#p&&(this.#p.classList.toggle("selected",e),this.#p.ariaExpanded=t)}setSelectedCommentButton(e){this.#p.classList.toggle("selected",e)}get commentPopupPosition(){if(this.#y)return this.#y;const{x:e,y:t,height:n}=this.#p.getBoundingClientRect(),{x:r,y:i,width:o,height:l}=this.#v.layer.getBoundingClientRect();return[(e-r)/o,(t+n-i)/l]}set commentPopupPosition(e){this.#y=e}hasDefaultPopupPosition(){return this.#y===null}get commentButtonPosition(){return this.#x}get commentButtonWidth(){return this.#p.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,n]=this.#y||this.commentButtonPosition.map(h=>h/100),r=this.parentBoundingClientRect,{x:i,y:o,width:l,height:d}=r;this.#e.showDialog(null,this,i+t*l,o+n*d,{...e,parentDimensions:r})}render(){if(this.#m)return;const e=this.#m=document.createElement("div");if(e.className="popup",this.#a){const n=e.style.outlineColor=qt.makeHexColor(...this.#a);e.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const t=document.createElement("span");if(t.className="header",this.#_?.str){const n=document.createElement("span");n.className="title",t.append(n),{dir:n.dir,str:n.textContent}=this.#_}if(e.append(t),this.#c){const n=document.createElement("time");n.className="popupDate",n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#c.valueOf()})),n.dateTime=this.#c.toISOString(),t.append(n)}L_({html:this.#L||this.#o.str,dir:this.#o?.dir,className:"popupContent"},e),this.#r.append(e)}get#L(){const e=this.#N,t=this.#o;return e?.str&&(!t?.str||t.str===e.str)&&this.#N.html||null}get#P(){return this.#L?.attributes?.style?.fontSize||0}get#M(){return this.#L?.attributes?.style?.color||null}#B(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},r={style:{color:this.#M,fontSize:this.#P?`calc(${this.#P}px * var(--total-scale-factor))`:""}};for(const i of e.split(`
`))t.push({name:"span",value:i,attributes:r});return n}#H(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#f)&&this.#S()}updateEdited({rect:e,popup:t,deleted:n}){if(this.#e){n?(this.remove(),this.#A=null):t&&(t.deleted?this.remove():(this.#I(),this.#A=t.text)),e&&(this.#x=null,this.#k(),this.#j());return}if(n||t?.deleted){this.remove();return}this.#T(),this.#w||={contentsObj:this.#o,richText:this.#N},e&&(this.#u=null),t&&t.text&&(this.#N=this.#B(t.text),this.#c=O1.toDateObject(t.date),this.#o=null),this.#m?.remove(),this.#m=null}resetEdited(){this.#w&&({contentsObj:this.#o,richText:this.#N}=this.#w,this.#w=null,this.#m?.remove(),this.#m=null,this.#u=null)}remove(){if(this.#g?.abort(),this.#g=null,this.#m?.remove(),this.#m=null,this.#E=!1,this.#f=!1,this.#p?.remove(),this.#p=null,this.trigger)for(const e of this.trigger)e.classList.remove("popupTriggerArea")}#C(){if(this.#u!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:r,pageY:i}}}=this.#h;let o=!!this.#d,l=o?this.#d:this.#b;for(const w of this.#l)if(!l||qt.intersect(w.data.rect,l)!==null){l=w.data.rect,o=!0;break}const d=qt.normalizeRect([l[0],e[3]-l[1]+e[1],l[2],e[3]-l[3]+e[1]]),p=o?l[2]-l[0]+5:0,g=d[0]+p,b=d[1];this.#u=[100*(g-r)/t,100*(b-i)/n];const{style:x}=this.#r;x.left=`${this.#u[0]}%`,x.top=`${this.#u[1]}%`}#S(){if(this.#e){this.#e.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#R(),this.#r.addEventListener("click",this.#i),this.#r.addEventListener("keydown",this.#t)):(this.#F(),this.#r.removeEventListener("click",this.#i),this.#r.removeEventListener("keydown",this.#t))}#R(){this.#m||this.render(),this.isVisible?this.#f&&this.#r.classList.add("focused"):(this.#C(),this.#r.hidden=!1,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)+1e3)}#F(){this.#r.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#r.hidden=!0,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)-1e3)}forceHide(){this.#E=this.isVisible,this.#E&&(this.#r.hidden=!0)}maybeShow(){this.#e||(this.#T(),this.#E&&(this.#m||this.#R(),this.#E=!1,this.#r.hidden=!1))}get isVisible(){return this.#e?!1:this.#r.hidden===!1}}class s4 extends Qs{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Tn.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=this.contentElement=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class GD extends Qs{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:e,width:t,height:n}=this,r=this.svgFactory.create(t,n,!0),i=this.#e=this.svgFactory.createElement("svg:line");return i.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),i.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),i.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),i.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),i.setAttribute("stroke-width",e.borderStyle.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),r.append(i),this.container.append(r),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class VD extends Qs{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:e,width:t,height:n}=this,r=this.svgFactory.create(t,n,!0),i=e.borderStyle.width,o=this.#e=this.svgFactory.createElement("svg:rect");return o.setAttribute("x",i/2),o.setAttribute("y",i/2),o.setAttribute("width",t-i),o.setAttribute("height",n-i),o.setAttribute("stroke-width",i||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class WD extends Qs{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:e,width:t,height:n}=this,r=this.svgFactory.create(t,n,!0),i=e.borderStyle.width,o=this.#e=this.svgFactory.createElement("svg:ellipse");return o.setAttribute("cx",t/2),o.setAttribute("cy",n/2),o.setAttribute("rx",t/2-i/2),o.setAttribute("ry",n/2-i/2),o.setAttribute("stroke-width",i||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class r4 extends Qs{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:n,popupRef:r},width:i,height:o}=this;if(!t)return this.container;const l=this.svgFactory.create(i,o,!0);let d=[];for(let p=0,g=t.length;p<g;p+=2){const b=t[p]-e[0],x=e[3]-t[p+1];d.push(`${b},${x}`)}d=d.join(" ");const h=this.#e=this.svgFactory.createElement(this.svgElementName);return h.setAttribute("points",d),h.setAttribute("stroke-width",n.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),l.append(h),this.container.append(l),!r&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class YD extends r4{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class KD extends Qs{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class Bb extends Qs{#e=null;#t=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Tn.HIGHLIGHT:Tn.INK}#s(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:t,inkLists:n,borderStyle:r,popupRef:i}}=this,{transform:o,width:l,height:d}=this.#s(t,e),h=this.svgFactory.create(l,d,!0),p=this.#e=this.svgFactory.createElement("svg:g");h.append(p),p.setAttribute("stroke-width",r.width||1),p.setAttribute("stroke-linecap","round"),p.setAttribute("stroke-linejoin","round"),p.setAttribute("stroke-miterlimit",10),p.setAttribute("stroke","transparent"),p.setAttribute("fill","transparent"),p.setAttribute("transform",o);for(let g=0,b=n.length;g<b;g++){const x=this.svgFactory.createElement(this.svgElementName);this.#t.push(x),x.setAttribute("points",n[g].join(",")),p.append(x)}return!i&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:t,points:n,rect:r}=e,i=this.#e;if(t>=0&&i.setAttribute("stroke-width",t||1),n)for(let o=0,l=this.#t.length;o<l;o++)this.#t[o].setAttribute("points",n[o].join(","));if(r){const{transform:o,width:l,height:d}=this.#s(this.data.rotation,r);i.parentElement.setAttribute("viewBox",`0 0 ${l} ${d}`),i.setAttribute("transform",o)}}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class i4 extends Qs{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Tn.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class XD extends Qs{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class JD extends Qs{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class ZD extends Qs{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),e){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class a4 extends Qs{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Tn.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class QD extends Qs{#e=null;constructor(e){super(e,{isRenderable:!0});const{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let n;t.hasAppearance||t.fillAlpha===0?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),n.addEventListener("dblclick",this.#t.bind(this)),this.#e=n;const{isMac:r}=qr.platform;return e.addEventListener("keydown",i=>{i.key==="Enter"&&(r?i.metaKey:i.ctrlKey)&&this.#t()}),!t.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):n.classList.add("popupTriggerArea"),e.append(n),e}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Ob{#e=null;#t=null;#s=null;#n=new Map;#i=null;#a=null;#r=[];#o=!1;constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:r,page:i,viewport:o,structTreeLayer:l,commentManager:d,linkService:h,annotationStorage:p}){this.div=e,this.#e=t,this.#t=n,this.#i=l||null,this.#a=h||null,this.#s=p||new jb,this.page=i,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=r,this._commentManager=d||null}hasEditableAnnotations(){return this.#n.size>0}async render(e){const{annotations:t}=e,n=this.div;Ou(n,this.viewport);const r=new Map,i=[],o={data:null,layer:n,linkService:this.#a,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new kg,annotationStorage:this.#s,enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const l of t){if(l.noHTML)continue;const d=l.annotationType===Er.POPUP;if(d){const g=r.get(l.id);if(!g)continue;if(!this._commentManager){i.push(l);continue}o.elements=g}else if(l.rect[2]===l.rect[0]||l.rect[3]===l.rect[1])continue;o.data=l;const h=Hx.create(o);if(!h.isRenderable)continue;if(!d&&(this.#r.push(h),l.popupRef)){const g=r.get(l.popupRef);g?g.push(h):r.set(l.popupRef,[h])}const p=h.render();l.hidden&&(p.style.visibility="hidden"),h._isEditable&&(this.#n.set(h.data.id,h),this._annotationEditorUIManager?.renderAnnotationElement(h))}await this.#c();for(const l of i){const d=o.elements=r.get(l.id);o.data=l;const h=Hx.create(o);if(!h.isRenderable)continue;const p=h.render();h.contentElement.id=`${eh}${l.id}`,l.hidden&&(p.style.visibility="hidden"),d.at(-1).container.after(p)}this.#l()}async#c(){if(this.#r.length===0)return;this.div.replaceChildren();const e=[];if(!this.#o){this.#o=!0;for(const{contentElement:n,data:{id:r}}of this.#r){const i=n.id=`${eh}${r}`;e.push(this.#i?.getAriaAttributes(i).then(o=>{if(o)for(const[l,d]of o)n.setAttribute(l,d)}))}}this.#r.sort(({data:{rect:[n,r,i,o]}},{data:{rect:[l,d,h,p]}})=>{if(n===i&&r===o)return 1;if(l===h&&d===p)return-1;const g=o,b=r,x=(r+o)/2,w=p,v=d,_=(d+p)/2;if(x>=w&&_<=b)return-1;if(_>=g&&x<=v)return 1;const N=(n+i)/2,E=(l+h)/2;return N-E});const t=document.createDocumentFragment();for(const n of this.#r)t.append(n.container),this._commentManager?(n.extraPopupElement?.popup||n.popup)?.renderCommentButton():n.extraPopupElement&&t.append(n.extraPopupElement.render());if(this.div.append(t),await Promise.all(e),this.#e)for(const n of this.#r)this.#e.addPointerInTextLayer(n.contentElement,!1)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:this.#a,svgFactory:new kg,parent:this};for(const n of e){n.borderStyle||=Ob._defaultBorderStyle,t.data=n;const r=Hx.create(t);r.isRenderable&&(r.render(),r.contentElement.id=`${eh}${n.id}`,this.#r.push(r))}await this.#c()}update({viewport:e}){const t=this.div;this.viewport=e,Ou(t,{rotation:e.rotation}),this.#l(),t.hidden=!1}#l(){if(!this.#t)return;const e=this.div;for(const[t,n]of this.#t){const r=e.querySelector(`[data-annotation-id="${t}"]`);if(!r)continue;n.className="annotationContent";const{firstChild:i}=r;i?i.nodeName==="CANVAS"?i.replaceWith(n):i.classList.contains("annotationContent")?i.after(n):i.before(n):r.append(n);const o=this.#n.get(t);o&&(o._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(t,r.id,n),o._hasNoCanvas=!1):o.canvas=n)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(e){return this.#n.get(e)}addFakeAnnotation(e){const{div:t}=this,{id:n,rotation:r}=e,i=new ID({data:{id:n,rect:e.getPDFRect(),rotation:r},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:this.#a,annotationStorage:this.#s});return i.render(),i.contentElement.id=`${eh}${n}`,i.createOrUpdatePopup(),this.#r.push(i),i}removeAnnotation(e){const t=this.#r.findIndex(r=>r.data.id===e);if(t<0)return;const[n]=this.#r.splice(t,1);this.#e?.removePointerInTextLayer(n.contentElement)}updateFakeAnnotations(e){if(e.length!==0){for(const t of e)t.updateFakeAnnotationElement(this);this.#c()}}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}static get _defaultBorderStyle(){return _n(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Yd.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const dp=/\r\n?|\n/g;class Zr extends cn{#e="";#t=`${this.id}-editor`;#s=null;#n;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=Zr.prototype,t=i=>i.isEmpty(),n=Vc.TRANSLATE_SMALL,r=Vc.TRANSLATE_BIG;return _n(this,"_keyboardManager",new t0([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[n,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,n],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,r],checker:t}]]))}static _type="freetext";static _editorType=Tn.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.color=e.color||Zr._defaultColor||cn._defaultLineColor,this.#n=e.fontSize||Zr._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(e,t){cn.initialize(e,t);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case Wn.FREETEXT_SIZE:Zr._defaultFontSize=t;break;case Wn.FREETEXT_COLOR:Zr._defaultColor=t;break}}updateParams(e,t){switch(e){case Wn.FREETEXT_SIZE:this.#i(t);break;case Wn.FREETEXT_COLOR:this.#a(t);break}}static get defaultPropertiesToUpdate(){return[[Wn.FREETEXT_SIZE,Zr._defaultFontSize],[Wn.FREETEXT_COLOR,Zr._defaultColor||cn._defaultLineColor]]}get propertiesToUpdate(){return[[Wn.FREETEXT_SIZE,this.#n],[Wn.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new Gf(this),[["colorPicker",this._colorPicker]]}get colorType(){return Wn.FREETEXT_COLOR}#i(e){const t=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--total-scale-factor))`,this.translate(0,-(r-this.#n)*this.parentScale),this.#n=r,this.#o()},n=this.#n;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Wn.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#a(e){const t=r=>{this.color=r,this.onUpdatedColor()},n=this.color;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Wn.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-Zr._internalPadding*e,-(Zr._internalPadding+this.#n)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#s=new AbortController;const e=this._uiManager.combinedSignal(this.#s);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#t),this._isDraggable=!0,this.#s?.abort(),this.#s=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#r(){const e=[];this.editorDiv.normalize();let t=null;for(const n of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&n.nodeName==="BR"||(e.push(Zr.#c(n)),t=n);return e.join(`
`)}#o(){const[e,t]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:r,div:i}=this,o=i.style.display,l=i.classList.contains("hidden");i.classList.remove("hidden"),i.style.display="hidden",r.div.append(this.div),n=i.getBoundingClientRect(),i.remove(),i.style.display=o,i.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=n.width/e,this.height=n.height/t):(this.width=n.height/e,this.height=n.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#e,t=this.#e=this.#r().trimEnd();if(e===t)return;const n=r=>{if(this.#e=r,!r){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#o()};this.addCommands({cmd:()=>{n(t)},undo:()=>{n(e)},mustExec:!1}),this.#o()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){Zr._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,t;(this._isCopy||this.annotationElementId)&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#t),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,n.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[r,i]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,d]=this.getInitialTranslation();[l,d]=this.pageTranslationToScreen(l,d);const[h,p]=this.pageDimensions,[g,b]=this.pageTranslation;let x,w;switch(this.rotation){case 0:x=e+(o[0]-g)/h,w=t+this.height-(o[1]-b)/p;break;case 90:x=e+(o[0]-g)/h,w=t-(o[1]-b)/p,[l,d]=[d,-l];break;case 180:x=e-this.width+(o[0]-g)/h,w=t-(o[1]-b)/p,[l,d]=[-l,-d];break;case 270:x=e+(o[0]-g-this.height*p)/h,w=t+(o[1]-b-this.width*h)/p,[l,d]=[-d,l];break}this.setAt(x*r,w*i,l,d)}else this._moveAfterPaste(e,t);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(dp,"")}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:n}=t;if(n.length===1&&n[0]==="text/plain")return;e.preventDefault();const r=Zr.#d(t.getData("text")||"").replaceAll(dp,`
`);if(!r)return;const i=window.getSelection();if(!i.rangeCount)return;this.editorDiv.normalize(),i.deleteFromDocument();const o=i.getRangeAt(0);if(!r.includes(`
`)){o.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),i.collapseToStart();return}const{startContainer:l,startOffset:d}=o,h=[],p=[];if(l.nodeType===Node.TEXT_NODE){const x=l.parentElement;if(p.push(l.nodeValue.slice(d).replaceAll(dp,"")),x!==this.editorDiv){let w=h;for(const v of this.editorDiv.childNodes){if(v===x){w=p;continue}w.push(Zr.#c(v))}}h.push(l.nodeValue.slice(0,d).replaceAll(dp,""))}else if(l===this.editorDiv){let x=h,w=0;for(const v of this.editorDiv.childNodes)w++===d&&(x=p),x.push(Zr.#c(v))}this.#e=`${h.join(`
`)}${r}${p.join(`
`)}`,this.#l();const g=new Range;let b=Math.sumPrecise(h.map(x=>x.length));for(const{firstChild:x}of this.editorDiv.childNodes)if(x.nodeType===Node.TEXT_NODE){const w=x.nodeValue.length;if(b<=w){g.setStart(x,b),g.setEnd(x,b);break}b-=w}i.removeAllRanges(),i.addRange(g)}#l(){if(this.editorDiv.replaceChildren(),!!this.#e)for(const e of this.#e.split(`
`)){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#h(){return this.#e.replaceAll(""," ")}static#d(e){return e.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const e=Zr._internalPadding*this.parentScale;return this.getRect(e,e)}static async deserialize(e,t,n){let r=null;if(e instanceof s4){const{data:{defaultAppearanceData:{fontSize:o,fontColor:l},rect:d,rotation:h,id:p,popupRef:g,richText:b,contentsObj:x,creationDate:w,modificationDate:v},textContent:_,textPosition:N,parent:{page:{pageNumber:E}}}=e;if(!_||_.length===0)return null;r=e={annotationType:Tn.FREETEXT,color:Array.from(l),fontSize:o,value:_.join(`
`),position:N,pageIndex:E-1,rect:d.slice(0),rotation:h,annotationElementId:p,id:p,deleted:!1,popupRef:g,comment:x?.str||null,richText:b,creationDate:w,modificationDate:v}}const i=await super.deserialize(e,t,n);return i.#n=e.fontSize,i.color=qt.makeHexColor(...e.color),i.#e=Zr.#d(e.value),i._initialData=r,e.comment&&i.setCommentData(e),i}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const t=cn._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),n=Object.assign(super.serialize(e),{color:t,fontSize:this.#n,value:this.#h()});return this.addComment(n),e?(n.isCopy=!0,n):this.annotationElementId&&!this.#f(n)?null:(n.id=this.annotationElementId,n)}#f(e){const{value:t,fontSize:n,color:r,pageIndex:i}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||e.value!==t||e.fontSize!==n||e.color.some((o,l)=>o!==r[l])||e.pageIndex!==i}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(!t)return null;const{style:n}=t;n.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,n.color=this.color,t.replaceChildren();for(const r of this.#e.split(`
`)){const i=document.createElement("div");i.append(r?document.createTextNode(r):document.createElement("br")),t.append(i)}return e.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#e}}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}class Gt{static PRECISION=1e-4;toSVGPath(){cs("Abstract method `toSVGPath` must be implemented.")}get box(){cs("Abstract getter `box` must be implemented.")}serialize(e,t){cs("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,r,i,o){o||=new Float32Array(e.length);for(let l=0,d=e.length;l<d;l+=2)o[l]=t+e[l]*r,o[l+1]=n+e[l+1]*i;return o}static _rescaleAndSwap(e,t,n,r,i,o){o||=new Float32Array(e.length);for(let l=0,d=e.length;l<d;l+=2)o[l]=t+e[l+1]*r,o[l+1]=n+e[l]*i;return o}static _translate(e,t,n,r){r||=new Float32Array(e.length);for(let i=0,o=e.length;i<o;i+=2)r[i]=t+e[i],r[i+1]=n+e[i+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,r,i){switch(i){case 90:return[1-t/n,e/r];case 180:return[1-e/n,1-t/r];case 270:return[t/n,1-e/r];default:return[e/n,t/r]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,r,i,o){return[(e+5*n)/6,(t+5*r)/6,(5*n+i)/6,(5*r+o)/6,(n+i)/2,(r+o)/2]}}class ju{#e;#t=[];#s;#n;#i=[];#a=new Float32Array(18);#r;#o;#c;#l;#h;#d;#f=[];static#m=8;static#g=2;static#u=ju.#m+ju.#g;constructor({x:e,y:t},n,r,i,o,l=0){this.#e=n,this.#d=i*r,this.#n=o,this.#a.set([NaN,NaN,NaN,NaN,e,t],6),this.#s=l,this.#l=ju.#m*r,this.#c=ju.#u*r,this.#h=r,this.#f.push(e,t)}isEmpty(){return isNaN(this.#a[8])}#p(){const e=this.#a.subarray(4,6),t=this.#a.subarray(16,18),[n,r,i,o]=this.#e;return[(this.#r+(e[0]-t[0])/2-n)/i,(this.#o+(e[1]-t[1])/2-r)/o,(this.#r+(t[0]-e[0])/2-n)/i,(this.#o+(t[1]-e[1])/2-r)/o]}add({x:e,y:t}){this.#r=e,this.#o=t;const[n,r,i,o]=this.#e;let[l,d,h,p]=this.#a.subarray(8,12);const g=e-h,b=t-p,x=Math.hypot(g,b);if(x<this.#c)return!1;const w=x-this.#l,v=w/x,_=v*g,N=v*b;let E=l,k=d;l=h,d=p,h+=_,p+=N,this.#f?.push(e,t);const T=-N/w,P=_/w,O=T*this.#d,F=P*this.#d;return this.#a.set(this.#a.subarray(2,8),0),this.#a.set([h+O,p+F],4),this.#a.set(this.#a.subarray(14,18),12),this.#a.set([h-O,p-F],16),isNaN(this.#a[6])?(this.#i.length===0&&(this.#a.set([l+O,d+F],2),this.#i.push(NaN,NaN,NaN,NaN,(l+O-n)/i,(d+F-r)/o),this.#a.set([l-O,d-F],14),this.#t.push(NaN,NaN,NaN,NaN,(l-O-n)/i,(d-F-r)/o)),this.#a.set([E,k,l,d,h,p],6),!this.isEmpty()):(this.#a.set([E,k,l,d,h,p],6),Math.abs(Math.atan2(k-d,E-l)-Math.atan2(N,_))<Math.PI/2?([l,d,h,p]=this.#a.subarray(2,6),this.#i.push(NaN,NaN,NaN,NaN,((l+h)/2-n)/i,((d+p)/2-r)/o),[l,d,E,k]=this.#a.subarray(14,18),this.#t.push(NaN,NaN,NaN,NaN,((E+l)/2-n)/i,((k+d)/2-r)/o),!0):([E,k,l,d,h,p]=this.#a.subarray(0,6),this.#i.push(((E+5*l)/6-n)/i,((k+5*d)/6-r)/o,((5*l+h)/6-n)/i,((5*d+p)/6-r)/o,((l+h)/2-n)/i,((d+p)/2-r)/o),[h,p,l,d,E,k]=this.#a.subarray(12,18),this.#t.push(((E+5*l)/6-n)/i,((k+5*d)/6-r)/o,((5*l+h)/6-n)/i,((5*d+p)/6-r)/o,((l+h)/2-n)/i,((d+p)/2-r)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=this.#i,t=this.#t;if(isNaN(this.#a[6])&&!this.isEmpty())return this.#x();const n=[];n.push(`M${e[4]} ${e[5]}`);for(let r=6;r<e.length;r+=6)isNaN(e[r])?n.push(`L${e[r+4]} ${e[r+5]}`):n.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);this.#b(n);for(let r=t.length-6;r>=6;r-=6)isNaN(t[r])?n.push(`L${t[r+4]} ${t[r+5]}`):n.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);return this.#y(n),n.join(" ")}#x(){const[e,t,n,r]=this.#e,[i,o,l,d]=this.#p();return`M${(this.#a[2]-e)/n} ${(this.#a[3]-t)/r} L${(this.#a[4]-e)/n} ${(this.#a[5]-t)/r} L${i} ${o} L${l} ${d} L${(this.#a[16]-e)/n} ${(this.#a[17]-t)/r} L${(this.#a[14]-e)/n} ${(this.#a[15]-t)/r} Z`}#y(e){const t=this.#t;e.push(`L${t[4]} ${t[5]} Z`)}#b(e){const[t,n,r,i]=this.#e,o=this.#a.subarray(4,6),l=this.#a.subarray(16,18),[d,h,p,g]=this.#p();e.push(`L${(o[0]-t)/r} ${(o[1]-n)/i} L${d} ${h} L${p} ${g} L${(l[0]-t)/r} ${(l[1]-n)/i}`)}newFreeDrawOutline(e,t,n,r,i,o){return new o4(e,t,n,r,i,o)}getOutlines(){const e=this.#i,t=this.#t,n=this.#a,[r,i,o,l]=this.#e,d=new Float32Array((this.#f?.length??0)+2);for(let g=0,b=d.length-2;g<b;g+=2)d[g]=(this.#f[g]-r)/o,d[g+1]=(this.#f[g+1]-i)/l;if(d[d.length-2]=(this.#r-r)/o,d[d.length-1]=(this.#o-i)/l,isNaN(n[6])&&!this.isEmpty())return this.#N(d);const h=new Float32Array(this.#i.length+24+this.#t.length);let p=e.length;for(let g=0;g<p;g+=2){if(isNaN(e[g])){h[g]=h[g+1]=NaN;continue}h[g]=e[g],h[g+1]=e[g+1]}p=this.#w(h,p);for(let g=t.length-6;g>=6;g-=6)for(let b=0;b<6;b+=2){if(isNaN(t[g+b])){h[p]=h[p+1]=NaN,p+=2;continue}h[p]=t[g+b],h[p+1]=t[g+b+1],p+=2}return this.#_(h,p),this.newFreeDrawOutline(h,d,this.#e,this.#h,this.#s,this.#n)}#N(e){const t=this.#a,[n,r,i,o]=this.#e,[l,d,h,p]=this.#p(),g=new Float32Array(36);return g.set([NaN,NaN,NaN,NaN,(t[2]-n)/i,(t[3]-r)/o,NaN,NaN,NaN,NaN,(t[4]-n)/i,(t[5]-r)/o,NaN,NaN,NaN,NaN,l,d,NaN,NaN,NaN,NaN,h,p,NaN,NaN,NaN,NaN,(t[16]-n)/i,(t[17]-r)/o,NaN,NaN,NaN,NaN,(t[14]-n)/i,(t[15]-r)/o],0),this.newFreeDrawOutline(g,e,this.#e,this.#h,this.#s,this.#n)}#_(e,t){const n=this.#t;return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6}#w(e,t){const n=this.#a.subarray(4,6),r=this.#a.subarray(16,18),[i,o,l,d]=this.#e,[h,p,g,b]=this.#p();return e.set([NaN,NaN,NaN,NaN,(n[0]-i)/l,(n[1]-o)/d,NaN,NaN,NaN,NaN,h,p,NaN,NaN,NaN,NaN,g,b,NaN,NaN,NaN,NaN,(r[0]-i)/l,(r[1]-o)/d],t),t+=24}}class o4 extends Gt{#e;#t=new Float32Array(4);#s;#n;#i;#a;#r;constructor(e,t,n,r,i,o){super(),this.#r=e,this.#i=t,this.#e=n,this.#a=r,this.#s=i,this.#n=o,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#o(o);const[l,d,h,p]=this.#t;for(let g=0,b=e.length;g<b;g+=2)e[g]=(e[g]-l)/h,e[g+1]=(e[g+1]-d)/p;for(let g=0,b=t.length;g<b;g+=2)t[g]=(t[g]-l)/h,t[g+1]=(t[g+1]-d)/p}toSVGPath(){const e=[`M${this.#r[4]} ${this.#r[5]}`];for(let t=6,n=this.#r.length;t<n;t+=6){if(isNaN(this.#r[t])){e.push(`L${this.#r[t+4]} ${this.#r[t+5]}`);continue}e.push(`C${this.#r[t]} ${this.#r[t+1]} ${this.#r[t+2]} ${this.#r[t+3]} ${this.#r[t+4]} ${this.#r[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,n,r],i){const o=n-e,l=r-t;let d,h;switch(i){case 0:d=Gt._rescale(this.#r,e,r,o,-l),h=Gt._rescale(this.#i,e,r,o,-l);break;case 90:d=Gt._rescaleAndSwap(this.#r,e,t,o,l),h=Gt._rescaleAndSwap(this.#i,e,t,o,l);break;case 180:d=Gt._rescale(this.#r,n,t,-o,l),h=Gt._rescale(this.#i,n,t,-o,l);break;case 270:d=Gt._rescaleAndSwap(this.#r,n,r,-o,-l),h=Gt._rescaleAndSwap(this.#i,n,r,-o,-l);break}return{outline:Array.from(d),points:[Array.from(h)]}}#o(e){const t=this.#r;let n=t[4],r=t[5];const i=[n,r,n,r];let o=n,l=r,d=n,h=r;const p=e?Math.max:Math.min,g=new Float32Array(4);for(let x=6,w=t.length;x<w;x+=6){const v=t[x+4],_=t[x+5];isNaN(t[x])?(qt.pointBoundingBox(v,_,i),l>_?(o=v,l=_):l===_&&(o=p(o,v)),h<_?(d=v,h=_):h===_&&(d=p(d,v))):(g[0]=g[1]=1/0,g[2]=g[3]=-1/0,qt.bezierBoundingBox(n,r,...t.slice(x,x+6),g),qt.rectBoundingBox(g[0],g[1],g[2],g[3],i),l>g[1]?(o=g[0],l=g[1]):l===g[1]&&(o=p(o,g[0])),h<g[3]?(d=g[2],h=g[3]):h===g[3]&&(d=p(d,g[2]))),n=v,r=_}const b=this.#t;b[0]=i[0]-this.#s,b[1]=i[1]-this.#s,b[2]=i[2]-i[0]+2*this.#s,b[3]=i[3]-i[1]+2*this.#s,this.firstPoint=[o,l],this.lastPoint=[d,h]}get box(){return this.#t}newOutliner(e,t,n,r,i,o=0){return new ju(e,t,n,r,i,o)}getNewOutline(e,t){const[n,r,i,o]=this.#t,[l,d,h,p]=this.#e,g=i*h,b=o*p,x=n*h+l,w=r*p+d,v=this.newOutliner({x:this.#i[0]*g+x,y:this.#i[1]*b+w},this.#e,this.#a,e,this.#n,t??this.#s);for(let _=2;_<this.#i.length;_+=2)v.add({x:this.#i[_]*g+x,y:this.#i[_+1]*b+w});return v.getOutlines()}}class H1{#e;#t;#s;#n=[];#i=[];constructor(e,t=0,n=0,r=!0){const i=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:v,y:_,width:N,height:E}of e){const k=Math.floor((v-t)/o)*o,T=Math.ceil((v+N+t)/o)*o,P=Math.floor((_-t)/o)*o,O=Math.ceil((_+E+t)/o)*o,F=[k,P,O,!0],$=[T,P,O,!1];this.#n.push(F,$),qt.rectBoundingBox(k,P,T,O,i)}const l=i[2]-i[0]+2*n,d=i[3]-i[1]+2*n,h=i[0]-n,p=i[1]-n;let g=r?-1/0:1/0,b=1/0;const x=this.#n.at(r?-1:-2),w=[x[0],x[2]];for(const v of this.#n){const[_,N,E,k]=v;!k&&r?N<b?(b=N,g=_):N===b&&(g=Math.max(g,_)):k&&!r&&(N<b?(b=N,g=_):N===b&&(g=Math.min(g,_))),v[0]=(_-h)/l,v[1]=(N-p)/d,v[2]=(E-p)/d}this.#e=new Float32Array([h,p,l,d]),this.#t=[g,b],this.#s=w}getOutlines(){this.#n.sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);const e=[];for(const t of this.#n)t[3]?(e.push(...this.#l(t)),this.#o(t)):(this.#c(t),e.push(...this.#l(t)));return this.#a(e)}#a(e){const t=[],n=new Set;for(const o of e){const[l,d,h]=o;t.push([l,d,o],[l,h,o])}t.sort((o,l)=>o[1]-l[1]||o[0]-l[0]);for(let o=0,l=t.length;o<l;o+=2){const d=t[o][2],h=t[o+1][2];d.push(h),h.push(d),n.add(d),n.add(h)}const r=[];let i;for(;n.size>0;){const o=n.values().next().value;let[l,d,h,p,g]=o;n.delete(o);let b=l,x=d;for(i=[l,h],r.push(i);;){let w;if(n.has(p))w=p;else if(n.has(g))w=g;else break;n.delete(w),[l,d,h,p,g]=w,b!==l&&(i.push(b,x,l,x===d?d:h),b=l),x=x===d?h:d}i.push(b,x)}return new eL(r,this.#e,this.#t,this.#s)}#r(e){const t=this.#i;let n=0,r=t.length-1;for(;n<=r;){const i=n+r>>1,o=t[i][0];if(o===e)return i;o<e?n=i+1:r=i-1}return r+1}#o([,e,t]){const n=this.#r(e);this.#i.splice(n,0,[e,t])}#c([,e,t]){const n=this.#r(e);for(let r=n;r<this.#i.length;r++){const[i,o]=this.#i[r];if(i!==e)break;if(i===e&&o===t){this.#i.splice(r,1);return}}for(let r=n-1;r>=0;r--){const[i,o]=this.#i[r];if(i!==e)break;if(i===e&&o===t){this.#i.splice(r,1);return}}}#l(e){const[t,n,r]=e,i=[[t,n,r]],o=this.#r(r);for(let l=0;l<o;l++){const[d,h]=this.#i[l];for(let p=0,g=i.length;p<g;p++){const[,b,x]=i[p];if(!(h<=b||x<=d)){if(b>=d){if(x>h)i[p][1]=h;else{if(g===1)return[];i.splice(p,1),p--,g--}continue}i[p][2]=d,x>h&&i.push([t,h,x])}}}return i}}class eL extends Gt{#e;#t;constructor(e,t,n,r){super(),this.#t=e,this.#e=t,this.firstPoint=n,this.lastPoint=r}toSVGPath(){const e=[];for(const t of this.#t){let[n,r]=t;e.push(`M${n} ${r}`);for(let i=2;i<t.length;i+=2){const o=t[i],l=t[i+1];o===n?(e.push(`V${l}`),r=l):l===r&&(e.push(`H${o}`),n=o)}e.push("Z")}return e.join(" ")}serialize([e,t,n,r],i){const o=[],l=n-e,d=r-t;for(const h of this.#t){const p=new Array(h.length);for(let g=0;g<h.length;g+=2)p[g]=e+h[g]*l,p[g+1]=r-h[g+1]*d;o.push(p)}return o}get box(){return this.#e}get classNamesForOutlining(){return["highlightOutline"]}}class G1 extends ju{newFreeDrawOutline(e,t,n,r,i,o){return new tL(e,t,n,r,i,o)}}class tL extends o4{newOutliner(e,t,n,r,i,o=0){return new G1(e,t,n,r,i,o)}}class mr extends cn{#e=null;#t=0;#s;#n=null;#i=null;#a=null;#r=null;#o=0;#c=null;#l=null;#h=null;#d=!1;#f=null;#m=null;#g=null;#u="";#p;#x="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=Tn.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const e=mr.prototype;return _n(this,"_keyboardManager",new t0([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||mr._defaultColor,this.#p=e.thickness||mr._defaultThickness,this.opacity=e.opacity||mr._defaultOpacity,this.#s=e.boxes||null,this.#x=e.methodOfCreation||"",this.#u=e.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(this.#d=!0,this.#b(e),this.#v()):this.#s&&(this.#e=e.anchorNode,this.#t=e.anchorOffset,this.#r=e.focusNode,this.#o=e.focusOffset,this.#y(),this.#v(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#d?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#p,methodOfCreation:this.#x}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#y(){const e=new H1(this.#s,.001);this.#l=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const t=new H1(this.#s,.0025,.001,this._uiManager.direction==="ltr");this.#a=t.getOutlines();const{firstPoint:n}=this.#l;this.#f=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height];const{lastPoint:r}=this.#a;this.#m=[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height]}#b({highlightOutlines:e,highlightId:t,clipPathId:n}){this.#l=e;const r=1.5;if(this.#a=e.getNewOutline(this.#p/2+r,.0025),t>=0)this.#h=t,this.#n=n,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#g=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#a.box,path:{d:this.#a.toSVGPath()}},!0);else if(this.parent){const g=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#h,{bbox:mr.#A(this.#l.box,(g-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#g,{bbox:mr.#A(this.#a.box,g),path:{d:this.#a.toSVGPath()}})}const[i,o,l,d]=e.box;switch(this.rotation){case 0:this.x=i,this.y=o,this.width=l,this.height=d;break;case 90:{const[g,b]=this.parentDimensions;this.x=o,this.y=1-i,this.width=l*b/g,this.height=d*g/b;break}case 180:this.x=1-i,this.y=1-o,this.width=l,this.height=d;break;case 270:{const[g,b]=this.parentDimensions;this.x=1-o,this.y=i,this.width=l*b/g,this.height=d*g/b;break}}const{firstPoint:h}=e;this.#f=[(h[0]-i)/l,(h[1]-o)/d];const{lastPoint:p}=this.#a;this.#m=[(p[0]-i)/l,(p[1]-o)/d]}static initialize(e,t){cn.initialize(e,t),mr._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case Wn.HIGHLIGHT_COLOR:mr._defaultColor=t;break;case Wn.HIGHLIGHT_THICKNESS:mr._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#m}get commentButtonPosition(){return this.#f}updateParams(e,t){switch(e){case Wn.HIGHLIGHT_COLOR:this.#N(t);break;case Wn.HIGHLIGHT_THICKNESS:this.#_(t);break}}static get defaultPropertiesToUpdate(){return[[Wn.HIGHLIGHT_COLOR,mr._defaultColor],[Wn.HIGHLIGHT_THICKNESS,mr._defaultThickness]]}get propertiesToUpdate(){return[[Wn.HIGHLIGHT_COLOR,this.color||mr._defaultColor],[Wn.HIGHLIGHT_THICKNESS,this.#p||mr._defaultThickness],[Wn.HIGHLIGHT_FREE,this.#d]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#h,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#i?.updateColor(this.color),super.onUpdatedColor()}#N(e){const t=(i,o)=>{this.color=i,this.opacity=o,this.onUpdatedColor()},n=this.color,r=this.opacity;this.addCommands({cmd:t.bind(this,e,mr._defaultOpacity),undo:t.bind(this,n,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Wn.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(e)},!0)}#_(e){const t=this.#p,n=r=>{this.#p=r,this.#w(r)};this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Wn.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#i=new Ya({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#j())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#j())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#E(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#v(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#E():e&&(this.#v(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#w(e){this.#d&&(this.#b({highlightOutlines:this.#l.getNewOutline(e/2)}),this.fixAndSetPosition(),this.setDims())}#E(){this.#h===null||!this.parent||(this.parent.drawLayer.remove(this.#h),this.#h=null,this.parent.drawLayer.remove(this.#g),this.#g=null)}#v(e=this.parent){this.#h===null&&({id:this.#h,clipPathId:this.#n}=e.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#d},path:{d:this.#l.toSVGPath()}},!1,!0),this.#g=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#d},bbox:this.#a.box,path:{d:this.#a.toSVGPath()}},this.#d),this.#c&&(this.#c.style.clipPath=this.#n))}static#A([e,t,n,r],i){switch(i){case 90:return[1-t-r,e,r,n];case 180:return[1-e-n,1-t-r,n,r];case 270:return[t,1-e-n,r,n]}return[e,t,n,r]}rotate(e){const{drawLayer:t}=this.parent;let n;this.#d?(e=(e-this.rotation+360)%360,n=mr.#A(this.#l.box,e)):n=mr.#A([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#h,{bbox:n,root:{"data-main-rotation":e}}),t.updateProperties(this.#g,{bbox:mr.#A(this.#a.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();this.#u&&(e.setAttribute("aria-label",this.#u),e.setAttribute("role","mark")),this.#d?e.classList.add("free"):this.div.addEventListener("keydown",this.#T.bind(this),{signal:this._uiManager._signal});const t=this.#c=document.createElement("div");return e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#n,this.setDims(),P_(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1}})}#T(e){mr._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#k(!0);break;case 1:case 3:this.#k(!1);break}}#k(e){if(!this.#e)return;const t=window.getSelection();e?t.setPosition(this.#e,this.#t):t.setPosition(this.#r,this.#o)}select(){super.select(),this.#g&&this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#g&&(this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{selected:!1}}),this.#d||this.#k(!1))}get _mustFixPosition(){return!this.#d}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#h,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#g,{rootClass:{hidden:!e}}))}#j(){return this.#d?this.rotation:0}#I(){if(this.#d)return null;const[e,t]=this.pageDimensions,[n,r]=this.pageTranslation,i=this.#s,o=new Float32Array(i.length*8);let l=0;for(const{x:d,y:h,width:p,height:g}of i){const b=d*e+n,x=(1-h)*t+r;o[l]=o[l+4]=b,o[l+1]=o[l+3]=x,o[l+2]=o[l+6]=b+p*e,o[l+5]=o[l+7]=x-g*t,l+=8}return o}#L(e){return this.#l.serialize(e,this.#j())}static startHighlighting(e,t,{target:n,x:r,y:i}){const{x:o,y:l,width:d,height:h}=n.getBoundingClientRect(),p=new AbortController,g=e.combinedSignal(p),b=x=>{p.abort(),this.#M(e,x)};window.addEventListener("blur",b,{signal:g}),window.addEventListener("pointerup",b,{signal:g}),window.addEventListener("pointerdown",hr,{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",Xa,{signal:g}),n.addEventListener("pointermove",this.#P.bind(this,e),{signal:g}),this._freeHighlight=new G1({x:r,y:i},[o,l,d,h],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#P(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#M(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(e,t,n){let r=null;if(e instanceof i4){const{data:{quadPoints:w,rect:v,rotation:_,id:N,color:E,opacity:k,popupRef:T,richText:P,contentsObj:O,creationDate:F,modificationDate:$},parent:{page:{pageNumber:z}}}=e;r=e={annotationType:Tn.HIGHLIGHT,color:Array.from(E),opacity:k,quadPoints:w,boxes:null,pageIndex:z-1,rect:v.slice(0),rotation:_,annotationElementId:N,id:N,deleted:!1,popupRef:T,richText:P,comment:O?.str||null,creationDate:F,modificationDate:$}}else if(e instanceof Bb){const{data:{inkLists:w,rect:v,rotation:_,id:N,color:E,borderStyle:{rawWidth:k},popupRef:T,richText:P,contentsObj:O,creationDate:F,modificationDate:$},parent:{page:{pageNumber:z}}}=e;r=e={annotationType:Tn.HIGHLIGHT,color:Array.from(E),thickness:k,inkLists:w,boxes:null,pageIndex:z-1,rect:v.slice(0),rotation:_,annotationElementId:N,id:N,deleted:!1,popupRef:T,richText:P,comment:O?.str||null,creationDate:F,modificationDate:$}}const{color:i,quadPoints:o,inkLists:l,opacity:d}=e,h=await super.deserialize(e,t,n);h.color=qt.makeHexColor(...i),h.opacity=d||1,l&&(h.#p=e.thickness),h._initialData=r,e.comment&&h.setCommentData(e);const[p,g]=h.pageDimensions,[b,x]=h.pageTranslation;if(o){const w=h.#s=[];for(let v=0;v<o.length;v+=8)w.push({x:(o[v]-b)/p,y:1-(o[v+1]-x)/g,width:(o[v+2]-o[v])/p,height:(o[v+1]-o[v+5])/g});h.#y(),h.#v(),h.rotate(h.rotation)}else if(l){h.#d=!0;const w=l[0],v={x:w[0]-b,y:g-(w[1]-x)},_=new G1(v,[0,0,p,g],1,h.#p/2,!0,.001);for(let k=0,T=w.length;k<T;k+=2)v.x=w[k]-b,v.y=g-(w[k+1]-x),_.add(v);const{id:N,clipPathId:E}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:_.toSVGPath()}},!0,!0);h.#b({highlightOutlines:_.getOutlines(),highlightId:N,clipPathId:E}),h.#v(),h.rotate(h.parentRotation)}return h}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const t=cn._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),n=super.serialize(e);return Object.assign(n,{color:t,opacity:this.opacity,thickness:this.#p,quadPoints:this.#I(),outlines:this.#L(n.rect)}),this.addComment(n),this.annotationElementId&&!this.#B(n)?null:(n.id=this.annotationElementId,n)}#B(e){const{color:t}=this._initialData;return this.hasEditedComment||e.color.some((n,r)=>n!==t[r])}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class l4{#e=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,n]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,n)}updateSVGProperty(e,t){this.#e[e]=t}toSVGProperties(){const e=this.#e;return this.#e=Object.create(null),{root:e}}reset(){this.#e=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){cs("Not implemented")}}class is extends cn{#e=null;#t;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#s=null;static#n=null;static#i=null;static _INNER_MARGIN=3;constructor(e){super(e),this.#t=e.mustBeCommitted||!1,this._addOutlines(e)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(e){e.drawOutlines&&(this.#a(e),this.#c())}#a({drawOutlines:e,drawId:t,drawingOptions:n}){this.#e=e,this._drawingOptions||=n,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),t>=0?(this._drawId=t,this.parent.drawLayer.finalizeDraw(t,e.defaultProperties)):this._drawId=this.#r(e,this.parent),this.#d(e.box)}#r(e,t){const{id:n}=t.drawLayer.draw(is._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return n}static _mergeSVGProperties(e,t){const n=new Set(Object.keys(e));for(const[r,i]of Object.entries(t))n.has(r)?Object.assign(e[r],i):e[r]=i;return e}static getDefaultDrawingOptions(e){cs("Not implemented")}static get typesMap(){cs("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,t){const n=this.typesMap.get(e);n&&this._defaultDrawingOptions.updateProperty(n,t),this._currentParent&&(is.#s.updateProperty(n,t),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,t){const n=this.constructor.typesMap.get(e);n&&this._updateProperty(e,n,t)}static get defaultPropertiesToUpdate(){const e=[],t=this._defaultDrawingOptions;for(const[n,r]of this.typesMap)e.push([n,t[r]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:t}=this;for(const[n,r]of this.constructor.typesMap)e.push([n,t[r]]);return e}_updateProperty(e,t,n){const r=this._drawingOptions,i=r[t],o=l=>{r.updateProperty(t,l);const d=this.#e.updateProperty(t,l);d&&this.#d(d),this.parent?.drawLayer.updateProperties(this._drawId,r.toSVGProperties()),e===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:o.bind(this,n),undo:o.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,is._mergeSVGProperties(this.#e.getPathResizingSVGProperties(this.#h()),{bbox:this.#f()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,is._mergeSVGProperties(this.#e.getPathResizedSVGProperties(this.#h()),{bbox:this.#f()}))}_onTranslating(e,t){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#f()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,is._mergeSVGProperties(this.#e.getPathTranslatedSVGProperties(this.#h(),this.parentDimensions),{bbox:this.#f()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#t&&(this.#t=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#o(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#c(),this.#d(this.#e.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#o()):e&&(this._uiManager.addShouldRescale(this),this.#c(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),t&&this.select()}#o(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#c(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#r(this.#e,e)}}#l([e,t,n,r]){const{parentDimensions:[i,o],rotation:l}=this;switch(l){case 90:return[t,1-e,n*(o/i),r*(i/o)];case 180:return[1-e,1-t,n,r];case 270:return[1-t,e,n*(o/i),r*(i/o)];default:return[e,t,n,r]}}#h(){const{x:e,y:t,width:n,height:r,parentDimensions:[i,o],rotation:l}=this;switch(l){case 90:return[1-t,e,n*(i/o),r*(o/i)];case 180:return[1-e,1-t,n,r];case 270:return[t,1-e,n*(i/o),r*(o/i)];default:return[e,t,n,r]}}#d(e){[this.x,this.y,this.width,this.height]=this.#l(e),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#f(){const{x:e,y:t,width:n,height:r,rotation:i,parentRotation:o,parentDimensions:[l,d]}=this;switch((i*4+o)/90){case 1:return[1-t-r,e,r,n];case 2:return[1-e-n,1-t-r,n,r];case 3:return[t,1-e-n,r,n];case 4:return[e,t-n*(l/d),r*(d/l),n*(l/d)];case 5:return[1-t,e,n*(l/d),r*(d/l)];case 6:return[1-e-r*(d/l),1-t,r*(d/l),n*(l/d)];case 7:return[t-n*(l/d),1-e-r*(d/l),n*(l/d),r*(d/l)];case 8:return[e-n,t-r,n,r];case 9:return[1-t,e-n,r,n];case 10:return[1-e,1-t,n,r];case 11:return[t-r,1-e,r,n];case 12:return[e-r*(d/l),t,r*(d/l),n*(l/d)];case 13:return[1-t-n*(l/d),e-r*(d/l),n*(l/d),r*(d/l)];case 14:return[1-e,1-t-n*(l/d),r*(d/l),n*(l/d)];case 15:return[t,1-e,n*(l/d),r*(d/l)];default:return[e,t,n,r]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,is._mergeSVGProperties({bbox:this.#f()},this.#e.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#d(this.#e.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,t;this._isCopy&&(e=this.x,t=this.y);const n=super.render();n.classList.add("draw");const r=document.createElement("div");return n.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,t),n}static createDrawerInstance(e,t,n,r,i){cs("Not implemented")}static startDrawing(e,t,n,r){const{target:i,offsetX:o,offsetY:l,pointerId:d,pointerType:h}=r;if(os.isInitializedAndDifferentPointerType(h))return;const{viewport:{rotation:p}}=e,{width:g,height:b}=i.getBoundingClientRect(),x=is.#n=new AbortController,w=e.combinedSignal(x);if(os.setPointer(h,d),window.addEventListener("pointerup",v=>{os.isSamePointerIdOrRemove(v.pointerId)&&this._endDraw(v)},{signal:w}),window.addEventListener("pointercancel",v=>{os.isSamePointerIdOrRemove(v.pointerId)&&this._currentParent.endDrawingSession()},{signal:w}),window.addEventListener("pointerdown",v=>{os.isSamePointerType(v.pointerType)&&(os.initializeAndAddPointerId(v.pointerId),is.#s.isCancellable()&&(is.#s.removeLastElement(),is.#s.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:w}),window.addEventListener("contextmenu",Xa,{signal:w}),i.addEventListener("pointermove",this._drawMove.bind(this),{signal:w}),i.addEventListener("touchmove",v=>{os.isSameTimeStamp(v.timeStamp)&&hr(v)},{signal:w}),e.toggleDrawing(),t._editorUndoBar?.hide(),is.#s){e.drawLayer.updateProperties(this._currentDrawId,is.#s.startNew(o,l,g,b,p));return}t.updateUIForDefaultProperties(this),is.#s=this.createDrawerInstance(o,l,g,b,p),is.#i=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(is.#i.toSVGProperties(),is.#s.defaultSVGProperties),!0,!1)}static _drawMove(e){if(os.isSameTimeStamp(e.timeStamp),!is.#s)return;const{offsetX:t,offsetY:n,pointerId:r}=e;if(os.isSamePointerId(r)){if(os.isUsingMultiplePointers()){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,is.#s.add(t,n)),os.setTimeStamp(e.timeStamp),hr(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,is.#s=null,is.#i=null,os.clearTimeStamp()),is.#n&&(is.#n.abort(),is.#n=null,os.clearPointerIds())}static _endDraw(e){const t=this._currentParent;if(t){if(t.toggleDrawing(!0),this._cleanup(!1),e?.target===t.div&&t.drawLayer.updateProperties(this._currentDrawId,is.#s.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const n=is.#s,r=this._currentDrawId,i=n.getLastElement();t.addCommands({cmd:()=>{t.drawLayer.updateProperties(r,n.setLastElement(i))},undo:()=>{t.drawLayer.updateProperties(r,n.removeLastElement())},mustExec:!1,type:Wn.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const t=this._currentParent;if(!t)return null;if(t.toggleDrawing(!0),t.cleanUndoStack(Wn.DRAW_STEP),!is.#s.isEmpty()){const{pageDimensions:[n,r],scale:i}=t,o=t.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:is.#s.getOutlines(n*i,r*i,i,this._INNER_MARGIN),drawingOptions:is.#i,mustBeCommitted:!e});return this._cleanup(!0),o}return t.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,t,n,r,i,o){cs("Not implemented")}static async deserialize(e,t,n){const{rawDims:{pageWidth:r,pageHeight:i,pageX:o,pageY:l}}=t.viewport,d=this.deserializeDraw(o,l,r,i,this._INNER_MARGIN,e),h=await super.deserialize(e,t,n);return h.createDrawingOptions(e),h.#a({drawOutlines:d}),h.#c(),h.onScaleChanging(),h.rotate(),h}serializeDraw(e){const[t,n]=this.pageTranslation,[r,i]=this.pageDimensions;return this.#e.serialize([t,n,r,i],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class nL{#e=new Float64Array(6);#t;#s;#n;#i;#a;#r="";#o=0;#c=new n0;#l;#h;constructor(e,t,n,r,i,o){this.#l=n,this.#h=r,this.#n=i,this.#i=o,[e,t]=this.#d(e,t);const l=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#a=[e,t],this.#s=[{line:l,points:this.#a}],this.#e.set(l,0)}updateProperty(e,t){e==="stroke-width"&&(this.#i=t)}#d(e,t){return Gt._normalizePoint(e,t,this.#l,this.#h,this.#n)}isEmpty(){return!this.#s||this.#s.length===0}isCancellable(){return this.#a.length<=10}add(e,t){[e,t]=this.#d(e,t);const[n,r,i,o]=this.#e.subarray(2,6),l=e-i,d=t-o;return Math.hypot(this.#l*l,this.#h*d)<=2?null:(this.#a.push(e,t),isNaN(n)?(this.#e.set([i,o,e,t],2),this.#t.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#e[0])&&this.#t.splice(6,6),this.#e.set([n,r,i,o,e,t],0),this.#t.push(...Gt.createBezierPoints(n,r,i,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const n=this.add(e,t);return n||(this.#a.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,r,i){this.#l=n,this.#h=r,this.#n=i,[e,t]=this.#d(e,t);const o=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#a=[e,t];const l=this.#s.at(-1);return l&&(l.line=new Float32Array(l.line),l.points=new Float32Array(l.points)),this.#s.push({line:o,points:this.#a}),this.#e.set(o,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#s.at(-1)}setLastElement(e){return this.#s?(this.#s.push(e),this.#t=e.line,this.#a=e.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(e)}removeLastElement(){if(!this.#s)return this.#c.removeLastElement();this.#s.pop(),this.#r="";for(let e=0,t=this.#s.length;e<t;e++){const{line:n,points:r}=this.#s[e];this.#t=n,this.#a=r,this.#o=0,this.toSVGPath()}return{path:{d:this.#r}}}toSVGPath(){const e=Gt.svgRound(this.#t[4]),t=Gt.svgRound(this.#t[5]);if(this.#a.length===2)return this.#r=`${this.#r} M ${e} ${t} Z`,this.#r;if(this.#a.length<=6){const r=this.#r.lastIndexOf("M");this.#r=`${this.#r.slice(0,r)} M ${e} ${t}`,this.#o=6}if(this.#a.length===4){const r=Gt.svgRound(this.#t[10]),i=Gt.svgRound(this.#t[11]);return this.#r=`${this.#r} L ${r} ${i}`,this.#o=12,this.#r}const n=[];this.#o===0&&(n.push(`M ${e} ${t}`),this.#o=6);for(let r=this.#o,i=this.#t.length;r<i;r+=6){const[o,l,d,h,p,g]=this.#t.slice(r,r+6).map(Gt.svgRound);n.push(`C${o} ${l} ${d} ${h} ${p} ${g}`)}return this.#r+=n.join(" "),this.#o=this.#t.length,this.#r}getOutlines(e,t,n,r){const i=this.#s.at(-1);return i.line=new Float32Array(i.line),i.points=new Float32Array(i.points),this.#c.build(this.#s,e,t,n,this.#n,this.#i,r),this.#e=null,this.#t=null,this.#s=null,this.#r=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class n0 extends Gt{#e;#t=0;#s;#n;#i;#a;#r;#o;#c;build(e,t,n,r,i,o,l){this.#i=t,this.#a=n,this.#r=r,this.#o=i,this.#c=o,this.#s=l??0,this.#n=e,this.#d()}get thickness(){return this.#c}setLastElement(e){return this.#n.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#n.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:t}of this.#n){if(e.push(`M${Gt.svgRound(t[4])} ${Gt.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12&&isNaN(t[6])){e.push(`L${Gt.svgRound(t[10])} ${Gt.svgRound(t[11])}`);continue}for(let n=6,r=t.length;n<r;n+=6){const[i,o,l,d,h,p]=t.subarray(n,n+6).map(Gt.svgRound);e.push(`C${i} ${o} ${l} ${d} ${h} ${p}`)}}return e.join("")}serialize([e,t,n,r],i){const o=[],l=[],[d,h,p,g]=this.#h();let b,x,w,v,_,N,E,k,T;switch(this.#o){case 0:T=Gt._rescale,b=e,x=t+r,w=n,v=-r,_=e+d*n,N=t+(1-h-g)*r,E=e+(d+p)*n,k=t+(1-h)*r;break;case 90:T=Gt._rescaleAndSwap,b=e,x=t,w=n,v=r,_=e+h*n,N=t+d*r,E=e+(h+g)*n,k=t+(d+p)*r;break;case 180:T=Gt._rescale,b=e+n,x=t,w=-n,v=r,_=e+(1-d-p)*n,N=t+h*r,E=e+(1-d)*n,k=t+(h+g)*r;break;case 270:T=Gt._rescaleAndSwap,b=e+n,x=t+r,w=-n,v=-r,_=e+(1-h-g)*n,N=t+(1-d-p)*r,E=e+(1-h)*n,k=t+(1-d)*r;break}for(const{line:P,points:O}of this.#n)o.push(T(P,b,x,w,v,i?new Array(P.length):null)),l.push(T(O,b,x,w,v,i?new Array(O.length):null));return{lines:o,points:l,rect:[_,N,E,k]}}static deserialize(e,t,n,r,i,{paths:{lines:o,points:l},rotation:d,thickness:h}){const p=[];let g,b,x,w,v;switch(d){case 0:v=Gt._rescale,g=-e/n,b=t/r+1,x=1/n,w=-1/r;break;case 90:v=Gt._rescaleAndSwap,g=-t/r,b=-e/n,x=1/r,w=1/n;break;case 180:v=Gt._rescale,g=e/n+1,b=-t/r,x=-1/n,w=1/r;break;case 270:v=Gt._rescaleAndSwap,g=t/r+1,b=e/n+1,x=-1/r,w=-1/n;break}if(!o){o=[];for(const N of l){const E=N.length;if(E===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,N[0],N[1]]));continue}if(E===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,N[0],N[1],NaN,NaN,NaN,NaN,N[2],N[3]]));continue}const k=new Float32Array(3*(E-2));o.push(k);let[T,P,O,F]=N.subarray(0,4);k.set([NaN,NaN,NaN,NaN,T,P],0);for(let $=4;$<E;$+=2){const z=N[$],G=N[$+1];k.set(Gt.createBezierPoints(T,P,O,F,z,G),($-2)*3),[T,P,O,F]=[O,F,z,G]}}}for(let N=0,E=o.length;N<E;N++)p.push({line:v(o[N].map(k=>k??NaN),g,b,x,w),points:v(l[N].map(k=>k??NaN),g,b,x,w)});const _=new this.prototype.constructor;return _.build(p,n,r,1,d,h,i),_}#l(e=this.#c){const t=this.#s+e/2*this.#r;return this.#o%180===0?[t/this.#i,t/this.#a]:[t/this.#a,t/this.#i]}#h(){const[e,t,n,r]=this.#e,[i,o]=this.#l(0);return[e+i,t+o,n-2*i,r-2*o]}#d(){const e=this.#e=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:r}of this.#n){if(r.length<=12){for(let l=4,d=r.length;l<d;l+=6)qt.pointBoundingBox(r[l],r[l+1],e);continue}let i=r[4],o=r[5];for(let l=6,d=r.length;l<d;l+=6){const[h,p,g,b,x,w]=r.subarray(l,l+6);qt.bezierBoundingBox(i,o,h,p,g,b,x,w,e),i=x,o=w}}const[t,n]=this.#l();e[0]=fi(e[0]-t,0,1),e[1]=fi(e[1]-n,0,1),e[2]=fi(e[2]+t,0,1),e[3]=fi(e[3]+n,0,1),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#e}updateProperty(e,t){return e==="stroke-width"?this.#f(t):null}#f(e){const[t,n]=this.#l();this.#c=e;const[r,i]=this.#l(),[o,l]=[r-t,i-n],d=this.#e;return d[0]-=o,d[1]-=l,d[2]+=2*o,d[3]+=2*l,d}updateParentDimensions([e,t],n){const[r,i]=this.#l();this.#i=e,this.#a=t,this.#r=n;const[o,l]=this.#l(),d=o-r,h=l-i,p=this.#e;return p[0]-=d,p[1]-=h,p[2]+=2*d,p[3]+=2*h,p}updateRotation(e){return this.#t=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#e.map(Gt.svgRound).join(" ")}get defaultProperties(){const[e,t]=this.#e;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Gt.svgRound(e)} ${Gt.svgRound(t)}`}}}get rotationTransform(){const[,,e,t]=this.#e;let n=0,r=0,i=0,o=0,l=0,d=0;switch(this.#t){case 90:r=t/e,i=-e/t,l=e;break;case 180:n=-1,o=-1,l=e,d=t;break;case 270:r=-t/e,i=e/t,d=t;break;default:return""}return`matrix(${n} ${r} ${i} ${o} ${Gt.svgRound(l)} ${Gt.svgRound(d)})`}getPathResizingSVGProperties([e,t,n,r]){const[i,o]=this.#l(),[l,d,h,p]=this.#e;if(Math.abs(h-i)<=Gt.PRECISION||Math.abs(p-o)<=Gt.PRECISION){const v=e+n/2-(l+h/2),_=t+r/2-(d+p/2);return{path:{"transform-origin":`${Gt.svgRound(e)} ${Gt.svgRound(t)}`,transform:`${this.rotationTransform} translate(${v} ${_})`}}}const g=(n-2*i)/(h-2*i),b=(r-2*o)/(p-2*o),x=h/n,w=p/r;return{path:{"transform-origin":`${Gt.svgRound(l)} ${Gt.svgRound(d)}`,transform:`${this.rotationTransform} scale(${x} ${w}) translate(${Gt.svgRound(i)} ${Gt.svgRound(o)}) scale(${g} ${b}) translate(${Gt.svgRound(-i)} ${Gt.svgRound(-o)})`}}}getPathResizedSVGProperties([e,t,n,r]){const[i,o]=this.#l(),l=this.#e,[d,h,p,g]=l;if(l[0]=e,l[1]=t,l[2]=n,l[3]=r,Math.abs(p-i)<=Gt.PRECISION||Math.abs(g-o)<=Gt.PRECISION){const _=e+n/2-(d+p/2),N=t+r/2-(h+g/2);for(const{line:E,points:k}of this.#n)Gt._translate(E,_,N,E),Gt._translate(k,_,N,k);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Gt.svgRound(e)} ${Gt.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const b=(n-2*i)/(p-2*i),x=(r-2*o)/(g-2*o),w=-b*(d+i)+e+i,v=-x*(h+o)+t+o;if(b!==1||x!==1||w!==0||v!==0)for(const{line:_,points:N}of this.#n)Gt._rescale(_,w,v,b,x,_),Gt._rescale(N,w,v,b,x,N);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Gt.svgRound(e)} ${Gt.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],n){const[r,i]=n,o=this.#e,l=e-o[0],d=t-o[1];if(this.#i===r&&this.#a===i)for(const{line:h,points:p}of this.#n)Gt._translate(h,l,d,h),Gt._translate(p,l,d,p);else{const h=this.#i/r,p=this.#a/i;this.#i=r,this.#a=i;for(const{line:g,points:b}of this.#n)Gt._rescale(g,l,d,h,p,g),Gt._rescale(b,l,d,h,p,b);o[2]*=h,o[3]*=p}return o[0]=e,o[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Gt.svgRound(e)} ${Gt.svgRound(t)}`}}}get defaultSVGProperties(){const e=this.#e;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Gt.svgRound(e[0])} ${Gt.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}class nm extends l4{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:cn._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new nm(this._viewParameters);return e.updateAll(this),e}}class Ib extends is{static _type="ink";static _editorType=Tn.INK;static _defaultDrawingOptions=null;constructor(e){super({...e,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,t){cn.initialize(e,t),this._defaultDrawingOptions=new nm(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return _n(this,"typesMap",new Map([[Wn.INK_THICKNESS,"stroke-width"],[Wn.INK_COLOR,"stroke"],[Wn.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,n,r,i){return new nL(e,t,n,r,i,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,n,r,i,o){return n0.deserialize(e,t,n,r,i,o)}static async deserialize(e,t,n){let r=null;if(e instanceof Bb){const{data:{inkLists:o,rect:l,rotation:d,id:h,color:p,opacity:g,borderStyle:{rawWidth:b},popupRef:x,richText:w,contentsObj:v,creationDate:_,modificationDate:N},parent:{page:{pageNumber:E}}}=e;r=e={annotationType:Tn.INK,color:Array.from(p),thickness:b,opacity:g,paths:{points:o},boxes:null,pageIndex:E-1,rect:l.slice(0),rotation:d,annotationElementId:h,id:h,deleted:!1,popupRef:x,richText:w,comment:v?.str||null,creationDate:_,modificationDate:N}}const i=await super.deserialize(e,t,n);return i._initialData=r,e.comment&&i.setCommentData(e),i}get toolbarButtons(){return this._colorPicker||=new Gf(this),[["colorPicker",this._colorPicker]]}get colorType(){return Wn.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:t,parent:n}=this;t.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:n}){this._drawingOptions=Ib.getDefaultDrawingOptions({stroke:qt.makeHexColor(...e),"stroke-width":t,"stroke-opacity":n})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:t,points:n}=this.serializeDraw(e),{_drawingOptions:{stroke:r,"stroke-opacity":i,"stroke-width":o}}=this,l=Object.assign(super.serialize(e),{color:cn._colorManager.convert(r),opacity:i,thickness:o,paths:{lines:t,points:n}});return this.addComment(l),e?(l.isCopy=!0,l):this.annotationElementId&&!this.#e(l)?null:(l.id=this.annotationElementId,l)}#e(e){const{color:t,thickness:n,opacity:r,pageIndex:i}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||e.color.some((o,l)=>o!==t[l])||e.thickness!==n||e.opacity!==r||e.pageIndex!==i}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;const{points:t,rect:n}=this.serializeDraw(!1);return e.updateEdited({rect:n,thickness:this._drawingOptions["stroke-width"],points:t,popup:this.comment}),null}}class V1 extends n0{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const hp=8,mf=3;class Xd{static#e={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#t(e,t,n,r){return n-=e,r-=t,n===0?r>0?0:4:n===1?r+6:2-r}static#s=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#n(e,t,n,r,i,o,l){const d=this.#t(n,r,i,o);for(let h=0;h<8;h++){const p=(-h+d-l+16)%8,g=this.#s[2*p],b=this.#s[2*p+1];if(e[(n+g)*t+(r+b)]!==0)return p}return-1}static#i(e,t,n,r,i,o,l){const d=this.#t(n,r,i,o);for(let h=0;h<8;h++){const p=(h+d+l+16)%8,g=this.#s[2*p],b=this.#s[2*p+1];if(e[(n+g)*t+(r+b)]!==0)return p}return-1}static#a(e,t,n,r){const i=e.length,o=new Int32Array(i);for(let p=0;p<i;p++)o[p]=e[p]<=r?1:0;for(let p=1;p<n-1;p++)o[p*t]=o[p*t+t-1]=0;for(let p=0;p<t;p++)o[p]=o[t*n-1-p]=0;let l=1,d;const h=[];for(let p=1;p<n-1;p++){d=1;for(let g=1;g<t-1;g++){const b=p*t+g,x=o[b];if(x===0)continue;let w=p,v=g;if(x===1&&o[b-1]===0)l+=1,v-=1;else if(x>=1&&o[b+1]===0)l+=1,v+=1,x>1&&(d=x);else{x!==1&&(d=Math.abs(x));continue}const _=[g,p],N=v===g+1,E={isHole:N,points:_,id:l,parent:0};h.push(E);let k;for(const R of h)if(R.id===d){k=R;break}k?k.isHole?E.parent=N?k.parent:d:E.parent=N?d:k.parent:E.parent=N?d:0;const T=this.#n(o,t,p,g,w,v,0);if(T===-1){o[b]=-l,o[b]!==1&&(d=Math.abs(o[b]));continue}let P=this.#s[2*T],O=this.#s[2*T+1];const F=p+P,$=g+O;w=F,v=$;let z=p,G=g;for(;;){const R=this.#i(o,t,z,G,w,v,1);P=this.#s[2*R],O=this.#s[2*R+1];const q=z+P,J=G+O;_.push(J,q);const Z=z*t+G;if(o[Z+1]===0?o[Z]=-l:o[Z]===1&&(o[Z]=l),q===p&&J===g&&z===F&&G===$){o[b]!==1&&(d=Math.abs(o[b]));break}else w=z,v=G,z=q,G=J}}}return h}static#r(e,t,n,r){if(n-t<=4){for(let F=t;F<n-2;F+=2)r.push(e[F],e[F+1]);return}const i=e[t],o=e[t+1],l=e[n-4]-i,d=e[n-3]-o,h=Math.hypot(l,d),p=l/h,g=d/h,b=p*o-g*i,x=d/l,w=1/h,v=Math.atan(x),_=Math.cos(v),N=Math.sin(v),E=w*(Math.abs(_)+Math.abs(N)),k=w*(1-E+E**2),T=Math.max(Math.atan(Math.abs(N+_)*k),Math.atan(Math.abs(N-_)*k));let P=0,O=t;for(let F=t+2;F<n-2;F+=2){const $=Math.abs(b-p*e[F+1]+g*e[F]);$>P&&(O=F,P=$)}P>(h*T)**2?(this.#r(e,t,O+2,r),this.#r(e,O,n,r)):r.push(i,o)}static#o(e){const t=[],n=e.length;return this.#r(e,0,n,t),t.push(e[n-2],e[n-1]),t.length<=4?null:t}static#c(e,t,n,r,i,o){const l=new Float32Array(o**2),d=-2*r**2,h=o>>1;for(let v=0;v<o;v++){const _=(v-h)**2;for(let N=0;N<o;N++)l[v*o+N]=Math.exp((_+(N-h)**2)/d)}const p=new Float32Array(256),g=-2*i**2;for(let v=0;v<256;v++)p[v]=Math.exp(v**2/g);const b=e.length,x=new Uint8Array(b),w=new Uint32Array(256);for(let v=0;v<n;v++)for(let _=0;_<t;_++){const N=v*t+_,E=e[N];let k=0,T=0;for(let O=0;O<o;O++){const F=v+O-h;if(!(F<0||F>=n))for(let $=0;$<o;$++){const z=_+$-h;if(z<0||z>=t)continue;const G=e[F*t+z],R=l[O*o+$]*p[Math.abs(G-E)];k+=G*R,T+=R}}const P=x[N]=Math.round(k/T);w[P]++}return[x,w]}static#l(e){const t=new Uint32Array(256);for(const n of e)t[n]++;return t}static#h(e){const t=e.length,n=new Uint8ClampedArray(t>>2);let r=-1/0,i=1/0;for(let l=0,d=n.length;l<d;l++){const h=n[l]=e[l<<2];r=Math.max(r,h),i=Math.min(i,h)}const o=255/(r-i);for(let l=0,d=n.length;l<d;l++)n[l]=(n[l]-i)*o;return n}static#d(e){let t,n=-1/0,r=-1/0;const i=e.findIndex(d=>d!==0);let o=i,l=i;for(t=i;t<256;t++){const d=e[t];d>n&&(t-o>r&&(r=t-o,l=t-1),n=d,o=t)}for(t=l-1;t>=0&&!(e[t]>e[t+1]);t--);return t}static#f(e){const t=e,{width:n,height:r}=e,{maxDim:i}=this.#e;let o=n,l=r;if(n>i||r>i){let b=n,x=r,w=Math.log2(Math.max(n,r)/i);const v=Math.floor(w);w=w===v?v-1:v;for(let N=0;N<w;N++){o=Math.ceil(b/2),l=Math.ceil(x/2);const E=new OffscreenCanvas(o,l);E.getContext("2d").drawImage(e,0,0,b,x,0,0,o,l),b=o,x=l,e!==t&&e.close(),e=E.transferToImageBitmap()}const _=Math.min(i/o,i/l);o=Math.round(o*_),l=Math.round(l*_)}const h=new OffscreenCanvas(o,l).getContext("2d",{willReadFrequently:!0});h.fillStyle="white",h.fillRect(0,0,o,l),h.filter="grayscale(1)",h.drawImage(e,0,0,e.width,e.height,0,0,o,l);const p=h.getImageData(0,0,o,l).data;return[this.#h(p),o,l]}static extractContoursFromText(e,{fontFamily:t,fontStyle:n,fontWeight:r},i,o,l,d){let h=new OffscreenCanvas(1,1),p=h.getContext("2d",{alpha:!1});const g=200,b=p.font=`${n} ${r} ${g}px ${t}`,{actualBoundingBoxLeft:x,actualBoundingBoxRight:w,actualBoundingBoxAscent:v,actualBoundingBoxDescent:_,fontBoundingBoxAscent:N,fontBoundingBoxDescent:E,width:k}=p.measureText(e),T=1.5,P=Math.ceil(Math.max(Math.abs(x)+Math.abs(w)||0,k)*T),O=Math.ceil(Math.max(Math.abs(v)+Math.abs(_)||g,Math.abs(N)+Math.abs(E)||g)*T);h=new OffscreenCanvas(P,O),p=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),p.font=b,p.filter="grayscale(1)",p.fillStyle="white",p.fillRect(0,0,P,O),p.fillStyle="black",p.fillText(e,P*(T-1)/2,O*(3-T)/2);const F=this.#h(p.getImageData(0,0,P,O).data),$=this.#l(F),z=this.#d($),G=this.#a(F,P,O,z);return this.processDrawnLines({lines:{curves:G,width:P,height:O},pageWidth:i,pageHeight:o,rotation:l,innerMargin:d,mustSmooth:!0,areContours:!0})}static process(e,t,n,r,i){const[o,l,d]=this.#f(e),[h,p]=this.#c(o,l,d,Math.hypot(l,d)*this.#e.sigmaSFactor,this.#e.sigmaR,this.#e.kernelSize),g=this.#d(p),b=this.#a(h,l,d,g);return this.processDrawnLines({lines:{curves:b,width:l,height:d},pageWidth:t,pageHeight:n,rotation:r,innerMargin:i,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:r,innerMargin:i,mustSmooth:o,areContours:l}){r%180!==0&&([t,n]=[n,t]);const{curves:d,width:h,height:p}=e,g=e.thickness??0,b=[],x=Math.min(t/h,n/p),w=x/t,v=x/n,_=[];for(const{points:E}of d){const k=o?this.#o(E):E;if(!k)continue;_.push(k);const T=k.length,P=new Float32Array(T),O=new Float32Array(3*(T===2?2:T-2));if(b.push({line:O,points:P}),T===2){P[0]=k[0]*w,P[1]=k[1]*v,O.set([NaN,NaN,NaN,NaN,P[0],P[1]],0);continue}let[F,$,z,G]=k;F*=w,$*=v,z*=w,G*=v,P.set([F,$,z,G],0),O.set([NaN,NaN,NaN,NaN,F,$],0);for(let R=4;R<T;R+=2){const q=P[R]=k[R]*w,J=P[R+1]=k[R+1]*v;O.set(Gt.createBezierPoints(F,$,z,G,q,J),(R-2)*3),[F,$,z,G]=[z,G,q,J]}}if(b.length===0)return null;const N=l?new V1:new n0;return N.build(b,t,n,1,r,l?0:g,i),{outline:N,newCurves:_,areContours:l,thickness:g,width:h,height:p}}static async compressSignature({outlines:e,areContours:t,thickness:n,width:r,height:i}){let o=1/0,l=-1/0,d=0;for(const k of e){d+=k.length;for(let T=2,P=k.length;T<P;T++){const O=k[T]-k[T-2];o=Math.min(o,O),l=Math.max(l,O)}}let h;o>=-128&&l<=127?h=Int8Array:o>=-32768&&l<=32767?h=Int16Array:h=Int32Array;const p=e.length,g=hp+mf*p,b=new Uint32Array(g);let x=0;b[x++]=g*Uint32Array.BYTES_PER_ELEMENT+(d-2*p)*h.BYTES_PER_ELEMENT,b[x++]=0,b[x++]=r,b[x++]=i,b[x++]=t?0:1,b[x++]=Math.max(0,Math.floor(n??0)),b[x++]=p,b[x++]=h.BYTES_PER_ELEMENT;for(const k of e)b[x++]=k.length-2,b[x++]=k[0],b[x++]=k[1];const w=new CompressionStream("deflate-raw"),v=w.writable.getWriter();await v.ready,v.write(b);const _=h.prototype.constructor;for(const k of e){const T=new _(k.length-2);for(let P=2,O=k.length;P<O;P++)T[P-2]=k[P]-k[P-2];v.write(T)}v.close();const N=await new Response(w.readable).arrayBuffer();return new Uint8Array(N).toBase64()}static async decompressSignature(e){try{const t=Uint8Array.fromBase64(e),{readable:n,writable:r}=new DecompressionStream("deflate-raw"),i=r.getWriter();await i.ready,i.write(t).then(async()=>{await i.ready,await i.close()}).catch(()=>{});let o=null,l=0;for await(const k of n)o||=new Uint8Array(new Uint32Array(k.buffer,0,4)[0]),o.set(k,l),l+=k.length;const d=new Uint32Array(o.buffer,0,o.length>>2),h=d[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const p=d[2],g=d[3],b=d[4]===0,x=d[5],w=d[6],v=d[7],_=[],N=(hp+mf*w)*Uint32Array.BYTES_PER_ELEMENT;let E;switch(v){case Int8Array.BYTES_PER_ELEMENT:E=new Int8Array(o.buffer,N);break;case Int16Array.BYTES_PER_ELEMENT:E=new Int16Array(o.buffer,N);break;case Int32Array.BYTES_PER_ELEMENT:E=new Int32Array(o.buffer,N);break}l=0;for(let k=0;k<w;k++){const T=d[mf*k+hp],P=new Float32Array(T+2);_.push(P);for(let O=0;O<mf-1;O++)P[O]=d[mf*k+hp+O+1];for(let O=0;O<T;O++)P[O+2]=P[O]+E[l++]}return{areContours:b,thickness:x,outlines:_,width:p,height:g}}catch(t){return Sn(`decompressSignature: ${t}`),null}}}class Mb extends l4{constructor(){super(),super.updateProperties({fill:cn._defaultLineColor,"stroke-width":0})}clone(){const e=new Mb;return e.updateAll(this),e}}class Fb extends nm{constructor(e){super(e),super.updateProperties({stroke:cn._defaultLineColor,"stroke-width":1})}clone(){const e=new Fb(this._viewParameters);return e.updateAll(this),e}}class al extends is{#e=!1;#t=null;#s=null;#n=null;static _type="signature";static _editorType=Tn.SIGNATURE;static _defaultDrawingOptions=null;constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#s=e.signatureData||null,this.#t=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,t){cn.initialize(e,t),this._defaultDrawingOptions=new Mb,this._defaultDrawnSignatureOptions=new Fb(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!1}static get typesMap(){return _n(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#t}}static computeTelemetryFinalData(e){const t=e.get("hasDescription");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,t;const{_isCopy:n}=this;if(n&&(this._isCopy=!1,e=this.x,t=this.y),super.render(),this._drawId===null)if(this.#s){const{lines:r,mustSmooth:i,areContours:o,description:l,uuid:d,heightInPage:h}=this.#s,{rawDims:{pageWidth:p,pageHeight:g},rotation:b}=this.parent.viewport,x=Xd.processDrawnLines({lines:r,pageWidth:p,pageHeight:g,rotation:b,innerMargin:al._INNER_MARGIN,mustSmooth:i,areContours:o});this.addSignature(x,h,l,d)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#t||""}));return n&&(this._isCopy=!0,this._moveAfterPaste(e,t)),this.div}setUuid(e){this.#n=e,this.addEditToolbar()}getUuid(){return this.#n}get description(){return this.#t}set description(e){this.#t=e,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:e})),super.addEditToolbar().then(t=>{t?.updateEditSignatureButton(e)}))}getSignaturePreview(){const{newCurves:e,areContours:t,thickness:n,width:r,height:i}=this.#s,o=Math.max(r,i),l=Xd.processDrawnLines({lines:{curves:e.map(d=>({points:d})),thickness:n,width:r,height:i},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:t});return{areContours:t,outline:l.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,t,n,r){const{x:i,y:o}=this,{outline:l}=this.#s=e;this.#e=l instanceof V1,this.description=n;let d;this.#e?d=al.getDefaultDrawingOptions():(d=al._defaultDrawnSignatureOptions.clone(),d.updateProperties({"stroke-width":l.thickness})),this._addOutlines({drawOutlines:l,drawingOptions:d});const[,h]=this.pageDimensions;let p=t/h;p=p>=1?.5:p,this.width*=p/this.height,this.width>=1&&(p*=.9/this.width,this.width=.9),this.height=p,this.setDims(),this.x=i,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(r),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!r,hasDescription:!!n}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:t,pageHeight:n},rotation:r}=this.parent.viewport;return Xd.process(e,t,n,r,al._INNER_MARGIN)}getFromText(e,t){const{rawDims:{pageWidth:n,pageHeight:r},rotation:i}=this.parent.viewport;return Xd.extractContoursFromText(e,t,n,r,i,al._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:t,pageHeight:n},rotation:r}=this.parent.viewport;return Xd.processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:r,innerMargin:al._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:t}){e?this._drawingOptions=al.getDefaultDrawingOptions():(this._drawingOptions=al._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":t}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:t,points:n}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":r}}=this,i=Object.assign(super.serialize(e),{isSignature:!0,areContours:this.#e,color:[0,0,0],thickness:this.#e?0:r});return this.addComment(i),e?(i.paths={lines:t,points:n},i.uuid=this.#n,i.isCopy=!0):i.lines=t,this.#t&&(i.accessibilityData={type:"Figure",alt:this.#t}),i}static deserializeDraw(e,t,n,r,i,o){return o.areContours?V1.deserialize(e,t,n,r,i,o):n0.deserialize(e,t,n,r,i,o)}static async deserialize(e,t,n){const r=await super.deserialize(e,t,n);return r.#e=e.areContours,r.description=e.accessibilityData?.alt||"",r.#n=e.uuid,r}}class sL extends cn{#e=null;#t=null;#s=null;#n=null;#i=null;#a="";#r=null;#o=!1;#c=null;#l=!1;#h=!1;static _type="stamp";static _editorType=Tn.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#n=e.bitmapUrl,this.#i=e.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,t){cn.initialize(e,t)}static isHandlingMimeForPasting(e){return I1.includes(e)}static paste(e,t){t.pasteEditor({mode:Tn.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){const t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#d(e,t=!1){if(!e){this.remove();return}this.#e=e.bitmap,t||(this.#t=e.id,this.#l=e.isSvg),e.file&&(this.#a=e.file.name),this.#g()}#f(){if(this.#s=null,this._uiManager.enableWaiting(!1),!!this.#r){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(e=null,t=!0){if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:i,height:o}=e||this.copyCanvas(null,null,!0).imageData,l=await n.guess({name:"altText",request:{data:r,width:i,height:o,channels:r.length/(i*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const d=l.output;return await this.setGuessedAltText(d),t&&!this.hasAltTextData()&&(this.altTextData={alt:d,decorative:!1}),d}#m(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(n=>this.#d(n,!0)).finally(()=>this.#f());return}if(this.#n){const n=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromUrl(n).then(r=>this.#d(r)).finally(()=>this.#f());return}if(this.#i){const n=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromFile(n).then(r=>this.#d(r)).finally(()=>this.#f());return}const e=document.createElement("input");e.type="file",e.accept=I1.join(",");const t=this._uiManager._signal;this.#s=new Promise(n=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#d(r)}n()},{signal:t}),e.addEventListener("cancel",()=>{this.remove(),n()},{signal:t})}).finally(()=>this.#f()),e.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#r?.remove(),this.#r=null,this.#c&&(clearTimeout(this.#c),this.#c=null)),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#m();return}super.rebuild(),this.div!==null&&(this.#t&&this.#r===null&&this.#m(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#s||this.#e||this.#n||this.#i||this.#t||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;return this._isCopy&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#e?this.#g():this.#m()),this._isCopy&&this._moveAfterPaste(e,t),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,t){const{id:n,bitmap:r}=this._uiManager.imageManager.getFromCanvas(e,t);t.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(this.#t=n,r&&(this.#e=r),this.#o=!1,this.#g())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#c!==null&&clearTimeout(this.#c);const e=200;this.#c=setTimeout(()=>{this.#c=null,this.#p()},e)}#g(){const{div:e}=this;let{width:t,height:n}=this.#e;const[r,i]=this.pageDimensions,o=.75;if(this.width)t=this.width*r,n=this.height*i;else if(t>o*r||n>o*i){const d=Math.min(o*r/t,o*i/n);t*=d,n*=d}this._uiManager.enableWaiting(!1);const l=this.#r=document.createElement("canvas");l.setAttribute("role","img"),this.addContainer(l),this.width=t/r,this.height=n/i,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#p(),this.#h||(this.parent.addUndoableEditor(this),this.#h=!0),this._reportTelemetry({action:"inserted_image"}),this.#a&&this.div.setAttribute("aria-description",this.#a),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(e,t,n=!1){e||(e=224);const{width:r,height:i}=this.#e,o=new hl;let l=this.#e,d=r,h=i,p=null;if(t){if(r>t||i>t){const O=Math.min(t/r,t/i);d=Math.floor(r*O),h=Math.floor(i*O)}p=document.createElement("canvas");const b=p.width=Math.ceil(d*o.sx),x=p.height=Math.ceil(h*o.sy);this.#l||(l=this.#u(b,x));const w=p.getContext("2d");w.filter=this._uiManager.hcmFilter;let v="white",_="#cfcfd8";this._uiManager.hcmFilter!=="none"?_="black":AT.isDarkMode&&(v="#8f8f9d",_="#42414d");const N=15,E=N*o.sx,k=N*o.sy,T=new OffscreenCanvas(E*2,k*2),P=T.getContext("2d");P.fillStyle=v,P.fillRect(0,0,E*2,k*2),P.fillStyle=_,P.fillRect(0,0,E,k),P.fillRect(E,k,E,k),w.fillStyle=w.createPattern(T,"repeat"),w.fillRect(0,0,b,x),w.drawImage(l,0,0,l.width,l.height,0,0,b,x)}let g=null;if(n){let b,x;if(o.symmetric&&l.width<e&&l.height<e)b=l.width,x=l.height;else if(l=this.#e,r>e||i>e){const _=Math.min(e/r,e/i);b=Math.floor(r*_),x=Math.floor(i*_),this.#l||(l=this.#u(b,x))}const v=new OffscreenCanvas(b,x).getContext("2d",{willReadFrequently:!0});v.drawImage(l,0,0,l.width,l.height,0,0,b,x),g={width:b,height:x,data:v.getImageData(0,0,b,x).data}}return{canvas:p,width:d,height:h,imageData:g}}#u(e,t){const{width:n,height:r}=this.#e;let i=n,o=r,l=this.#e;for(;i>2*e||o>2*t;){const d=i,h=o;i>2*e&&(i=i>=16384?Math.floor(i/2)-1:Math.ceil(i/2)),o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const p=new OffscreenCanvas(i,o);p.getContext("2d").drawImage(l,0,0,d,h,0,0,i,o),l=p.transferToImageBitmap()}return l}#p(){const[e,t]=this.parentDimensions,{width:n,height:r}=this,i=new hl,o=Math.ceil(n*e*i.sx),l=Math.ceil(r*t*i.sy),d=this.#r;if(!d||d.width===o&&d.height===l)return;d.width=o,d.height=l;const h=this.#l?this.#e:this.#u(o,l),p=d.getContext("2d");p.filter=this._uiManager.hcmFilter,p.drawImage(h,0,0,h.width,h.height,0,0,o,l)}#x(e){if(e){if(this.#l){const r=this._uiManager.imageManager.getSvgUrl(this.#t);if(r)return r}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#e,t.getContext("2d").drawImage(this.#e,0,0),t.toDataURL()}if(this.#l){const[t,n]=this.pageDimensions,r=Math.round(this.width*t*bh.PDF_TO_CSS_UNITS),i=Math.round(this.height*n*bh.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(r,i);return o.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,r,i),o.transferToImageBitmap()}return structuredClone(this.#e)}static async deserialize(e,t,n){let r=null,i=!1;if(e instanceof a4){const{data:{rect:v,rotation:_,id:N,structParent:E,popupRef:k,richText:T,contentsObj:P,creationDate:O,modificationDate:F},container:$,parent:{page:{pageNumber:z}},canvas:G}=e;let R,q;G?(delete e.canvas,{id:R,bitmap:q}=n.imageManager.getFromCanvas($.id,G),G.remove()):(i=!0,e._hasNoCanvas=!0);const J=(await t._structTree.getAriaAttributes(`${eh}${N}`))?.get("aria-label")||"";r=e={annotationType:Tn.STAMP,bitmapId:R,bitmap:q,pageIndex:z-1,rect:v.slice(0),rotation:_,annotationElementId:N,id:N,deleted:!1,accessibilityData:{decorative:!1,altText:J},isSvg:!1,structParent:E,popupRef:k,richText:T,comment:P?.str||null,creationDate:O,modificationDate:F}}const o=await super.deserialize(e,t,n),{rect:l,bitmap:d,bitmapUrl:h,bitmapId:p,isSvg:g,accessibilityData:b}=e;i?(n.addMissingCanvas(e.id,o),o.#o=!0):p&&n.imageManager.isValidId(p)?(o.#t=p,d&&(o.#e=d)):o.#n=h,o.#l=g;const[x,w]=o.pageDimensions;return o.width=(l[2]-l[0])/x,o.height=(l[3]-l[1])/w,b&&(o.altTextData=b),o._initialData=r,e.comment&&o.setCommentData(e),o.#h=!!r,o}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=Object.assign(super.serialize(e),{bitmapId:this.#t,isSvg:this.#l});if(this.addComment(n),e)return n.bitmapUrl=this.#x(!0),n.accessibilityData=this.serializeAltText(!0),n.isCopy=!0,n;const{decorative:r,altText:i}=this.serializeAltText(!1);if(!r&&i&&(n.accessibilityData={type:"Figure",alt:i}),this.annotationElementId){const l=this.#y(n);return l.isSame?null:(l.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1,n.id=this.annotationElementId,delete n.bitmapId,n)}if(t===null)return n;t.stamps||=new Map;const o=this.#l?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!t.stamps.has(this.#t))t.stamps.set(this.#t,{area:o,serialized:n}),n.bitmap=this.#x(!1);else if(this.#l){const l=t.stamps.get(this.#t);o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=this.#x(!1))}return n}#y(e){const{pageIndex:t,accessibilityData:{altText:n}}=this._initialData,r=e.pageIndex===t,i=(e.accessibilityData?.alt||"")===n;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&r&&i,isSameAltText:i}}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class Vl{#e;#t=!1;#s=null;#n=null;#i=null;#a=new Map;#r=!1;#o=!1;#c=!1;#l=null;#h=null;#d=null;#f=null;#m=null;#g=-1;#u;static _initialized=!1;static#p=new Map([Zr,Ib,sL,mr,al].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:r,accessibilityManager:i,annotationLayer:o,drawLayer:l,textLayer:d,viewport:h,l10n:p}){const g=[...Vl.#p.values()];if(!Vl._initialized){Vl._initialized=!0;for(const b of g)b.initialize(p,e)}e.registerEditorTypes(g),this.#u=e,this.pageIndex=t,this.div=n,this.#e=i,this.#s=o,this.viewport=h,this.#d=d,this.drawLayer=l,this._structTree=r,this.#u.addLayer(this)}updatePageIndex(e){this.pageIndex=e}get isEmpty(){return this.#a.size===0}get isInvisible(){return this.isEmpty&&this.#u.getMode()===Tn.NONE}updateToolbar(e){this.#u.updateToolbar(e)}updateMode(e=this.#u.getMode()){switch(this.#w(),e){case Tn.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Tn.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Tn.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===Tn.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const n of Vl.#p.values())t.toggle(`${n._type}Editing`,e===n._editorType)}this.div.hidden=!1}hasTextLayer(e){return e===this.#d?.div}setEditingState(e){this.#u.setEditingState(e)}addCommands(e){this.#u.addCommands(e)}cleanUndoStack(e){this.#u.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#s?.togglePointerEvents(e)}get#x(){return this.#a.size!==0?this.#a.values():this.#u.getEditors(this.pageIndex)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#m?.abort(),this.#m=null;const e=new Set;for(const n of this.#x)n.enableEditing(),n.show(!0),n.annotationElementId&&(this.#u.removeChangedExistingAnnotation(n),e.add(n.annotationElementId));const t=this.#s;if(t)for(const n of t.getEditableAnnotations()){if(n.hide(),this.#u.isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;const r=await this.deserialize(n);r&&(this.addOrRebuild(r),r.enableEditing())}this.#c=!1,this.#u._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#d&&!this.#m){this.#m=new AbortController;const r=this.#u.combinedSignal(this.#m);this.#d.div.addEventListener("pointerdown",i=>{const{clientX:l,clientY:d,timeStamp:h}=i,p=this.#g;if(h-p>500){this.#g=h;return}this.#g=-1;const{classList:g}=this.div;g.toggle("getElements",!0);const b=document.elementsFromPoint(l,d);if(g.toggle("getElements",!1),!this.div.contains(b[0]))return;let x;const w=new RegExp(`^${zf}[0-9]+$`);for(const _ of b)if(w.test(_.id)){x=_.id;break}if(!x)return;const v=this.#a.get(x);v?.annotationElementId===null&&(i.stopPropagation(),i.preventDefault(),v.dblclick(i))},{signal:r,capture:!0})}const e=this.#s,t=[];if(e){const r=new Map,i=new Map;for(const l of this.#x){if(l.disableEditing(),!l.annotationElementId){t.push(l);continue}if(l.serialize()!==null){r.set(l.annotationElementId,l);continue}else i.set(l.annotationElementId,l);this.getEditableAnnotation(l.annotationElementId)?.show(),l.remove()}const o=e.getEditableAnnotations();for(const l of o){const{id:d}=l.data;if(this.#u.isDeletedAnnotationElement(d)){l.updateEdited({deleted:!0});continue}let h=i.get(d);if(h){h.resetAnnotationElement(l),h.show(!1),l.show();continue}h=r.get(d),h&&(this.#u.addChangedExistingAnnotation(h),h.renderAnnotationElement(l)&&h.show(!1)),l.show()}}this.#w(),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const r of Vl.#p.values())n.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),e?.updateFakeAnnotations(t),this.#o=!1}getEditableAnnotation(e){return this.#s?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#u.getActive()!==e&&this.#u.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#d?.div&&!this.#f){this.#f=new AbortController;const e=this.#u.combinedSignal(this.#f);this.#d.div.addEventListener("pointerdown",this.#y.bind(this),{signal:e}),this.#d.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#d?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#d.div.classList.remove("highlighting"))}#y(e){this.#u.unselectAll();const{target:t}=e;if(t===this.#d.div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&this.#d.div.contains(t)){const{isMac:n}=qr.platform;if(e.button!==0||e.ctrlKey&&n)return;this.#u.showAllEditors("highlight",!0,!0),this.#d.div.classList.add("free"),this.toggleDrawing(),mr.startHighlighting(this,this.#u.direction==="ltr",{target:this.#d.div,x:e.x,y:e.y}),this.#d.div.addEventListener("pointerup",()=>{this.#d.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#u._signal}),e.preventDefault()}}enableClick(){if(this.#n)return;this.#n=new AbortController;const e=this.#u.combinedSignal(this.#n);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){this.#n?.abort(),this.#n=null}attach(e){this.#a.set(e.id,e);const{annotationElementId:t}=e;t&&this.#u.isDeletedAnnotationElement(t)&&this.#u.removeDeletedAnnotationElement(e)}detach(e){this.#a.delete(e.id),this.#e?.removePointerInTextLayer(e.contentDiv),!this.#o&&e.annotationElementId&&this.#u.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#u.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#u.addDeletedAnnotationElement(e),cn.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),this.#u.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#c),this.#u.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!this.#i&&(e._focusEventsAllowed=!1,this.#i=setTimeout(()=>{this.#i=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#u._signal}),t.focus())},0)),e._structTreeParentId=this.#e?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getEditorByUID(e){for(const t of this.#a.values())if(t.uid===e)return t;return null}getNextId(){return this.#u.getId()}get#b(){return Vl.#p.get(this.#u.getMode())}combinedSignal(e){return this.#u.combinedSignal(e)}#N(e){const t=this.#b;return t?new t.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#b?.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await this.#u.updateMode(e.mode);const{offsetX:n,offsetY:r}=this.#_(),i=this.getNextId(),o=this.#N({parent:this,id:i,x:n,y:r,uiManager:this.#u,isCentered:!0,...t});o&&this.add(o)}async deserialize(e){return await Vl.#p.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#u)||null}createAndAddNewEditor(e,t,n={}){const r=this.getNextId(),i=this.#N({parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:this.#u,isCentered:t,...n});return i&&this.add(i),i}get boundingClientRect(){return this.div.getBoundingClientRect()}#_(){const{x:e,y:t,width:n,height:r}=this.boundingClientRect,i=Math.max(0,e),o=Math.max(0,t),l=Math.min(window.innerWidth,e+n),d=Math.min(window.innerHeight,t+r),h=(i+l)/2-e,p=(o+d)/2-t,[g,b]=this.viewport.rotation%180===0?[h,p]:[p,h];return{offsetX:g,offsetY:b}}addNewEditor(e={}){this.createAndAddNewEditor(this.#_(),!0,e)}setSelected(e){this.#u.setSelected(e)}toggleSelected(e){this.#u.toggleSelected(e)}unselect(e){this.#u.unselect(e)}pointerup(e){const{isMac:t}=qr.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!this.#r||(this.#r=!1,this.#b?.isDrawer&&this.#b.supportMultipleDrawings))return;if(!this.#t){this.#t=!0;return}const n=this.#u.getMode();if(n===Tn.STAMP||n===Tn.SIGNATURE){this.#u.unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){if(this.#u.getMode()===Tn.HIGHLIGHT&&this.enableTextSelection(),this.#r){this.#r=!1;return}const{isMac:t}=qr.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(this.#r=!0,this.#b?.isDrawer){this.startDrawingSession(e);return}const n=this.#u.getActive();this.#t=!n||n.isEmpty()}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),this.#l){this.#b.startDrawing(this,this.#u,!1,e);return}this.#u.setCurrentDrawingSession(this),this.#l=new AbortController;const t=this.#u.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(this.#h=null,this.commitOrRemove())},{signal:t}),this.#b.startDrawing(this,this.#u,!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&(this.#h=t);return}this.#h&&setTimeout(()=>{this.#h?.focus(),this.#h=null},0)}endDrawingSession(e=!1){return this.#l?(this.#u.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#h=null,this.#b.endDrawing(e)):null}findNewParent(e,t,n){const r=this.#u.findParent(t,n);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#b.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#u.getActive()?.parent===this&&(this.#u.commitOrRemove(),this.#u.setActiveEditor(null)),this.#i&&(clearTimeout(this.#i),this.#i=null);for(const e of this.#a.values())this.#e?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#a.clear(),this.#u.removeLayer(this)}#w(){for(const e of this.#a.values())e.isEmpty()&&e.remove()}render({viewport:e}){this.viewport=e,Ou(this.div,e);for(const t of this.#u.getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){this.#u.commitOrRemove(),this.#w();const t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,Ou(this.div,{rotation:n}),t!==n)for(const r of this.#a.values())r.rotate(n)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return this.#u.viewParameters.realScale}}class hi{#e=null;#t=new Map;#s=new Map;static#n=0;setParent(e){if(!this.#e){this.#e=e;return}if(this.#e!==e){if(this.#t.size>0)for(const t of this.#t.values())t.remove(),e.append(t);this.#e=e}}static get _svgFactory(){return _n(this,"_svgFactory",new kg)}static#i(e,[t,n,r,i]){const{style:o}=e;o.top=`${100*n}%`,o.left=`${100*t}%`,o.width=`${100*r}%`,o.height=`${100*i}%`}#a(){const e=hi._svgFactory.create(1,1,!0);return this.#e.append(e),e.setAttribute("aria-hidden",!0),e}#r(e,t){const n=hi._svgFactory.createElement("clipPath");e.append(n);const r=`clip_${t}`;n.setAttribute("id",r),n.setAttribute("clipPathUnits","objectBoundingBox");const i=hi._svgFactory.createElement("use");return n.append(i),i.setAttribute("href",`#${t}`),i.classList.add("clip"),r}#o(e,t){for(const[n,r]of Object.entries(t))r===null?e.removeAttribute(n):e.setAttribute(n,r)}draw(e,t=!1,n=!1){const r=hi.#n++,i=this.#a(),o=hi._svgFactory.createElement("defs");i.append(o);const l=hi._svgFactory.createElement("path");o.append(l);const d=`path_${r}`;l.setAttribute("id",d),l.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#s.set(r,l);const h=n?this.#r(o,d):null,p=hi._svgFactory.createElement("use");return i.append(p),p.setAttribute("href",`#${d}`),this.updateProperties(i,e),this.#t.set(r,i),{id:r,clipPathId:`url(#${h})`}}drawOutline(e,t){const n=hi.#n++,r=this.#a(),i=hi._svgFactory.createElement("defs");r.append(i);const o=hi._svgFactory.createElement("path");i.append(o);const l=`path_${n}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke");let d;if(t){const g=hi._svgFactory.createElement("mask");i.append(g),d=`mask_${n}`,g.setAttribute("id",d),g.setAttribute("maskUnits","objectBoundingBox");const b=hi._svgFactory.createElement("rect");g.append(b),b.setAttribute("width","1"),b.setAttribute("height","1"),b.setAttribute("fill","white");const x=hi._svgFactory.createElement("use");g.append(x),x.setAttribute("href",`#${l}`),x.setAttribute("stroke","none"),x.setAttribute("fill","black"),x.setAttribute("fill-rule","nonzero"),x.classList.add("mask")}const h=hi._svgFactory.createElement("use");r.append(h),h.setAttribute("href",`#${l}`),d&&h.setAttribute("mask",`url(#${d})`);const p=h.cloneNode();return r.append(p),h.classList.add("mainOutline"),p.classList.add("secondaryOutline"),this.updateProperties(r,e),this.#t.set(n,r),n}finalizeDraw(e,t){this.#s.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;const{root:n,bbox:r,rootClass:i,path:o}=t,l=typeof e=="number"?this.#t.get(e):e;if(l){if(n&&this.#o(l,n),r&&hi.#i(l,r),i){const{classList:d}=l;for(const[h,p]of Object.entries(i))d.toggle(h,p)}if(o){const h=l.firstElementChild.firstElementChild;this.#o(h,o)}}}updateParent(e,t){if(t===this)return;const n=this.#t.get(e);n&&(t.#e.append(n),this.#t.delete(e),t.#t.set(e,n))}remove(e){this.#s.delete(e),this.#e!==null&&(this.#t.get(e).remove(),this.#t.delete(e))}destroy(){this.#e=null;for(const e of this.#t.values())e.remove();this.#t.clear(),this.#s.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:H1};globalThis.pdfjsLib={AbortException:Gc,AnnotationEditorLayer:Vl,AnnotationEditorParamsType:Wn,AnnotationEditorType:Tn,AnnotationEditorUIManager:Vc,AnnotationLayer:Ob,AnnotationMode:Fc,AnnotationType:Er,applyOpacity:CT,build:RD,ColorPicker:Ya,createValidAbsoluteUrl:k_,CSSConstants:NT,DOMSVGFactory:kg,DrawLayer:hi,FeatureTest:qr,fetchData:Zf,findContrastColor:ET,getDocument:Z_,getFilenameFromUrl:yT,getPdfFilenameFromUrl:vT,getRGB:e0,getUuid:T_,getXfaPageViewport:ST,GlobalWorkerOptions:ch,ImageKind:ig,InvalidPDFException:B1,isDataScheme:Kg,isPdfFile:Cb,isValidExplicitDest:MT,MathClamp:fi,noContextMenu:Xa,normalizeUnicode:xT,OPS:$f,OutputScale:hl,PagesMapper:as,PasswordResponses:oT,PDFDataRangeTransport:Q_,PDFDateString:O1,PDFWorker:Hf,PermissionFlag:aT,PixelsPerInch:bh,RenderingCancelledException:Nb,renderRichText:L_,ResponseException:Cg,setLayerDimensions:Ou,shadow:_n,SignatureExtractor:Xd,stopEvent:hr,SupportedImageMimeTypes:I1,TextLayer:Sa,TouchManager:Xg,updateUrlHash:j_,Util:qt,VerbosityLevel:Gg,version:LD,XfaLayer:D_};const rL="/assets/pdf.worker.min-wgc6bjNh.mjs",iL=[{name:"Yellow",color:"#fef08a"},{name:"Green",color:"#bbf7d0"},{name:"Pink",color:"#fbcfe8"},{name:"None",color:"transparent"}],aL=({tool:s,setTool:e,color:t,setColor:n,size:r,setSize:i,onUpload:o,onZoomIn:l,onZoomOut:d,gridMode:h,setGridMode:p,page:g,totalPages:b,onPrevPage:x,onNextPage:w,onAddPage:v,onDeletePage:_,onClear:N,onUndo:E,onRedo:k,isDocumentPage:T=!1,onDocHighlight:P,onDocTextColor:O,onDocHighlightPopoverOpen:F})=>{const $=[{id:"pan",icon:m6,label:"Hand (Grab)"},{id:"pen",icon:j6,label:"Pen"},{id:"highlighter",icon:b6,label:"Highlighter"},{id:"text",icon:W6,label:"Text Box"},{id:"eraser",icon:l6,label:"Eraser"},{id:"screenshare",icon:dl,label:"Share Screen"}],z=["#0B2545","#14B8A6","#EF4444","#F59E0B","#10B981","#FFFF00"],[G,R]=ra.useState(!1),[q,J]=ra.useState(!1);return u.jsxs("div",{className:"w-20 h-full bg-white border-r border-brand-light flex flex-col items-center py-2 gap-2 shadow-lg z-20 overflow-y-auto pb-20 scrollbar-none",children:[u.jsx("div",{className:"flex flex-col gap-1 w-full px-2",children:$.map(Z=>Z.id==="highlighter"&&T&&typeof P=="function"?u.jsxs("div",{className:"relative flex flex-col items-center",children:[u.jsx("button",{onMouseDown:le=>{le.preventDefault(),!q&&typeof F=="function"&&F()},onClick:()=>J(!q),className:`w-10 h-10 min-w-0 min-h-0 tap-target-bypass rounded-lg transition-all flex items-center justify-center border-2 mx-auto ${q?"bg-purple-600 text-white border-purple-800":"bg-transparent text-gray-400 border-transparent hover:bg-purple-50 hover:text-purple-700"}`,title:"Highlight (document)",children:u.jsx(Z.icon,{size:18,strokeWidth:2})}),q&&u.jsx("div",{className:"absolute left-full ml-1 top-0 py-1.5 px-2 bg-white border border-gray-200 rounded-lg shadow-lg z-[100] flex flex-col gap-1 min-w-[88px]",children:iL.map(({name:le,color:K})=>u.jsx("button",{type:"button",onMouseDown:se=>se.preventDefault(),onClick:()=>{P(K),J(!1)},className:`text-left px-2 py-1 rounded text-xs font-bold ${K==="transparent"?"bg-gray-100 text-gray-600 border border-gray-200":""}`,style:K!=="transparent"?{backgroundColor:K,color:"#1f2937"}:{},children:le},le))})]},Z.id):u.jsx("button",{onClick:()=>{Z.id==="screenshare"?(window.dispatchEvent(new CustomEvent("toggleScreenShare")),R(!G)):(e(Z.id),Z.id==="highlighter"&&n("#FFFF00"))},className:`w-10 h-10 min-w-0 min-h-0 tap-target-bypass rounded-lg transition-all flex items-center justify-center border-2 mx-auto ${Z.id==="screenshare"&&G?"bg-red-500 text-white border-red-600 ring-2 ring-red-200":s===Z.id?"bg-purple-600 text-white border-purple-800 shadow-lg scale-110":"bg-transparent text-gray-400 border-transparent hover:bg-purple-50 hover:text-purple-700"} ${Z.id==="pan"?"ring-1 ring-black/5 outline outline-1 outline-black/20":""}`,title:Z.id==="screenshare"?G?"Stop Sharing":"Share Screen":Z.label,children:Z.id==="screenshare"&&G?u.jsx(l_,{size:18}):u.jsx(Z.icon,{size:18,strokeWidth:s===Z.id?2.5:2})},Z.id))}),u.jsx("div",{className:"h-px w-10 bg-gray-200"}),u.jsxs("label",{className:"w-full min-h-10 px-2 py-2 tap-target-bypass text-gray-500 hover:bg-brand-light hover:text-brand-navy rounded-lg cursor-pointer transition-all flex flex-col items-center justify-center gap-1 border border-gray-200",title:"Upload Image/PDF",children:[u.jsx(d6,{size:20,strokeWidth:2,className:"shrink-0"}),u.jsx("span",{className:"text-[10px] font-bold",children:"File"}),u.jsx("input",{type:"file",accept:"application/pdf,image/*",className:"hidden",onChange:o})]}),u.jsx("div",{className:"h-px w-10 bg-gray-200"}),u.jsxs("div",{className:"flex flex-col gap-2",children:[u.jsx("div",{className:"flex gap-2",children:z.slice(0,3).map(Z=>u.jsx("button",{onMouseDown:T&&O?le=>le.preventDefault():void 0,onClick:()=>{T&&typeof O=="function"?O(Z):(n(Z),s==="eraser"&&e("pen"))},className:`w-3 h-3 min-w-0 min-h-0 tap-target-bypass rounded-full transition-all border ${t===Z&&s!=="eraser"?"border-brand-navy scale-125":"border-transparent hover:scale-110"}`,style:{backgroundColor:Z}},Z))}),u.jsx("div",{className:"flex gap-2",children:z.slice(3).map(Z=>u.jsx("button",{onMouseDown:T&&O?le=>le.preventDefault():void 0,onClick:()=>{T&&typeof O=="function"?O(Z):(n(Z),s==="eraser"&&e("pen"))},className:`w-3 h-3 min-w-0 min-h-0 tap-target-bypass rounded-full transition-all border ${t===Z&&s!=="eraser"?"border-brand-navy scale-125":"border-transparent hover:scale-110"}`,style:{backgroundColor:Z}},Z))})]}),u.jsx("div",{className:"h-px w-10 bg-gray-200"}),u.jsxs("div",{className:"flex flex-col items-center gap-1 w-full px-2",children:[u.jsx("span",{className:"text-[10px] uppercase font-bold text-gray-400",children:"Size"}),u.jsx("input",{type:"range",min:"1",max:"40",value:r,onChange:Z=>i(Number(Z.target.value)),className:"w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-teal",title:"Pen Size"}),u.jsxs("span",{className:"text-[10px] font-bold text-brand-navy",children:[r,"px"]})]}),u.jsx("div",{className:"h-px w-10 bg-gray-200"}),u.jsxs("div",{className:"flex flex-col gap-1",children:[u.jsxs("div",{className:"flex gap-1",children:[u.jsx("button",{onClick:l,className:"w-8 h-8 min-w-0 min-h-0 tap-target-bypass text-gray-400 hover:text-brand-teal bg-gray-50 rounded-lg flex items-center justify-center border border-gray-100",title:"Zoom In",children:u.jsx(rE,{size:16})}),u.jsx("button",{onClick:d,className:"w-8 h-8 min-w-0 min-h-0 tap-target-bypass text-gray-400 hover:text-brand-teal bg-gray-50 rounded-lg flex items-center justify-center border border-gray-100",title:"Zoom Out",children:u.jsx(aE,{size:16})})]}),u.jsxs("button",{onClick:()=>p(!h),className:`w-[68px] h-8 min-w-0 min-h-0 tap-target-bypass flex items-center justify-center gap-2 transition-colors rounded-lg border text-[10px] font-bold ${h?"bg-brand-teal text-white border-brand-teal":"bg-gray-50 text-gray-400 border-gray-100"}`,title:"Toggle Grid",children:[u.jsx(p6,{size:16})," Grid"]})]}),u.jsx("div",{className:"h-px w-10 bg-gray-200"}),u.jsxs("div",{className:"flex flex-col gap-1 items-center",children:[u.jsxs("div",{className:"flex gap-1",children:[u.jsx("button",{onClick:E,className:"w-8 h-8 min-w-0 min-h-0 tap-target-bypass text-gray-500 hover:text-brand-navy hover:bg-gray-100 rounded-lg flex items-center justify-center border border-gray-100",title:"Undo",children:u.jsx(K6,{size:16})}),u.jsx("button",{onClick:k,className:"w-8 h-8 min-w-0 min-h-0 tap-target-bypass text-gray-500 hover:text-brand-navy hover:bg-gray-100 rounded-lg flex items-center justify-center border border-gray-100",title:"Redo",children:u.jsx(P6,{size:16})})]}),u.jsxs("button",{onClick:N,className:"w-[68px] h-8 min-w-0 min-h-0 tap-target-bypass text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg flex items-center justify-center gap-1 border border-red-50 text-[10px] font-bold",title:"Clear Page",children:[u.jsx(Kl,{size:14})," Clear"]})]}),u.jsx("div",{className:"h-px w-10 bg-gray-200"}),u.jsxs("div",{className:"flex flex-col items-center gap-1",children:[u.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 p-1 rounded-lg border border-gray-100",children:[u.jsx("button",{onClick:x,disabled:g===1,className:"w-6 h-6 min-w-0 min-h-0 tap-target-bypass flex items-center justify-center text-gray-400 hover:text-brand-navy disabled:opacity-30 rounded hover:bg-white",title:"Previous Page",children:u.jsx(i_,{size:14})}),u.jsxs("span",{className:"text-[10px] font-bold text-gray-500 min-w-[32px] text-center",children:[g,"/",b]}),u.jsx("button",{onClick:w,disabled:g===b,className:"w-6 h-6 min-w-0 min-h-0 tap-target-bypass flex items-center justify-center text-gray-400 hover:text-brand-navy disabled:opacity-30 rounded hover:bg-white",title:"Next Page",children:u.jsx(Ef,{size:14})})]}),_&&u.jsx("button",{onClick:_,disabled:b<=1,className:"w-full mt-1 text-[10px] font-bold text-red-500 hover:bg-red-50 rounded py-1 disabled:opacity-40",title:"Delete this page",children:"Delete page"})]}),u.jsx("div",{className:"h-px w-12 bg-gray-200"}),u.jsx("div",{className:"mt-auto flex flex-col gap-1 pb-4",children:u.jsxs("button",{onClick:v,className:"w-16 h-8 min-w-0 min-h-0 tap-target-bypass flex items-center justify-center gap-1 text-brand-teal border-2 border-brand-teal rounded-lg hover:bg-brand-teal hover:text-white transition-all font-bold text-xs",title:"Add Page",children:[u.jsx("span",{className:"text-lg",children:"+"})," Page"]})})]})},oL=(s,e,t,n,r)=>{const[i,o]=Y.useState("pen"),[l,d]=Y.useState("#0B2545"),[h,p]=Y.useState(3),[g,b]=Y.useState(!1),[x,w]=Y.useState(1),[v,_]=Y.useState(1),[N,E]=Y.useState([]),[k,T]=Y.useState({x:-200,y:-200,scale:1}),[P,O]=Y.useState([]),[F,$]=Y.useState(-1),[z,G]=Y.useState(null),R=Y.useRef(!1),q=Y.useRef([]),J=Y.useRef(null),Z=Y.useRef(null),le=Y.useRef({tool:i,color:l,size:h,transform:k,page:x});Y.useRef(0),Y.useEffect(()=>{le.current={tool:i,color:l,size:h,transform:k,page:x}},[i,l,h,k,x]),Y.useEffect(()=>{const je=s.current;if(je){je.width=2500,je.height=2500;const Fe=je.getContext("2d",{alpha:!0});Fe.lineCap="round",Fe.lineJoin="round",J.current=Fe}const Me=()=>{e.current&&(Z.current=e.current.getBoundingClientRect())};return window.addEventListener("resize",Me),setTimeout(Me,100),()=>window.removeEventListener("resize",Me)},[]);const K=n||"default",se=je=>`tutor_wb_${K}_p${je}`,ce=()=>`tutor_wb_${K}_pageTypes`,ye=je=>`tutor_wb_${K}_p${je}_doc`,Ce=ra.useCallback((je,Me)=>{try{localStorage.setItem(je,Me)}catch(Fe){if(Fe&&Fe.name==="QuotaExceededError")try{const ue=[];for(let Te=0;Te<localStorage.length;Te++){const Oe=localStorage.key(Te);Oe&&Oe.startsWith("tutor_wb_")&&!Oe.startsWith(`tutor_wb_${K}_`)&&ue.push(Oe)}ue.slice(0,20).forEach(Te=>localStorage.removeItem(Te)),localStorage.setItem(je,Me)}catch{}else throw Fe}},[K]),M=ra.useCallback(je=>{const Me=J.current;if(!Me||!s.current)return;try{const ue=localStorage.getItem(ce());if((ue?JSON.parse(ue):["whiteboard"])[je-1]==="document"){Me.clearRect(0,0,s.current.width,s.current.height),O([]),$(-1);return}}catch{}Me.clearRect(0,0,s.current.width,s.current.height);const Fe=localStorage.getItem(se(je));if(Fe){const ue=new Image;ue.onload=()=>{Me.drawImage(ue,0,0),O([Fe]),$(0)},ue.src=Fe}else{const ue=s.current.toDataURL();O([ue]),$(0)}},[n]),L=r?`student_${String(r).replace(/\s+/g,"_")}`:null,U=ra.useCallback(()=>{if(s.current)try{const je=s.current.toDataURL();Ce(se(x),je),Ce(`tutor_wb_${K}_total`,String(v)),L&&(Ce(`tutor_wb_${L}_p${x}`,je),Ce(`tutor_wb_${L}_total`,String(v)))}catch{}},[x,v,n,L,Ce]),H=ra.useCallback(()=>{if(!s.current)return;const je=s.current.toDataURL(),Me=P.slice(0,F+1);Me.push(je),Me.length>20&&Me.shift(),O(Me),$(Me.length-1),U()},[P,F,U]),ae=ra.useCallback((je=!0)=>{if(F>0){const Me=F-1;$(Me);const Fe=new Image;Fe.onload=()=>{const ue=J.current;ue&&s.current&&(ue.clearRect(0,0,s.current.width,s.current.height),ue.drawImage(Fe,0,0),U())},Fe.src=P[Me],je&&t&&t.open&&t.send({type:"undo"})}},[P,F,U,t]),de=ra.useCallback((je=!0)=>{if(F<P.length-1){const Me=F+1;$(Me);const Fe=new Image;Fe.onload=()=>{const ue=J.current;ue&&s.current&&(ue.clearRect(0,0,s.current.width,s.current.height),ue.drawImage(Fe,0,0),U())},Fe.src=P[Me],je&&t&&t.open&&t.send({type:"redo"})}},[P,F,U,t]),xe=ra.useCallback((je,Me=!0)=>{const Fe=x;je!==Fe&&requestAnimationFrame(()=>{if(s.current)try{const ue=s.current.toDataURL();Ce(se(Fe),ue),Ce(`tutor_wb_${K}_total`,String(v)),L&&(Ce(`tutor_wb_${L}_p${Fe}`,ue),Ce(`tutor_wb_${L}_total`,String(v)))}catch{}w(je),M(je),Me&&t&&t.open&&t.send({type:"change_page",page:je})})},[x,M,t,n,r,v,Ce]),he=ra.useCallback((je="whiteboard",Me)=>{const Fe=je==="whiteboard"||je==="document"?je:"whiteboard",ue=typeof je=="boolean"?je:Me!==!1;U();const Te=v+1;E(Oe=>{const ct=[...Oe,Fe];try{Ce(ce(),JSON.stringify(ct))}catch{}return ct}),_(Te),w(Te),M(Te),ue&&t&&t.open&&t.send({type:"add_page",pageType:Fe})},[U,M,v,t,Ce,ce]),me=ra.useCallback((je=!0)=>{if(v<=1)return;U();const Me=v-1;E(ue=>{const Te=ue.filter((Oe,ct)=>ct!==x-1);try{Ce(ce(),JSON.stringify(Te))}catch{}return Te});for(let ue=x;ue<Me;ue++){const Te=localStorage.getItem(se(ue+1));if(Te)Ce(se(ue),Te);else try{localStorage.removeItem(se(ue))}catch{}const Oe=localStorage.getItem(ye(ue+1));if(Oe!=null)Ce(ye(ue),Oe);else try{localStorage.removeItem(ye(ue))}catch{}}try{localStorage.removeItem(se(Me+1)),localStorage.removeItem(ye(Me+1))}catch{}if(Ce(`tutor_wb_${K}_total`,String(Me)),L){for(let ue=x;ue<Me;ue++){const Te=localStorage.getItem(`tutor_wb_${L}_p${ue+1}`);if(Te)Ce(`tutor_wb_${L}_p${ue}`,Te);else try{localStorage.removeItem(`tutor_wb_${L}_p${ue}`)}catch{}}try{localStorage.removeItem(`tutor_wb_${L}_p${Me+1}`)}catch{}Ce(`tutor_wb_${L}_total`,String(Me))}_(Me);const Fe=x>Me?Me:x;w(Fe),M(Fe),je&&t&&t.open&&t.send({type:"delete_page",deletedPage:x})},[x,v,U,M,t,n,L,Ce,se,ye,ce,K]),ve=()=>xe(Math.min(v,x+1)),Re=()=>xe(Math.max(1,x-1)),Ke=ra.useCallback((je=!0)=>{const Me=J.current;Me&&s.current&&(Me.clearRect(0,0,s.current.width,s.current.height),H(),je&&t&&t.open&&t.send({type:"clear_canvas"}))},[H,t]);Y.useEffect(()=>{if(!n)return;const je=Me=>{try{const Fe=localStorage.getItem(ce());let ue=Fe?JSON.parse(Fe):[];(!Array.isArray(ue)||ue.length!==Me)&&(ue=Array.from({length:Me},(Te,Oe)=>ue[Oe]||"whiteboard"),Ce(ce(),JSON.stringify(ue))),E(ue)}catch{E(Array.from({length:Me},()=>"whiteboard"))}};try{const Me=localStorage.getItem(`tutor_wb_${K}_total`);if(Me){const Fe=parseInt(Me)||1;_(Fe),je(Fe),w(1),M(1)}else if(L){const Fe=localStorage.getItem(`tutor_wb_${L}_total`);if(Fe){const ue=parseInt(Fe);for(let Te=1;Te<=ue;Te++){const Oe=localStorage.getItem(`tutor_wb_${L}_p${Te}`);Oe&&Ce(se(Te),Oe)}Ce(`tutor_wb_${K}_total`,Fe),_(ue),je(ue),w(1),M(1)}else _(1),E(["whiteboard"]),w(1),Ke(!1)}else _(1),E(["whiteboard"]),w(1),Ke(!1)}catch{_(1),E(["whiteboard"]),w(1),M(1)}},[n,L,Ce]);const Ge=()=>{if(!z||!z.text.trim()){G(null);return}const je=J.current;je&&(je.globalCompositeOperation="source-over",je.fillStyle=le.current.color,je.font=`bold ${le.current.size*5}px sans-serif`,je.fillText(z.text,z.x,z.y),H(),t&&t.open&&t.send({type:"draw_text",text:z.text,x:z.x,y:z.y,color:le.current.color,size:le.current.size,page:le.current.page})),G(null)},ke=je=>{Z.current||(Z.current=e.current.getBoundingClientRect());const Me=Z.current,{x:Fe,y:ue,scale:Te}=le.current.transform;return{x:(je.clientX-Me.left-Fe)/Te,y:(je.clientY-Me.top-ue)/Te}},X=(je,Me,Fe)=>{if(Me.length<2)return;if(je.lineWidth=Fe.size,je.lineCap="round",je.lineJoin="round",Fe.isEraser?(je.globalCompositeOperation="destination-out",je.strokeStyle="rgba(0,0,0,1)"):Fe.isHighlighter?(je.globalCompositeOperation="multiply",je.strokeStyle=Fe.color,je.globalAlpha=.5):(je.globalCompositeOperation="source-over",je.strokeStyle=Fe.color),je.beginPath(),Me.length===2){je.moveTo(Me[0].x,Me[0].y),je.lineTo(Me[1].x,Me[1].y),je.stroke();return}const ue=Me.length-3,Te=Me[ue],Oe=Me[ue+1],ct=Me[ue+2],ft=(Te.x+Oe.x)/2,wt=(Te.y+Oe.y)/2,it=(Oe.x+ct.x)/2,At=(Oe.y+ct.y)/2;return je.moveTo(ft,wt),je.quadraticCurveTo(Oe.x,Oe.y,it,At),je.stroke(),{p0:{x:ft,y:wt},p1:Oe,p2:{x:it,y:At}}},Pe=je=>{const{tool:Me,color:Fe,size:ue}=le.current;if(z){Ge();return}const Te=je.buttons===1&&document.body.style.cursor==="grab";if(Me==="pan"||je.button===1||Te){b(!0);return}if(Me==="text"){const wt=ke(je);console.log("Text Tool Clicked at:",wt),G({x:wt.x,y:wt.y,text:""});return}R.current=!0;const Oe=ke(je);q.current=[Oe];const ct=J.current,ft={color:Fe,isEraser:Me==="eraser",isHighlighter:Me==="highlighter"};ft.isEraser?(ct.globalCompositeOperation="destination-out",ct.fillStyle="rgba(0,0,0,1)"):ft.isHighlighter?(ct.globalCompositeOperation="multiply",ct.fillStyle=ft.color,ct.globalAlpha=.5):(ct.globalCompositeOperation="source-over",ct.fillStyle=ft.color)},gt=je=>{if(g){const{movementX:wt,movementY:it}=je;T(At=>({...At,x:At.x+wt,y:At.y+it}));return}if(!R.current)return;const Me=ke(je),Fe=q.current;if(Fe.length>0){const wt=Fe[Fe.length-1];if(Math.sqrt(Math.pow(Me.x-wt.x,2)+Math.pow(Me.y-wt.y,2))<5)return}q.current.push(Me);const ue=J.current,{tool:Te,color:Oe,size:ct}=le.current,ft={color:Oe,size:Te==="highlighter"?ct*3:ct,isHighlighter:Te==="highlighter",isEraser:Te==="eraser"};if(Fe.length>2){const wt=X(ue,Fe,ft);t&&t.open&&wt&&t.send({type:"draw_curve",pts:[wt.p0,wt.p1,wt.p2],color:ft.color,size:ft.size,isHighlighter:ft.isHighlighter,isEraser:ft.isEraser,page:le.current.page})}},bt=()=>{R.current&&H(),R.current=!1,q.current=[],b(!1)},Ye=je=>{if(je.ctrlKey){je.preventDefault();const Me=-je.deltaY*.001;T(Fe=>({...Fe,scale:Math.max(.1,Math.min(5,Fe.scale+Me))}))}else T(Me=>({...Me,y:Me.y-je.deltaY}))},Et=()=>T(je=>({...je,scale:Math.min(5,je.scale*1.2)})),vt=()=>T(je=>({...je,scale:Math.max(.1,je.scale/1.2)})),st=Y.useRef({saveHistory:H,savePage:U,changePage:xe,addPage:he,deletePage:me,clearCanvas:Ke,undo:ae,redo:de});return Y.useEffect(()=>{st.current={saveHistory:H,savePage:U,changePage:xe,addPage:he,deletePage:me,clearCanvas:Ke,undo:ae,redo:de}},[H,U,xe,he,me,Ke,ae,de]),Y.useEffect(()=>{const je=Me=>{requestAnimationFrame(()=>{const Fe=J.current;if(Fe)if(Me.type==="draw_curve"){if(Me.page!==void 0&&Me.page!==le.current.page)return;const[ue,Te,Oe]=Me.pts;Fe.save(),Fe.lineWidth=Me.size,Fe.lineCap="round",Fe.lineJoin="round",Me.isEraser?(Fe.globalCompositeOperation="destination-out",Fe.strokeStyle="rgba(0,0,0,1)"):Me.isHighlighter?(Fe.globalCompositeOperation="multiply",Fe.strokeStyle=Me.color,Fe.globalAlpha=.5):(Fe.globalCompositeOperation="source-over",Fe.strokeStyle=Me.color),Fe.beginPath(),Fe.moveTo(ue.x,ue.y),Fe.quadraticCurveTo(Te.x,Te.y,Oe.x,Oe.y),Fe.stroke(),Fe.restore(),st.current.savePage()}else if(Me.type==="draw_text"){if(Me.page!==void 0&&Me.page!==le.current.page)return;Fe.save(),Fe.globalCompositeOperation="source-over",Fe.fillStyle=Me.color,Fe.font=`bold ${Me.size*5}px sans-serif`,Fe.fillText(Me.text,Me.x,Me.y),Fe.restore(),st.current.saveHistory()}else Me.type==="change_page"?st.current.changePage(Me.page,!1):Me.type==="add_page"?st.current.addPage(Me.pageType||"whiteboard",!1):Me.type==="delete_page"?st.current.deletePage(!1):Me.type==="clear_canvas"?st.current.clearCanvas(!1):Me.type==="undo"?st.current.undo(!1):Me.type==="redo"&&st.current.redo(!1)})};return window.externalDraw=je,()=>{window.externalDraw===je&&(window.externalDraw=null)}},[]),{tool:i,setTool:o,color:l,setColor:d,size:h,setSize:p,transform:k,setTransform:T,zoomIn:Et,zoomOut:vt,page:x,totalPages:v,nextPage:ve,prevPage:Re,addPage:he,deletePage:me,clearCanvas:Ke,pageTypes:N,getPageType:je=>N[je-1]||"whiteboard",getDocContent:je=>localStorage.getItem(ye(je))||"",setDocContent:(je,Me)=>{try{Ce(ye(je),Me)}catch{}},undo:ae,redo:de,activeText:z,setActiveText:G,finalizeText:Ge,events:{onMouseDown:Pe,onMouseMove:gt,onMouseUp:bt,onMouseLeave:bt,onWheel:Ye}}},lL="modulepreload",cL=function(s){return"/"+s},m5={},Gx=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let d=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");r=d(t.map(h=>{if(h=cL(h),h in m5)return;m5[h]=!0;const p=h.endsWith(".css"),g=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${g}`))return;const b=document.createElement("link");if(b.rel=p?"stylesheet":lL,p||(b.as="script"),b.crossOrigin="",b.href=h,l&&b.setAttribute("nonce",l),document.head.appendChild(b),p)return new Promise((x,w)=>{b.addEventListener("load",x),b.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${h}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return r.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};function gs(s){"@babel/helpers - typeof";return gs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gs(s)}var Do=Uint8Array,Ca=Uint16Array,Ub=Int32Array,zb=new Do([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),$b=new Do([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),x5=new Do([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c4=function(s,e){for(var t=new Ca(31),n=0;n<31;++n)t[n]=e+=1<<s[n-1];for(var r=new Ub(t[30]),n=1;n<30;++n)for(var i=t[n];i<t[n+1];++i)r[i]=i-t[n]<<5|n;return{b:t,r}},u4=c4(zb,2),uL=u4.b,W1=u4.r;uL[28]=258,W1[258]=28;var dL=c4($b,0),b5=dL.r,Y1=new Ca(32768);for(var Ms=0;Ms<32768;++Ms){var Bc=(Ms&43690)>>1|(Ms&21845)<<1;Bc=(Bc&52428)>>2|(Bc&13107)<<2,Bc=(Bc&61680)>>4|(Bc&3855)<<4,Y1[Ms]=((Bc&65280)>>8|(Bc&255)<<8)>>1}var Df=(function(s,e,t){for(var n=s.length,r=0,i=new Ca(e);r<n;++r)s[r]&&++i[s[r]-1];var o=new Ca(e);for(r=1;r<e;++r)o[r]=o[r-1]+i[r-1]<<1;var l;if(t){l=new Ca(1<<e);var d=15-e;for(r=0;r<n;++r)if(s[r])for(var h=r<<4|s[r],p=e-s[r],g=o[s[r]-1]++<<p,b=g|(1<<p)-1;g<=b;++g)l[Y1[g]>>d]=h}else for(l=new Ca(n),r=0;r<n;++r)s[r]&&(l[r]=Y1[o[s[r]-1]++]>>15-s[r]);return l}),Mu=new Do(288);for(var Ms=0;Ms<144;++Ms)Mu[Ms]=8;for(var Ms=144;Ms<256;++Ms)Mu[Ms]=9;for(var Ms=256;Ms<280;++Ms)Mu[Ms]=7;for(var Ms=280;Ms<288;++Ms)Mu[Ms]=8;var jg=new Do(32);for(var Ms=0;Ms<32;++Ms)jg[Ms]=5;var hL=Df(Mu,9,0),fL=Df(jg,5,0),d4=function(s){return(s+7)/8|0},pL=function(s,e,t){return(t==null||t>s.length)&&(t=s.length),new Do(s.subarray(e,t))},$l=function(s,e,t){t<<=e&7;var n=e/8|0;s[n]|=t,s[n+1]|=t>>8},xf=function(s,e,t){t<<=e&7;var n=e/8|0;s[n]|=t,s[n+1]|=t>>8,s[n+2]|=t>>16},Vx=function(s,e){for(var t=[],n=0;n<s.length;++n)s[n]&&t.push({s:n,f:s[n]});var r=t.length,i=t.slice();if(!r)return{t:f4,l:0};if(r==1){var o=new Do(t[0].s+1);return o[t[0].s]=1,{t:o,l:1}}t.sort(function(P,O){return P.f-O.f}),t.push({s:-1,f:25001});var l=t[0],d=t[1],h=0,p=1,g=2;for(t[0]={s:-1,f:l.f+d.f,l,r:d};p!=r-1;)l=t[t[h].f<t[g].f?h++:g++],d=t[h!=p&&t[h].f<t[g].f?h++:g++],t[p++]={s:-1,f:l.f+d.f,l,r:d};for(var b=i[0].s,n=1;n<r;++n)i[n].s>b&&(b=i[n].s);var x=new Ca(b+1),w=K1(t[p-1],x,0);if(w>e){var n=0,v=0,_=w-e,N=1<<_;for(i.sort(function(O,F){return x[F.s]-x[O.s]||O.f-F.f});n<r;++n){var E=i[n].s;if(x[E]>e)v+=N-(1<<w-x[E]),x[E]=e;else break}for(v>>=_;v>0;){var k=i[n].s;x[k]<e?v-=1<<e-x[k]++-1:++n}for(;n>=0&&v;--n){var T=i[n].s;x[T]==e&&(--x[T],++v)}w=e}return{t:new Do(x),l:w}},K1=function(s,e,t){return s.s==-1?Math.max(K1(s.l,e,t+1),K1(s.r,e,t+1)):e[s.s]=t},y5=function(s){for(var e=s.length;e&&!s[--e];);for(var t=new Ca(++e),n=0,r=s[0],i=1,o=function(d){t[n++]=d},l=1;l<=e;++l)if(s[l]==r&&l!=e)++i;else{if(!r&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(r),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(r);i=1,r=s[l]}return{c:t.subarray(0,n),n:e}},bf=function(s,e){for(var t=0,n=0;n<e.length;++n)t+=s[n]*e[n];return t},h4=function(s,e,t){var n=t.length,r=d4(e+2);s[r]=n&255,s[r+1]=n>>8,s[r+2]=s[r]^255,s[r+3]=s[r+1]^255;for(var i=0;i<n;++i)s[r+i+4]=t[i];return(r+4+n)*8},v5=function(s,e,t,n,r,i,o,l,d,h,p){$l(e,p++,t),++r[256];for(var g=Vx(r,15),b=g.t,x=g.l,w=Vx(i,15),v=w.t,_=w.l,N=y5(b),E=N.c,k=N.n,T=y5(v),P=T.c,O=T.n,F=new Ca(19),$=0;$<E.length;++$)++F[E[$]&31];for(var $=0;$<P.length;++$)++F[P[$]&31];for(var z=Vx(F,7),G=z.t,R=z.l,q=19;q>4&&!G[x5[q-1]];--q);var J=h+5<<3,Z=bf(r,Mu)+bf(i,jg)+o,le=bf(r,b)+bf(i,v)+o+14+3*q+bf(F,G)+2*F[16]+3*F[17]+7*F[18];if(d>=0&&J<=Z&&J<=le)return h4(e,p,s.subarray(d,d+h));var K,se,ce,ye;if($l(e,p,1+(le<Z)),p+=2,le<Z){K=Df(b,x,0),se=b,ce=Df(v,_,0),ye=v;var Ce=Df(G,R,0);$l(e,p,k-257),$l(e,p+5,O-1),$l(e,p+10,q-4),p+=14;for(var $=0;$<q;++$)$l(e,p+3*$,G[x5[$]]);p+=3*q;for(var M=[E,P],L=0;L<2;++L)for(var U=M[L],$=0;$<U.length;++$){var H=U[$]&31;$l(e,p,Ce[H]),p+=G[H],H>15&&($l(e,p,U[$]>>5&127),p+=U[$]>>12)}}else K=hL,se=Mu,ce=fL,ye=jg;for(var $=0;$<l;++$){var ae=n[$];if(ae>255){var H=ae>>18&31;xf(e,p,K[H+257]),p+=se[H+257],H>7&&($l(e,p,ae>>23&31),p+=zb[H]);var de=ae&31;xf(e,p,ce[de]),p+=ye[de],de>3&&(xf(e,p,ae>>5&8191),p+=$b[de])}else xf(e,p,K[ae]),p+=se[ae]}return xf(e,p,K[256]),p+se[256]},gL=new Ub([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),f4=new Do(0),mL=function(s,e,t,n,r,i){var o=i.z||s.length,l=new Do(n+o+5*(1+Math.ceil(o/7e3))+r),d=l.subarray(n,l.length-r),h=i.l,p=(i.r||0)&7;if(e){p&&(d[0]=i.r>>3);for(var g=gL[e-1],b=g>>13,x=g&8191,w=(1<<t)-1,v=i.p||new Ca(32768),_=i.h||new Ca(w+1),N=Math.ceil(t/3),E=2*N,k=function(ke){return(s[ke]^s[ke+1]<<N^s[ke+2]<<E)&w},T=new Ub(25e3),P=new Ca(288),O=new Ca(32),F=0,$=0,z=i.i||0,G=0,R=i.w||0,q=0;z+2<o;++z){var J=k(z),Z=z&32767,le=_[J];if(v[Z]=le,_[J]=Z,R<=z){var K=o-z;if((F>7e3||G>24576)&&(K>423||!h)){p=v5(s,d,0,T,P,O,$,G,q,z-q,p),G=F=$=0,q=z;for(var se=0;se<286;++se)P[se]=0;for(var se=0;se<30;++se)O[se]=0}var ce=2,ye=0,Ce=x,M=Z-le&32767;if(K>2&&J==k(z-M))for(var L=Math.min(b,K)-1,U=Math.min(32767,z),H=Math.min(258,K);M<=U&&--Ce&&Z!=le;){if(s[z+ce]==s[z+ce-M]){for(var ae=0;ae<H&&s[z+ae]==s[z+ae-M];++ae);if(ae>ce){if(ce=ae,ye=M,ae>L)break;for(var de=Math.min(M,ae-2),xe=0,se=0;se<de;++se){var he=z-M+se&32767,me=v[he],ve=he-me&32767;ve>xe&&(xe=ve,le=he)}}}Z=le,le=v[Z],M+=Z-le&32767}if(ye){T[G++]=268435456|W1[ce]<<18|b5[ye];var Re=W1[ce]&31,Ke=b5[ye]&31;$+=zb[Re]+$b[Ke],++P[257+Re],++O[Ke],R=z+ce,++F}else T[G++]=s[z],++P[s[z]]}}for(z=Math.max(z,R);z<o;++z)T[G++]=s[z],++P[s[z]];p=v5(s,d,h,T,P,O,$,G,q,z-q,p),h||(i.r=p&7|d[p/8|0]<<3,p-=7,i.h=_,i.p=v,i.i=z,i.w=R)}else{for(var z=i.w||0;z<o+h;z+=65535){var Ge=z+65535;Ge>=o&&(d[p/8|0]=h,Ge=o),p=h4(d,p+1,s.subarray(z,Ge))}i.i=o}return pL(l,0,n+d4(p)+r)},p4=function(){var s=1,e=0;return{p:function(t){for(var n=s,r=e,i=t.length|0,o=0;o!=i;){for(var l=Math.min(o+2655,i);o<l;++o)r+=n+=t[o];n=(n&65535)+15*(n>>16),r=(r&65535)+15*(r>>16)}s=n,e=r},d:function(){return s%=65521,e%=65521,(s&255)<<24|(s&65280)<<8|(e&255)<<8|e>>8}}},xL=function(s,e,t,n,r){if(!r&&(r={l:1},e.dictionary)){var i=e.dictionary.subarray(-32768),o=new Do(i.length+s.length);o.set(i),o.set(s,i.length),s=o,r.w=i.length}return mL(s,e.level==null?6:e.level,e.mem==null?r.l?Math.ceil(Math.max(8,Math.min(13,Math.log(s.length)))*1.5):20:12+e.mem,t,n,r)},g4=function(s,e,t){for(;t;++e)s[e]=t,t>>>=8},bL=function(s,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;if(s[0]=120,s[1]=n<<6|(e.dictionary&&32),s[1]|=31-(s[0]<<8|s[1])%31,e.dictionary){var r=p4();r.p(e.dictionary),g4(s,2,r.d())}};function X1(s,e){e||(e={});var t=p4();t.p(s);var n=xL(s,e,e.dictionary?6:2,4);return bL(n,e),g4(n,n.length-4,t.d()),n}var yL=typeof TextDecoder<"u"&&new TextDecoder,vL=0;try{yL.decode(f4,{stream:!0}),vL=1}catch{}function wL(s){if(Array.isArray(s))return s}function SL(s,e){var t=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(t!=null){var n,r,i,o,l=[],d=!0,h=!1;try{if(i=(t=t.call(s)).next,e!==0)for(;!(d=(n=i.call(t)).done)&&(l.push(n.value),l.length!==e);d=!0);}catch(p){h=!0,r=p}finally{try{if(!d&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(h)throw r}}return l}}function w5(s,e){(e==null||e>s.length)&&(e=s.length);for(var t=0,n=Array(e);t<e;t++)n[t]=s[t];return n}function _L(s,e){if(s){if(typeof s=="string")return w5(s,e);var t={}.toString.call(s).slice(8,-1);return t==="Object"&&s.constructor&&(t=s.constructor.name),t==="Map"||t==="Set"?Array.from(s):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?w5(s,e):void 0}}function AL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S5(s,e){return wL(s)||SL(s,e)||_L(s,e)||AL()}function _5(s,e="utf8"){return new TextDecoder(e).decode(s)}const NL=new TextEncoder;function CL(s){return NL.encode(s)}const EL=1024*8,kL=(()=>{const s=new Uint8Array(4),e=new Uint32Array(s.buffer);return!((e[0]=1)&s[0])})(),Wx={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class qb{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(e=EL,t={}){let n=!1;typeof e=="number"?e=new ArrayBuffer(e):(n=!0,this.lastWrittenByte=e.byteLength);const r=t.offset?t.offset>>>0:0,i=e.byteLength-r;let o=r;(ArrayBuffer.isView(e)||e instanceof qb)&&(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+r),e=e.buffer),n?this.lastWrittenByte=i:this.lastWrittenByte=0,this.buffer=e,this.length=i,this.byteLength=i,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,i),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const n=(this.offset+e)*2,r=new Uint8Array(n);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=n,this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const n=Wx[t].BYTES_PER_ELEMENT*e,r=this.byteOffset+this.offset,i=this.buffer.slice(r,r+n);if(this.littleEndian===kL&&t!=="uint8"&&t!=="int8"){const l=new Uint8Array(this.buffer.slice(r,r+n));l.reverse();const d=new Wx[t](l.buffer);return this.offset+=n,d.reverse(),d}const o=new Wx[t](i);return this.offset+=n,o}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let n=0;n<e;n++)t+=this.readChar();return t}readUtf8(e=1){return _5(this.readBytes(e))}decodeText(e=1,t="utf8"){return _5(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(CL(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function _h(s){let e=s.length;for(;--e>=0;)s[e]=0}const jL=3,TL=258,m4=29,DL=256,LL=DL+1+m4,x4=30,RL=512,PL=new Array((LL+2)*2);_h(PL);const BL=new Array(x4*2);_h(BL);const OL=new Array(RL);_h(OL);const IL=new Array(TL-jL+1);_h(IL);const ML=new Array(m4);_h(ML);const FL=new Array(x4);_h(FL);const UL=(s,e,t,n)=>{let r=s&65535|0,i=s>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do r=r+e[n++]|0,i=i+r|0;while(--o);r%=65521,i%=65521}return r|i<<16|0};var J1=UL;const zL=()=>{let s,e=[];for(var t=0;t<256;t++){s=t;for(var n=0;n<8;n++)s=s&1?3988292384^s>>>1:s>>>1;e[t]=s}return e},$L=new Uint32Array(zL()),qL=(s,e,t,n)=>{const r=$L,i=n+t;s^=-1;for(let o=n;o<i;o++)s=s>>>8^r[(s^e[o])&255];return s^-1};var rl=qL,Z1={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},b4={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const HL=(s,e)=>Object.prototype.hasOwnProperty.call(s,e);var GL=function(s){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const n in t)HL(t,n)&&(s[n]=t[n])}}return s},VL=s=>{let e=0;for(let n=0,r=s.length;n<r;n++)e+=s[n].length;const t=new Uint8Array(e);for(let n=0,r=0,i=s.length;n<i;n++){let o=s[n];t.set(o,r),r+=o.length}return t},y4={assign:GL,flattenChunks:VL};let v4=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{v4=!1}const Vf=new Uint8Array(256);for(let s=0;s<256;s++)Vf[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;Vf[254]=Vf[254]=1;var WL=s=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(s);let e,t,n,r,i,o=s.length,l=0;for(r=0;r<o;r++)t=s.charCodeAt(r),(t&64512)===55296&&r+1<o&&(n=s.charCodeAt(r+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),r++)),l+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(l),i=0,r=0;i<l;r++)t=s.charCodeAt(r),(t&64512)===55296&&r+1<o&&(n=s.charCodeAt(r+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),r++)),t<128?e[i++]=t:t<2048?(e[i++]=192|t>>>6,e[i++]=128|t&63):t<65536?(e[i++]=224|t>>>12,e[i++]=128|t>>>6&63,e[i++]=128|t&63):(e[i++]=240|t>>>18,e[i++]=128|t>>>12&63,e[i++]=128|t>>>6&63,e[i++]=128|t&63);return e};const YL=(s,e)=>{if(e<65534&&s.subarray&&v4)return String.fromCharCode.apply(null,s.length===e?s:s.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(s[n]);return t};var KL=(s,e)=>{const t=e||s.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(s.subarray(0,e));let n,r;const i=new Array(t*2);for(r=0,n=0;n<t;){let o=s[n++];if(o<128){i[r++]=o;continue}let l=Vf[o];if(l>4){i[r++]=65533,n+=l-1;continue}for(o&=l===2?31:l===3?15:7;l>1&&n<t;)o=o<<6|s[n++]&63,l--;if(l>1){i[r++]=65533;continue}o<65536?i[r++]=o:(o-=65536,i[r++]=55296|o>>10&1023,i[r++]=56320|o&1023)}return YL(i,r)},XL=(s,e)=>{e=e||s.length,e>s.length&&(e=s.length);let t=e-1;for(;t>=0&&(s[t]&192)===128;)t--;return t<0||t===0?e:t+Vf[s[t]]>e?t:e},Q1={string2buf:WL,buf2string:KL,utf8border:XL};function JL(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var ZL=JL;const fp=16209,QL=16191;var eR=function(e,t){let n,r,i,o,l,d,h,p,g,b,x,w,v,_,N,E,k,T,P,O,F,$,z,G;const R=e.state;n=e.next_in,z=e.input,r=n+(e.avail_in-5),i=e.next_out,G=e.output,o=i-(t-e.avail_out),l=i+(e.avail_out-257),d=R.dmax,h=R.wsize,p=R.whave,g=R.wnext,b=R.window,x=R.hold,w=R.bits,v=R.lencode,_=R.distcode,N=(1<<R.lenbits)-1,E=(1<<R.distbits)-1;e:do{w<15&&(x+=z[n++]<<w,w+=8,x+=z[n++]<<w,w+=8),k=v[x&N];t:for(;;){if(T=k>>>24,x>>>=T,w-=T,T=k>>>16&255,T===0)G[i++]=k&65535;else if(T&16){P=k&65535,T&=15,T&&(w<T&&(x+=z[n++]<<w,w+=8),P+=x&(1<<T)-1,x>>>=T,w-=T),w<15&&(x+=z[n++]<<w,w+=8,x+=z[n++]<<w,w+=8),k=_[x&E];n:for(;;){if(T=k>>>24,x>>>=T,w-=T,T=k>>>16&255,T&16){if(O=k&65535,T&=15,w<T&&(x+=z[n++]<<w,w+=8,w<T&&(x+=z[n++]<<w,w+=8)),O+=x&(1<<T)-1,O>d){e.msg="invalid distance too far back",R.mode=fp;break e}if(x>>>=T,w-=T,T=i-o,O>T){if(T=O-T,T>p&&R.sane){e.msg="invalid distance too far back",R.mode=fp;break e}if(F=0,$=b,g===0){if(F+=h-T,T<P){P-=T;do G[i++]=b[F++];while(--T);F=i-O,$=G}}else if(g<T){if(F+=h+g-T,T-=g,T<P){P-=T;do G[i++]=b[F++];while(--T);if(F=0,g<P){T=g,P-=T;do G[i++]=b[F++];while(--T);F=i-O,$=G}}}else if(F+=g-T,T<P){P-=T;do G[i++]=b[F++];while(--T);F=i-O,$=G}for(;P>2;)G[i++]=$[F++],G[i++]=$[F++],G[i++]=$[F++],P-=3;P&&(G[i++]=$[F++],P>1&&(G[i++]=$[F++]))}else{F=i-O;do G[i++]=G[F++],G[i++]=G[F++],G[i++]=G[F++],P-=3;while(P>2);P&&(G[i++]=G[F++],P>1&&(G[i++]=G[F++]))}}else if((T&64)===0){k=_[(k&65535)+(x&(1<<T)-1)];continue n}else{e.msg="invalid distance code",R.mode=fp;break e}break}}else if((T&64)===0){k=v[(k&65535)+(x&(1<<T)-1)];continue t}else if(T&32){R.mode=QL;break e}else{e.msg="invalid literal/length code",R.mode=fp;break e}break}}while(n<r&&i<l);P=w>>3,n-=P,w-=P<<3,x&=(1<<w)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?5+(r-n):5-(n-r),e.avail_out=i<l?257+(l-i):257-(i-l),R.hold=x,R.bits=w};const $d=15,A5=852,N5=592,C5=0,Yx=1,E5=2,tR=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),nR=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),sR=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),rR=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),iR=(s,e,t,n,r,i,o,l)=>{const d=l.bits;let h=0,p=0,g=0,b=0,x=0,w=0,v=0,_=0,N=0,E=0,k,T,P,O,F,$=null,z;const G=new Uint16Array($d+1),R=new Uint16Array($d+1);let q=null,J,Z,le;for(h=0;h<=$d;h++)G[h]=0;for(p=0;p<n;p++)G[e[t+p]]++;for(x=d,b=$d;b>=1&&G[b]===0;b--);if(x>b&&(x=b),b===0)return r[i++]=1<<24|64<<16|0,r[i++]=1<<24|64<<16|0,l.bits=1,0;for(g=1;g<b&&G[g]===0;g++);for(x<g&&(x=g),_=1,h=1;h<=$d;h++)if(_<<=1,_-=G[h],_<0)return-1;if(_>0&&(s===C5||b!==1))return-1;for(R[1]=0,h=1;h<$d;h++)R[h+1]=R[h]+G[h];for(p=0;p<n;p++)e[t+p]!==0&&(o[R[e[t+p]]++]=p);if(s===C5?($=q=o,z=20):s===Yx?($=tR,q=nR,z=257):($=sR,q=rR,z=0),E=0,p=0,h=g,F=i,w=x,v=0,P=-1,N=1<<x,O=N-1,s===Yx&&N>A5||s===E5&&N>N5)return 1;for(;;){J=h-v,o[p]+1<z?(Z=0,le=o[p]):o[p]>=z?(Z=q[o[p]-z],le=$[o[p]-z]):(Z=96,le=0),k=1<<h-v,T=1<<w,g=T;do T-=k,r[F+(E>>v)+T]=J<<24|Z<<16|le|0;while(T!==0);for(k=1<<h-1;E&k;)k>>=1;if(k!==0?(E&=k-1,E+=k):E=0,p++,--G[h]===0){if(h===b)break;h=e[t+o[p]]}if(h>x&&(E&O)!==P){for(v===0&&(v=x),F+=g,w=h-v,_=1<<w;w+v<b&&(_-=G[w+v],!(_<=0));)w++,_<<=1;if(N+=1<<w,s===Yx&&N>A5||s===E5&&N>N5)return 1;P=E&O,r[P]=x<<24|w<<16|F-i|0}}return E!==0&&(r[F+E]=h-v<<24|64<<16|0),l.bits=x,0};var Lf=iR;const aR=0,w4=1,S4=2,{Z_FINISH:k5,Z_BLOCK:oR,Z_TREES:pp,Z_OK:Fu,Z_STREAM_END:lR,Z_NEED_DICT:cR,Z_STREAM_ERROR:Ja,Z_DATA_ERROR:_4,Z_MEM_ERROR:A4,Z_BUF_ERROR:uR,Z_DEFLATED:j5}=b4,sm=16180,T5=16181,D5=16182,L5=16183,R5=16184,P5=16185,B5=16186,O5=16187,I5=16188,M5=16189,Tg=16190,ql=16191,Kx=16192,F5=16193,Xx=16194,U5=16195,z5=16196,$5=16197,q5=16198,gp=16199,mp=16200,H5=16201,G5=16202,V5=16203,W5=16204,Y5=16205,Jx=16206,K5=16207,X5=16208,Hs=16209,N4=16210,C4=16211,dR=852,hR=592,fR=15,pR=fR,J5=s=>(s>>>24&255)+(s>>>8&65280)+((s&65280)<<8)+((s&255)<<24);function gR(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Hu=s=>{if(!s)return 1;const e=s.state;return!e||e.strm!==s||e.mode<sm||e.mode>C4?1:0},E4=s=>{if(Hu(s))return Ja;const e=s.state;return s.total_in=s.total_out=e.total=0,s.msg="",e.wrap&&(s.adler=e.wrap&1),e.mode=sm,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(dR),e.distcode=e.distdyn=new Int32Array(hR),e.sane=1,e.back=-1,Fu},k4=s=>{if(Hu(s))return Ja;const e=s.state;return e.wsize=0,e.whave=0,e.wnext=0,E4(s)},j4=(s,e)=>{let t;if(Hu(s))return Ja;const n=s.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?Ja:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,k4(s))},T4=(s,e)=>{if(!s)return Ja;const t=new gR;s.state=t,t.strm=s,t.window=null,t.mode=sm;const n=j4(s,e);return n!==Fu&&(s.state=null),n},mR=s=>T4(s,pR);let Z5=!0,Zx,Qx;const xR=s=>{if(Z5){Zx=new Int32Array(512),Qx=new Int32Array(32);let e=0;for(;e<144;)s.lens[e++]=8;for(;e<256;)s.lens[e++]=9;for(;e<280;)s.lens[e++]=7;for(;e<288;)s.lens[e++]=8;for(Lf(w4,s.lens,0,288,Zx,0,s.work,{bits:9}),e=0;e<32;)s.lens[e++]=5;Lf(S4,s.lens,0,32,Qx,0,s.work,{bits:5}),Z5=!1}s.lencode=Zx,s.lenbits=9,s.distcode=Qx,s.distbits=5},D4=(s,e,t,n)=>{let r;const i=s.state;return i.window===null&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),n>=i.wsize?(i.window.set(e.subarray(t-i.wsize,t),0),i.wnext=0,i.whave=i.wsize):(r=i.wsize-i.wnext,r>n&&(r=n),i.window.set(e.subarray(t-n,t-n+r),i.wnext),n-=r,n?(i.window.set(e.subarray(t-n,t),0),i.wnext=n,i.whave=i.wsize):(i.wnext+=r,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=r))),0},bR=(s,e)=>{let t,n,r,i,o,l,d,h,p,g,b,x,w,v,_=0,N,E,k,T,P,O,F,$;const z=new Uint8Array(4);let G,R;const q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Hu(s)||!s.output||!s.input&&s.avail_in!==0)return Ja;t=s.state,t.mode===ql&&(t.mode=Kx),o=s.next_out,r=s.output,d=s.avail_out,i=s.next_in,n=s.input,l=s.avail_in,h=t.hold,p=t.bits,g=l,b=d,$=Fu;e:for(;;)switch(t.mode){case sm:if(t.wrap===0){t.mode=Kx;break}for(;p<16;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}if(t.wrap&2&&h===35615){t.wbits===0&&(t.wbits=15),t.check=0,z[0]=h&255,z[1]=h>>>8&255,t.check=rl(t.check,z,2,0),h=0,p=0,t.mode=T5;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((h&255)<<8)+(h>>8))%31){s.msg="incorrect header check",t.mode=Hs;break}if((h&15)!==j5){s.msg="unknown compression method",t.mode=Hs;break}if(h>>>=4,p-=4,F=(h&15)+8,t.wbits===0&&(t.wbits=F),F>15||F>t.wbits){s.msg="invalid window size",t.mode=Hs;break}t.dmax=1<<t.wbits,t.flags=0,s.adler=t.check=1,t.mode=h&512?M5:ql,h=0,p=0;break;case T5:for(;p<16;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}if(t.flags=h,(t.flags&255)!==j5){s.msg="unknown compression method",t.mode=Hs;break}if(t.flags&57344){s.msg="unknown header flags set",t.mode=Hs;break}t.head&&(t.head.text=h>>8&1),t.flags&512&&t.wrap&4&&(z[0]=h&255,z[1]=h>>>8&255,t.check=rl(t.check,z,2,0)),h=0,p=0,t.mode=D5;case D5:for(;p<32;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}t.head&&(t.head.time=h),t.flags&512&&t.wrap&4&&(z[0]=h&255,z[1]=h>>>8&255,z[2]=h>>>16&255,z[3]=h>>>24&255,t.check=rl(t.check,z,4,0)),h=0,p=0,t.mode=L5;case L5:for(;p<16;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}t.head&&(t.head.xflags=h&255,t.head.os=h>>8),t.flags&512&&t.wrap&4&&(z[0]=h&255,z[1]=h>>>8&255,t.check=rl(t.check,z,2,0)),h=0,p=0,t.mode=R5;case R5:if(t.flags&1024){for(;p<16;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}t.length=h,t.head&&(t.head.extra_len=h),t.flags&512&&t.wrap&4&&(z[0]=h&255,z[1]=h>>>8&255,t.check=rl(t.check,z,2,0)),h=0,p=0}else t.head&&(t.head.extra=null);t.mode=P5;case P5:if(t.flags&1024&&(x=t.length,x>l&&(x=l),x&&(t.head&&(F=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(i,i+x),F)),t.flags&512&&t.wrap&4&&(t.check=rl(t.check,n,x,i)),l-=x,i+=x,t.length-=x),t.length))break e;t.length=0,t.mode=B5;case B5:if(t.flags&2048){if(l===0)break e;x=0;do F=n[i+x++],t.head&&F&&t.length<65536&&(t.head.name+=String.fromCharCode(F));while(F&&x<l);if(t.flags&512&&t.wrap&4&&(t.check=rl(t.check,n,x,i)),l-=x,i+=x,F)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=O5;case O5:if(t.flags&4096){if(l===0)break e;x=0;do F=n[i+x++],t.head&&F&&t.length<65536&&(t.head.comment+=String.fromCharCode(F));while(F&&x<l);if(t.flags&512&&t.wrap&4&&(t.check=rl(t.check,n,x,i)),l-=x,i+=x,F)break e}else t.head&&(t.head.comment=null);t.mode=I5;case I5:if(t.flags&512){for(;p<16;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}if(t.wrap&4&&h!==(t.check&65535)){s.msg="header crc mismatch",t.mode=Hs;break}h=0,p=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),s.adler=t.check=0,t.mode=ql;break;case M5:for(;p<32;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}s.adler=t.check=J5(h),h=0,p=0,t.mode=Tg;case Tg:if(t.havedict===0)return s.next_out=o,s.avail_out=d,s.next_in=i,s.avail_in=l,t.hold=h,t.bits=p,cR;s.adler=t.check=1,t.mode=ql;case ql:if(e===oR||e===pp)break e;case Kx:if(t.last){h>>>=p&7,p-=p&7,t.mode=Jx;break}for(;p<3;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}switch(t.last=h&1,h>>>=1,p-=1,h&3){case 0:t.mode=F5;break;case 1:if(xR(t),t.mode=gp,e===pp){h>>>=2,p-=2;break e}break;case 2:t.mode=z5;break;case 3:s.msg="invalid block type",t.mode=Hs}h>>>=2,p-=2;break;case F5:for(h>>>=p&7,p-=p&7;p<32;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}if((h&65535)!==(h>>>16^65535)){s.msg="invalid stored block lengths",t.mode=Hs;break}if(t.length=h&65535,h=0,p=0,t.mode=Xx,e===pp)break e;case Xx:t.mode=U5;case U5:if(x=t.length,x){if(x>l&&(x=l),x>d&&(x=d),x===0)break e;r.set(n.subarray(i,i+x),o),l-=x,i+=x,d-=x,o+=x,t.length-=x;break}t.mode=ql;break;case z5:for(;p<14;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}if(t.nlen=(h&31)+257,h>>>=5,p-=5,t.ndist=(h&31)+1,h>>>=5,p-=5,t.ncode=(h&15)+4,h>>>=4,p-=4,t.nlen>286||t.ndist>30){s.msg="too many length or distance symbols",t.mode=Hs;break}t.have=0,t.mode=$5;case $5:for(;t.have<t.ncode;){for(;p<3;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}t.lens[q[t.have++]]=h&7,h>>>=3,p-=3}for(;t.have<19;)t.lens[q[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,G={bits:t.lenbits},$=Lf(aR,t.lens,0,19,t.lencode,0,t.work,G),t.lenbits=G.bits,$){s.msg="invalid code lengths set",t.mode=Hs;break}t.have=0,t.mode=q5;case q5:for(;t.have<t.nlen+t.ndist;){for(;_=t.lencode[h&(1<<t.lenbits)-1],N=_>>>24,E=_>>>16&255,k=_&65535,!(N<=p);){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}if(k<16)h>>>=N,p-=N,t.lens[t.have++]=k;else{if(k===16){for(R=N+2;p<R;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}if(h>>>=N,p-=N,t.have===0){s.msg="invalid bit length repeat",t.mode=Hs;break}F=t.lens[t.have-1],x=3+(h&3),h>>>=2,p-=2}else if(k===17){for(R=N+3;p<R;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}h>>>=N,p-=N,F=0,x=3+(h&7),h>>>=3,p-=3}else{for(R=N+7;p<R;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}h>>>=N,p-=N,F=0,x=11+(h&127),h>>>=7,p-=7}if(t.have+x>t.nlen+t.ndist){s.msg="invalid bit length repeat",t.mode=Hs;break}for(;x--;)t.lens[t.have++]=F}}if(t.mode===Hs)break;if(t.lens[256]===0){s.msg="invalid code -- missing end-of-block",t.mode=Hs;break}if(t.lenbits=9,G={bits:t.lenbits},$=Lf(w4,t.lens,0,t.nlen,t.lencode,0,t.work,G),t.lenbits=G.bits,$){s.msg="invalid literal/lengths set",t.mode=Hs;break}if(t.distbits=6,t.distcode=t.distdyn,G={bits:t.distbits},$=Lf(S4,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,G),t.distbits=G.bits,$){s.msg="invalid distances set",t.mode=Hs;break}if(t.mode=gp,e===pp)break e;case gp:t.mode=mp;case mp:if(l>=6&&d>=258){s.next_out=o,s.avail_out=d,s.next_in=i,s.avail_in=l,t.hold=h,t.bits=p,eR(s,b),o=s.next_out,r=s.output,d=s.avail_out,i=s.next_in,n=s.input,l=s.avail_in,h=t.hold,p=t.bits,t.mode===ql&&(t.back=-1);break}for(t.back=0;_=t.lencode[h&(1<<t.lenbits)-1],N=_>>>24,E=_>>>16&255,k=_&65535,!(N<=p);){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}if(E&&(E&240)===0){for(T=N,P=E,O=k;_=t.lencode[O+((h&(1<<T+P)-1)>>T)],N=_>>>24,E=_>>>16&255,k=_&65535,!(T+N<=p);){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}h>>>=T,p-=T,t.back+=T}if(h>>>=N,p-=N,t.back+=N,t.length=k,E===0){t.mode=Y5;break}if(E&32){t.back=-1,t.mode=ql;break}if(E&64){s.msg="invalid literal/length code",t.mode=Hs;break}t.extra=E&15,t.mode=H5;case H5:if(t.extra){for(R=t.extra;p<R;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}t.length+=h&(1<<t.extra)-1,h>>>=t.extra,p-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=G5;case G5:for(;_=t.distcode[h&(1<<t.distbits)-1],N=_>>>24,E=_>>>16&255,k=_&65535,!(N<=p);){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}if((E&240)===0){for(T=N,P=E,O=k;_=t.distcode[O+((h&(1<<T+P)-1)>>T)],N=_>>>24,E=_>>>16&255,k=_&65535,!(T+N<=p);){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}h>>>=T,p-=T,t.back+=T}if(h>>>=N,p-=N,t.back+=N,E&64){s.msg="invalid distance code",t.mode=Hs;break}t.offset=k,t.extra=E&15,t.mode=V5;case V5:if(t.extra){for(R=t.extra;p<R;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}t.offset+=h&(1<<t.extra)-1,h>>>=t.extra,p-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){s.msg="invalid distance too far back",t.mode=Hs;break}t.mode=W5;case W5:if(d===0)break e;if(x=b-d,t.offset>x){if(x=t.offset-x,x>t.whave&&t.sane){s.msg="invalid distance too far back",t.mode=Hs;break}x>t.wnext?(x-=t.wnext,w=t.wsize-x):w=t.wnext-x,x>t.length&&(x=t.length),v=t.window}else v=r,w=o-t.offset,x=t.length;x>d&&(x=d),d-=x,t.length-=x;do r[o++]=v[w++];while(--x);t.length===0&&(t.mode=mp);break;case Y5:if(d===0)break e;r[o++]=t.length,d--,t.mode=mp;break;case Jx:if(t.wrap){for(;p<32;){if(l===0)break e;l--,h|=n[i++]<<p,p+=8}if(b-=d,s.total_out+=b,t.total+=b,t.wrap&4&&b&&(s.adler=t.check=t.flags?rl(t.check,r,b,o-b):J1(t.check,r,b,o-b)),b=d,t.wrap&4&&(t.flags?h:J5(h))!==t.check){s.msg="incorrect data check",t.mode=Hs;break}h=0,p=0}t.mode=K5;case K5:if(t.wrap&&t.flags){for(;p<32;){if(l===0)break e;l--,h+=n[i++]<<p,p+=8}if(t.wrap&4&&h!==(t.total&4294967295)){s.msg="incorrect length check",t.mode=Hs;break}h=0,p=0}t.mode=X5;case X5:$=lR;break e;case Hs:$=_4;break e;case N4:return A4;case C4:default:return Ja}return s.next_out=o,s.avail_out=d,s.next_in=i,s.avail_in=l,t.hold=h,t.bits=p,(t.wsize||b!==s.avail_out&&t.mode<Hs&&(t.mode<Jx||e!==k5))&&D4(s,s.output,s.next_out,b-s.avail_out),g-=s.avail_in,b-=s.avail_out,s.total_in+=g,s.total_out+=b,t.total+=b,t.wrap&4&&b&&(s.adler=t.check=t.flags?rl(t.check,r,b,s.next_out-b):J1(t.check,r,b,s.next_out-b)),s.data_type=t.bits+(t.last?64:0)+(t.mode===ql?128:0)+(t.mode===gp||t.mode===Xx?256:0),(g===0&&b===0||e===k5)&&$===Fu&&($=uR),$},yR=s=>{if(Hu(s))return Ja;let e=s.state;return e.window&&(e.window=null),s.state=null,Fu},vR=(s,e)=>{if(Hu(s))return Ja;const t=s.state;return(t.wrap&2)===0?Ja:(t.head=e,e.done=!1,Fu)},wR=(s,e)=>{const t=e.length;let n,r,i;return Hu(s)||(n=s.state,n.wrap!==0&&n.mode!==Tg)?Ja:n.mode===Tg&&(r=1,r=J1(r,e,t,0),r!==n.check)?_4:(i=D4(s,e,t,t),i?(n.mode=N4,A4):(n.havedict=1,Fu))};var SR=k4,_R=j4,AR=E4,NR=mR,CR=T4,ER=bR,kR=yR,jR=vR,TR=wR,DR="pako inflate (from Nodeca project)",Wl={inflateReset:SR,inflateReset2:_R,inflateResetKeep:AR,inflateInit:NR,inflateInit2:CR,inflate:ER,inflateEnd:kR,inflateGetHeader:jR,inflateSetDictionary:TR,inflateInfo:DR};function LR(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var RR=LR;const L4=Object.prototype.toString,{Z_NO_FLUSH:PR,Z_FINISH:BR,Z_OK:Wf,Z_STREAM_END:e1,Z_NEED_DICT:t1,Z_STREAM_ERROR:OR,Z_DATA_ERROR:Q5,Z_MEM_ERROR:IR}=b4;function s0(s){this.options=y4.assign({chunkSize:1024*64,windowBits:15,to:""},s||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(s&&s.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZL,this.strm.avail_out=0;let t=Wl.inflateInit2(this.strm,e.windowBits);if(t!==Wf)throw new Error(Z1[t]);if(this.header=new RR,Wl.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Q1.string2buf(e.dictionary):L4.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=Wl.inflateSetDictionary(this.strm,e.dictionary),t!==Wf)))throw new Error(Z1[t])}s0.prototype.push=function(s,e){const t=this.strm,n=this.options.chunkSize,r=this.options.dictionary;let i,o,l;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?BR:PR,L4.call(s)==="[object ArrayBuffer]"?t.input=new Uint8Array(s):t.input=s,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),i=Wl.inflate(t,o),i===t1&&r&&(i=Wl.inflateSetDictionary(t,r),i===Wf?i=Wl.inflate(t,o):i===Q5&&(i=t1));t.avail_in>0&&i===e1&&t.state.wrap>0&&s[t.next_in]!==0;)Wl.inflateReset(t),i=Wl.inflate(t,o);switch(i){case OR:case Q5:case t1:case IR:return this.onEnd(i),this.ended=!0,!1}if(l=t.avail_out,t.next_out&&(t.avail_out===0||i===e1))if(this.options.to==="string"){let d=Q1.utf8border(t.output,t.next_out),h=t.next_out-d,p=Q1.buf2string(t.output,d);t.next_out=h,t.avail_out=n-h,h&&t.output.set(t.output.subarray(d,d+h),0),this.onData(p)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(i===Wf&&l===0)){if(i===e1)return i=Wl.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};s0.prototype.onData=function(s){this.chunks.push(s)};s0.prototype.onEnd=function(s){s===Wf&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=y4.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};function MR(s,e){const t=new s0(e);if(t.push(s),t.err)throw t.msg||Z1[t.err];return t.result}var FR=s0,UR=MR,zR={Inflate:FR,inflate:UR};const{Inflate:$R,inflate:qR}=zR;var eS=$R,HR=qR;const R4=[];for(let s=0;s<256;s++){let e=s;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;R4[s]=e}const tS=4294967295;function GR(s,e,t){let n=s;for(let r=0;r<t;r++)n=R4[(n^e[r])&255]^n>>>8;return n}function VR(s,e){return(GR(tS,s,e)^tS)>>>0}function nS(s,e,t){const n=s.readUint32(),r=VR(new Uint8Array(s.buffer,s.byteOffset+s.offset-e-4,e),e);if(r!==n)throw new Error(`CRC mismatch for chunk ${t}. Expected ${n}, found ${r}`)}function P4(s,e,t){for(let n=0;n<t;n++)e[n]=s[n]}function B4(s,e,t,n){let r=0;for(;r<n;r++)e[r]=s[r];for(;r<t;r++)e[r]=s[r]+e[r-n]&255}function O4(s,e,t,n){let r=0;if(t.length===0)for(;r<n;r++)e[r]=s[r];else for(;r<n;r++)e[r]=s[r]+t[r]&255}function I4(s,e,t,n,r){let i=0;if(t.length===0){for(;i<r;i++)e[i]=s[i];for(;i<n;i++)e[i]=s[i]+(e[i-r]>>1)&255}else{for(;i<r;i++)e[i]=s[i]+(t[i]>>1)&255;for(;i<n;i++)e[i]=s[i]+(e[i-r]+t[i]>>1)&255}}function M4(s,e,t,n,r){let i=0;if(t.length===0){for(;i<r;i++)e[i]=s[i];for(;i<n;i++)e[i]=s[i]+e[i-r]&255}else{for(;i<r;i++)e[i]=s[i]+t[i]&255;for(;i<n;i++)e[i]=s[i]+WR(e[i-r],t[i],t[i-r])&255}}function WR(s,e,t){const n=s+e-t,r=Math.abs(n-s),i=Math.abs(n-e),o=Math.abs(n-t);return r<=i&&r<=o?s:i<=o?e:t}function YR(s,e,t,n,r,i){switch(s){case 0:P4(e,t,r);break;case 1:B4(e,t,r,i);break;case 2:O4(e,t,n,r);break;case 3:I4(e,t,n,r,i);break;case 4:M4(e,t,n,r,i);break;default:throw new Error(`Unsupported filter: ${s}`)}}const KR=new Uint16Array([255]),XR=new Uint8Array(KR.buffer),JR=XR[0]===255;function ZR(s){const{data:e,width:t,height:n,channels:r,depth:i}=s,o=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],l=Math.ceil(i/8)*r,d=new Uint8Array(n*t*l);let h=0;for(let p=0;p<7;p++){const g=o[p],b=Math.ceil((t-g.x)/g.xStep),x=Math.ceil((n-g.y)/g.yStep);if(b<=0||x<=0)continue;const w=b*l,v=new Uint8Array(w);for(let _=0;_<x;_++){const N=e[h++],E=e.subarray(h,h+w);h+=w;const k=new Uint8Array(w);YR(N,E,k,v,w,l),v.set(k);for(let T=0;T<b;T++){const P=g.x+T*g.xStep,O=g.y+_*g.yStep;if(!(P>=t||O>=n))for(let F=0;F<l;F++)d[(O*t+P)*l+F]=k[T*l+F]}}}if(i===16){const p=new Uint16Array(d.buffer);if(JR)for(let g=0;g<p.length;g++)p[g]=QR(p[g]);return p}else return d}function QR(s){return(s&255)<<8|s>>8&255}const e7=new Uint16Array([255]),t7=new Uint8Array(e7.buffer),n7=t7[0]===255,s7=new Uint8Array(0);function sS(s){const{data:e,width:t,height:n,channels:r,depth:i}=s,o=Math.ceil(i/8)*r,l=Math.ceil(i/8*r*t),d=new Uint8Array(n*l);let h=s7,p=0,g,b;for(let x=0;x<n;x++){switch(g=e.subarray(p+1,p+1+l),b=d.subarray(x*l,(x+1)*l),e[p]){case 0:P4(g,b,l);break;case 1:B4(g,b,l,o);break;case 2:O4(g,b,h,l);break;case 3:I4(g,b,h,l,o);break;case 4:M4(g,b,h,l,o);break;default:throw new Error(`Unsupported filter: ${e[p]}`)}h=b,p+=l+1}if(i===16){const x=new Uint16Array(d.buffer);if(n7)for(let w=0;w<x.length;w++)x[w]=r7(x[w]);return x}else return d}function r7(s){return(s&255)<<8|s>>8&255}const lg=Uint8Array.of(137,80,78,71,13,10,26,10);function rS(s){if(!i7(s.readBytes(lg.length)))throw new Error("wrong PNG signature")}function i7(s){if(s.length<lg.length)return!1;for(let e=0;e<lg.length;e++)if(s[e]!==lg[e])return!1;return!0}const a7="tEXt",o7=0,F4=new TextDecoder("latin1");function l7(s){if(u7(s),s.length===0||s.length>79)throw new Error("keyword length must be between 1 and 79")}const c7=/^[\u0000-\u00FF]*$/;function u7(s){if(!c7.test(s))throw new Error("invalid latin1 text")}function d7(s,e,t){const n=U4(e);s[n]=h7(e,t-n.length-1)}function U4(s){for(s.mark();s.readByte()!==o7;);const e=s.offset;s.reset();const t=F4.decode(s.readBytes(e-s.offset-1));return s.skip(1),l7(t),t}function h7(s,e){return F4.decode(s.readBytes(e))}const ya={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},n1={UNKNOWN:-1,DEFLATE:0},iS={UNKNOWN:-1,ADAPTIVE:0},s1={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},xp={NONE:0,BACKGROUND:1,PREVIOUS:2},r1={SOURCE:0,OVER:1};class f7 extends qb{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(e,t={}){super(e);const{checkCrc:n=!1}=t;this._checkCrc=n,this._inflator=new eS,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=n1.UNKNOWN,this._filterMethod=iS.UNKNOWN,this._interlaceMethod=s1.UNKNOWN,this._colorType=ya.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(rS(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(rS(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const n=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case a7:d7(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-n!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?nS(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const n=this.offset;switch(t!=="fdAT"&&t!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=n+e;break}if(this.offset-n!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?nS(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=p7(this.readUint8());const t=this.readUint8();this._colorType=t;let n;switch(t){case ya.GREYSCALE:n=1;break;case ya.TRUECOLOUR:n=3;break;case ya.INDEXED_COLOUR:n=1;break;case ya.GREYSCALE_ALPHA:n=2;break;case ya.TRUECOLOUR_ALPHA:n=4;break;case ya.UNKNOWN:default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==n1.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const n=[];this._palette=n;for(let r=0;r<t;r++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,n=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,n,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,n=this.offset+this.byteOffset;if(n+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,n,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodetRNS(e){switch(this._colorType){case ya.GREYSCALE:case ya.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break}case ya.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const n=this.readByte();this._palette[t].push(n)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}case ya.UNKNOWN:case ya.GREYSCALE_ALPHA:case ya.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){const t=U4(this),n=this.readUint8();if(n!==n1.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${n}`);const r=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:HR(r)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),n=this.readByte();this._png.resolution={x:e,y:t,unit:n}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},n=this._frames.at(e);if(n){if(n.data=sS({data:n.data,width:n.width,height:n.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),e===0||n.xOffset===0&&n.yOffset===0&&n.width===this._png.width&&n.height===this._png.height)t.data=n.data;else{const r=this._apng.frames.at(e-1);this.disposeFrame(n,r,t),this.addFrameDataToCanvas(t,n)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,n){switch(e.disposeOp){case xp.NONE:break;case xp.BACKGROUND:for(let r=0;r<this._png.height;r++)for(let i=0;i<this._png.width;i++){const o=(r*e.width+i)*this._png.channels;for(let l=0;l<this._png.channels;l++)n.data[o+l]=0}break;case xp.PREVIOUS:n.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const n=1<<this._png.depth,r=(i,o)=>{const l=((i+t.yOffset)*this._png.width+t.xOffset+o)*this._png.channels,d=(i*t.width+o)*this._png.channels;return{index:l,frameIndex:d}};switch(t.blendOp){case r1.SOURCE:for(let i=0;i<t.height;i++)for(let o=0;o<t.width;o++){const{index:l,frameIndex:d}=r(i,o);for(let h=0;h<this._png.channels;h++)e.data[l+h]=t.data[d+h]}break;case r1.OVER:for(let i=0;i<t.height;i++)for(let o=0;o<t.width;o++){const{index:l,frameIndex:d}=r(i,o);for(let h=0;h<this._png.channels;h++){const p=t.data[d+this._png.channels-1]/n,g=h%(this._png.channels-1)===0?1:t.data[d+h],b=Math.floor(p*g+(1-p)*e.data[l+h]);e.data[l+h]+=b}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==iS.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===s1.NO_INTERLACE)this._png.data=sS({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===s1.ADAM7)this._png.data=ZR({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:xp.NONE,blendOp:r1.SOURCE,data:e}),this._inflator=new eS,this._writingDataChunks=!1}}function p7(s){if(s!==1&&s!==2&&s!==4&&s!==8&&s!==16)throw new Error(`invalid bit depth: ${s}`);return s}var aS;(function(s){s[s.UNKNOWN=0]="UNKNOWN",s[s.METRE=1]="METRE"})(aS||(aS={}));function g7(s,e){return new f7(s,e).decode()}var vn=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function i1(){vn.console&&typeof vn.console.log=="function"&&vn.console.log.apply(vn.console,arguments)}var js={log:i1,warn:function(s){vn.console&&(typeof vn.console.warn=="function"?vn.console.warn.apply(vn.console,arguments):i1.call(null,arguments))},error:function(s){vn.console&&(typeof vn.console.error=="function"?vn.console.error.apply(vn.console,arguments):i1(s))}};function a1(s,e,t){var n=new XMLHttpRequest;n.open("GET",s),n.responseType="blob",n.onload=function(){_u(n.response,e,t)},n.onerror=function(){js.error("could not download file")},n.send()}function oS(s){var e=new XMLHttpRequest;e.open("HEAD",s,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function bp(s){try{s.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),s.dispatchEvent(e)}}var _u=vn.saveAs||((typeof window>"u"?"undefined":gs(window))!=="object"||window!==vn?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(s,e,t){var n=vn.URL||vn.webkitURL,r=document.createElement("a");e=e||s.name||"download",r.download=e,r.rel="noopener",typeof s=="string"?(r.href=s,r.origin!==location.origin?oS(r.href)?a1(s,e,t):bp(r,r.target="_blank"):bp(r)):(r.href=n.createObjectURL(s),setTimeout(function(){n.revokeObjectURL(r.href)},4e4),setTimeout(function(){bp(r)},0))}:"msSaveOrOpenBlob"in navigator?function(s,e,t){if(e=e||s.name||"download",typeof s=="string")if(oS(s))a1(s,e,t);else{var n=document.createElement("a");n.href=s,n.target="_blank",setTimeout(function(){bp(n)})}else navigator.msSaveOrOpenBlob((function(r,i){return i===void 0?i={autoBom:!1}:gs(i)!=="object"&&(js.warn("Deprecated: Expected third argument to be a object"),i={autoBom:!i}),i.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(r.type)?new Blob(["\uFEFF",r],{type:r.type}):r})(s,t),e)}:function(s,e,t,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof s=="string")return a1(s,e,t);var r=s.type==="application/octet-stream",i=/constructor/i.test(vn.HTMLElement)||vn.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent);if((o||r&&i)&&(typeof FileReader>"u"?"undefined":gs(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var p=l.result;p=o?p:p.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=p:location=p,n=null},l.readAsDataURL(s)}else{var d=vn.URL||vn.webkitURL,h=d.createObjectURL(s);n?n.location=h:location.href=h,n=null,setTimeout(function(){d.revokeObjectURL(h)},4e4)}});function z4(s){var e;s=s||"",this.ok=!1,s.charAt(0)=="#"&&(s=s.substr(1,6)),s={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[s=(s=s.replace(/ /g,"")).toLowerCase()]||s;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],n=0;n<t.length;n++){var r=t[n].re,i=t[n].process,o=r.exec(s);o&&(e=i(o),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),d=this.g.toString(16),h=this.b.toString(16);return l.length==1&&(l="0"+l),d.length==1&&(d="0"+d),h.length==1&&(h="0"+h),"#"+l+d+h}}var cg=vn.atob.bind(vn),lS=vn.btoa.bind(vn);function o1(s,e){var t=s[0],n=s[1],r=s[2],i=s[3];t=vi(t,n,r,i,e[0],7,-680876936),i=vi(i,t,n,r,e[1],12,-389564586),r=vi(r,i,t,n,e[2],17,606105819),n=vi(n,r,i,t,e[3],22,-1044525330),t=vi(t,n,r,i,e[4],7,-176418897),i=vi(i,t,n,r,e[5],12,1200080426),r=vi(r,i,t,n,e[6],17,-1473231341),n=vi(n,r,i,t,e[7],22,-45705983),t=vi(t,n,r,i,e[8],7,1770035416),i=vi(i,t,n,r,e[9],12,-1958414417),r=vi(r,i,t,n,e[10],17,-42063),n=vi(n,r,i,t,e[11],22,-1990404162),t=vi(t,n,r,i,e[12],7,1804603682),i=vi(i,t,n,r,e[13],12,-40341101),r=vi(r,i,t,n,e[14],17,-1502002290),t=wi(t,n=vi(n,r,i,t,e[15],22,1236535329),r,i,e[1],5,-165796510),i=wi(i,t,n,r,e[6],9,-1069501632),r=wi(r,i,t,n,e[11],14,643717713),n=wi(n,r,i,t,e[0],20,-373897302),t=wi(t,n,r,i,e[5],5,-701558691),i=wi(i,t,n,r,e[10],9,38016083),r=wi(r,i,t,n,e[15],14,-660478335),n=wi(n,r,i,t,e[4],20,-405537848),t=wi(t,n,r,i,e[9],5,568446438),i=wi(i,t,n,r,e[14],9,-1019803690),r=wi(r,i,t,n,e[3],14,-187363961),n=wi(n,r,i,t,e[8],20,1163531501),t=wi(t,n,r,i,e[13],5,-1444681467),i=wi(i,t,n,r,e[2],9,-51403784),r=wi(r,i,t,n,e[7],14,1735328473),t=Si(t,n=wi(n,r,i,t,e[12],20,-1926607734),r,i,e[5],4,-378558),i=Si(i,t,n,r,e[8],11,-2022574463),r=Si(r,i,t,n,e[11],16,1839030562),n=Si(n,r,i,t,e[14],23,-35309556),t=Si(t,n,r,i,e[1],4,-1530992060),i=Si(i,t,n,r,e[4],11,1272893353),r=Si(r,i,t,n,e[7],16,-155497632),n=Si(n,r,i,t,e[10],23,-1094730640),t=Si(t,n,r,i,e[13],4,681279174),i=Si(i,t,n,r,e[0],11,-358537222),r=Si(r,i,t,n,e[3],16,-722521979),n=Si(n,r,i,t,e[6],23,76029189),t=Si(t,n,r,i,e[9],4,-640364487),i=Si(i,t,n,r,e[12],11,-421815835),r=Si(r,i,t,n,e[15],16,530742520),t=_i(t,n=Si(n,r,i,t,e[2],23,-995338651),r,i,e[0],6,-198630844),i=_i(i,t,n,r,e[7],10,1126891415),r=_i(r,i,t,n,e[14],15,-1416354905),n=_i(n,r,i,t,e[5],21,-57434055),t=_i(t,n,r,i,e[12],6,1700485571),i=_i(i,t,n,r,e[3],10,-1894986606),r=_i(r,i,t,n,e[10],15,-1051523),n=_i(n,r,i,t,e[1],21,-2054922799),t=_i(t,n,r,i,e[8],6,1873313359),i=_i(i,t,n,r,e[15],10,-30611744),r=_i(r,i,t,n,e[6],15,-1560198380),n=_i(n,r,i,t,e[13],21,1309151649),t=_i(t,n,r,i,e[4],6,-145523070),i=_i(i,t,n,r,e[11],10,-1120210379),r=_i(r,i,t,n,e[2],15,718787259),n=_i(n,r,i,t,e[9],21,-343485551),s[0]=zc(t,s[0]),s[1]=zc(n,s[1]),s[2]=zc(r,s[2]),s[3]=zc(i,s[3])}function rm(s,e,t,n,r,i){return e=zc(zc(e,s),zc(n,i)),zc(e<<r|e>>>32-r,t)}function vi(s,e,t,n,r,i,o){return rm(e&t|~e&n,s,e,r,i,o)}function wi(s,e,t,n,r,i,o){return rm(e&n|t&~n,s,e,r,i,o)}function Si(s,e,t,n,r,i,o){return rm(e^t^n,s,e,r,i,o)}function _i(s,e,t,n,r,i,o){return rm(t^(e|~n),s,e,r,i,o)}function $4(s){var e,t=s.length,n=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=s.length;e+=64)o1(n,m7(s.substring(e-64,e)));s=s.substring(e-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<s.length;e++)r[e>>2]|=s.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(o1(n,r),e=0;e<16;e++)r[e]=0;return r[14]=8*t,o1(n,r),n}function m7(s){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=s.charCodeAt(e)+(s.charCodeAt(e+1)<<8)+(s.charCodeAt(e+2)<<16)+(s.charCodeAt(e+3)<<24);return t}var cS="0123456789abcdef".split("");function x7(s){for(var e="",t=0;t<4;t++)e+=cS[s>>8*t+4&15]+cS[s>>8*t&15];return e}function b7(s){return String.fromCharCode(255&s,(65280&s)>>8,(16711680&s)>>16,(4278190080&s)>>24)}function eb(s){return $4(s).map(b7).join("")}var y7=(function(s){for(var e=0;e<s.length;e++)s[e]=x7(s[e]);return s.join("")})($4("hello"))!="5d41402abc4b2a76b9719d911017c592";function zc(s,e){if(y7){var t=(65535&s)+(65535&e);return(s>>16)+(e>>16)+(t>>16)<<16|65535&t}return s+e&4294967295}function tb(s,e){var t,n,r,i;if(s!==t){for(var o=(r=s,i=1+(256/s.length|0),new Array(i+1).join(r)),l=[],d=0;d<256;d++)l[d]=d;var h=0;for(d=0;d<256;d++){var p=l[d];h=(h+p+o.charCodeAt(d))%256,l[d]=l[h],l[h]=p}t=s,n=l}else l=n;var g=e.length,b=0,x=0,w="";for(d=0;d<g;d++)x=(x+(p=l[b=(b+1)%256]))%256,l[b]=l[x],l[x]=p,o=l[(l[b]+l[x])%256],w+=String.fromCharCode(e.charCodeAt(d)^o);return w}var uS={print:4,modify:8,copy:16,"annot-forms":32};function Jd(s,e,t,n){this.v=1,this.r=2;var r=192;s.forEach(function(l){if(uS.perm!==void 0)throw new Error("Invalid permission: "+l);r+=uS[l]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var i=(e+this.padding).substr(0,32),o=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(i,o),this.P=-(1+(255^r)),this.encryptionKey=eb(i+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=tb(this.encryptionKey,this.padding)}function Zd(s){if(/[^\u0000-\u00ff]/.test(s))throw new Error("Invalid PDF Name Object: "+s+", Only accept ASCII characters.");for(var e="",t=s.length,n=0;n<t;n++){var r=s.charCodeAt(n);e+=r<33||r===35||r===37||r===40||r===41||r===47||r===60||r===62||r===91||r===93||r===123||r===125||r>126?"#"+("0"+r.toString(16)).slice(-2):s[n]}return e}function dS(s){if(gs(s)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,n,r){if(r=r||!1,typeof t!="string"||typeof n!="function"||typeof r!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var i=Math.random().toString(35);return e[t][i]=[n,!!r],i},this.unsubscribe=function(t){for(var n in e)if(e[n][t])return delete e[n][t],Object.keys(e[n]).length===0&&delete e[n],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var n=Array.prototype.slice.call(arguments,1),r=[];for(var i in e[t]){var o=e[t][i];try{o[0].apply(s,n)}catch(l){vn.console&&js.error("jsPDF PubSub Error",l.message,l)}o[1]&&r.push(i)}r.length&&r.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function Dg(s){if(!(this instanceof Dg))return new Dg(s);var e="opacity,stroke-opacity".split(",");for(var t in s)s.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=s[t]);this.id="",this.objectNumber=-1}function q4(s,e){this.gState=s,this.matrix=e,this.id="",this.objectNumber=-1}function Eu(s,e,t,n,r){if(!(this instanceof Eu))return new Eu(s,e,t,n,r);this.type=s==="axial"?2:3,this.coords=e,this.colors=t,q4.call(this,n,r)}function sh(s,e,t,n,r){if(!(this instanceof sh))return new sh(s,e,t,n,r);this.boundingBox=s,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,q4.call(this,n,r)}function nn(s){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],r=arguments[2],i=arguments[3],o=[],l=1,d=16,h="S",p=null;gs(s=s||{})==="object"&&(t=s.orientation,n=s.unit||n,r=s.format||r,i=s.compress||s.compressPdf||i,(p=s.encryption||null)!==null&&(p.userPassword=p.userPassword||"",p.ownerPassword=p.ownerPassword||"",p.userPermissions=p.userPermissions||[]),l=typeof s.userUnit=="number"?Math.abs(s.userUnit):1,s.precision!==void 0&&(e=s.precision),s.floatPrecision!==void 0&&(d=s.floatPrecision),h=s.defaultPathOperation||"S"),o=s.filters||(i===!0?["FlateEncode"]:o),n=n||"mm",t=(""+(t||"P")).toLowerCase();var g=s.putOnlyUsedFonts||!1,b={},x={internal:{},__private__:{}};x.__private__.PubSub=dS;var w="1.3",v=x.__private__.getPdfVersion=function(){return w};x.__private__.setPdfVersion=function(j){w=j};var _={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};x.__private__.getPageFormats=function(){return _};var N=x.__private__.getPageFormat=function(j){return _[j]};r=r||"a4";var E="compat",k="advanced",T=E;function P(){this.saveGraphicsState(),X(new re(Te,0,0,-Te,0,io()*Te).toString()+" cm"),this.setFontSize(this.getFontSize()/Te),h="n",T=k}function O(){this.restoreGraphicsState(),h="S",T=E}var F=x.__private__.combineFontStyleAndFontWeight=function(j,V){if(j=="bold"&&V=="normal"||j=="bold"&&V==400||j=="normal"&&V=="italic"||j=="bold"&&V=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return V&&(j=V==400||V==="normal"?j==="italic"?"italic":"normal":V!=700&&V!=="bold"||j!=="normal"?(V==700?"bold":V)+""+j:"bold"),j};x.advancedAPI=function(j){var V=T===E;return V&&P.call(this),typeof j!="function"||(j(this),V&&O.call(this)),this},x.compatAPI=function(j){var V=T===k;return V&&O.call(this),typeof j!="function"||(j(this),V&&P.call(this)),this},x.isAdvancedAPI=function(){return T===k};var $,z=function(j){if(T!==k)throw new Error(j+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},G=x.roundToPrecision=x.__private__.roundToPrecision=function(j,V){var ge=e||V;if(isNaN(j)||isNaN(ge))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return j.toFixed(ge).replace(/0+$/,"")};$=x.hpf=x.__private__.hpf=typeof d=="number"?function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.hpf");return G(j,d)}:d==="smart"?function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.hpf");return G(j,j>-1&&j<1?16:5)}:function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.hpf");return G(j,16)};var R=x.f2=x.__private__.f2=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.f2");return G(j,2)},q=x.__private__.f3=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.f3");return G(j,3)},J=x.scale=x.__private__.scale=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.scale");return T===E?j*Te:T===k?j:void 0},Z=function(j){return J((function(V){return T===E?io()-V:T===k?V:void 0})(j))};x.__private__.setPrecision=x.setPrecision=function(j){typeof parseInt(j,10)=="number"&&(e=parseInt(j,10))};var le,K="00000000000000000000000000000000",se=x.__private__.getFileId=function(){return K},ce=x.__private__.setFileId=function(j){return K=j!==void 0&&/^[a-fA-F0-9]{32}$/.test(j)?j.toUpperCase():K.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),p!==null&&(Ze=new Jd(p.userPermissions,p.userPassword,p.ownerPassword,K)),K};x.setFileId=function(j){return ce(j),this},x.getFileId=function(){return se()};var ye=x.__private__.convertDateToPDFDate=function(j){var V=j.getTimezoneOffset(),ge=V<0?"+":"-",we=Math.floor(Math.abs(V/60)),De=Math.abs(V%60),at=[ge,H(we),"'",H(De),"'"].join("");return["D:",j.getFullYear(),H(j.getMonth()+1),H(j.getDate()),H(j.getHours()),H(j.getMinutes()),H(j.getSeconds()),at].join("")},Ce=x.__private__.convertPDFDateToDate=function(j){var V=parseInt(j.substr(2,4),10),ge=parseInt(j.substr(6,2),10)-1,we=parseInt(j.substr(8,2),10),De=parseInt(j.substr(10,2),10),at=parseInt(j.substr(12,2),10),_t=parseInt(j.substr(14,2),10);return new Date(V,ge,we,De,at,_t,0)},M=x.__private__.setCreationDate=function(j){var V;if(j===void 0&&(j=new Date),j instanceof Date)V=ye(j);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(j))throw new Error("Invalid argument passed to jsPDF.setCreationDate");V=j}return le=V},L=x.__private__.getCreationDate=function(j){var V=le;return j==="jsDate"&&(V=Ce(le)),V};x.setCreationDate=function(j){return M(j),this},x.getCreationDate=function(j){return L(j)};var U,H=x.__private__.padd2=function(j){return("0"+parseInt(j)).slice(-2)},ae=x.__private__.padd2Hex=function(j){return("00"+(j=j.toString())).substr(j.length)},de=0,xe=[],he=[],me=0,ve=[],Re=[],Ke=!1,Ge=he;x.__private__.setCustomOutputDestination=function(j){Ke=!0,Ge=j};var ke=function(j){Ke||(Ge=j)};x.__private__.resetCustomOutputDestination=function(){Ke=!1,Ge=he};var X=x.__private__.out=function(j){return j=j.toString(),me+=j.length+1,Ge.push(j),Ge},Pe=x.__private__.write=function(j){return X(arguments.length===1?j.toString():Array.prototype.join.call(arguments," "))},gt=x.__private__.getArrayBuffer=function(j){for(var V=j.length,ge=new ArrayBuffer(V),we=new Uint8Array(ge);V--;)we[V]=j.charCodeAt(V);return ge},bt=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];x.__private__.getStandardFonts=function(){return bt};var Ye=s.fontSize||16;x.__private__.setFontSize=x.setFontSize=function(j){return Ye=T===k?j/Te:j,this};var Et,vt=x.__private__.getFontSize=x.getFontSize=function(){return T===E?Ye:Ye*Te},st=s.R2L||!1;x.__private__.setR2L=x.setR2L=function(j){return st=j,this},x.__private__.getR2L=x.getR2L=function(){return st};var St,Pt=x.__private__.setZoomMode=function(j){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(j))Et=j;else if(isNaN(j)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(j)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+j+'" is not recognized.');Et=j}else Et=parseInt(j,10)};x.__private__.getZoomMode=function(){return Et};var Ut,je=x.__private__.setPageMode=function(j){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(j)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+j+'" is not recognized.');St=j};x.__private__.getPageMode=function(){return St};var Me=x.__private__.setLayoutMode=function(j){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(j)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+j+'" is not recognized.');Ut=j};x.__private__.getLayoutMode=function(){return Ut},x.__private__.setDisplayMode=x.setDisplayMode=function(j,V,ge){return Pt(j),Me(V),je(ge),this};var Fe={title:"",subject:"",author:"",keywords:"",creator:""};x.__private__.getDocumentProperty=function(j){if(Object.keys(Fe).indexOf(j)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Fe[j]},x.__private__.getDocumentProperties=function(){return Fe},x.__private__.setDocumentProperties=x.setProperties=x.setDocumentProperties=function(j){for(var V in Fe)Fe.hasOwnProperty(V)&&j[V]&&(Fe[V]=j[V]);return this},x.__private__.setDocumentProperty=function(j,V){if(Object.keys(Fe).indexOf(j)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Fe[j]=V};var ue,Te,Oe,ct,ft,wt={},it={},At=[],We={},lt={},pt={},It={},en=null,Mt=0,Bt=[],Yt=new dS(x),On=s.hotfixes||[],an={},As={},ut=[],re=function j(V,ge,we,De,at,_t){if(!(this instanceof j))return new j(V,ge,we,De,at,_t);isNaN(V)&&(V=1),isNaN(ge)&&(ge=0),isNaN(we)&&(we=0),isNaN(De)&&(De=1),isNaN(at)&&(at=0),isNaN(_t)&&(_t=0),this._matrix=[V,ge,we,De,at,_t]};Object.defineProperty(re.prototype,"sx",{get:function(){return this._matrix[0]},set:function(j){this._matrix[0]=j}}),Object.defineProperty(re.prototype,"shy",{get:function(){return this._matrix[1]},set:function(j){this._matrix[1]=j}}),Object.defineProperty(re.prototype,"shx",{get:function(){return this._matrix[2]},set:function(j){this._matrix[2]=j}}),Object.defineProperty(re.prototype,"sy",{get:function(){return this._matrix[3]},set:function(j){this._matrix[3]=j}}),Object.defineProperty(re.prototype,"tx",{get:function(){return this._matrix[4]},set:function(j){this._matrix[4]=j}}),Object.defineProperty(re.prototype,"ty",{get:function(){return this._matrix[5]},set:function(j){this._matrix[5]=j}}),Object.defineProperty(re.prototype,"a",{get:function(){return this._matrix[0]},set:function(j){this._matrix[0]=j}}),Object.defineProperty(re.prototype,"b",{get:function(){return this._matrix[1]},set:function(j){this._matrix[1]=j}}),Object.defineProperty(re.prototype,"c",{get:function(){return this._matrix[2]},set:function(j){this._matrix[2]=j}}),Object.defineProperty(re.prototype,"d",{get:function(){return this._matrix[3]},set:function(j){this._matrix[3]=j}}),Object.defineProperty(re.prototype,"e",{get:function(){return this._matrix[4]},set:function(j){this._matrix[4]=j}}),Object.defineProperty(re.prototype,"f",{get:function(){return this._matrix[5]},set:function(j){this._matrix[5]=j}}),Object.defineProperty(re.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(re.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(re.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(re.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),re.prototype.join=function(j){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map($).join(j)},re.prototype.multiply=function(j){var V=j.sx*this.sx+j.shy*this.shx,ge=j.sx*this.shy+j.shy*this.sy,we=j.shx*this.sx+j.sy*this.shx,De=j.shx*this.shy+j.sy*this.sy,at=j.tx*this.sx+j.ty*this.shx+this.tx,_t=j.tx*this.shy+j.ty*this.sy+this.ty;return new re(V,ge,we,De,at,_t)},re.prototype.decompose=function(){var j=this.sx,V=this.shy,ge=this.shx,we=this.sy,De=this.tx,at=this.ty,_t=Math.sqrt(j*j+V*V),Vt=(j/=_t)*ge+(V/=_t)*we;ge-=j*Vt,we-=V*Vt;var Zt=Math.sqrt(ge*ge+we*we);return Vt/=Zt,j*(we/=Zt)<V*(ge/=Zt)&&(j=-j,V=-V,Vt=-Vt,_t=-_t),{scale:new re(_t,0,0,Zt,0,0),translate:new re(1,0,0,1,De,at),rotate:new re(j,V,-V,j,0,0),skew:new re(1,0,Vt,1,0,0)}},re.prototype.toString=function(j){return this.join(" ")},re.prototype.inversed=function(){var j=this.sx,V=this.shy,ge=this.shx,we=this.sy,De=this.tx,at=this.ty,_t=1/(j*we-V*ge),Vt=we*_t,Zt=-V*_t,gn=-ge*_t,Nn=j*_t;return new re(Vt,Zt,gn,Nn,-Vt*De-gn*at,-Zt*De-Nn*at)},re.prototype.applyToPoint=function(j){var V=j.x*this.sx+j.y*this.shx+this.tx,ge=j.x*this.shy+j.y*this.sy+this.ty;return new Ui(V,ge)},re.prototype.applyToRectangle=function(j){var V=this.applyToPoint(j),ge=this.applyToPoint(new Ui(j.x+j.w,j.y+j.h));return new eo(V.x,V.y,ge.x-V.x,ge.y-V.y)},re.prototype.clone=function(){var j=this.sx,V=this.shy,ge=this.shx,we=this.sy,De=this.tx,at=this.ty;return new re(j,V,ge,we,De,at)},x.Matrix=re;var Qe=x.matrixMult=function(j,V){return V.multiply(j)},mt=new re(1,0,0,1,0,0);x.unitMatrix=x.identityMatrix=mt;var Xe=function(j,V){if(!lt[j]){var ge=(V instanceof Eu?"Sh":"P")+(Object.keys(We).length+1).toString(10);V.id=ge,lt[j]=ge,We[ge]=V,Yt.publish("addPattern",V)}};x.ShadingPattern=Eu,x.TilingPattern=sh,x.addShadingPattern=function(j,V){return z("addShadingPattern()"),Xe(j,V),this},x.beginTilingPattern=function(j){z("beginTilingPattern()"),vl(j.boundingBox[0],j.boundingBox[1],j.boundingBox[2]-j.boundingBox[0],j.boundingBox[3]-j.boundingBox[1],j.matrix)},x.endTilingPattern=function(j,V){z("endTilingPattern()"),V.stream=Re[U].join(`
`),Xe(j,V),Yt.publish("endTilingPattern",V),ut.pop().restore()};var et,kt=x.__private__.newObject=function(){var j=Tt();return Rt(j,!0),j},Tt=x.__private__.newObjectDeferred=function(){return de++,xe[de]=function(){return me},de},Rt=function(j,V){return V=typeof V=="boolean"&&V,xe[j]=me,V&&X(j+" 0 obj"),j},An=x.__private__.newAdditionalObject=function(){var j={objId:Tt(),content:""};return ve.push(j),j},Pn=Tt(),wn=Tt(),jt=x.__private__.decodeColorString=function(j){var V=j.split(" ");if(V.length!==2||V[1]!=="g"&&V[1]!=="G")V.length!==5||V[4]!=="k"&&V[4]!=="K"||(V=[(1-V[0])*(1-V[3]),(1-V[1])*(1-V[3]),(1-V[2])*(1-V[3]),"r"]);else{var ge=parseFloat(V[0]);V=[ge,ge,ge,"r"]}for(var we="#",De=0;De<3;De++)we+=("0"+Math.floor(255*parseFloat(V[De])).toString(16)).slice(-2);return we},dt=x.__private__.encodeColorString=function(j){var V;typeof j=="string"&&(j={ch1:j});var ge=j.ch1,we=j.ch2,De=j.ch3,at=j.ch4,_t=j.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof ge=="string"&&ge.charAt(0)!=="#"){var Vt=new z4(ge);if(Vt.ok)ge=Vt.toHex();else if(!/^\d*\.?\d*$/.test(ge))throw new Error('Invalid color "'+ge+'" passed to jsPDF.encodeColorString.')}if(typeof ge=="string"&&/^#[0-9A-Fa-f]{3}$/.test(ge)&&(ge="#"+ge[1]+ge[1]+ge[2]+ge[2]+ge[3]+ge[3]),typeof ge=="string"&&/^#[0-9A-Fa-f]{6}$/.test(ge)){var Zt=parseInt(ge.substr(1),16);ge=Zt>>16&255,we=Zt>>8&255,De=255&Zt}if(we===void 0||at===void 0&&ge===we&&we===De)V=typeof ge=="string"?ge+" "+_t[0]:j.precision===2?R(ge/255)+" "+_t[0]:q(ge/255)+" "+_t[0];else if(at===void 0||gs(at)==="object"){if(at&&!isNaN(at.a)&&at.a===0)return["1.","1.","1.",_t[1]].join(" ");V=typeof ge=="string"?[ge,we,De,_t[1]].join(" "):j.precision===2?[R(ge/255),R(we/255),R(De/255),_t[1]].join(" "):[q(ge/255),q(we/255),q(De/255),_t[1]].join(" ")}else V=typeof ge=="string"?[ge,we,De,at,_t[2]].join(" "):j.precision===2?[R(ge),R(we),R(De),R(at),_t[2]].join(" "):[q(ge),q(we),q(De),q(at),_t[2]].join(" ");return V},sn=x.__private__.getFilters=function(){return o},Un=x.__private__.putStream=function(j){var V=(j=j||{}).data||"",ge=j.filters||sn(),we=j.alreadyAppliedFilters||[],De=j.addLength1||!1,at=V.length,_t=j.objectId,Vt=function(fr){return fr};if(p!==null&&_t===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");p!==null&&(Vt=Ze.encryptor(_t,0));var Zt={};ge===!0&&(ge=["FlateEncode"]);var gn=j.additionalKeyValues||[],Nn=(Zt=nn.API.processDataByFilters!==void 0?nn.API.processDataByFilters(V,ge):{data:V,reverseChain:[]}).reverseChain+(Array.isArray(we)?we.join(" "):we.toString());if(Zt.data.length!==0&&(gn.push({key:"Length",value:Zt.data.length}),De===!0&&gn.push({key:"Length1",value:at})),Nn.length!=0)if(Nn.split("/").length-1==1)gn.push({key:"Filter",value:Nn});else{gn.push({key:"Filter",value:"["+Nn+"]"});for(var Hn=0;Hn<gn.length;Hn+=1)if(gn[Hn].key==="DecodeParms"){for(var Ls=[],Ws=0;Ws<Zt.reverseChain.split("/").length-1;Ws+=1)Ls.push("null");Ls.push(gn[Hn].value),gn[Hn].value="["+Ls.join(" ")+"]"}}X("<<");for(var xs=0;xs<gn.length;xs++)X("/"+gn[xs].key+" "+gn[xs].value);X(">>"),Zt.data.length!==0&&(X("stream"),X(Vt(Zt.data)),X("endstream"))},er=x.__private__.putPage=function(j){var V=j.number,ge=j.data,we=j.objId,De=j.contentsObjId;Rt(we,!0),X("<</Type /Page"),X("/Parent "+j.rootDictionaryObjId+" 0 R"),X("/Resources "+j.resourceDictionaryObjId+" 0 R"),X("/MediaBox ["+parseFloat($(j.mediaBox.bottomLeftX))+" "+parseFloat($(j.mediaBox.bottomLeftY))+" "+$(j.mediaBox.topRightX)+" "+$(j.mediaBox.topRightY)+"]"),j.cropBox!==null&&X("/CropBox ["+$(j.cropBox.bottomLeftX)+" "+$(j.cropBox.bottomLeftY)+" "+$(j.cropBox.topRightX)+" "+$(j.cropBox.topRightY)+"]"),j.bleedBox!==null&&X("/BleedBox ["+$(j.bleedBox.bottomLeftX)+" "+$(j.bleedBox.bottomLeftY)+" "+$(j.bleedBox.topRightX)+" "+$(j.bleedBox.topRightY)+"]"),j.trimBox!==null&&X("/TrimBox ["+$(j.trimBox.bottomLeftX)+" "+$(j.trimBox.bottomLeftY)+" "+$(j.trimBox.topRightX)+" "+$(j.trimBox.topRightY)+"]"),j.artBox!==null&&X("/ArtBox ["+$(j.artBox.bottomLeftX)+" "+$(j.artBox.bottomLeftY)+" "+$(j.artBox.topRightX)+" "+$(j.artBox.topRightY)+"]"),typeof j.userUnit=="number"&&j.userUnit!==1&&X("/UserUnit "+j.userUnit),Yt.publish("putPage",{objId:we,pageContext:Bt[V],pageNumber:V,page:ge}),X("/Contents "+De+" 0 R"),X(">>"),X("endobj");var at=ge.join(`
`);return T===k&&(at+=`
Q`),Rt(De,!0),Un({data:at,filters:sn(),objectId:De}),X("endobj"),we},tr=x.__private__.putPages=function(){var j,V,ge=[];for(j=1;j<=Mt;j++)Bt[j].objId=Tt(),Bt[j].contentsObjId=Tt();for(j=1;j<=Mt;j++)ge.push(er({number:j,data:Re[j],objId:Bt[j].objId,contentsObjId:Bt[j].contentsObjId,mediaBox:Bt[j].mediaBox,cropBox:Bt[j].cropBox,bleedBox:Bt[j].bleedBox,trimBox:Bt[j].trimBox,artBox:Bt[j].artBox,userUnit:Bt[j].userUnit,rootDictionaryObjId:Pn,resourceDictionaryObjId:wn}));Rt(Pn,!0),X("<</Type /Pages");var we="/Kids [";for(V=0;V<Mt;V++)we+=ge[V]+" 0 R ";X(we+"]"),X("/Count "+Mt),X(">>"),X("endobj"),Yt.publish("postPutPages")},Ns=function(j){Yt.publish("putFont",{font:j,out:X,newObject:kt,putStream:Un}),j.isAlreadyPutted!==!0&&(j.objectNumber=kt(),X("<<"),X("/Type /Font"),X("/BaseFont /"+Zd(j.postScriptName)),X("/Subtype /Type1"),typeof j.encoding=="string"&&X("/Encoding /"+j.encoding),X("/FirstChar 32"),X("/LastChar 255"),X(">>"),X("endobj"))},Hr=function(j){j.objectNumber=kt();var V=[];V.push({key:"Type",value:"/XObject"}),V.push({key:"Subtype",value:"/Form"}),V.push({key:"BBox",value:"["+[$(j.x),$(j.y),$(j.x+j.width),$(j.y+j.height)].join(" ")+"]"}),V.push({key:"Matrix",value:"["+j.matrix.toString()+"]"});var ge=j.pages[1].join(`
`);Un({data:ge,additionalKeyValues:V,objectId:j.objectNumber}),X("endobj")},Tr=function(j,V){V||(V=21);var ge=kt(),we=(function(_t,Vt){var Zt,gn=[],Nn=1/(Vt-1);for(Zt=0;Zt<1;Zt+=Nn)gn.push(Zt);if(gn.push(1),_t[0].offset!=0){var Hn={offset:0,color:_t[0].color};_t.unshift(Hn)}if(_t[_t.length-1].offset!=1){var Ls={offset:1,color:_t[_t.length-1].color};_t.push(Ls)}for(var Ws="",xs=0,fr=0;fr<gn.length;fr++){for(Zt=gn[fr];Zt>_t[xs+1].offset;)xs++;var sr=_t[xs].offset,Lr=(Zt-sr)/(_t[xs+1].offset-sr),ao=_t[xs].color,ua=_t[xs+1].color;Ws+=ae(Math.round((1-Lr)*ao[0]+Lr*ua[0]).toString(16))+ae(Math.round((1-Lr)*ao[1]+Lr*ua[1]).toString(16))+ae(Math.round((1-Lr)*ao[2]+Lr*ua[2]).toString(16))}return Ws.trim()})(j.colors,V),De=[];De.push({key:"FunctionType",value:"0"}),De.push({key:"Domain",value:"[0.0 1.0]"}),De.push({key:"Size",value:"["+V+"]"}),De.push({key:"BitsPerSample",value:"8"}),De.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),De.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Un({data:we,additionalKeyValues:De,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:ge}),X("endobj"),j.objectNumber=kt(),X("<< /ShadingType "+j.type),X("/ColorSpace /DeviceRGB");var at="/Coords ["+$(parseFloat(j.coords[0]))+" "+$(parseFloat(j.coords[1]))+" ";j.type===2?at+=$(parseFloat(j.coords[2]))+" "+$(parseFloat(j.coords[3])):at+=$(parseFloat(j.coords[2]))+" "+$(parseFloat(j.coords[3]))+" "+$(parseFloat(j.coords[4]))+" "+$(parseFloat(j.coords[5])),X(at+="]"),j.matrix&&X("/Matrix ["+j.matrix.toString()+"]"),X("/Function "+ge+" 0 R"),X("/Extend [true true]"),X(">>"),X("endobj")},Ci=function(j,V){var ge=Tt(),we=kt();V.push({resourcesOid:ge,objectOid:we}),j.objectNumber=we;var De=[];De.push({key:"Type",value:"/Pattern"}),De.push({key:"PatternType",value:"1"}),De.push({key:"PaintType",value:"1"}),De.push({key:"TilingType",value:"1"}),De.push({key:"BBox",value:"["+j.boundingBox.map($).join(" ")+"]"}),De.push({key:"XStep",value:$(j.xStep)}),De.push({key:"YStep",value:$(j.yStep)}),De.push({key:"Resources",value:ge+" 0 R"}),j.matrix&&De.push({key:"Matrix",value:"["+j.matrix.toString()+"]"}),Un({data:j.stream,additionalKeyValues:De,objectId:j.objectNumber}),X("endobj")},Za=function(j){for(var V in j.objectNumber=kt(),X("<<"),j)switch(V){case"opacity":X("/ca "+R(j[V]));break;case"stroke-opacity":X("/CA "+R(j[V]))}X(">>"),X("endobj")},Ei=function(j){Rt(j.resourcesOid,!0),X("<<"),X("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var V in X("/Font <<"),wt)wt.hasOwnProperty(V)&&(g===!1||g===!0&&b.hasOwnProperty(V))&&X("/"+V+" "+wt[V].objectNumber+" 0 R");X(">>")})(),(function(){if(Object.keys(We).length>0){for(var V in X("/Shading <<"),We)We.hasOwnProperty(V)&&We[V]instanceof Eu&&We[V].objectNumber>=0&&X("/"+V+" "+We[V].objectNumber+" 0 R");Yt.publish("putShadingPatternDict"),X(">>")}})(),(function(V){if(Object.keys(We).length>0){for(var ge in X("/Pattern <<"),We)We.hasOwnProperty(ge)&&We[ge]instanceof x.TilingPattern&&We[ge].objectNumber>=0&&We[ge].objectNumber<V&&X("/"+ge+" "+We[ge].objectNumber+" 0 R");Yt.publish("putTilingPatternDict"),X(">>")}})(j.objectOid),(function(){if(Object.keys(pt).length>0){var V;for(V in X("/ExtGState <<"),pt)pt.hasOwnProperty(V)&&pt[V].objectNumber>=0&&X("/"+V+" "+pt[V].objectNumber+" 0 R");Yt.publish("putGStateDict"),X(">>")}})(),(function(){for(var V in X("/XObject <<"),an)an.hasOwnProperty(V)&&an[V].objectNumber>=0&&X("/"+V+" "+an[V].objectNumber+" 0 R");Yt.publish("putXobjectDict"),X(">>")})(),X(">>"),X("endobj")},Ds=function(j){it[j.fontName]=it[j.fontName]||{},it[j.fontName][j.fontStyle]=j.id},pl=function(j,V,ge,we,De){var at={id:"F"+(Object.keys(wt).length+1).toString(10),postScriptName:j,fontName:V,fontStyle:ge,encoding:we,isStandardFont:De||!1,metadata:{}};return Yt.publish("addFont",{font:at,instance:this}),wt[at.id]=at,Ds(at),at.id},ni=x.__private__.pdfEscape=x.pdfEscape=function(j,V){return(function(ge,we){var De,at,_t,Vt,Zt,gn,Nn,Hn,Ls;if(_t=(we=we||{}).sourceEncoding||"Unicode",Zt=we.outputEncoding,(we.autoencode||Zt)&&wt[ue].metadata&&wt[ue].metadata[_t]&&wt[ue].metadata[_t].encoding&&(Vt=wt[ue].metadata[_t].encoding,!Zt&&wt[ue].encoding&&(Zt=wt[ue].encoding),!Zt&&Vt.codePages&&(Zt=Vt.codePages[0]),typeof Zt=="string"&&(Zt=Vt[Zt]),Zt)){for(Nn=!1,gn=[],De=0,at=ge.length;De<at;De++)(Hn=Zt[ge.charCodeAt(De)])?gn.push(String.fromCharCode(Hn)):gn.push(ge[De]),gn[De].charCodeAt(0)>>8&&(Nn=!0);ge=gn.join("")}for(De=ge.length;Nn===void 0&&De!==0;)ge.charCodeAt(De-1)>>8&&(Nn=!0),De--;if(!Nn)return ge;for(gn=we.noBOM?[]:[254,255],De=0,at=ge.length;De<at;De++){if((Ls=(Hn=ge.charCodeAt(De))>>8)>>8)throw new Error("Character at position "+De+" of string '"+ge+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");gn.push(Ls),gn.push(Hn-(Ls<<8))}return String.fromCharCode.apply(void 0,gn)})(j,V).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},ki=x.__private__.beginPage=function(j){Re[++Mt]=[],Bt[Mt]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(j[0]),topRightY:Number(j[1])}},gl(Mt),ke(Re[U])},gi=function(j,V){var ge,we,De;switch(t=V||t,typeof j=="string"&&(ge=N(j.toLowerCase()),Array.isArray(ge)&&(we=ge[0],De=ge[1])),Array.isArray(j)&&(we=j[0]*Te,De=j[1]*Te),isNaN(we)&&(we=r[0],De=r[1]),(we>14400||De>14400)&&(js.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),we=Math.min(14400,we),De=Math.min(14400,De)),r=[we,De],t.substr(0,1)){case"l":De>we&&(r=[De,we]);break;case"p":we>De&&(r=[De,we])}ki(r),un(xl),X(Di),sc!==0&&X(sc+" J"),wr!==0&&X(wr+" j"),Yt.publish("addPage",{pageNumber:Mt})},Bo=function(j){j>0&&j<=Mt&&(Re.splice(j,1),Bt.splice(j,1),Mt--,U>Mt&&(U=Mt),this.setPage(U))},gl=function(j){j>0&&j<=Mt&&(U=j)},ml=x.__private__.getNumberOfPages=x.getNumberOfPages=function(){return Re.length-1},tc=function(j,V,ge){var we,De=void 0;return ge=ge||{},j=j!==void 0?j:wt[ue].fontName,V=V!==void 0?V:wt[ue].fontStyle,we=j.toLowerCase(),it[we]!==void 0&&it[we][V]!==void 0?De=it[we][V]:it[j]!==void 0&&it[j][V]!==void 0?De=it[j][V]:ge.disableWarning===!1&&js.warn("Unable to look up font label for font '"+j+"', '"+V+"'. Refer to getFontList() for available fonts."),De||ge.noFallback||(De=it.times[V])==null&&(De=it.times.normal),De},si=x.__private__.putInfo=function(){var j=kt(),V=function(we){return we};for(var ge in p!==null&&(V=Ze.encryptor(j,0)),X("<<"),X("/Producer ("+ni(V("jsPDF "+nn.version))+")"),Fe)Fe.hasOwnProperty(ge)&&Fe[ge]&&X("/"+ge.substr(0,1).toUpperCase()+ge.substr(1)+" ("+ni(V(Fe[ge]))+")");X("/CreationDate ("+ni(V(le))+")"),X(">>"),X("endobj")},la=x.__private__.putCatalog=function(j){var V=(j=j||{}).rootDictionaryObjId||Pn;switch(kt(),X("<<"),X("/Type /Catalog"),X("/Pages "+V+" 0 R"),Et||(Et="fullwidth"),Et){case"fullwidth":X("/OpenAction [3 0 R /FitH null]");break;case"fullheight":X("/OpenAction [3 0 R /FitV null]");break;case"fullpage":X("/OpenAction [3 0 R /Fit]");break;case"original":X("/OpenAction [3 0 R /XYZ null null 1]");break;default:var ge=""+Et;ge.substr(ge.length-1)==="%"&&(Et=parseInt(Et)/100),typeof Et=="number"&&X("/OpenAction [3 0 R /XYZ null null "+R(Et)+"]")}switch(Ut||(Ut="continuous"),Ut){case"continuous":X("/PageLayout /OneColumn");break;case"single":X("/PageLayout /SinglePage");break;case"two":case"twoleft":X("/PageLayout /TwoColumnLeft");break;case"tworight":X("/PageLayout /TwoColumnRight")}St&&X("/PageMode /"+St),Yt.publish("putCatalog"),X(">>"),X("endobj")},ji=x.__private__.putTrailer=function(){X("trailer"),X("<<"),X("/Size "+(de+1)),X("/Root "+de+" 0 R"),X("/Info "+(de-1)+" 0 R"),p!==null&&X("/Encrypt "+Ze.oid+" 0 R"),X("/ID [ <"+K+"> <"+K+"> ]"),X(">>")},zn=x.__private__.putHeader=function(){X("%PDF-"+w),X("%")},te=x.__private__.putXRef=function(){var j="0000000000";X("xref"),X("0 "+(de+1)),X("0000000000 65535 f ");for(var V=1;V<=de;V++)typeof xe[V]=="function"?X((j+xe[V]()).slice(-10)+" 00000 n "):xe[V]!==void 0?X((j+xe[V]).slice(-10)+" 00000 n "):X("0000000000 00000 n ")},Se=x.__private__.buildDocument=function(){var j;de=0,me=0,he=[],xe=[],ve=[],Pn=Tt(),wn=Tt(),ke(he),Yt.publish("buildDocument"),zn(),tr(),(function(){Yt.publish("putAdditionalObjects");for(var ge=0;ge<ve.length;ge++){var we=ve[ge];Rt(we.objId,!0),X(we.content),X("endobj")}Yt.publish("postPutAdditionalObjects")})(),j=[],(function(){for(var ge in wt)wt.hasOwnProperty(ge)&&(g===!1||g===!0&&b.hasOwnProperty(ge))&&Ns(wt[ge])})(),(function(){var ge;for(ge in pt)pt.hasOwnProperty(ge)&&Za(pt[ge])})(),(function(){for(var ge in an)an.hasOwnProperty(ge)&&Hr(an[ge])})(),(function(ge){var we;for(we in We)We.hasOwnProperty(we)&&(We[we]instanceof Eu?Tr(We[we]):We[we]instanceof sh&&Ci(We[we],ge))})(j),Yt.publish("putResources"),j.forEach(Ei),Ei({resourcesOid:wn,objectOid:Number.MAX_SAFE_INTEGER}),Yt.publish("postPutResources"),p!==null&&(Ze.oid=kt(),X("<<"),X("/Filter /Standard"),X("/V "+Ze.v),X("/R "+Ze.r),X("/U <"+Ze.toHexString(Ze.U)+">"),X("/O <"+Ze.toHexString(Ze.O)+">"),X("/P "+Ze.P),X(">>"),X("endobj")),si(),la();var V=me;return te(),ji(),X("startxref"),X(""+V),X("%%EOF"),ke(Re[U]),he.join(`
`)},Ve=x.__private__.getBlob=function(j){return new Blob([gt(j)],{type:"application/pdf"})},Ae=x.output=x.__private__.output=(et=function(j,V){switch(typeof(V=V||{})=="string"?V={filename:V}:V.filename=V.filename||"generated.pdf",j){case void 0:return Se();case"save":x.save(V.filename);break;case"arraybuffer":return gt(Se());case"blob":return Ve(Se());case"bloburi":case"bloburl":if(vn.URL!==void 0&&typeof vn.URL.createObjectURL=="function")return vn.URL&&vn.URL.createObjectURL(Ve(Se()))||void 0;js.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var ge="",we=Se();try{ge=lS(we)}catch{ge=lS(unescape(encodeURIComponent(we)))}return"data:application/pdf;filename="+V.filename+";base64,"+ge;case"pdfobjectnewwindow":if(Object.prototype.toString.call(vn)==="[object Window]"){var De="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",at=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';V.pdfObjectUrl&&(De=V.pdfObjectUrl,at="");var _t='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+De+'"'+at+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(V)+");<\/script></body></html>",Vt=vn.open();return Vt!==null&&Vt.document.write(_t),Vt}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(vn)==="[object Window]"){var Zt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(V.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+V.filename+'" width="500px" height="400px" /></body></html>',gn=vn.open();if(gn!==null){gn.document.write(Zt);var Nn=this;gn.document.documentElement.querySelector("#pdfViewer").onload=function(){gn.document.title=V.filename,gn.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Nn.output("bloburl"))}}return gn}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(vn)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Hn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",V)+'"></iframe></body></html>',Ls=vn.open();if(Ls!==null&&(Ls.document.write(Hn),Ls.document.title=V.filename),Ls||typeof safari>"u")return Ls;break;case"datauri":case"dataurl":return vn.document.location.href=this.output("datauristring",V);default:return null}},et.foo=function(){try{return et.apply(this,arguments)}catch(ge){var j=ge.stack||"";~j.indexOf(" at ")&&(j=j.split(" at ")[1]);var V="Error in function "+j.split(`
`)[0].split("<")[0]+": "+ge.message;if(!vn.console)throw new Error(V);vn.console.error(V,ge),vn.alert&&alert(V)}},et.foo.bar=et,et.foo),Ie=function(j){return Array.isArray(On)===!0&&On.indexOf(j)>-1};switch(n){case"pt":Te=1;break;case"mm":Te=72/25.4;break;case"cm":Te=72/2.54;break;case"in":Te=72;break;case"px":Te=Ie("px_scaling")==1?.75:96/72;break;case"pc":case"em":Te=12;break;case"ex":Te=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);Te=n}var Ze=null;M(),ce();var Ct=x.__private__.getPageInfo=x.getPageInfo=function(j){if(isNaN(j)||j%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Bt[j].objId,pageNumber:j,pageContext:Bt[j]}},Lt=x.__private__.getPageInfoByObjId=function(j){if(isNaN(j)||j%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var V in Bt)if(Bt[V].objId===j)break;return Ct(V)},fn=x.__private__.getCurrentPageInfo=x.getCurrentPageInfo=function(){return{objId:Bt[U].objId,pageNumber:U,pageContext:Bt[U]}};x.addPage=function(){return gi.apply(this,arguments),this},x.setPage=function(){return gl.apply(this,arguments),ke.call(this,Re[U]),this},x.insertPage=function(j){return this.addPage(),this.movePage(U,j),this},x.movePage=function(j,V){var ge,we;if(j>V){ge=Re[j],we=Bt[j];for(var De=j;De>V;De--)Re[De]=Re[De-1],Bt[De]=Bt[De-1];Re[V]=ge,Bt[V]=we,this.setPage(V)}else if(j<V){ge=Re[j],we=Bt[j];for(var at=j;at<V;at++)Re[at]=Re[at+1],Bt[at]=Bt[at+1];Re[V]=ge,Bt[V]=we,this.setPage(V)}return this},x.deletePage=function(){return Bo.apply(this,arguments),this},x.__private__.text=x.text=function(j,V,ge,we,De){var at,_t,Vt,Zt,gn,Nn,Hn,Ls,Ws,xs=(we=we||{}).scope||this;if(typeof j=="number"&&typeof V=="number"&&(typeof ge=="string"||Array.isArray(ge))){var fr=ge;ge=V,V=j,j=fr}if(arguments[3]instanceof re==0?(Vt=arguments[4],Zt=arguments[5],gs(Hn=arguments[3])==="object"&&Hn!==null||(typeof Vt=="string"&&(Zt=Vt,Vt=null),typeof Hn=="string"&&(Zt=Hn,Hn=null),typeof Hn=="number"&&(Vt=Hn,Hn=null),we={flags:Hn,angle:Vt,align:Zt})):(z("The transform parameter of text() with a Matrix value"),Ws=De),isNaN(V)||isNaN(ge)||j==null)throw new Error("Invalid arguments passed to jsPDF.text");if(j.length===0)return xs;var sr,Lr="",ao=typeof we.lineHeightFactor=="number"?we.lineHeightFactor:Qa,ua=xs.internal.scaleFactor;function oo(Zn){return Zn=Zn.split("	").join(Array(we.TabLen||9).join(" ")),ni(Zn,Hn)}function Qc(Zn){for(var Gn,bs=Zn.concat(),Ks=[],Fa=bs.length;Fa--;)typeof(Gn=bs.shift())=="string"?Ks.push(Gn):Array.isArray(Zn)&&(Gn.length===1||Gn[1]===void 0&&Gn[2]===void 0)?Ks.push(Gn[0]):Ks.push([Gn[0],Gn[1],Gn[2]]);return Ks}function ic(Zn,Gn){var bs;if(typeof Zn=="string")bs=Gn(Zn)[0];else if(Array.isArray(Zn)){for(var Ks,Fa,pa=Zn.concat(),Al=[],nu=pa.length;nu--;)typeof(Ks=pa.shift())=="string"?Al.push(Gn(Ks)[0]):Array.isArray(Ks)&&typeof Ks[0]=="string"&&(Fa=Gn(Ks[0],Ks[1],Ks[2]),Al.push([Fa[0],Fa[1],Fa[2]]));bs=Al}return bs}var La=!1,da=!0;if(typeof j=="string")La=!0;else if(Array.isArray(j)){var Sl=j.concat();_t=[];for(var lo,Sr=Sl.length;Sr--;)(typeof(lo=Sl.shift())!="string"||Array.isArray(lo)&&typeof lo[0]!="string")&&(da=!1);La=da}if(La===!1)throw new Error('Type of text must be string or Array. "'+j+'" is not recognized.');typeof j=="string"&&(j=j.match(/[\r?\n]/)?j.split(/\r\n|\r|\n/g):[j]);var Mo=Ye/xs.internal.scaleFactor,Fo=Mo*(ao-1);switch(we.baseline){case"bottom":ge-=Fo;break;case"top":ge+=Mo-Fo;break;case"hanging":ge+=Mo-2*Fo;break;case"middle":ge+=Mo/2-Fo}if((Nn=we.maxWidth||0)>0&&(typeof j=="string"?j=xs.splitTextToSize(j,Nn):Object.prototype.toString.call(j)==="[object Array]"&&(j=j.reduce(function(Zn,Gn){return Zn.concat(xs.splitTextToSize(Gn,Nn))},[]))),at={text:j,x:V,y:ge,options:we,mutex:{pdfEscape:ni,activeFontKey:ue,fonts:wt,activeFontSize:Ye}},Yt.publish("preProcessText",at),j=at.text,Vt=(we=at.options).angle,Ws instanceof re==0&&Vt&&typeof Vt=="number"){Vt*=Math.PI/180,we.rotationDirection===0&&(Vt=-Vt),T===k&&(Vt=-Vt);var ac=Math.cos(Vt),Ra=Math.sin(Vt);Ws=new re(ac,Ra,-Ra,ac,0,0)}else Vt&&Vt instanceof re&&(Ws=Vt);T!==k||Ws||(Ws=mt),(gn=we.charSpace||Fi)!==void 0&&(Lr+=$(J(gn))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Ls=we.horizontalScale)!==void 0&&(Lr+=$(100*Ls)+` Tz
`),we.lang;var ri=-1,co=we.renderingMode!==void 0?we.renderingMode:we.stroke,oc=xs.internal.getCurrentPageInfo().pageContext;switch(co){case 0:case!1:case"fill":ri=0;break;case 1:case!0:case"stroke":ri=1;break;case 2:case"fillThenStroke":ri=2;break;case 3:case"invisible":ri=3;break;case 4:case"fillAndAddForClipping":ri=4;break;case 5:case"strokeAndAddPathForClipping":ri=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":ri=6;break;case 7:case"addToPathForClipping":ri=7}var eu=oc.usedRenderingMode!==void 0?oc.usedRenderingMode:-1;ri!==-1?Lr+=ri+` Tr
`:eu!==-1&&(Lr+=`0 Tr
`),ri!==-1&&(oc.usedRenderingMode=ri),Zt=we.align||"left";var Li,ha=Ye*ao,uo=xs.internal.pageSize.getWidth(),tu=wt[ue];gn=we.charSpace||Fi,Nn=we.maxWidth||0,Hn=Object.assign({autoencode:!0,noBOM:!0},we.flags);var fa=[],Uo=function(Zn){return xs.getStringUnitWidth(Zn,{font:tu,charSpace:gn,fontSize:Ye,doKerning:!1})*Ye/ua};if(Object.prototype.toString.call(j)==="[object Array]"){var xi;_t=Qc(j),Zt!=="left"&&(Li=_t.map(Uo));var ii,Pa=0;if(Zt==="right"){V-=Li[0],j=[],Sr=_t.length;for(var Ba=0;Ba<Sr;Ba++)Ba===0?(ii=Ti(V),xi=Dr(ge)):(ii=J(Pa-Li[Ba]),xi=-ha),j.push([_t[Ba],ii,xi]),Pa=Li[Ba]}else if(Zt==="center"){V-=Li[0]/2,j=[],Sr=_t.length;for(var ho=0;ho<Sr;ho++)ho===0?(ii=Ti(V),xi=Dr(ge)):(ii=J((Pa-Li[ho])/2),xi=-ha),j.push([_t[ho],ii,xi]),Pa=Li[ho]}else if(Zt==="left"){j=[],Sr=_t.length;for(var lc=0;lc<Sr;lc++)j.push(_t[lc])}else if(Zt==="justify"&&tu.encoding==="Identity-H"){j=[],Sr=_t.length,Nn=Nn!==0?Nn:uo;for(var cc=0,Ys=0;Ys<Sr;Ys++)if(xi=Ys===0?Dr(ge):-ha,ii=Ys===0?Ti(V):cc,Ys<Sr-1){var td=J((Nn-Li[Ys])/(_t[Ys].split(" ").length-1)),Oa=_t[Ys].split(" ");j.push([Oa[0]+" ",ii,xi]),cc=0;for(var Ia=1;Ia<Oa.length;Ia++){var Rr=(Uo(Oa[Ia-1]+" "+Oa[Ia])-Uo(Oa[Ia]))*ua+td;Ia==Oa.length-1?j.push([Oa[Ia],Rr,0]):j.push([Oa[Ia]+" ",Rr,0]),cc-=Rr}}else j.push([_t[Ys],ii,xi]);j.push(["",cc,0])}else{if(Zt!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(j=[],Sr=_t.length,Nn=Nn!==0?Nn:uo,Ys=0;Ys<Sr;Ys++){xi=Ys===0?Dr(ge):-ha,ii=Ys===0?Ti(V):0;var fo=_t[Ys].split(" ").length-1,uc=fo>0?(Nn-Li[Ys])/fo:0;Ys<Sr-1?fa.push($(J(uc))):fa.push(0),j.push([_t[Ys],ii,xi])}}}(typeof we.R2L=="boolean"?we.R2L:st)===!0&&(j=ic(j,function(Zn,Gn,bs){return[Zn.split("").reverse().join(""),Gn,bs]})),at={text:j,x:V,y:ge,options:we,mutex:{pdfEscape:ni,activeFontKey:ue,fonts:wt,activeFontSize:Ye}},Yt.publish("postProcessText",at),j=at.text,sr=at.mutex.isHex||!1;var dc=wt[ue].encoding;dc!=="WinAnsiEncoding"&&dc!=="StandardEncoding"||(j=ic(j,function(Zn,Gn,bs){return[oo(Zn),Gn,bs]})),_t=Qc(j),j=[];for(var po,go,Ma,_l=Array.isArray(_t[0])?1:0,Ri="",mo=function(Zn,Gn,bs){var Ks="";return bs instanceof re?(bs=typeof we.angle=="number"?Qe(bs,new re(1,0,0,1,Zn,Gn)):Qe(new re(1,0,0,1,Zn,Gn),bs),T===k&&(bs=Qe(new re(1,0,0,-1,0,0),bs)),Ks=bs.join(" ")+` Tm
`):Ks=$(Zn)+" "+$(Gn)+` Td
`,Ks},Gr=0;Gr<_t.length;Gr++){switch(Ri="",_l){case 1:Ma=(sr?"<":"(")+_t[Gr][0]+(sr?">":")"),po=parseFloat(_t[Gr][1]),go=parseFloat(_t[Gr][2]);break;case 0:Ma=(sr?"<":"(")+_t[Gr]+(sr?">":")"),po=Ti(V),go=Dr(ge)}fa!==void 0&&fa[Gr]!==void 0&&(Ri=fa[Gr]+` Tw
`),Gr===0?j.push(Ri+mo(po,go,Ws)+Ma):_l===0?j.push(Ri+Ma):_l===1&&j.push(Ri+mo(po,go,Ws)+Ma)}j=_l===0?j.join(` Tj
T* `):j.join(` Tj
`),j+=` Tj
`;var zi=`BT
/`;return zi+=ue+" "+Ye+` Tf
`,zi+=$(Ye*ao)+` TL
`,zi+=Ta+`
`,zi+=Lr,zi+=j,X(zi+="ET"),b[ue]=!0,xs};var Dn=x.__private__.clip=x.clip=function(j){return X(j==="evenodd"?"W*":"W"),this};x.clipEvenOdd=function(){return Dn("evenodd")},x.__private__.discardPath=x.discardPath=function(){return X("n"),this};var Ot=x.__private__.isValidStyle=function(j){var V=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(j)!==-1&&(V=!0),V};x.__private__.setDefaultPathOperation=x.setDefaultPathOperation=function(j){return Ot(j)&&(h=j),this};var Ft=x.__private__.getStyle=x.getStyle=function(j){var V=h;switch(j){case"D":case"S":V="S";break;case"F":V="f";break;case"FD":case"DF":V="B";break;case"f":case"f*":case"B":case"B*":V=j}return V},ms=x.close=function(){return X("h"),this};x.stroke=function(){return X("S"),this},x.fill=function(j){return bn("f",j),this},x.fillEvenOdd=function(j){return bn("f*",j),this},x.fillStroke=function(j){return bn("B",j),this},x.fillStrokeEvenOdd=function(j){return bn("B*",j),this};var bn=function(j,V){gs(V)==="object"?ja(V,j):X(j)},us=function(j){j===null||T===k&&j===void 0||(j=Ft(j),X(j))};function nr(j,V,ge,we,De){var at=new sh(V||this.boundingBox,ge||this.xStep,we||this.yStep,this.gState,De||this.matrix);at.stream=this.stream;var _t=j+"$$"+this.cloneIndex+++"$$";return Xe(_t,at),at}var ja=function(j,V){var ge=lt[j.key],we=We[ge];if(we instanceof Eu)X("q"),X(Oo(V)),we.gState&&x.setGState(we.gState),X(j.matrix.toString()+" cm"),X("/"+ge+" sh"),X("Q");else if(we instanceof sh){var De=new re(1,0,0,-1,0,io());j.matrix&&(De=De.multiply(j.matrix||mt),ge=nr.call(we,j.key,j.boundingBox,j.xStep,j.yStep,De).id),X("q"),X("/Pattern cs"),X("/"+ge+" scn"),we.gState&&x.setGState(we.gState),X(V),X("Q")}},Oo=function(j){switch(j){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Kc=x.moveTo=function(j,V){return X($(J(j))+" "+$(Z(V))+" m"),this},Ku=x.lineTo=function(j,V){return X($(J(j))+" "+$(Z(V))+" l"),this},mi=x.curveTo=function(j,V,ge,we,De,at){return X([$(J(j)),$(Z(V)),$(J(ge)),$(Z(we)),$(J(De)),$(Z(at)),"c"].join(" ")),this};x.__private__.line=x.line=function(j,V,ge,we,De){if(isNaN(j)||isNaN(V)||isNaN(ge)||isNaN(we)||!Ot(De))throw new Error("Invalid arguments passed to jsPDF.line");return T===E?this.lines([[ge-j,we-V]],j,V,[1,1],De||"S"):this.lines([[ge-j,we-V]],j,V,[1,1]).stroke()},x.__private__.lines=x.lines=function(j,V,ge,we,De,at){var _t,Vt,Zt,gn,Nn,Hn,Ls,Ws,xs,fr,sr,Lr;if(typeof j=="number"&&(Lr=ge,ge=V,V=j,j=Lr),we=we||[1,1],at=at||!1,isNaN(V)||isNaN(ge)||!Array.isArray(j)||!Array.isArray(we)||!Ot(De)||typeof at!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Kc(V,ge),_t=we[0],Vt=we[1],gn=j.length,fr=V,sr=ge,Zt=0;Zt<gn;Zt++)(Nn=j[Zt]).length===2?(fr=Nn[0]*_t+fr,sr=Nn[1]*Vt+sr,Ku(fr,sr)):(Hn=Nn[0]*_t+fr,Ls=Nn[1]*Vt+sr,Ws=Nn[2]*_t+fr,xs=Nn[3]*Vt+sr,fr=Nn[4]*_t+fr,sr=Nn[5]*Vt+sr,mi(Hn,Ls,Ws,xs,fr,sr));return at&&ms(),us(De),this},x.path=function(j){for(var V=0;V<j.length;V++){var ge=j[V],we=ge.c;switch(ge.op){case"m":Kc(we[0],we[1]);break;case"l":Ku(we[0],we[1]);break;case"c":mi.apply(this,we);break;case"h":ms()}}return this},x.__private__.rect=x.rect=function(j,V,ge,we,De){if(isNaN(j)||isNaN(V)||isNaN(ge)||isNaN(we)||!Ot(De))throw new Error("Invalid arguments passed to jsPDF.rect");return T===E&&(we=-we),X([$(J(j)),$(Z(V)),$(J(ge)),$(J(we)),"re"].join(" ")),us(De),this},x.__private__.triangle=x.triangle=function(j,V,ge,we,De,at,_t){if(isNaN(j)||isNaN(V)||isNaN(ge)||isNaN(we)||isNaN(De)||isNaN(at)||!Ot(_t))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[ge-j,we-V],[De-ge,at-we],[j-De,V-at]],j,V,[1,1],_t,!0),this},x.__private__.roundedRect=x.roundedRect=function(j,V,ge,we,De,at,_t){if(isNaN(j)||isNaN(V)||isNaN(ge)||isNaN(we)||isNaN(De)||isNaN(at)||!Ot(_t))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Vt=4/3*(Math.SQRT2-1);return De=Math.min(De,.5*ge),at=Math.min(at,.5*we),this.lines([[ge-2*De,0],[De*Vt,0,De,at-at*Vt,De,at],[0,we-2*at],[0,at*Vt,-De*Vt,at,-De,at],[2*De-ge,0],[-De*Vt,0,-De,-at*Vt,-De,-at],[0,2*at-we],[0,-at*Vt,De*Vt,-at,De,-at]],j+De,V,[1,1],_t,!0),this},x.__private__.ellipse=x.ellipse=function(j,V,ge,we,De){if(isNaN(j)||isNaN(V)||isNaN(ge)||isNaN(we)||!Ot(De))throw new Error("Invalid arguments passed to jsPDF.ellipse");var at=4/3*(Math.SQRT2-1)*ge,_t=4/3*(Math.SQRT2-1)*we;return Kc(j+ge,V),mi(j+ge,V-_t,j+at,V-we,j,V-we),mi(j-at,V-we,j-ge,V-_t,j-ge,V),mi(j-ge,V+_t,j-at,V+we,j,V+we),mi(j+at,V+we,j+ge,V+_t,j+ge,V),us(De),this},x.__private__.circle=x.circle=function(j,V,ge,we){if(isNaN(j)||isNaN(V)||isNaN(ge)||!Ot(we))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(j,V,ge,ge,we)},x.setFont=function(j,V,ge){return ge&&(V=F(V,ge)),ue=tc(j,V,{disableWarning:!1}),this};var ca=x.__private__.getFont=x.getFont=function(){return wt[tc.apply(x,arguments)]};x.__private__.getFontList=x.getFontList=function(){var j,V,ge={};for(j in it)if(it.hasOwnProperty(j))for(V in ge[j]=[],it[j])it[j].hasOwnProperty(V)&&ge[j].push(V);return ge},x.addFont=function(j,V,ge,we,De){var at=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&at.indexOf(arguments[3])!==-1?De=arguments[3]:arguments[3]&&at.indexOf(arguments[3])==-1&&(ge=F(ge,we)),pl.call(this,j,V,ge,De=De||"Identity-H")};var Qa,xl=s.lineWidth||.200025,Io=x.__private__.getLineWidth=x.getLineWidth=function(){return xl},un=x.__private__.setLineWidth=x.setLineWidth=function(j){return xl=j,X($(J(j))+" w"),this};x.__private__.setLineDash=nn.API.setLineDash=nn.API.setLineDashPattern=function(j,V){if(j=j||[],V=V||0,isNaN(V)||!Array.isArray(j))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return j=j.map(function(ge){return $(J(ge))}).join(" "),V=$(J(V)),X("["+j+"] "+V+" d"),this};var Xu=x.__private__.getLineHeight=x.getLineHeight=function(){return Ye*Qa};x.__private__.getLineHeight=x.getLineHeight=function(){return Ye*Qa};var Xc=x.__private__.setLineHeightFactor=x.setLineHeightFactor=function(j){return typeof(j=j||1.15)=="number"&&(Qa=j),this},Ju=x.__private__.getLineHeightFactor=x.getLineHeightFactor=function(){return Qa};Xc(s.lineHeight);var Ti=x.__private__.getHorizontalCoordinate=function(j){return J(j)},Dr=x.__private__.getVerticalCoordinate=function(j){return T===k?j:Bt[U].mediaBox.topRightY-Bt[U].mediaBox.bottomLeftY-J(j)},Jc=x.__private__.getHorizontalCoordinateString=x.getHorizontalCoordinateString=function(j){return $(Ti(j))},bl=x.__private__.getVerticalCoordinateString=x.getVerticalCoordinateString=function(j){return $(Dr(j))},Di=s.strokeColor||"0 G";x.__private__.getStrokeColor=x.getDrawColor=function(){return jt(Di)},x.__private__.setStrokeColor=x.setDrawColor=function(j,V,ge,we){return Di=dt({ch1:j,ch2:V,ch3:ge,ch4:we,pdfColorType:"draw",precision:2}),X(Di),this};var yl=s.fillColor||"0 g";x.__private__.getFillColor=x.getFillColor=function(){return jt(yl)},x.__private__.setFillColor=x.setFillColor=function(j,V,ge,we){return yl=dt({ch1:j,ch2:V,ch3:ge,ch4:we,pdfColorType:"fill",precision:2}),X(yl),this};var Ta=s.textColor||"0 g",Zu=x.__private__.getTextColor=x.getTextColor=function(){return jt(Ta)};x.__private__.setTextColor=x.setTextColor=function(j,V,ge,we){return Ta=dt({ch1:j,ch2:V,ch3:ge,ch4:we,pdfColorType:"text",precision:3}),this};var Fi=s.charSpace,nc=x.__private__.getCharSpace=x.getCharSpace=function(){return parseFloat(Fi||0)};x.__private__.setCharSpace=x.setCharSpace=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Fi=j,this};var sc=0;x.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},x.__private__.setLineCap=x.setLineCap=function(j){var V=x.CapJoinStyles[j];if(V===void 0)throw new Error("Line cap style of '"+j+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return sc=V,X(V+" J"),this};var wr=0;x.__private__.setLineJoin=x.setLineJoin=function(j){var V=x.CapJoinStyles[j];if(V===void 0)throw new Error("Line join style of '"+j+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return wr=V,X(V+" j"),this},x.__private__.setLineMiterLimit=x.__private__.setMiterLimit=x.setLineMiterLimit=x.setMiterLimit=function(j){if(j=j||0,isNaN(j))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return X($(J(j))+" M"),this},x.GState=Dg,x.setGState=function(j){(j=typeof j=="string"?pt[It[j]]:Da(null,j)).equals(en)||(X("/"+j.id+" gs"),en=j)};var Da=function(j,V){if(!j||!It[j]){var ge=!1;for(var we in pt)if(pt.hasOwnProperty(we)&&pt[we].equals(V)){ge=!0;break}if(ge)V=pt[we];else{var De="GS"+(Object.keys(pt).length+1).toString(10);pt[De]=V,V.id=De}return j&&(It[j]=V.id),Yt.publish("addGState",V),V}};x.addGState=function(j,V){return Da(j,V),this},x.saveGraphicsState=function(){return X("q"),At.push({key:ue,size:Ye,color:Ta}),this},x.restoreGraphicsState=function(){X("Q");var j=At.pop();return ue=j.key,Ye=j.size,Ta=j.color,en=null,this},x.setCurrentTransformationMatrix=function(j){return X(j.toString()+" cm"),this},x.comment=function(j){return X("#"+j),this};var Ui=function(j,V){var ge=j||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return ge},set:function(at){isNaN(at)||(ge=parseFloat(at))}});var we=V||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return we},set:function(at){isNaN(at)||(we=parseFloat(at))}});var De="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return De},set:function(at){De=at.toString()}}),this},eo=function(j,V,ge,we){Ui.call(this,j,V),this.type="rect";var De=ge||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return De},set:function(_t){isNaN(_t)||(De=parseFloat(_t))}});var at=we||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return at},set:function(_t){isNaN(_t)||(at=parseFloat(_t))}}),this},rc=function(){this.page=Mt,this.currentPage=U,this.pages=Re.slice(0),this.pagesContext=Bt.slice(0),this.x=Oe,this.y=ct,this.matrix=ft,this.width=no(U),this.height=Zc(U),this.outputDestination=Ge,this.id="",this.objectNumber=-1};rc.prototype.restore=function(){Mt=this.page,U=this.currentPage,Bt=this.pagesContext,Re=this.pages,Oe=this.x,ct=this.y,ft=this.matrix,wl(U,this.width),so(U,this.height),Ge=this.outputDestination};var vl=function(j,V,ge,we,De){ut.push(new rc),Mt=U=0,Re=[],Oe=j,ct=V,ft=De,ki([ge,we])};for(var to in x.beginFormObject=function(j,V,ge,we,De){return vl(j,V,ge,we,De),this},x.endFormObject=function(j){return(function(V){if(As[V])ut.pop().restore();else{var ge=new rc,we="Xo"+(Object.keys(an).length+1).toString(10);ge.id=we,As[V]=we,an[we]=ge,Yt.publish("addFormObject",ge),ut.pop().restore()}})(j),this},x.doFormObject=function(j,V){var ge=an[As[j]];return X("q"),X(V.toString()+" cm"),X("/"+ge.id+" Do"),X("Q"),this},x.getFormObject=function(j){var V=an[As[j]];return{x:V.x,y:V.y,width:V.width,height:V.height,matrix:V.matrix}},x.save=function(j,V){return j=j||"generated.pdf",(V=V||{}).returnPromise=V.returnPromise||!1,V.returnPromise===!1?(_u(Ve(Se()),j),typeof _u.unload=="function"&&vn.setTimeout&&setTimeout(_u.unload,911),this):new Promise(function(ge,we){try{var De=_u(Ve(Se()),j);typeof _u.unload=="function"&&vn.setTimeout&&setTimeout(_u.unload,911),ge(De)}catch(at){we(at.message)}})},nn.API)nn.API.hasOwnProperty(to)&&(to==="events"&&nn.API.events.length?(function(j,V){var ge,we,De;for(De=V.length-1;De!==-1;De--)ge=V[De][0],we=V[De][1],j.subscribe.apply(j,[ge].concat(typeof we=="function"?[we]:we))})(Yt,nn.API.events):x[to]=nn.API[to]);function no(j){return Bt[j].mediaBox.topRightX-Bt[j].mediaBox.bottomLeftX}function wl(j,V){Bt[j].mediaBox.topRightX=V+Bt[j].mediaBox.bottomLeftX}function Zc(j){return Bt[j].mediaBox.topRightY-Bt[j].mediaBox.bottomLeftY}function so(j,V){Bt[j].mediaBox.topRightY=V+Bt[j].mediaBox.bottomLeftY}var ro=x.getPageWidth=function(j){return no(j=j||U)/Te},Qu=x.setPageWidth=function(j,V){wl(j,V*Te)},io=x.getPageHeight=function(j){return Zc(j=j||U)/Te},ed=x.setPageHeight=function(j,V){so(j,V*Te)};return x.internal={pdfEscape:ni,getStyle:Ft,getFont:ca,getFontSize:vt,getCharSpace:nc,getTextColor:Zu,getLineHeight:Xu,getLineHeightFactor:Ju,getLineWidth:Io,write:Pe,getHorizontalCoordinate:Ti,getVerticalCoordinate:Dr,getCoordinateString:Jc,getVerticalCoordinateString:bl,collections:{},newObject:kt,newAdditionalObject:An,newObjectDeferred:Tt,newObjectDeferredBegin:Rt,getFilters:sn,putStream:Un,events:Yt,scaleFactor:Te,pageSize:{getWidth:function(){return ro(U)},setWidth:function(j){Qu(U,j)},getHeight:function(){return io(U)},setHeight:function(j){ed(U,j)}},encryptionOptions:p,encryption:Ze,getEncryptor:function(j){return p!==null?Ze.encryptor(j,0):function(V){return V}},output:Ae,getNumberOfPages:ml,get pages(){return Re},out:X,f2:R,f3:q,getPageInfo:Ct,getPageInfoByObjId:Lt,getCurrentPageInfo:fn,getPDFVersion:v,Point:Ui,Rectangle:eo,Matrix:re,hasHotfix:Ie},Object.defineProperty(x.internal.pageSize,"width",{get:function(){return ro(U)},set:function(j){Qu(U,j)},enumerable:!0,configurable:!0}),Object.defineProperty(x.internal.pageSize,"height",{get:function(){return io(U)},set:function(j){ed(U,j)},enumerable:!0,configurable:!0}),(function(j){for(var V=0,ge=bt.length;V<ge;V++){var we=pl.call(this,j[V][0],j[V][1],j[V][2],bt[V][3],!0);g===!1&&(b[we]=!0);var De=j[V][0].split("-");Ds({id:we,fontName:De[0],fontStyle:De[1]||""})}Yt.publish("addFonts",{fonts:wt,dictionary:it})}).call(x,bt),ue="F1",gi(r,t),Yt.publish("initialized"),x}Jd.prototype.lsbFirstWord=function(s){return String.fromCharCode(255&s,s>>8&255,s>>16&255,s>>24&255)},Jd.prototype.toHexString=function(s){return s.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Jd.prototype.hexToBytes=function(s){for(var e=[],t=0;t<s.length;t+=2)e.push(String.fromCharCode(parseInt(s.substr(t,2),16)));return e.join("")},Jd.prototype.processOwnerPassword=function(s,e){return tb(eb(e).substr(0,5),s)},Jd.prototype.encryptor=function(s,e){var t=eb(this.encryptionKey+String.fromCharCode(255&s,s>>8&255,s>>16&255,255&e,e>>8&255)).substr(0,10);return function(n){return tb(t,n)}},Dg.prototype.equals=function(s){var e,t="id,objectNumber,equals";if(!s||gs(s)!==gs(this))return!1;var n=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!s.hasOwnProperty(e)||this[e]!==s[e])return!1;n++}for(e in s)s.hasOwnProperty(e)&&t.indexOf(e)<0&&n--;return n===0},nn.API={events:[]},nn.version="4.1.0";var ur=nn.API,Hb=1,Gu=function(s){return s.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},qd=function(s){return s.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Lg=function(s){return s.toString().replace(/#/g,"#23").replace(/[\s\n\r()<>[\]{}\/%]/g,function(e){var t=e.charCodeAt(0).toString(16).toUpperCase();return"#"+(t.length===1?"0"+t:t)})},kn=function(s){return s.toFixed(2)},Oc=function(s){return s.toFixed(5)};ur.__acroform__={};var oa=function(s,e){s.prototype=Object.create(e.prototype),s.prototype.constructor=s},hS=function(s){return s*Hb},il=function(s){var e=new G4,t=Xt.internal.getHeight(s)||0,n=Xt.internal.getWidth(s)||0;return e.BBox=[0,0,Number(kn(n)),Number(kn(t))],e},v7=ur.__acroform__.setBit=function(s,e){if(s=s||0,e=e||0,isNaN(s)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return s|1<<e},w7=ur.__acroform__.clearBit=function(s,e){if(s=s||0,e=e||0,isNaN(s)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return s&~(1<<e)},S7=ur.__acroform__.getBit=function(s,e){if(isNaN(s)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return s&1<<e?1:0},br=ur.__acroform__.getBitForPdf=function(s,e){if(isNaN(s)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return S7(s,e-1)},yr=ur.__acroform__.setBitForPdf=function(s,e){if(isNaN(s)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return v7(s,e-1)},vr=ur.__acroform__.clearBitForPdf=function(s,e){if(isNaN(s)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return w7(s,e-1)},_7=ur.__acroform__.calculateCoordinates=function(s,e){var t=e.internal.getHorizontalCoordinate,n=e.internal.getVerticalCoordinate,r=s[0],i=s[1],o=s[2],l=s[3],d={};return d.lowerLeft_X=t(r)||0,d.lowerLeft_Y=n(i+l)||0,d.upperRight_X=t(r+o)||0,d.upperRight_Y=n(i)||0,[Number(kn(d.lowerLeft_X)),Number(kn(d.lowerLeft_Y)),Number(kn(d.upperRight_X)),Number(kn(d.upperRight_Y))]},A7=function(s){if(s.appearanceStreamContent)return s.appearanceStreamContent;if(s.V||s.DV){var e=[],t=s._V||s.DV,n=nb(s,t),r=s.scope.internal.getFont(s.fontName,s.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(s.scope.__private__.encodeColorString(s.color)),e.push("/"+r+" "+kn(n.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(n.text),e.push("ET"),e.push("Q"),e.push("EMC");var i=il(s);return i.scope=s.scope,i.stream=e.join(`
`),i}},nb=function(s,e){var t=s.fontSize===0?s.maxFontSize:s.fontSize,n={text:"",fontSize:""},r=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");r=s.multiline?r.map(function(R){return R.split(`
`)}):r.map(function(R){return[R]});var i=t,o=Xt.internal.getHeight(s)||0;o=o<0?-o:o;var l=Xt.internal.getWidth(s)||0;l=l<0?-l:l;var d=function(R,q,J){if(R+1<r.length){var Z=q+" "+r[R+1][0];return yp(Z,s,J).width<=l-4}return!1};i++;e:for(;i>0;){e="",i--;var h,p,g=yp("3",s,i).height,b=s.multiline?o-i:(o-g)/2,x=b+=2,w=0,v=0,_=0;if(i<=0){e=`(...) Tj
`,e+="% Width of Text: "+yp(e,s,i=12).width+", FieldWidth:"+l+`
`;break}for(var N="",E=0,k=0;k<r.length;k++)if(r.hasOwnProperty(k)){var T=!1;if(r[k].length!==1&&_!==r[k].length-1){if((g+2)*(E+2)+2>o)continue e;N+=r[k][_],T=!0,v=k,k--}else{N=(N+=r[k][_]+" ").substr(N.length-1)==" "?N.substr(0,N.length-1):N;var P=parseInt(k),O=d(P,N,i),F=k>=r.length-1;if(O&&!F){N+=" ",_=0;continue}if(O||F){if(F)v=P;else if(s.multiline&&(g+2)*(E+2)+2>o)continue e}else{if(!s.multiline||(g+2)*(E+2)+2>o)continue e;v=P}}for(var $="",z=w;z<=v;z++){var G=r[z];if(s.multiline){if(z===v){$+=G[_]+" ",_=(_+1)%G.length;continue}if(z===w){$+=G[G.length-1]+" ";continue}}$+=G[0]+" "}switch($=$.substr($.length-1)==" "?$.substr(0,$.length-1):$,p=yp($,s,i).width,s.textAlign){case"right":h=l-p-2;break;case"center":h=(l-p)/2;break;default:h=2}e+=kn(h)+" "+kn(x)+` Td
`,e+="("+Gu($)+`) Tj
`,e+=-kn(h)+` 0 Td
`,x=-(i+2),p=0,w=T?v:v+1,E++,N=""}break}return n.text=e,n.fontSize=i,n},yp=function(s,e,t){var n=e.scope.internal.getFont(e.fontName,e.fontStyle),r=e.scope.getStringUnitWidth(s,{font:n,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:r}},N7={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},C7=function(s,e){var t={type:"reference",object:s};e.internal.getPageInfo(s.page).pageContext.annotations.find(function(n){return n.type===t.type&&n.object===t.object})===void 0&&e.internal.getPageInfo(s.page).pageContext.annotations.push(t)},E7=function(s,e){if(e.scope=s,s.internal!==void 0&&(s.internal.acroformPlugin===void 0||s.internal.acroformPlugin.isInitialized===!1)){if(Ro.FieldNum=0,s.internal.acroformPlugin=JSON.parse(JSON.stringify(N7)),s.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Hb=s.internal.scaleFactor,s.internal.acroformPlugin.acroFormDictionaryRoot=new V4,s.internal.acroformPlugin.acroFormDictionaryRoot.scope=s,s.internal.acroformPlugin.acroFormDictionaryRoot._eventID=s.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(s)}),s.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];i.objId=void 0,i.hasAnnotation&&C7(i,t)}})(s)}),s.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(s)}),s.internal.events.subscribe("postPutPages",function(t){(function(n,r){var i=!n;for(var o in n||(r.internal.newObjectDeferredBegin(r.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),r.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||r.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(o)){var l=n[o],d=[],h=l.Rect;if(l.Rect&&(l.Rect=_7(l.Rect,r)),r.internal.newObjectDeferredBegin(l.objId,!0),l.DA=Xt.createDefaultAppearanceStream(l),gs(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(d=l.getKeyValueListForStream()),l.Rect=h,l.hasAppearanceStream&&!l.appearanceStreamContent){var p=A7(l);d.push({key:"AP",value:"<</N "+p+">>"}),r.internal.acroformPlugin.xForms.push(p)}if(l.appearanceStreamContent){var g="";for(var b in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(b)){var x=l.appearanceStreamContent[b];if(g+="/"+b+" ",g+="<<",Object.keys(x).length>=1||Array.isArray(x)){for(var o in x)if(x.hasOwnProperty(o)){var w=x[o];typeof w=="function"&&(w=w.call(r,l)),g+="/"+o+" "+w+" ",r.internal.acroformPlugin.xForms.indexOf(w)>=0||r.internal.acroformPlugin.xForms.push(w)}}else typeof(w=x)=="function"&&(w=w.call(r,l)),g+="/"+o+" "+w,r.internal.acroformPlugin.xForms.indexOf(w)>=0||r.internal.acroformPlugin.xForms.push(w);g+=">>"}d.push({key:"AP",value:`<<
`+g+">>"})}r.internal.putStream({additionalKeyValues:d,objectId:l.objId}),r.internal.out("endobj")}i&&(function(v,_){for(var N in v)if(v.hasOwnProperty(N)){var E=N,k=v[N];_.internal.newObjectDeferredBegin(k.objId,!0),gs(k)==="object"&&typeof k.putStream=="function"&&k.putStream(),delete v[E]}})(r.internal.acroformPlugin.xForms,r)})(t,s)}),s.internal.acroformPlugin.isInitialized=!0}},H4=ur.__acroform__.arrayToPdfArray=function(s,e,t){var n=function(o){return o};if(Array.isArray(s)){for(var r="[",i=0;i<s.length;i++)switch(i!==0&&(r+=" "),gs(s[i])){case"boolean":case"number":case"object":r+=s[i].toString();break;case"string":s[i].substr(0,1)==="/"?r+="/"+Lg(s[i].substr(1)):(e!==void 0&&t&&(n=t.internal.getEncryptor(e)),r+="("+Gu(n(s[i].toString()))+")")}return r+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},l1=function(s,e,t){var n=function(r){return r};return e!==void 0&&t&&(n=t.internal.getEncryptor(e)),(s=s||"").toString(),"("+Gu(n(s))+")"},ul=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(s){this._objId=s}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};ul.prototype.toString=function(){return this.objId+" 0 R"},ul.prototype.putStream=function(){var s=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:s,objectId:this.objId}),this.scope.internal.out("endobj")},ul.prototype.getKeyValueListForStream=function(){var s=[],e=Object.getOwnPropertyNames(this).filter(function(i){return i!="content"&&i!="appearanceStreamContent"&&i!="scope"&&i!="objId"&&i.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var n=e[t],r=this[n];r&&(Array.isArray(r)?s.push({key:n,value:H4(r,this.objId,this.scope)}):r instanceof ul?(r.scope=this.scope,s.push({key:n,value:r.objId+" 0 R"})):typeof r!="function"&&s.push({key:n,value:r}))}return s};var G4=function(){ul.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var s,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){s=t.trim()},get:function(){return s||null}})};oa(G4,ul);var V4=function(){ul.call(this);var s,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(s){var t=function(n){return n};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Gu(t(s))+")"}},set:function(t){s=t}})};oa(V4,ul);var Ro=function s(){ul.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(N){if(isNaN(N))throw new Error('Invalid value "'+N+'" for attribute F supplied.');e=N}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!br(e,3)},set:function(N){N?this.F=yr(e,3):this.F=vr(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(N){if(isNaN(N))throw new Error('Invalid value "'+N+'" for attribute Ff supplied.');t=N}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(N){n=N!==void 0?N:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(N){n[0]=N}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(N){n[1]=N}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(N){n[2]=N}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(N){n[3]=N}});var r="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return r},set:function(N){switch(N){case"/Btn":case"/Tx":case"/Ch":case"/Sig":r=N;break;default:throw new Error('Invalid value "'+N+'" for attribute FT supplied.')}}});var i=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!i||i.length<1){if(this instanceof Rg)return;i="FieldObject"+s.FieldNum++}var N=function(E){return E};return this.scope&&(N=this.scope.internal.getEncryptor(this.objId)),"("+Gu(N(i))+")"},set:function(N){i=N.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return i},set:function(N){i=N}});var o="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return o},set:function(N){o=N}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(N){l=N}});var d=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return d},set:function(N){d=N}});var h=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return h===void 0?50/Hb:h},set:function(N){h=N}});var p="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return p},set:function(N){p=N}});var g="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!g||this instanceof Rg||this instanceof Bu))return l1(g,this.objId,this.scope)},set:function(N){N=N.toString(),g=N}});var b=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(b)return this instanceof Qr==0?l1(b,this.objId,this.scope):b},set:function(N){N=N.toString(),b=this instanceof Qr==0?N.substr(0,1)==="("?qd(N.substr(1,N.length-2)):qd(N):N}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Qr==1?qd(b.substr(1,b.length-1)):b},set:function(N){N=N.toString(),b=this instanceof Qr==1?"/"+Lg(N):N}});var x=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(x)return x},set:function(N){this.V=N}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(x)return this instanceof Qr==0?l1(x,this.objId,this.scope):x},set:function(N){N=N.toString(),x=this instanceof Qr==0?N.substr(0,1)==="("?qd(N.substr(1,N.length-2)):qd(N):N}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Qr==1?qd(x.substr(1,x.length-1)):x},set:function(N){N=N.toString(),x=this instanceof Qr==1?"/"+Lg(N):N}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var w,v=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return v},set:function(N){N=!!N,v=N}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(w)return w},set:function(N){w=N}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,1)},set:function(N){N?this.Ff=yr(this.Ff,1):this.Ff=vr(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,2)},set:function(N){N?this.Ff=yr(this.Ff,2):this.Ff=vr(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,3)},set:function(N){N?this.Ff=yr(this.Ff,3):this.Ff=vr(this.Ff,3)}});var _=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(_!==null)return _},set:function(N){if([0,1,2].indexOf(N)===-1)throw new Error('Invalid value "'+N+'" for attribute Q supplied.');_=N}}),Object.defineProperty(this,"textAlign",{get:function(){var N;switch(_){case 0:default:N="left";break;case 1:N="center";break;case 2:N="right"}return N},configurable:!0,enumerable:!0,set:function(N){switch(N){case"right":case 2:_=2;break;case"center":case 1:_=1;break;default:_=0}}})};oa(Ro,ul);var uh=function(){Ro.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var s=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return s},set:function(t){s=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return s},set:function(t){s=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return H4(e,this.objId,this.scope)},set:function(t){var n,r;r=[],typeof(n=t)=="string"&&(r=(function(i,o,l){l||(l=1);for(var d,h=[];d=o.exec(i);)h.push(d[l]);return h})(n,/\((.*?)\)/g)),e=r}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,n){for(n=n||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,18)},set:function(t){t?this.Ff=yr(this.Ff,18):this.Ff=vr(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=yr(this.Ff,19):this.Ff=vr(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,20)},set:function(t){t?(this.Ff=yr(this.Ff,20),e.sort()):this.Ff=vr(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,22)},set:function(t){t?this.Ff=yr(this.Ff,22):this.Ff=vr(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,23)},set:function(t){t?this.Ff=yr(this.Ff,23):this.Ff=vr(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,27)},set:function(t){t?this.Ff=yr(this.Ff,27):this.Ff=vr(this.Ff,27)}}),this.hasAppearanceStream=!1};oa(uh,Ro);var dh=function(){uh.call(this),this.fontName="helvetica",this.combo=!1};oa(dh,uh);var hh=function(){dh.call(this),this.combo=!0};oa(hh,dh);var ug=function(){hh.call(this),this.edit=!0};oa(ug,hh);var Qr=function(){Ro.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,15)},set:function(t){t?this.Ff=yr(this.Ff,15):this.Ff=vr(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,16)},set:function(t){t?this.Ff=yr(this.Ff,16):this.Ff=vr(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,17)},set:function(t){t?this.Ff=yr(this.Ff,17):this.Ff=vr(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,26)},set:function(t){t?this.Ff=yr(this.Ff,26):this.Ff=vr(this.Ff,26)}});var s,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(i){return i};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var n,r=[];for(n in r.push("<<"),e)r.push("/"+n+" ("+Gu(t(e[n]))+")");return r.push(">>"),r.join(`
`)}},set:function(t){gs(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return s},set:function(t){s=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return s.substr(1,s.length-1)},set:function(t){s="/"+Lg(t)}})};oa(Qr,Ro);var dg=function(){Qr.call(this),this.pushButton=!0};oa(dg,Qr);var fh=function(){Qr.call(this),this.radio=!0,this.pushButton=!1;var s=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return s},set:function(e){s=e!==void 0?e:[]}})};oa(fh,Qr);var Rg=function(){var s,e;Ro.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return s},set:function(r){s=r}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(r){e=r}});var t,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(l){return l};this.scope&&(r=this.scope.internal.getEncryptor(this.objId));var i,o=[];for(i in o.push("<<"),n)o.push("/"+i+" ("+Gu(r(n[i]))+")");return o.push(">>"),o.join(`
`)},set:function(r){gs(r)==="object"&&(n=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(r){typeof r=="string"&&(n.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(r){t="/"+r}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Xt.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};oa(Rg,Ro),fh.prototype.setAppearance=function(s){if(!("createAppearanceStream"in s)||!("getCA"in s))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=s.createAppearanceStream(t.optionName),t.caption=s.getCA()}},fh.prototype.createOption=function(s){var e=new Rg;return e.Parent=this,e.optionName=s,this.Kids.push(e),k7.call(this.scope,e),e};var hg=function(){Qr.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Xt.CheckBox.createAppearanceStream()};oa(hg,Qr);var Bu=function(){Ro.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,13)},set:function(e){e?this.Ff=yr(this.Ff,13):this.Ff=vr(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,21)},set:function(e){e?this.Ff=yr(this.Ff,21):this.Ff=vr(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,23)},set:function(e){e?this.Ff=yr(this.Ff,23):this.Ff=vr(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,24)},set:function(e){e?this.Ff=yr(this.Ff,24):this.Ff=vr(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,25)},set:function(e){e?this.Ff=yr(this.Ff,25):this.Ff=vr(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,26)},set:function(e){e?this.Ff=yr(this.Ff,26):this.Ff=vr(this.Ff,26)}});var s=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return s},set:function(e){s=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return s},set:function(e){Number.isInteger(e)&&(s=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};oa(Bu,Ro);var fg=function(){Bu.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!br(this.Ff,14)},set:function(s){s?this.Ff=yr(this.Ff,14):this.Ff=vr(this.Ff,14)}}),this.password=!0};oa(fg,Bu);var Xt={CheckBox:{createAppearanceStream:function(){return{N:{On:Xt.CheckBox.YesNormal},D:{On:Xt.CheckBox.YesPushDown,Off:Xt.CheckBox.OffPushDown}}},YesPushDown:function(s){var e=il(s);e.scope=s.scope;var t=[],n=s.scope.internal.getFont(s.fontName,s.fontStyle).id,r=s.scope.__private__.encodeColorString(s.color),i=nb(s,s.caption);return t.push("0.749023 g"),t.push("0 0 "+kn(Xt.internal.getWidth(s))+" "+kn(Xt.internal.getHeight(s))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+n+" "+kn(i.fontSize)+" Tf "+r),t.push("BT"),t.push(i.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(s){var e=il(s);e.scope=s.scope;var t=s.scope.internal.getFont(s.fontName,s.fontStyle).id,n=s.scope.__private__.encodeColorString(s.color),r=[],i=Xt.internal.getHeight(s),o=Xt.internal.getWidth(s),l=nb(s,s.caption);return r.push("1 g"),r.push("0 0 "+kn(o)+" "+kn(i)+" re"),r.push("f"),r.push("q"),r.push("0 0 1 rg"),r.push("0 0 "+kn(o-1)+" "+kn(i-1)+" re"),r.push("W"),r.push("n"),r.push("0 g"),r.push("BT"),r.push("/"+t+" "+kn(l.fontSize)+" Tf "+n),r.push(l.text),r.push("ET"),r.push("Q"),e.stream=r.join(`
`),e},OffPushDown:function(s){var e=il(s);e.scope=s.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+kn(Xt.internal.getWidth(s))+" "+kn(Xt.internal.getHeight(s))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(s){var e={D:{Off:Xt.RadioButton.Circle.OffPushDown},N:{}};return e.N[s]=Xt.RadioButton.Circle.YesNormal,e.D[s]=Xt.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(s){var e=il(s);e.scope=s.scope;var t=[],n=Xt.internal.getWidth(s)<=Xt.internal.getHeight(s)?Xt.internal.getWidth(s)/4:Xt.internal.getHeight(s)/4;n=Number((.9*n).toFixed(5));var r=Xt.internal.Bezier_C,i=Number((n*r).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+Oc(Xt.internal.getWidth(s)/2)+" "+Oc(Xt.internal.getHeight(s)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+i+" "+i+" "+n+" 0 "+n+" c"),t.push("-"+i+" "+n+" -"+n+" "+i+" -"+n+" 0 c"),t.push("-"+n+" -"+i+" -"+i+" -"+n+" 0 -"+n+" c"),t.push(i+" -"+n+" "+n+" -"+i+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(s){var e=il(s);e.scope=s.scope;var t=[],n=Xt.internal.getWidth(s)<=Xt.internal.getHeight(s)?Xt.internal.getWidth(s)/4:Xt.internal.getHeight(s)/4;n=Number((.9*n).toFixed(5));var r=Number((2*n).toFixed(5)),i=Number((r*Xt.internal.Bezier_C).toFixed(5)),o=Number((n*Xt.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Oc(Xt.internal.getWidth(s)/2)+" "+Oc(Xt.internal.getHeight(s)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+i+" "+i+" "+r+" 0 "+r+" c"),t.push("-"+i+" "+r+" -"+r+" "+i+" -"+r+" 0 c"),t.push("-"+r+" -"+i+" -"+i+" -"+r+" 0 -"+r+" c"),t.push(i+" -"+r+" "+r+" -"+i+" "+r+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+Oc(Xt.internal.getWidth(s)/2)+" "+Oc(Xt.internal.getHeight(s)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),t.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),t.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),t.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(s){var e=il(s);e.scope=s.scope;var t=[],n=Xt.internal.getWidth(s)<=Xt.internal.getHeight(s)?Xt.internal.getWidth(s)/4:Xt.internal.getHeight(s)/4;n=Number((.9*n).toFixed(5));var r=Number((2*n).toFixed(5)),i=Number((r*Xt.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Oc(Xt.internal.getWidth(s)/2)+" "+Oc(Xt.internal.getHeight(s)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+i+" "+i+" "+r+" 0 "+r+" c"),t.push("-"+i+" "+r+" -"+r+" "+i+" -"+r+" 0 c"),t.push("-"+r+" -"+i+" -"+i+" -"+r+" 0 -"+r+" c"),t.push(i+" -"+r+" "+r+" -"+i+" "+r+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(s){var e={D:{Off:Xt.RadioButton.Cross.OffPushDown},N:{}};return e.N[s]=Xt.RadioButton.Cross.YesNormal,e.D[s]=Xt.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(s){var e=il(s);e.scope=s.scope;var t=[],n=Xt.internal.calculateCross(s);return t.push("q"),t.push("1 1 "+kn(Xt.internal.getWidth(s)-2)+" "+kn(Xt.internal.getHeight(s)-2)+" re"),t.push("W"),t.push("n"),t.push(kn(n.x1.x)+" "+kn(n.x1.y)+" m"),t.push(kn(n.x2.x)+" "+kn(n.x2.y)+" l"),t.push(kn(n.x4.x)+" "+kn(n.x4.y)+" m"),t.push(kn(n.x3.x)+" "+kn(n.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(s){var e=il(s);e.scope=s.scope;var t=Xt.internal.calculateCross(s),n=[];return n.push("0.749023 g"),n.push("0 0 "+kn(Xt.internal.getWidth(s))+" "+kn(Xt.internal.getHeight(s))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+kn(Xt.internal.getWidth(s)-2)+" "+kn(Xt.internal.getHeight(s)-2)+" re"),n.push("W"),n.push("n"),n.push(kn(t.x1.x)+" "+kn(t.x1.y)+" m"),n.push(kn(t.x2.x)+" "+kn(t.x2.y)+" l"),n.push(kn(t.x4.x)+" "+kn(t.x4.y)+" m"),n.push(kn(t.x3.x)+" "+kn(t.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(s){var e=il(s);e.scope=s.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+kn(Xt.internal.getWidth(s))+" "+kn(Xt.internal.getHeight(s))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(s){var e=s.scope.internal.getFont(s.fontName,s.fontStyle).id,t=s.scope.__private__.encodeColorString(s.color);return"/"+e+" "+s.fontSize+" Tf "+t}};Xt.internal={Bezier_C:.551915024494,calculateCross:function(s){var e=Xt.internal.getWidth(s),t=Xt.internal.getHeight(s),n=Math.min(e,t);return{x1:{x:(e-n)/2,y:(t-n)/2+n},x2:{x:(e-n)/2+n,y:(t-n)/2},x3:{x:(e-n)/2,y:(t-n)/2},x4:{x:(e-n)/2+n,y:(t-n)/2+n}}}},Xt.internal.getWidth=function(s){var e=0;return gs(s)==="object"&&(e=hS(s.Rect[2])),e},Xt.internal.getHeight=function(s){var e=0;return gs(s)==="object"&&(e=hS(s.Rect[3])),e};var k7=ur.addField=function(s){if(E7(this,s),!(s instanceof Ro))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=s).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),s.page=s.scope.internal.getCurrentPageInfo().pageNumber,this};ur.AcroFormChoiceField=uh,ur.AcroFormListBox=dh,ur.AcroFormComboBox=hh,ur.AcroFormEditBox=ug,ur.AcroFormButton=Qr,ur.AcroFormPushButton=dg,ur.AcroFormRadioButton=fh,ur.AcroFormCheckBox=hg,ur.AcroFormTextField=Bu,ur.AcroFormPasswordField=fg,ur.AcroFormAppearance=Xt,ur.AcroForm={ChoiceField:uh,ListBox:dh,ComboBox:hh,EditBox:ug,Button:Qr,PushButton:dg,RadioButton:fh,CheckBox:hg,TextField:Bu,PasswordField:fg,Appearance:Xt},nn.AcroForm={ChoiceField:uh,ListBox:dh,ComboBox:hh,EditBox:ug,Button:Qr,PushButton:dg,RadioButton:fh,CheckBox:hg,TextField:Bu,PasswordField:fg,Appearance:Xt};nn.AcroForm;function W4(s){return s.reduce(function(e,t,n){return e[t]=n,e},{})}(function(s){var e="addImage_";s.__addimage__={};var t="UNKNOWN",n={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=s.__addimage__.getImageFileTypeByImageData=function(R,q){var J,Z,le,K,se,ce=t;if((q=q||t)==="RGBA"||R.data!==void 0&&R.data instanceof Uint8ClampedArray&&"height"in R&&"width"in R)return"RGBA";if(O(R))for(se in n)for(le=n[se],J=0;J<le.length;J+=1){for(K=!0,Z=0;Z<le[J].length;Z+=1)if(le[J][Z]!==void 0&&le[J][Z]!==R[Z]){K=!1;break}if(K===!0){ce=se;break}}else for(se in n)for(le=n[se],J=0;J<le.length;J+=1){for(K=!0,Z=0;Z<le[J].length;Z+=1)if(le[J][Z]!==void 0&&le[J][Z]!==R.charCodeAt(Z)){K=!1;break}if(K===!0){ce=se;break}}return ce===t&&q!==t&&(ce=q),ce},i=function R(q){for(var J=this.internal.write,Z=this.internal.putStream,le=(0,this.internal.getFilters)();le.indexOf("FlateEncode")!==-1;)le.splice(le.indexOf("FlateEncode"),1);q.objectId=this.internal.newObject();var K=[];if(K.push({key:"Type",value:"/XObject"}),K.push({key:"Subtype",value:"/Image"}),K.push({key:"Width",value:q.width}),K.push({key:"Height",value:q.height}),q.colorSpace===N.INDEXED?K.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(q.palette.length/3-1)+" "+("sMask"in q&&q.sMask!==void 0?q.objectId+2:q.objectId+1)+" 0 R]"}):(K.push({key:"ColorSpace",value:"/"+q.colorSpace}),q.colorSpace===N.DEVICE_CMYK&&K.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),K.push({key:"BitsPerComponent",value:q.bitsPerComponent}),"decodeParameters"in q&&q.decodeParameters!==void 0&&K.push({key:"DecodeParms",value:"<<"+q.decodeParameters+">>"}),"transparency"in q&&Array.isArray(q.transparency)&&q.transparency.length>0){for(var se="",ce=0,ye=q.transparency.length;ce<ye;ce++)se+=q.transparency[ce]+" "+q.transparency[ce]+" ";K.push({key:"Mask",value:"["+se+"]"})}q.sMask!==void 0&&K.push({key:"SMask",value:q.objectId+1+" 0 R"});var Ce=q.filter!==void 0?["/"+q.filter]:void 0;if(Z({data:q.data,additionalKeyValues:K,alreadyAppliedFilters:Ce,objectId:q.objectId}),J("endobj"),"sMask"in q&&q.sMask!==void 0){var M,L=(M=q.sMaskBitsPerComponent)!==null&&M!==void 0?M:q.bitsPerComponent,U={width:q.width,height:q.height,colorSpace:"DeviceGray",bitsPerComponent:L,data:q.sMask};"filter"in q&&(U.decodeParameters="/Predictor ".concat(q.predictor," /Colors 1 /BitsPerComponent ").concat(L," /Columns ").concat(q.width),U.filter=q.filter),R.call(this,U)}if(q.colorSpace===N.INDEXED){var H=this.internal.newObject();Z({data:$(new Uint8Array(q.palette)),objectId:H}),J("endobj")}},o=function(){var R=this.internal.collections[e+"images"];for(var q in R)i.call(this,R[q])},l=function(){var R,q=this.internal.collections[e+"images"],J=this.internal.write;for(var Z in q)J("/I"+(R=q[Z]).index,R.objectId,"0","R")},d=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",l))},h=function(){var R=this.internal.collections[e+"images"];return d.call(this),R},p=function(){return Object.keys(this.internal.collections[e+"images"]).length},g=function(R){return typeof s["process"+R.toUpperCase()]=="function"},b=function(R){return gs(R)==="object"&&R.nodeType===1},x=function(R,q){if(R.nodeName==="IMG"&&R.hasAttribute("src")){var J=""+R.getAttribute("src");if(J.indexOf("data:image/")===0)return cg(unescape(J).split("base64,").pop());var Z=s.loadFile(J,!0);if(Z!==void 0)return Z}if(R.nodeName==="CANVAS"){if(R.width===0||R.height===0)throw new Error("Given canvas must have data. Canvas width: "+R.width+", height: "+R.height);var le;switch(q){case"PNG":le="image/png";break;case"WEBP":le="image/webp";break;default:le="image/jpeg"}return cg(R.toDataURL(le,1).split("base64,").pop())}},w=function(R){var q=this.internal.collections[e+"images"];if(q){for(var J in q)if(R===q[J].alias)return q[J]}},v=function(R,q,J){return R||q||(R=-96,q=-96),R<0&&(R=-1*J.width*72/R/this.internal.scaleFactor),q<0&&(q=-1*J.height*72/q/this.internal.scaleFactor),R===0&&(R=q*J.width/J.height),q===0&&(q=R*J.height/J.width),[R,q]},_=function(R,q,J,Z,le,K){var se=v.call(this,J,Z,le),ce=this.internal.getCoordinateString,ye=this.internal.getVerticalCoordinateString,Ce=h.call(this);if(J=se[0],Z=se[1],Ce[le.index]=le,K){K*=Math.PI/180;var M=Math.cos(K),L=Math.sin(K),U=function(ae){return ae.toFixed(4)},H=[U(M),U(L),U(-1*L),U(M),0,0,"cm"]}this.internal.write("q"),K?(this.internal.write([1,"0","0",1,ce(R),ye(q+Z),"cm"].join(" ")),this.internal.write(H.join(" ")),this.internal.write([ce(J),"0","0",ce(Z),"0","0","cm"].join(" "))):this.internal.write([ce(J),"0","0",ce(Z),ce(R),ye(q+Z),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+le.index+" Do"),this.internal.write("Q")},N=s.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};s.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var E=s.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},k=s.__addimage__.sHashCode=function(R){var q,J,Z=0;if(typeof R=="string")for(J=R.length,q=0;q<J;q++)Z=(Z<<5)-Z+R.charCodeAt(q),Z|=0;else if(O(R))for(J=R.byteLength/2,q=0;q<J;q++)Z=(Z<<5)-Z+R[q],Z|=0;return Z},T=s.__addimage__.validateStringAsBase64=function(R){(R=R||"").toString().trim();var q=!0;return R.length===0&&(q=!1),R.length%4!=0&&(q=!1),/^[A-Za-z0-9+/]+$/.test(R.substr(0,R.length-2))===!1&&(q=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(R.substr(-2))===!1&&(q=!1),q},P=s.__addimage__.extractImageFromDataUrl=function(R){if(R==null||!(R=R.trim()).startsWith("data:"))return null;var q=R.indexOf(",");return q<0?null:R.substring(0,q).trim().endsWith("base64")?R.substring(q+1):null};s.__addimage__.isArrayBuffer=function(R){return R instanceof ArrayBuffer};var O=s.__addimage__.isArrayBufferView=function(R){return R instanceof Int8Array||R instanceof Uint8Array||R instanceof Uint8ClampedArray||R instanceof Int16Array||R instanceof Uint16Array||R instanceof Int32Array||R instanceof Uint32Array||R instanceof Float32Array||R instanceof Float64Array},F=s.__addimage__.binaryStringToUint8Array=function(R){for(var q=R.length,J=new Uint8Array(q),Z=0;Z<q;Z++)J[Z]=R.charCodeAt(Z);return J},$=s.__addimage__.arrayBufferToBinaryString=function(R){for(var q="",J=O(R)?R:new Uint8Array(R),Z=0;Z<J.length;Z+=8192)q+=String.fromCharCode.apply(null,J.subarray(Z,Z+8192));return q};s.addImage=function(){var R,q,J,Z,le,K,se,ce,ye;if(typeof arguments[1]=="number"?(q=t,J=arguments[1],Z=arguments[2],le=arguments[3],K=arguments[4],se=arguments[5],ce=arguments[6],ye=arguments[7]):(q=arguments[1],J=arguments[2],Z=arguments[3],le=arguments[4],K=arguments[5],se=arguments[6],ce=arguments[7],ye=arguments[8]),gs(R=arguments[0])==="object"&&!b(R)&&"imageData"in R){var Ce=R;R=Ce.imageData,q=Ce.format||q||t,J=Ce.x||J||0,Z=Ce.y||Z||0,le=Ce.w||Ce.width||le,K=Ce.h||Ce.height||K,se=Ce.alias||se,ce=Ce.compression||ce,ye=Ce.rotation||Ce.angle||ye}var M=this.internal.getFilters();if(ce===void 0&&M.indexOf("FlateEncode")!==-1&&(ce="SLOW"),isNaN(J)||isNaN(Z))throw new Error("Invalid coordinates passed to jsPDF.addImage");d.call(this);var L=z.call(this,R,q,se,ce);return _.call(this,J,Z,le,K,L,ye),this};var z=function(R,q,J,Z){var le,K,se;if(typeof R=="string"&&r(R)===t){R=unescape(R);var ce=G(R,!1);(ce!==""||(ce=s.loadFile(R,!0))!==void 0)&&(R=ce)}if(b(R)&&(R=x(R,q)),q=r(R,q),!g(q))throw new Error("addImage does not support files of type '"+q+"', please ensure that a plugin for '"+q+"' support is added.");if(((se=J)==null||se.length===0)&&(J=(function(ye){return typeof ye=="string"||O(ye)?k(ye):O(ye.data)?k(ye.data):null})(R)),(le=w.call(this,J))||(R instanceof Uint8Array||q==="RGBA"||(K=R,R=F(R)),le=this["process"+q.toUpperCase()](R,p.call(this),J,(function(ye){return ye&&typeof ye=="string"&&(ye=ye.toUpperCase()),ye in s.image_compression?ye:E.NONE})(Z),K)),!le)throw new Error("An unknown error occurred whilst processing the image.");return le},G=s.__addimage__.convertBase64ToBinaryString=function(R,q){q=typeof q!="boolean"||q;var J,Z="";if(typeof R=="string"){var le;J=(le=P(R))!==null&&le!==void 0?le:R;try{Z=cg(J)}catch(K){if(q)throw T(J)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+K.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Z};s.getImageProperties=function(R){var q,J,Z="";if(b(R)&&(R=x(R)),typeof R=="string"&&r(R)===t&&((Z=G(R,!1))===""&&(Z=s.loadFile(R)||""),R=Z),J=r(R),!g(J))throw new Error("addImage does not support files of type '"+J+"', please ensure that a plugin for '"+J+"' support is added.");if(R instanceof Uint8Array||(R=F(R)),!(q=this["process"+J.toUpperCase()](R)))throw new Error("An unknown error occurred whilst processing the image");return q.fileType=J,q}})(nn.API),(function(s){var e=function(t){if(t!==void 0&&t!="")return!0};nn.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),s.events.push(["putPage",function(t){for(var n,r,i,o=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,d=this.internal.getPageInfoByObjId(t.objId),h=t.pageContext.annotations,p=!1,g=0;g<h.length&&!p;g++)switch((n=h[g]).type){case"link":(e(n.options.url)||e(n.options.pageNumber))&&(p=!0);break;case"reference":case"text":case"freetext":p=!0}if(p!=0){this.internal.write("/Annots [");for(var b=0;b<h.length;b++){n=h[b];var x=this.internal.pdfEscape,w=this.internal.getEncryptor(t.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var v=this.internal.newAdditionalObject(),_=this.internal.newAdditionalObject(),N=this.internal.getEncryptor(v.objId),E=n.title||"Note";i="<</Type /Annot /Subtype /Text "+(r="/Rect ["+o(n.bounds.x)+" "+l(n.bounds.y+n.bounds.h)+" "+o(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y)+"] ")+"/Contents ("+x(N(n.contents))+")",i+=" /Popup "+_.objId+" 0 R",i+=" /P "+d.objId+" 0 R",i+=" /T ("+x(N(E))+") >>",v.content=i;var k=v.objId+" 0 R";i="<</Type /Annot /Subtype /Popup "+(r="/Rect ["+o(n.bounds.x+30)+" "+l(n.bounds.y+n.bounds.h)+" "+o(n.bounds.x+n.bounds.w+30)+" "+l(n.bounds.y)+"] ")+" /Parent "+k,n.open&&(i+=" /Open true"),i+=" >>",_.content=i,this.internal.write(v.objId,"0 R",_.objId,"0 R");break;case"freetext":r="/Rect ["+o(n.bounds.x)+" "+l(n.bounds.y)+" "+o(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y+n.bounds.h)+"] ";var T=n.color||"#000000";i="<</Type /Annot /Subtype /FreeText "+r+"/Contents ("+x(w(n.contents))+")",i+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+T+")",i+=" /Border [0 0 0]",i+=" >>",this.internal.write(i);break;case"link":if(n.options.name){var P=this.annotations._nameMap[n.options.name];n.options.pageNumber=P.page,n.options.top=P.y}else n.options.top||(n.options.top=0);if(r="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",i="",n.options.url)i="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /A <</S /URI /URI ("+x(w(n.options.url))+") >>";else if(n.options.pageNumber)switch(i="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":i+=" /Fit]";break;case"FitH":i+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,i+=" /FitV "+n.options.left+"]";break;default:var O=l(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),i+=" /XYZ "+n.options.left+" "+O+" "+n.options.zoom+"]"}i!=""&&(i+=" >>",this.internal.write(i))}}this.internal.write("]")}}]),s.createAnnotation=function(t){var n=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":n.pageContext.annotations.push(t)}},s.link=function(t,n,r,i,o){var l=this.internal.getCurrentPageInfo(),d=this.internal.getCoordinateString,h=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:d(t),y:h(n),w:d(t+r),h:h(n+i)},options:o,type:"link"})},s.textWithLink=function(t,n,r,i){var o,l,d=this.getTextWidth(t),h=this.internal.getLineHeight()/this.internal.scaleFactor;if(i.maxWidth!==void 0){l=i.maxWidth;var p=this.splitTextToSize(t,l).length;o=Math.ceil(h*p)}else l=d,o=h;return this.text(t,n,r,i),r+=.2*h,i.align==="center"&&(n-=d/2),i.align==="right"&&(n-=d),this.link(n,r-h,l,o,i),d},s.getTextWidth=function(t){var n=this.internal.getFontSize();return this.getStringUnitWidth(t)*n/this.internal.scaleFactor}})(nn.API),(function(s){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},r=[1570,1571,1573,1575];s.__arabicParser__={};var i=s.__arabicParser__.isInArabicSubstitutionA=function(v){return e[v.charCodeAt(0)]!==void 0},o=s.__arabicParser__.isArabicLetter=function(v){return typeof v=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(v)},l=s.__arabicParser__.isArabicEndLetter=function(v){return o(v)&&i(v)&&e[v.charCodeAt(0)].length<=2},d=s.__arabicParser__.isArabicAlfLetter=function(v){return o(v)&&r.indexOf(v.charCodeAt(0))>=0};s.__arabicParser__.arabicLetterHasIsolatedForm=function(v){return o(v)&&i(v)&&e[v.charCodeAt(0)].length>=1};var h=s.__arabicParser__.arabicLetterHasFinalForm=function(v){return o(v)&&i(v)&&e[v.charCodeAt(0)].length>=2};s.__arabicParser__.arabicLetterHasInitialForm=function(v){return o(v)&&i(v)&&e[v.charCodeAt(0)].length>=3};var p=s.__arabicParser__.arabicLetterHasMedialForm=function(v){return o(v)&&i(v)&&e[v.charCodeAt(0)].length==4},g=s.__arabicParser__.resolveLigatures=function(v){var _=0,N=t,E="",k=0;for(_=0;_<v.length;_+=1)N[v.charCodeAt(_)]!==void 0?(k++,typeof(N=N[v.charCodeAt(_)])=="number"&&(E+=String.fromCharCode(N),N=t,k=0),_===v.length-1&&(N=t,E+=v.charAt(_-(k-1)),_-=k-1,k=0)):(N=t,E+=v.charAt(_-k),_-=k,k=0);return E};s.__arabicParser__.isArabicDiacritic=function(v){return v!==void 0&&n[v.charCodeAt(0)]!==void 0};var b=s.__arabicParser__.getCorrectForm=function(v,_,N){return o(v)?i(v)===!1?-1:!h(v)||!o(_)&&!o(N)||!o(N)&&l(_)||l(v)&&!o(_)||l(v)&&d(_)||l(v)&&l(_)?0:p(v)&&o(_)&&!l(_)&&o(N)&&h(N)?3:l(v)||!o(N)?1:2:-1},x=function(v){var _=0,N=0,E=0,k="",T="",P="",O=(v=v||"").split("\\s+"),F=[];for(_=0;_<O.length;_+=1){for(F.push(""),N=0;N<O[_].length;N+=1)k=O[_][N],T=O[_][N-1],P=O[_][N+1],o(k)?(E=b(k,T,P),F[_]+=E!==-1?String.fromCharCode(e[k.charCodeAt(0)][E]):k):F[_]+=k;F[_]=g(F[_])}return F.join(" ")},w=s.__arabicParser__.processArabic=s.processArabic=function(){var v,_=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,N=[];if(Array.isArray(_)){var E=0;for(N=[],E=0;E<_.length;E+=1)Array.isArray(_[E])?N.push([x(_[E][0]),_[E][1],_[E][2]]):N.push([x(_[E])]);v=N}else v=x(_);return typeof arguments[0]=="string"?v:(arguments[0].text=v,arguments[0])};s.events.push(["preProcessText",w])})(nn.API),nn.API.autoPrint=function(s){var e;return(s=s||{}).variant=s.variant||"non-conform",s.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},(function(s){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(l){t=l}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(l){n=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var r=300;Object.defineProperty(this,"height",{get:function(){return r},set:function(l){r=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=r+1)}});var i=[];Object.defineProperty(this,"childNodes",{get:function(){return i},set:function(l){i=l}});var o={};Object.defineProperty(this,"style",{get:function(){return o},set:function(l){o=l}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,n){var r;if((t=t||"2d")!=="2d")return null;for(r in n)this.pdf.context2d.hasOwnProperty(r)&&(this.pdf.context2d[r]=n[r]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},s.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])})(nn.API),(function(s){var e={left:0,top:0,bottom:0,right:0},t=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),r.call(this))},r=function(){this.internal.__cell__.lastCell=new i,this.internal.__cell__.pages=1},i=function(){var d=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return d},set:function(v){d=v}});var h=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return h},set:function(v){h=v}});var p=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return p},set:function(v){p=v}});var g=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return g},set:function(v){g=v}});var b=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return b},set:function(v){b=v}});var x=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return x},set:function(v){x=v}});var w=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return w},set:function(v){w=v}}),this};i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},i.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},s.setHeaderFunction=function(d){return n.call(this),this.internal.__cell__.headerFunction=typeof d=="function"?d:void 0,this},s.getTextDimensions=function(d,h){n.call(this);var p=(h=h||{}).fontSize||this.getFontSize(),g=h.font||this.getFont(),b=h.scaleFactor||this.internal.scaleFactor,x=0,w=0,v=0,_=this;if(!Array.isArray(d)&&typeof d!="string"){if(typeof d!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");d=String(d)}var N=h.maxWidth;N>0?typeof d=="string"?d=this.splitTextToSize(d,N):Object.prototype.toString.call(d)==="[object Array]"&&(d=d.reduce(function(k,T){return k.concat(_.splitTextToSize(T,N))},[])):d=Array.isArray(d)?d:[d];for(var E=0;E<d.length;E++)x<(v=this.getStringUnitWidth(d[E],{font:g})*p)&&(x=v);return x!==0&&(w=d.length),{w:x/=b,h:Math.max((w*p*this.getLineHeightFactor()-p*(this.getLineHeightFactor()-1))/b,0)}},s.cellAddPage=function(){n.call(this),this.addPage();var d=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new i(d.left,d.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var o=s.cell=function(){var d;d=arguments[0]instanceof i?arguments[0]:new i(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),n.call(this);var h=this.internal.__cell__.lastCell,p=this.internal.__cell__.padding,g=this.internal.__cell__.margins||e,b=this.internal.__cell__.tableHeaderRow,x=this.internal.__cell__.printHeaders;return h.lineNumber!==void 0&&(h.lineNumber===d.lineNumber?(d.x=(h.x||0)+(h.width||0),d.y=h.y||0):h.y+h.height+d.height+g.bottom>this.getPageHeight()?(this.cellAddPage(),d.y=g.top,x&&b&&(this.printHeaderRow(d.lineNumber,!0),d.y+=b[0].height)):d.y=h.y+h.height||d.y),d.text[0]!==void 0&&(this.rect(d.x,d.y,d.width,d.height,t===!0?"FD":void 0),d.align==="right"?this.text(d.text,d.x+d.width-p,d.y+p,{align:"right",baseline:"top"}):d.align==="center"?this.text(d.text,d.x+d.width/2,d.y+p,{align:"center",baseline:"top",maxWidth:d.width-p-p}):this.text(d.text,d.x+p,d.y+p,{align:"left",baseline:"top",maxWidth:d.width-p-p})),this.internal.__cell__.lastCell=d,this};s.table=function(d,h,p,g,b){if(n.call(this),!p)throw new Error("No data for PDF table.");var x,w,v,_,N=[],E=[],k=[],T={},P={},O=[],F=[],$=(b=b||{}).autoSize||!1,z=b.printHeaders!==!1,G=b.css&&b.css["font-size"]!==void 0?16*b.css["font-size"]:b.fontSize||12,R=b.margins||Object.assign({width:this.getPageWidth()},e),q=typeof b.padding=="number"?b.padding:3,J=b.headerBackgroundColor||"#c8c8c8",Z=b.headerTextColor||"#000";if(r.call(this),this.internal.__cell__.printHeaders=z,this.internal.__cell__.margins=R,this.internal.__cell__.table_font_size=G,this.internal.__cell__.padding=q,this.internal.__cell__.headerBackgroundColor=J,this.internal.__cell__.headerTextColor=Z,this.setFontSize(G),g==null)E=N=Object.keys(p[0]),k=N.map(function(){return"left"});else if(Array.isArray(g)&&gs(g[0])==="object")for(N=g.map(function(Ce){return Ce.name}),E=g.map(function(Ce){return Ce.prompt||Ce.name||""}),k=g.map(function(Ce){return Ce.align||"left"}),x=0;x<g.length;x+=1)P[g[x].name]=.7499990551181103*g[x].width;else Array.isArray(g)&&typeof g[0]=="string"&&(E=N=g,k=N.map(function(){return"left"}));if($||Array.isArray(g)&&typeof g[0]=="string")for(x=0;x<N.length;x+=1){for(T[_=N[x]]=p.map(function(Ce){return Ce[_]}),this.setFont(void 0,"bold"),O.push(this.getTextDimensions(E[x],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),w=T[_],this.setFont(void 0,"normal"),v=0;v<w.length;v+=1)O.push(this.getTextDimensions(w[v],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);P[_]=Math.max.apply(null,O)+q+q,O=[]}if(z){var le={};for(x=0;x<N.length;x+=1)le[N[x]]={},le[N[x]].text=E[x],le[N[x]].align=k[x];var K=l.call(this,le,P);F=N.map(function(Ce){return new i(d,h,P[Ce],K,le[Ce].text,void 0,le[Ce].align)}),this.setTableHeaderRow(F),this.printHeaderRow(1,!1)}var se=g.reduce(function(Ce,M){return Ce[M.name]=M.align,Ce},{});for(x=0;x<p.length;x+=1){"rowStart"in b&&b.rowStart instanceof Function&&b.rowStart({row:x,data:p[x]},this);var ce=l.call(this,p[x],P);for(v=0;v<N.length;v+=1){var ye=p[x][N[v]];"cellStart"in b&&b.cellStart instanceof Function&&b.cellStart({row:x,col:v,data:ye},this),o.call(this,new i(d,h,P[N[v]],ce,ye,x+2,se[N[v]]))}}return this.internal.__cell__.table_x=d,this.internal.__cell__.table_y=h,this};var l=function(d,h){var p=this.internal.__cell__.padding,g=this.internal.__cell__.table_font_size,b=this.internal.scaleFactor;return Object.keys(d).map(function(x){var w=d[x];return this.splitTextToSize(w.hasOwnProperty("text")?w.text:w,h[x]-p-p)},this).map(function(x){return this.getLineHeightFactor()*x.length*g/b+p+p},this).reduce(function(x,w){return Math.max(x,w)},0)};s.setTableHeaderRow=function(d){n.call(this),this.internal.__cell__.tableHeaderRow=d},s.printHeaderRow=function(d,h){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var p;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var g=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new i(g[0],g[1],g[2],g[3],void 0,-1)}this.setFont(void 0,"bold");for(var b=[],x=0;x<this.internal.__cell__.tableHeaderRow.length;x+=1){p=this.internal.__cell__.tableHeaderRow[x].clone(),h&&(p.y=this.internal.__cell__.margins.top||0,b.push(p)),p.lineNumber=d;var w=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),o.call(this,p),this.setTextColor(w)}b.length>0&&this.setTableHeaderRow(b),this.setFont(void 0,"normal"),t=!1}})(nn.API);var Y4={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},K4=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],sb=W4(K4),X4=[100,200,300,400,500,600,700,800,900],j7=W4(X4);function c1(s){var e=s.family.replace(/"|'/g,"").toLowerCase(),t=(function(i){return Y4[i=i||"normal"]?i:"normal"})(s.style),n=(function(i){return i?typeof i=="number"?i>=100&&i<=900&&i%100==0?i:400:/^\d00$/.test(i)?parseInt(i):i==="bold"?700:400:400})(s.weight),r=(function(i){return typeof sb[i=i||"normal"]=="number"?i:"normal"})(s.stretch);return{family:e,style:t,weight:n,stretch:r,src:s.src||[],ref:s.ref||{name:e,style:[r,t,n].join(" ")}}}function fS(s,e,t,n){var r;for(r=t;r>=0&&r<e.length;r+=n)if(s[e[r]])return s[e[r]];for(r=t;r>=0&&r<e.length;r-=n)if(s[e[r]])return s[e[r]]}var T7={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},pS={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function gS(s){return[s.stretch,s.style,s.weight,s.family].join(" ")}function mS(s){return s.trimLeft()}function D7(s,e){for(var t=0;t<s.length;){if(s.charAt(t)===e)return[s.substring(0,t),s.substring(t+1)];t+=1}return null}function L7(s){var e=s.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],s.substring(e[0].length)]}var Hd,vp,xS,bS,yS,u1=["times"];function vS(s,e,t,n,r){var i=4,o=SS;switch(r){case nn.API.image_compression.FAST:i=1,o=wS;break;case nn.API.image_compression.MEDIUM:i=6,o=_S;break;case nn.API.image_compression.SLOW:i=9,o=AS}s=(function(d,h,p,g){for(var b,x=d.length/h,w=new Uint8Array(d.length+x),v=[R7,wS,SS,_S,AS],_=0;_<x;_+=1){var N=_*h,E=d.subarray(N,N+h);if(g)w.set(g(E,p,b),N+_);else{for(var k=v.length,T=[],P=0;P<k;P+=1)T[P]=v[P](E,p,b);var O=B7(T.concat());w.set(T[O],N+_)}b=E}return w})(s,e,Math.ceil(t*n/8),o);var l=X1(s,{level:i});return nn.API.__addimage__.arrayBufferToBinaryString(l)}function R7(s){var e=Array.apply([],s);return e.unshift(0),e}function wS(s,e){var t=s.length,n=[];n[0]=1;for(var r=0;r<t;r+=1){var i=s[r-e]||0;n[r+1]=s[r]-i+256&255}return n}function SS(s,e,t){var n=s.length,r=[];r[0]=2;for(var i=0;i<n;i+=1){var o=t&&t[i]||0;r[i+1]=s[i]-o+256&255}return r}function _S(s,e,t){var n=s.length,r=[];r[0]=3;for(var i=0;i<n;i+=1){var o=s[i-e]||0,l=t&&t[i]||0;r[i+1]=s[i]+256-(o+l>>>1)&255}return r}function AS(s,e,t){var n=s.length,r=[];r[0]=4;for(var i=0;i<n;i+=1){var o=P7(s[i-e]||0,t&&t[i]||0,t&&t[i-e]||0);r[i+1]=s[i]-o+256&255}return r}function P7(s,e,t){if(s===e&&e===t)return s;var n=Math.abs(e-t),r=Math.abs(s-t),i=Math.abs(s+e-t-t);return n<=r&&n<=i?s:r<=i?e:t}function B7(s){var e=s.map(function(t){return t.reduce(function(n,r){return n+Math.abs(r)},0)});return e.indexOf(Math.min.apply(null,e))}function d1(s,e,t){var n=e*t,r=Math.floor(n/8),i=16-(n-8*r+t),o=(1<<t)-1;return J4(s,r)>>i&o}function NS(s,e,t,n){var r=t*n,i=Math.floor(r/8),o=16-(r-8*i+n),l=(1<<n)-1,d=(e&l)<<o;(function(h,p,g){if(p+1<h.byteLength)h.setUint16(p,g,!1);else{var b=g>>8&255;h.setUint8(p,b)}})(s,i,J4(s,i)&~(l<<o)&65535|d)}function J4(s,e){return e+1<s.byteLength?s.getUint16(e,!1):s.getUint8(e)<<8}function O7(s){var e=0;if(s[e++]!==71||s[e++]!==73||s[e++]!==70||s[e++]!==56||(s[e++]+1&253)!=56||s[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=s[e++]|s[e++]<<8,n=s[e++]|s[e++]<<8,r=s[e++],i=r>>7,o=1<<1+(7&r);s[e++],s[e++];var l=null,d=null;i&&(l=e,d=o,e+=3*o);var h=!0,p=[],g=0,b=null,x=0,w=null;for(this.width=t,this.height=n;h&&e<s.length;)switch(s[e++]){case 33:switch(s[e++]){case 255:if(s[e]!==11||s[e+1]==78&&s[e+2]==69&&s[e+3]==84&&s[e+4]==83&&s[e+5]==67&&s[e+6]==65&&s[e+7]==80&&s[e+8]==69&&s[e+9]==50&&s[e+10]==46&&s[e+11]==48&&s[e+12]==3&&s[e+13]==1&&s[e+16]==0)e+=14,w=s[e++]|s[e++]<<8,e++;else for(e+=12;;){if(!((R=s[e++])>=0))throw Error("Invalid block size");if(R===0)break;e+=R}break;case 249:if(s[e++]!==4||s[e+4]!==0)throw new Error("Invalid graphics extension block.");var v=s[e++];g=s[e++]|s[e++]<<8,b=s[e++],1&v||(b=null),x=v>>2&7,e++;break;case 254:for(;;){if(!((R=s[e++])>=0))throw Error("Invalid block size");if(R===0)break;e+=R}break;default:throw new Error("Unknown graphic control label: 0x"+s[e-1].toString(16))}break;case 44:var _=s[e++]|s[e++]<<8,N=s[e++]|s[e++]<<8,E=s[e++]|s[e++]<<8,k=s[e++]|s[e++]<<8,T=s[e++],P=T>>6&1,O=1<<1+(7&T),F=l,$=d,z=!1;T>>7&&(z=!0,F=e,$=O,e+=3*O);var G=e;for(e++;;){var R;if(!((R=s[e++])>=0))throw Error("Invalid block size");if(R===0)break;e+=R}p.push({x:_,y:N,width:E,height:k,has_local_palette:z,palette_offset:F,palette_size:$,data_offset:G,data_length:e-G,transparent_index:b,interlaced:!!P,delay:g,disposal:x});break;case 59:h=!1;break;default:throw new Error("Unknown gif block: 0x"+s[e-1].toString(16))}this.numFrames=function(){return p.length},this.loopCount=function(){return w},this.frameInfo=function(q){if(q<0||q>=p.length)throw new Error("Frame index out of range.");return p[q]},this.decodeAndBlitFrameBGRA=function(q,J){var Z=this.frameInfo(q),le=Z.width*Z.height,K=new Uint8Array(le);CS(s,Z.data_offset,K,le);var se=Z.palette_offset,ce=Z.transparent_index;ce===null&&(ce=256);var ye=Z.width,Ce=t-ye,M=ye,L=4*(Z.y*t+Z.x),U=4*((Z.y+Z.height)*t+Z.x),H=L,ae=4*Ce;Z.interlaced===!0&&(ae+=4*t*7);for(var de=8,xe=0,he=K.length;xe<he;++xe){var me=K[xe];if(M===0&&(M=ye,(H+=ae)>=U&&(ae=4*Ce+4*t*(de-1),H=L+(ye+Ce)*(de<<1),de>>=1)),me===ce)H+=4;else{var ve=s[se+3*me],Re=s[se+3*me+1],Ke=s[se+3*me+2];J[H++]=Ke,J[H++]=Re,J[H++]=ve,J[H++]=255}--M}},this.decodeAndBlitFrameRGBA=function(q,J){var Z=this.frameInfo(q),le=Z.width*Z.height,K=new Uint8Array(le);CS(s,Z.data_offset,K,le);var se=Z.palette_offset,ce=Z.transparent_index;ce===null&&(ce=256);var ye=Z.width,Ce=t-ye,M=ye,L=4*(Z.y*t+Z.x),U=4*((Z.y+Z.height)*t+Z.x),H=L,ae=4*Ce;Z.interlaced===!0&&(ae+=4*t*7);for(var de=8,xe=0,he=K.length;xe<he;++xe){var me=K[xe];if(M===0&&(M=ye,(H+=ae)>=U&&(ae=4*Ce+4*t*(de-1),H=L+(ye+Ce)*(de<<1),de>>=1)),me===ce)H+=4;else{var ve=s[se+3*me],Re=s[se+3*me+1],Ke=s[se+3*me+2];J[H++]=ve,J[H++]=Re,J[H++]=Ke,J[H++]=255}--M}}}function CS(s,e,t,n){for(var r=s[e++],i=1<<r,o=i+1,l=o+1,d=r+1,h=(1<<d)-1,p=0,g=0,b=0,x=s[e++],w=new Int32Array(4096),v=null;;){for(;p<16&&x!==0;)g|=s[e++]<<p,p+=8,x===1?x=s[e++]:--x;if(p<d)break;var _=g&h;if(g>>=d,p-=d,_!==i){if(_===o)break;for(var N=_<l?_:v,E=0,k=N;k>i;)k=w[k]>>8,++E;var T=k;if(b+E+(N!==_?1:0)>n)return void js.log("Warning, gif stream longer than expected.");t[b++]=T;var P=b+=E;for(N!==_&&(t[b++]=T),k=N;E--;)k=w[k],t[--P]=255&k,k>>=8;v!==null&&l<4096&&(w[l++]=v<<8|T,l>=h+1&&d<12&&(++d,h=h<<1|1)),v=_}else l=o+1,h=(1<<(d=r+1))-1,v=null}return b!==n&&js.log("Warning, gif stream shorter than expected."),t}function h1(s){var e,t,n,r,i,o=Math.floor,l=new Array(64),d=new Array(64),h=new Array(64),p=new Array(64),g=new Array(65535),b=new Array(65535),x=new Array(64),w=new Array(64),v=[],_=0,N=7,E=new Array(64),k=new Array(64),T=new Array(64),P=new Array(256),O=new Array(2048),F=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],$=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],z=[0,1,2,3,4,5,6,7,8,9,10,11],G=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],R=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],q=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],J=[0,1,2,3,4,5,6,7,8,9,10,11],Z=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],le=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function K(L,U){for(var H=0,ae=0,de=new Array,xe=1;xe<=16;xe++){for(var he=1;he<=L[xe];he++)de[U[ae]]=[],de[U[ae]][0]=H,de[U[ae]][1]=xe,ae++,H++;H*=2}return de}function se(L){for(var U=L[0],H=L[1]-1;H>=0;)U&1<<H&&(_|=1<<N),H--,--N<0&&(_==255?(ce(255),ce(0)):ce(_),N=7,_=0)}function ce(L){v.push(L)}function ye(L){ce(L>>8&255),ce(255&L)}function Ce(L,U,H,ae,de){for(var xe,he=de[0],me=de[240],ve=(function(Ye,Et){var vt,st,St,Pt,Ut,je,Me,Fe,ue,Te,Oe=0;for(ue=0;ue<8;++ue){vt=Ye[Oe],st=Ye[Oe+1],St=Ye[Oe+2],Pt=Ye[Oe+3],Ut=Ye[Oe+4],je=Ye[Oe+5],Me=Ye[Oe+6];var ct=vt+(Fe=Ye[Oe+7]),ft=vt-Fe,wt=st+Me,it=st-Me,At=St+je,We=St-je,lt=Pt+Ut,pt=Pt-Ut,It=ct+lt,en=ct-lt,Mt=wt+At,Bt=wt-At;Ye[Oe]=It+Mt,Ye[Oe+4]=It-Mt;var Yt=.707106781*(Bt+en);Ye[Oe+2]=en+Yt,Ye[Oe+6]=en-Yt;var On=.382683433*((It=pt+We)-(Bt=it+ft)),an=.5411961*It+On,As=1.306562965*Bt+On,ut=.707106781*(Mt=We+it),re=ft+ut,Qe=ft-ut;Ye[Oe+5]=Qe+an,Ye[Oe+3]=Qe-an,Ye[Oe+1]=re+As,Ye[Oe+7]=re-As,Oe+=8}for(Oe=0,ue=0;ue<8;++ue){vt=Ye[Oe],st=Ye[Oe+8],St=Ye[Oe+16],Pt=Ye[Oe+24],Ut=Ye[Oe+32],je=Ye[Oe+40],Me=Ye[Oe+48];var mt=vt+(Fe=Ye[Oe+56]),Xe=vt-Fe,et=st+Me,kt=st-Me,Tt=St+je,Rt=St-je,An=Pt+Ut,Pn=Pt-Ut,wn=mt+An,jt=mt-An,dt=et+Tt,sn=et-Tt;Ye[Oe]=wn+dt,Ye[Oe+32]=wn-dt;var Un=.707106781*(sn+jt);Ye[Oe+16]=jt+Un,Ye[Oe+48]=jt-Un;var er=.382683433*((wn=Pn+Rt)-(sn=kt+Xe)),tr=.5411961*wn+er,Ns=1.306562965*sn+er,Hr=.707106781*(dt=Rt+kt),Tr=Xe+Hr,Ci=Xe-Hr;Ye[Oe+40]=Ci+tr,Ye[Oe+24]=Ci-tr,Ye[Oe+8]=Tr+Ns,Ye[Oe+56]=Tr-Ns,Oe++}for(ue=0;ue<64;++ue)Te=Ye[ue]*Et[ue],x[ue]=Te>0?Te+.5|0:Te-.5|0;return x})(L,U),Re=0;Re<64;++Re)w[F[Re]]=ve[Re];var Ke=w[0]-H;H=w[0],Ke==0?se(ae[0]):(se(ae[b[xe=32767+Ke]]),se(g[xe]));for(var Ge=63;Ge>0&&w[Ge]==0;)Ge--;if(Ge==0)return se(he),H;for(var ke,X=1;X<=Ge;){for(var Pe=X;w[X]==0&&X<=Ge;)++X;var gt=X-Pe;if(gt>=16){ke=gt>>4;for(var bt=1;bt<=ke;++bt)se(me);gt&=15}xe=32767+w[X],se(de[(gt<<4)+b[xe]]),se(g[xe]),X++}return Ge!=63&&se(he),H}function M(L){L=Math.min(Math.max(L,1),100),i!=L&&((function(U){for(var H=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],ae=0;ae<64;ae++){var de=o((H[ae]*U+50)/100);de=Math.min(Math.max(de,1),255),l[F[ae]]=de}for(var xe=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],he=0;he<64;he++){var me=o((xe[he]*U+50)/100);me=Math.min(Math.max(me,1),255),d[F[he]]=me}for(var ve=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Re=0,Ke=0;Ke<8;Ke++)for(var Ge=0;Ge<8;Ge++)h[Re]=1/(l[F[Re]]*ve[Ke]*ve[Ge]*8),p[Re]=1/(d[F[Re]]*ve[Ke]*ve[Ge]*8),Re++})(L<50?Math.floor(5e3/L):Math.floor(200-2*L)),i=L)}this.encode=function(L,U){U&&M(U),v=new Array,_=0,N=7,ye(65496),ye(65504),ye(16),ce(74),ce(70),ce(73),ce(70),ce(0),ce(1),ce(1),ce(0),ye(1),ye(1),ce(0),ce(0),(function(){ye(65499),ye(132),ce(0);for(var st=0;st<64;st++)ce(l[st]);ce(1);for(var St=0;St<64;St++)ce(d[St])})(),(function(st,St){ye(65472),ye(17),ce(8),ye(St),ye(st),ce(3),ce(1),ce(17),ce(0),ce(2),ce(17),ce(1),ce(3),ce(17),ce(1)})(L.width,L.height),(function(){ye(65476),ye(418),ce(0);for(var st=0;st<16;st++)ce($[st+1]);for(var St=0;St<=11;St++)ce(z[St]);ce(16);for(var Pt=0;Pt<16;Pt++)ce(G[Pt+1]);for(var Ut=0;Ut<=161;Ut++)ce(R[Ut]);ce(1);for(var je=0;je<16;je++)ce(q[je+1]);for(var Me=0;Me<=11;Me++)ce(J[Me]);ce(17);for(var Fe=0;Fe<16;Fe++)ce(Z[Fe+1]);for(var ue=0;ue<=161;ue++)ce(le[ue])})(),ye(65498),ye(12),ce(3),ce(1),ce(0),ce(2),ce(17),ce(3),ce(17),ce(0),ce(63),ce(0);var H=0,ae=0,de=0;_=0,N=7,this.encode.displayName="_encode_";for(var xe,he,me,ve,Re,Ke,Ge,ke,X,Pe=L.data,gt=L.width,bt=L.height,Ye=4*gt,Et=0;Et<bt;){for(xe=0;xe<Ye;){for(Re=Ye*Et+xe,Ge=-1,ke=0,X=0;X<64;X++)Ke=Re+(ke=X>>3)*Ye+(Ge=4*(7&X)),Et+ke>=bt&&(Ke-=Ye*(Et+1+ke-bt)),xe+Ge>=Ye&&(Ke-=xe+Ge-Ye+4),he=Pe[Ke++],me=Pe[Ke++],ve=Pe[Ke++],E[X]=(O[he]+O[me+256|0]+O[ve+512|0]>>16)-128,k[X]=(O[he+768|0]+O[me+1024|0]+O[ve+1280|0]>>16)-128,T[X]=(O[he+1280|0]+O[me+1536|0]+O[ve+1792|0]>>16)-128;H=Ce(E,h,H,e,n),ae=Ce(k,p,ae,t,r),de=Ce(T,p,de,t,r),xe+=32}Et+=8}if(N>=0){var vt=[];vt[1]=N+1,vt[0]=(1<<N+1)-1,se(vt)}return ye(65497),new Uint8Array(v)},s=s||50,(function(){for(var L=String.fromCharCode,U=0;U<256;U++)P[U]=L(U)})(),e=K($,z),t=K(q,J),n=K(G,R),r=K(Z,le),(function(){for(var L=1,U=2,H=1;H<=15;H++){for(var ae=L;ae<U;ae++)b[32767+ae]=H,g[32767+ae]=[],g[32767+ae][1]=H,g[32767+ae][0]=ae;for(var de=-(U-1);de<=-L;de++)b[32767+de]=H,g[32767+de]=[],g[32767+de][1]=H,g[32767+de][0]=U-1+de;L<<=1,U<<=1}})(),(function(){for(var L=0;L<256;L++)O[L]=19595*L,O[L+256|0]=38470*L,O[L+512|0]=7471*L+32768,O[L+768|0]=-11059*L,O[L+1024|0]=-21709*L,O[L+1280|0]=32768*L+8421375,O[L+1536|0]=-27439*L,O[L+1792|0]=-5329*L})(),M(s)}function No(s,e){if(this.pos=0,this.buffer=s,this.datav=new DataView(s.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function ES(s){function e(z){if(!z)throw Error("assert :P")}function t(z,G,R){for(var q=0;4>q;q++)if(z[G+q]!=R.charCodeAt(q))return!0;return!1}function n(z,G,R,q,J){for(var Z=0;Z<J;Z++)z[G+Z]=R[q+Z]}function r(z,G,R,q){for(var J=0;J<q;J++)z[G+J]=R}function i(z){return new Int32Array(z)}function o(z,G){for(var R=[],q=0;q<z;q++)R.push(new G);return R}function l(z,G){var R=[];return(function q(J,Z,le){for(var K=le[Z],se=0;se<K&&(J.push(le.length>Z+1?[]:new G),!(le.length<Z+1));se++)q(J[se],Z+1,le)})(R,0,z),R}var d=function(){var z=this;function G(y,A){for(var D=1<<A-1>>>0;y&D;)D>>>=1;return D?(y&D-1)+D:y}function R(y,A,D,B,W){e(!(B%D));do y[A+(B-=D)]=W;while(0<B)}function q(y,A,D,B,W){if(e(2328>=W),512>=W)var Q=i(512);else if((Q=i(W))==null)return 0;return(function(ee,ie,oe,pe,_e,ze){var fe,Ee,Be=ie,nt=1<<oe,Ue=i(16),tt=i(16);for(e(_e!=0),e(pe!=null),e(ee!=null),e(0<oe),Ee=0;Ee<_e;++Ee){if(15<pe[Ee])return 0;++Ue[pe[Ee]]}if(Ue[0]==_e)return 0;for(tt[1]=0,fe=1;15>fe;++fe){if(Ue[fe]>1<<fe)return 0;tt[fe+1]=tt[fe]+Ue[fe]}for(Ee=0;Ee<_e;++Ee)fe=pe[Ee],0<pe[Ee]&&(ze[tt[fe]++]=Ee);if(tt[15]==1)return(pe=new J).g=0,pe.value=ze[0],R(ee,Be,1,nt,pe),nt;var ot,Nt=-1,yt=nt-1,Kt=0,zt=1,yn=1,Ht=1<<oe;for(Ee=0,fe=1,_e=2;fe<=oe;++fe,_e<<=1){if(zt+=yn<<=1,0>(yn-=Ue[fe]))return 0;for(;0<Ue[fe];--Ue[fe])(pe=new J).g=fe,pe.value=ze[Ee++],R(ee,Be+Kt,_e,Ht,pe),Kt=G(Kt,fe)}for(fe=oe+1,_e=2;15>=fe;++fe,_e<<=1){if(zt+=yn<<=1,0>(yn-=Ue[fe]))return 0;for(;0<Ue[fe];--Ue[fe]){if(pe=new J,(Kt&yt)!=Nt){for(Be+=Ht,ot=1<<(Nt=fe)-oe;15>Nt&&!(0>=(ot-=Ue[Nt]));)++Nt,ot<<=1;nt+=Ht=1<<(ot=Nt-oe),ee[ie+(Nt=Kt&yt)].g=ot+oe,ee[ie+Nt].value=Be-ie-Nt}pe.g=fe-oe,pe.value=ze[Ee++],R(ee,Be+(Kt>>oe),_e,Ht,pe),Kt=G(Kt,fe)}}return zt!=2*tt[15]-1?0:nt})(y,A,D,B,W,Q)}function J(){this.value=this.g=0}function Z(){this.value=this.g=0}function le(){this.G=o(5,J),this.H=i(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=o(Uo,Z)}function K(y,A,D,B){e(y!=null),e(A!=null),e(2147483648>B),y.Ca=254,y.I=0,y.b=-8,y.Ka=0,y.oa=A,y.pa=D,y.Jd=A,y.Yc=D+B,y.Zc=4<=B?D+B-4+1:D,he(y)}function se(y,A){for(var D=0;0<A--;)D|=ve(y,128)<<A;return D}function ce(y,A){var D=se(y,A);return me(y)?-D:D}function ye(y,A,D,B){var W,Q=0;for(e(y!=null),e(A!=null),e(4294967288>B),y.Sb=B,y.Ra=0,y.u=0,y.h=0,4<B&&(B=4),W=0;W<B;++W)Q+=A[D+W]<<8*W;y.Ra=Q,y.bb=B,y.oa=A,y.pa=D}function Ce(y){for(;8<=y.u&&y.bb<y.Sb;)y.Ra>>>=8,y.Ra+=y.oa[y.pa+y.bb]<<Pa-8>>>0,++y.bb,y.u-=8;ae(y)&&(y.h=1,y.u=0)}function M(y,A){if(e(0<=A),!y.h&&A<=ii){var D=H(y)&xi[A];return y.u+=A,Ce(y),D}return y.h=1,y.u=0}function L(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function U(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function H(y){return y.Ra>>>(y.u&Pa-1)>>>0}function ae(y){return e(y.bb<=y.Sb),y.h||y.bb==y.Sb&&y.u>Pa}function de(y,A){y.u=A,y.h=ae(y)}function xe(y){y.u>=Ba&&(e(y.u>=Ba),Ce(y))}function he(y){e(y!=null&&y.oa!=null),y.pa<y.Zc?(y.I=(y.oa[y.pa++]|y.I<<8)>>>0,y.b+=8):(e(y!=null&&y.oa!=null),y.pa<y.Yc?(y.b+=8,y.I=y.oa[y.pa++]|y.I<<8):y.Ka?y.b=0:(y.I<<=8,y.b+=8,y.Ka=1))}function me(y){return se(y,1)}function ve(y,A){var D=y.Ca;0>y.b&&he(y);var B=y.b,W=D*A>>>8,Q=(y.I>>>B>W)+0;for(Q?(D-=W,y.I-=W+1<<B>>>0):D=W+1,B=D,W=0;256<=B;)W+=8,B>>=8;return B=7^W+ho[B],y.b-=B,y.Ca=(D<<B)-1,Q}function Re(y,A,D){y[A+0]=D>>24&255,y[A+1]=D>>16&255,y[A+2]=D>>8&255,y[A+3]=255&D}function Ke(y,A){return y[A+0]|y[A+1]<<8}function Ge(y,A){return Ke(y,A)|y[A+2]<<16}function ke(y,A){return Ke(y,A)|Ke(y,A+2)<<16}function X(y,A){var D=1<<A;return e(y!=null),e(0<A),y.X=i(D),y.X==null?0:(y.Mb=32-A,y.Xa=A,1)}function Pe(y,A){e(y!=null),e(A!=null),e(y.Xa==A.Xa),n(A.X,0,y.X,0,1<<A.Xa)}function gt(){this.X=[],this.Xa=this.Mb=0}function bt(y,A,D,B){e(D!=null),e(B!=null);var W=D[0],Q=B[0];return W==0&&(W=(y*Q+A/2)/A),Q==0&&(Q=(A*W+y/2)/y),0>=W||0>=Q?0:(D[0]=W,B[0]=Q,1)}function Ye(y,A){return y+(1<<A)-1>>>A}function Et(y,A){return((4278255360&y)+(4278255360&A)>>>0&4278255360)+((16711935&y)+(16711935&A)>>>0&16711935)>>>0}function vt(y,A){z[A]=function(D,B,W,Q,ee,ie,oe){var pe;for(pe=0;pe<ee;++pe){var _e=z[y](ie[oe+pe-1],W,Q+pe);ie[oe+pe]=Et(D[B+pe],_e)}}}function st(){this.ud=this.hd=this.jd=0}function St(y,A){return((4278124286&(y^A))>>>1)+(y&A)>>>0}function Pt(y){return 0<=y&&256>y?y:0>y?0:255<y?255:void 0}function Ut(y,A){return Pt(y+(y-A+.5>>1))}function je(y,A,D){return Math.abs(A-D)-Math.abs(y-D)}function Me(y,A,D,B,W,Q,ee){for(B=Q[ee-1],D=0;D<W;++D)Q[ee+D]=B=Et(y[A+D],B)}function Fe(y,A,D,B,W){var Q;for(Q=0;Q<D;++Q){var ee=y[A+Q],ie=ee>>8&255,oe=16711935&(oe=(oe=16711935&ee)+((ie<<16)+ie));B[W+Q]=(4278255360&ee)+oe>>>0}}function ue(y,A){A.jd=255&y,A.hd=y>>8&255,A.ud=y>>16&255}function Te(y,A,D,B,W,Q){var ee;for(ee=0;ee<B;++ee){var ie=A[D+ee],oe=ie>>>8,pe=ie,_e=255&(_e=(_e=ie>>>16)+((y.jd<<24>>24)*(oe<<24>>24)>>>5));pe=255&(pe=(pe+=(y.hd<<24>>24)*(oe<<24>>24)>>>5)+((y.ud<<24>>24)*(_e<<24>>24)>>>5)),W[Q+ee]=(4278255360&ie)+(_e<<16)+pe}}function Oe(y,A,D,B,W){z[A]=function(Q,ee,ie,oe,pe,_e,ze,fe,Ee){for(oe=ze;oe<fe;++oe)for(ze=0;ze<Ee;++ze)pe[_e++]=W(ie[B(Q[ee++])])},z[y]=function(Q,ee,ie,oe,pe,_e,ze){var fe=8>>Q.b,Ee=Q.Ea,Be=Q.K[0],nt=Q.w;if(8>fe)for(Q=(1<<Q.b)-1,nt=(1<<fe)-1;ee<ie;++ee){var Ue,tt=0;for(Ue=0;Ue<Ee;++Ue)Ue&Q||(tt=B(oe[pe++])),_e[ze++]=W(Be[tt&nt]),tt>>=fe}else z["VP8LMapColor"+D](oe,pe,Be,nt,_e,ze,ee,ie,Ee)}}function ct(y,A,D,B,W){for(D=A+D;A<D;){var Q=y[A++];B[W++]=Q>>16&255,B[W++]=Q>>8&255,B[W++]=255&Q}}function ft(y,A,D,B,W){for(D=A+D;A<D;){var Q=y[A++];B[W++]=Q>>16&255,B[W++]=Q>>8&255,B[W++]=255&Q,B[W++]=Q>>24&255}}function wt(y,A,D,B,W){for(D=A+D;A<D;){var Q=(ee=y[A++])>>16&240|ee>>12&15,ee=240&ee|ee>>28&15;B[W++]=Q,B[W++]=ee}}function it(y,A,D,B,W){for(D=A+D;A<D;){var Q=(ee=y[A++])>>16&248|ee>>13&7,ee=ee>>5&224|ee>>3&31;B[W++]=Q,B[W++]=ee}}function At(y,A,D,B,W){for(D=A+D;A<D;){var Q=y[A++];B[W++]=255&Q,B[W++]=Q>>8&255,B[W++]=Q>>16&255}}function We(y,A,D,B,W,Q){if(Q==0)for(D=A+D;A<D;)Re(B,((Q=y[A++])[0]>>24|Q[1]>>8&65280|Q[2]<<8&16711680|Q[3]<<24)>>>0),W+=32;else n(B,W,y,A,D)}function lt(y,A){z[A][0]=z[y+"0"],z[A][1]=z[y+"1"],z[A][2]=z[y+"2"],z[A][3]=z[y+"3"],z[A][4]=z[y+"4"],z[A][5]=z[y+"5"],z[A][6]=z[y+"6"],z[A][7]=z[y+"7"],z[A][8]=z[y+"8"],z[A][9]=z[y+"9"],z[A][10]=z[y+"10"],z[A][11]=z[y+"11"],z[A][12]=z[y+"12"],z[A][13]=z[y+"13"],z[A][14]=z[y+"0"],z[A][15]=z[y+"0"]}function pt(y){return y==lu||y==ad||y==fc||y==od}function It(){this.eb=[],this.size=this.A=this.fb=0}function en(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Mt(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new It,this.f.kb=new en,this.sd=null}function Bt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Yt(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function On(y){return alert("todo:WebPSamplerProcessPlane"),y.T}function an(y,A){var D=y.T,B=A.ba.f.RGBA,W=B.eb,Q=B.fb+y.ka*B.A,ee=Or[A.ba.S],ie=y.y,oe=y.O,pe=y.f,_e=y.N,ze=y.ea,fe=y.W,Ee=A.cc,Be=A.dc,nt=A.Mc,Ue=A.Nc,tt=y.ka,ot=y.ka+y.T,Nt=y.U,yt=Nt+1>>1;for(tt==0?ee(ie,oe,null,null,pe,_e,ze,fe,pe,_e,ze,fe,W,Q,null,null,Nt):(ee(A.ec,A.fc,ie,oe,Ee,Be,nt,Ue,pe,_e,ze,fe,W,Q-B.A,W,Q,Nt),++D);tt+2<ot;tt+=2)Ee=pe,Be=_e,nt=ze,Ue=fe,_e+=y.Rc,fe+=y.Rc,Q+=2*B.A,ee(ie,(oe+=2*y.fa)-y.fa,ie,oe,Ee,Be,nt,Ue,pe,_e,ze,fe,W,Q-B.A,W,Q,Nt);return oe+=y.fa,y.j+ot<y.o?(n(A.ec,A.fc,ie,oe,Nt),n(A.cc,A.dc,pe,_e,yt),n(A.Mc,A.Nc,ze,fe,yt),D--):1&ot||ee(ie,oe,null,null,pe,_e,ze,fe,pe,_e,ze,fe,W,Q+B.A,null,null,Nt),D}function As(y,A,D){var B=y.F,W=[y.J];if(B!=null){var Q=y.U,ee=A.ba.S,ie=ee==ou||ee==fc;A=A.ba.f.RGBA;var oe=[0],pe=y.ka;oe[0]=y.T,y.Kb&&(pe==0?--oe[0]:(--pe,W[0]-=y.width),y.j+y.ka+y.T==y.o&&(oe[0]=y.o-y.j-pe));var _e=A.eb;pe=A.fb+pe*A.A,y=su(B,W[0],y.width,Q,oe,_e,pe+(ie?0:3),A.A),e(D==oe),y&&pt(ee)&&Nl(_e,pe,ie,Q,oe,A.A)}return 0}function ut(y){var A=y.ma,D=A.ba.S,B=11>D,W=D==Wr||D==qi||D==ou||D==hc||D==12||pt(D);if(A.memory=null,A.Ib=null,A.Jb=null,A.Nd=null,!uo(A.Oa,y,W?11:12))return 0;if(W&&pt(D)&&Qc(),y.da)alert("todo:use_scaling");else{if(B){if(A.Ib=On,y.Kb){if(D=y.U+1>>1,A.memory=i(y.U+2*D),A.memory==null)return 0;A.ec=A.memory,A.fc=0,A.cc=A.ec,A.dc=A.fc+y.U,A.Mc=A.cc,A.Nc=A.dc+D,A.Ib=an,Qc()}}else alert("todo:EmitYUV");W&&(A.Jb=As,B&&ua())}if(B&&!Wo){for(y=0;256>y;++y)Ir[y]=89858*(y-128)+mc>>Ki,am[y]=-22014*(y-128)+mc,c0[y]=-45773*(y-128),hd[y]=113618*(y-128)+mc>>Ki;for(y=jl;y<Vo;++y)A=76283*(y-16)+mc>>Ki,om[y-jl]=si(A,255),lm[y-jl]=si(A+8>>4,15);Wo=1}return 1}function re(y){var A=y.ma,D=y.U,B=y.T;return e(!(1&y.ka)),0>=D||0>=B?0:(D=A.Ib(y,A),A.Jb!=null&&A.Jb(y,A,D),A.Dc+=D,1)}function Qe(y){y.ma.memory=null}function mt(y,A,D,B){return M(y,8)!=47?0:(A[0]=M(y,14)+1,D[0]=M(y,14)+1,B[0]=M(y,1),M(y,3)!=0?0:!y.h)}function Xe(y,A){if(4>y)return y+1;var D=y-2>>1;return(2+(1&y)<<D)+M(A,D)+1}function et(y,A){return 120<A?A-120:1<=(D=((D=Gi[A-1])>>4)*y+(8-(15&D)))?D:1;var D}function kt(y,A,D){var B=H(D),W=y[A+=255&B].g-8;return 0<W&&(de(D,D.u+8),B=H(D),A+=y[A].value,A+=B&(1<<W)-1),de(D,D.u+y[A].g),y[A].value}function Tt(y,A,D){return D.g+=y.g,D.value+=y.value<<A>>>0,e(8>=D.g),y.g}function Rt(y,A,D){var B=y.xc;return e((A=B==0?0:y.vc[y.md*(D>>B)+(A>>B)])<y.Wb),y.Ya[A]}function An(y,A,D,B){var W=y.ab,Q=y.c*A,ee=y.C;A=ee+A;var ie=D,oe=B;for(B=y.Ta,D=y.Ua;0<W--;){var pe=y.gc[W],_e=ee,ze=A,fe=ie,Ee=oe,Be=(oe=B,ie=D,pe.Ea);switch(e(_e<ze),e(ze<=pe.nc),pe.hc){case 2:Ys(fe,Ee,(ze-_e)*Be,oe,ie);break;case 0:var nt=_e,Ue=ze,tt=oe,ot=ie,Nt=(Ht=pe).Ea;nt==0&&(lc(fe,Ee,null,null,1,tt,ot),Me(fe,Ee+1,0,0,Nt-1,tt,ot+1),Ee+=Nt,ot+=Nt,++nt);for(var yt=1<<Ht.b,Kt=yt-1,zt=Ye(Nt,Ht.b),yn=Ht.K,Ht=Ht.w+(nt>>Ht.b)*zt;nt<Ue;){var Bn=yn,Es=Ht,Cn=1;for(cc(fe,Ee,tt,ot-Nt,1,tt,ot);Cn<Nt;){var $t=(Cn&~Kt)+yt;$t>Nt&&($t=Nt),(0,fo[Bn[Es++]>>8&15])(fe,Ee+ +Cn,tt,ot+Cn-Nt,$t-Cn,tt,ot+Cn),Cn=$t}Ee+=Nt,ot+=Nt,++nt&Kt||(Ht+=zt)}ze!=pe.nc&&n(oe,ie-Be,oe,ie+(ze-_e-1)*Be,Be);break;case 1:for(Be=fe,Ue=Ee,Nt=(fe=pe.Ea)-(ot=fe&~(tt=(Ee=1<<pe.b)-1)),nt=Ye(fe,pe.b),yt=pe.K,pe=pe.w+(_e>>pe.b)*nt;_e<ze;){for(Kt=yt,zt=pe,yn=new st,Ht=Ue+ot,Bn=Ue+fe;Ue<Ht;)ue(Kt[zt++],yn),uc(yn,Be,Ue,Ee,oe,ie),Ue+=Ee,ie+=Ee;Ue<Bn&&(ue(Kt[zt++],yn),uc(yn,Be,Ue,Nt,oe,ie),Ue+=Nt,ie+=Nt),++_e&tt||(pe+=nt)}break;case 3:if(fe==oe&&Ee==ie&&0<pe.b){for(Ue=oe,fe=Be=ie+(ze-_e)*Be-(ot=(ze-_e)*Ye(pe.Ea,pe.b)),Ee=oe,tt=ie,nt=[],ot=(Nt=ot)-1;0<=ot;--ot)nt[ot]=Ee[tt+ot];for(ot=Nt-1;0<=ot;--ot)Ue[fe+ot]=nt[ot];td(pe,_e,ze,oe,Be,oe,ie)}else td(pe,_e,ze,fe,Ee,oe,ie)}ie=B,oe=D}oe!=D&&n(B,D,ie,oe,Q)}function Pn(y,A){var D=y.V,B=y.Ba+y.c*y.C,W=A-y.C;if(e(A<=y.l.o),e(16>=W),0<W){var Q=y.l,ee=y.Ta,ie=y.Ua,oe=Q.width;if(An(y,W,D,B),W=ie=[ie],e((D=y.C)<(B=A)),e(Q.v<Q.va),B>Q.o&&(B=Q.o),D<Q.j){var pe=Q.j-D;D=Q.j,W[0]+=pe*oe}if(D>=B?D=0:(W[0]+=4*Q.v,Q.ka=D-Q.j,Q.U=Q.va-Q.v,Q.T=B-D,D=1),D){if(ie=ie[0],11>(D=y.ca).S){var _e=D.f.RGBA,ze=(B=D.S,W=Q.U,Q=Q.T,pe=_e.eb,_e.A),fe=Q;for(_e=_e.fb+y.Ma*_e.A;0<fe--;){var Ee=ee,Be=ie,nt=W,Ue=pe,tt=_e;switch(B){case rd:dc(Ee,Be,nt,Ue,tt);break;case Wr:po(Ee,Be,nt,Ue,tt);break;case lu:po(Ee,Be,nt,Ue,tt),Nl(Ue,tt,0,nt,1,0);break;case id:_l(Ee,Be,nt,Ue,tt);break;case qi:We(Ee,Be,nt,Ue,tt,1);break;case ad:We(Ee,Be,nt,Ue,tt,1),Nl(Ue,tt,0,nt,1,0);break;case ou:We(Ee,Be,nt,Ue,tt,0);break;case fc:We(Ee,Be,nt,Ue,tt,0),Nl(Ue,tt,1,nt,1,0);break;case hc:go(Ee,Be,nt,Ue,tt);break;case od:go(Ee,Be,nt,Ue,tt),$i(Ue,tt,nt,1,0);break;case zo:Ma(Ee,Be,nt,Ue,tt);break;default:e(0)}ie+=oe,_e+=ze}y.Ma+=Q}else alert("todo:EmitRescaledRowsYUVA");e(y.Ma<=D.height)}}y.C=A,e(y.C<=y.i)}function wn(y){var A;if(0<y.ua)return 0;for(A=0;A<y.Wb;++A){var D=y.Ya[A].G,B=y.Ya[A].H;if(0<D[1][B[1]+0].g||0<D[2][B[2]+0].g||0<D[3][B[3]+0].g)return 0}return 1}function jt(y,A,D,B,W,Q){if(y.Z!=0){var ee=y.qd,ie=y.rd;for(e(bo[y.Z]!=null);A<D;++A)bo[y.Z](ee,ie,B,W,B,W,Q),ee=B,ie=W,W+=Q;y.qd=ee,y.rd=ie}}function dt(y,A){var D=y.l.ma,B=D.Z==0||D.Z==1?y.l.j:y.C;if(B=y.C<B?B:y.C,e(A<=y.l.o),A>B){var W=y.l.width,Q=D.ca,ee=D.tb+W*B,ie=y.V,oe=y.Ba+y.c*B,pe=y.gc;e(y.ab==1),e(pe[0].hc==3),Ia(pe[0],B,A,ie,oe,Q,ee),jt(D,B,A,Q,ee,W)}y.C=y.Ma=A}function sn(y,A,D,B,W,Q,ee){var ie=y.$/B,oe=y.$%B,pe=y.m,_e=y.s,ze=D+y.$,fe=ze;W=D+B*W;var Ee=D+B*Q,Be=280+_e.ua,nt=y.Pb?ie:16777216,Ue=0<_e.ua?_e.Wa:null,tt=_e.wc,ot=ze<Ee?Rt(_e,oe,ie):null;e(y.C<Q),e(Ee<=W);var Nt=!1;e:for(;;){for(;Nt||ze<Ee;){var yt=0;if(ie>=nt){var Kt=ze-D;e((nt=y).Pb),nt.wd=nt.m,nt.xd=Kt,0<nt.s.ua&&Pe(nt.s.Wa,nt.s.vb),nt=ie+$o}if(oe&tt||(ot=Rt(_e,oe,ie)),e(ot!=null),ot.Qb&&(A[ze]=ot.qb,Nt=!0),!Nt)if(xe(pe),ot.jc){yt=pe,Kt=A;var zt=ze,yn=ot.pd[H(yt)&Uo-1];e(ot.jc),256>yn.g?(de(yt,yt.u+yn.g),Kt[zt]=yn.value,yt=0):(de(yt,yt.u+yn.g-256),e(256<=yn.value),yt=yn.value),yt==0&&(Nt=!0)}else yt=kt(ot.G[0],ot.H[0],pe);if(pe.h)break;if(Nt||256>yt){if(!Nt)if(ot.nd)A[ze]=(ot.qb|yt<<8)>>>0;else{if(xe(pe),Nt=kt(ot.G[1],ot.H[1],pe),xe(pe),Kt=kt(ot.G[2],ot.H[2],pe),zt=kt(ot.G[3],ot.H[3],pe),pe.h)break;A[ze]=(zt<<24|Nt<<16|yt<<8|Kt)>>>0}if(Nt=!1,++ze,++oe>=B&&(oe=0,++ie,ee!=null&&ie<=Q&&!(ie%16)&&ee(y,ie),Ue!=null))for(;fe<ze;)yt=A[fe++],Ue.X[(506832829*yt&4294967295)>>>Ue.Mb]=yt}else if(280>yt){if(yt=Xe(yt-256,pe),Kt=kt(ot.G[4],ot.H[4],pe),xe(pe),Kt=et(B,Kt=Xe(Kt,pe)),pe.h)break;if(ze-D<Kt||W-ze<yt)break e;for(zt=0;zt<yt;++zt)A[ze+zt]=A[ze+zt-Kt];for(ze+=yt,oe+=yt;oe>=B;)oe-=B,++ie,ee!=null&&ie<=Q&&!(ie%16)&&ee(y,ie);if(e(ze<=W),oe&tt&&(ot=Rt(_e,oe,ie)),Ue!=null)for(;fe<ze;)yt=A[fe++],Ue.X[(506832829*yt&4294967295)>>>Ue.Mb]=yt}else{if(!(yt<Be))break e;for(Nt=yt-280,e(Ue!=null);fe<ze;)yt=A[fe++],Ue.X[(506832829*yt&4294967295)>>>Ue.Mb]=yt;yt=ze,e(!(Nt>>>(Kt=Ue).Xa)),A[yt]=Kt.X[Nt],Nt=!0}Nt||e(pe.h==ae(pe))}if(y.Pb&&pe.h&&ze<W)e(y.m.h),y.a=5,y.m=y.wd,y.$=y.xd,0<y.s.ua&&Pe(y.s.vb,y.s.Wa);else{if(pe.h)break e;ee?.(y,ie>Q?Q:ie),y.a=0,y.$=ze-D}return 1}return y.a=3,0}function Un(y){e(y!=null),y.vc=null,y.yc=null,y.Ya=null;var A=y.Wa;A!=null&&(A.X=null),y.vb=null,e(y!=null)}function er(){var y=new gn;return y==null?null:(y.a=0,y.xb=kh,lt("Predictor","VP8LPredictors"),lt("Predictor","VP8LPredictors_C"),lt("PredictorAdd","VP8LPredictorsAdd"),lt("PredictorAdd","VP8LPredictorsAdd_C"),Ys=Fe,uc=Te,dc=ct,po=ft,go=wt,Ma=it,_l=At,z.VP8LMapColor32b=Oa,z.VP8LMapColor8b=Rr,y)}function tr(y,A,D,B,W){var Q=1,ee=[y],ie=[A],oe=B.m,pe=B.s,_e=null,ze=0;e:for(;;){if(D)for(;Q&&M(oe,1);){var fe=ee,Ee=ie,Be=B,nt=1,Ue=Be.m,tt=Be.gc[Be.ab],ot=M(Ue,2);if(Be.Oc&1<<ot)Q=0;else{switch(Be.Oc|=1<<ot,tt.hc=ot,tt.Ea=fe[0],tt.nc=Ee[0],tt.K=[null],++Be.ab,e(4>=Be.ab),ot){case 0:case 1:tt.b=M(Ue,3)+2,nt=tr(Ye(tt.Ea,tt.b),Ye(tt.nc,tt.b),0,Be,tt.K),tt.K=tt.K[0];break;case 3:var Nt,yt=M(Ue,8)+1,Kt=16<yt?0:4<yt?1:2<yt?2:3;if(fe[0]=Ye(tt.Ea,Kt),tt.b=Kt,Nt=nt=tr(yt,1,0,Be,tt.K)){var zt,yn=yt,Ht=tt,Bn=1<<(8>>Ht.b),Es=i(Bn);if(Es==null)Nt=0;else{var Cn=Ht.K[0],$t=Ht.w;for(Es[0]=Ht.K[0][0],zt=1;zt<1*yn;++zt)Es[zt]=Et(Cn[$t+zt],Es[zt-1]);for(;zt<4*Bn;++zt)Es[zt]=0;Ht.K[0]=null,Ht.K[0]=Es,Nt=1}}nt=Nt;break;case 2:break;default:e(0)}Q=nt}}if(ee=ee[0],ie=ie[0],Q&&M(oe,1)&&!(Q=1<=(ze=M(oe,4))&&11>=ze)){B.a=3;break e}var Dt;if(Dt=Q)t:{var Rs,dn,jn,ns=B,pr=ee,Mr=ie,ys=ze,rr=D,Yr=ns.m,ir=ns.s,Rn=[null],Kn=1,Ps=0,Qn=Vi[ys];n:for(;;){if(rr&&M(Yr,1)){var gr=M(Yr,3)+2,Bs=Ye(pr,gr),Xn=Ye(Mr,gr),Js=Bs*Xn;if(!tr(Bs,Xn,0,ns,Rn))break n;for(Rn=Rn[0],ir.xc=gr,Rs=0;Rs<Js;++Rs){var ss=Rn[Rs]>>8&65535;Rn[Rs]=ss,ss>=Kn&&(Kn=ss+1)}}if(Yr.h)break n;for(dn=0;5>dn;++dn){var ar=El[dn];!dn&&0<ys&&(ar+=1<<ys),Ps<ar&&(Ps=ar)}var or=o(Kn*Qn,J),hs=Kn,Vn=o(hs,le);if(Vn==null)var Kr=null;else e(65536>=hs),Kr=Vn;var Us=i(Ps);if(Kr==null||Us==null||or==null){ns.a=1;break n}var rn=or;for(Rs=jn=0;Rs<Kn;++Rs){var on=Kr[Rs],Jn=on.G,bi=on.H,Xi=0,oi=1,lr=0;for(dn=0;5>dn;++dn){ar=El[dn],Jn[dn]=rn,bi[dn]=jn,!dn&&0<ys&&(ar+=1<<ys);r:{var Yo,Ko=ar,pd=ns,vs=Us,Th=rn,Dh=jn,gd=0,yo=pd.m,cm=M(yo,1);if(r(vs,0,0,Ko),cm){var Lh=M(yo,1)+1,Rh=M(yo,1),md=M(yo,Rh==0?1:8);vs[md]=1,Lh==2&&(vs[md=M(yo,8)]=1);var _r=1}else{var zs=i(19),hu=M(yo,4)+4;if(19<hu){pd.a=3;var Xo=0;break r}for(Yo=0;Yo<hu;++Yo)zs[cu[Yo]]=M(yo,3);var bc=void 0,Tl=void 0,za=pd,xd=zs,yc=Ko,bd=vs,yd=0,vo=za.m,Ph=8,Bh=o(128,J);s:for(;q(Bh,0,7,xd,19);){if(M(vo,1)){var u0=2+2*M(vo,3);if((bc=2+M(vo,u0))>yc)break s}else bc=yc;for(Tl=0;Tl<yc&&bc--;){xe(vo);var Oh=Bh[0+(127&H(vo))];de(vo,vo.u+Oh.g);var Jo=Oh.value;if(16>Jo)bd[Tl++]=Jo,Jo!=0&&(Ph=Jo);else{var d0=Jo==16,h0=Jo-16,f0=pc[h0],Ih=M(vo,Hi[h0])+f0;if(Tl+Ih>yc)break s;for(var p0=d0?Ph:0;0<Ih--;)bd[Tl++]=p0}}yd=1;break s}yd||(za.a=3),_r=yd}(_r=_r&&!yo.h)&&(gd=q(Th,Dh,8,vs,Ko)),_r&&gd!=0?Xo=gd:(pd.a=3,Xo=0)}if(Xo==0)break n;if(oi&&ld[dn]==1&&(oi=rn[jn].g==0),Xi+=rn[jn].g,jn+=Xo,3>=dn){var Dl,vd=Us[0];for(Dl=1;Dl<ar;++Dl)Us[Dl]>vd&&(vd=Us[Dl]);lr+=vd}}if(on.nd=oi,on.Qb=0,oi&&(on.qb=(Jn[3][bi[3]+0].value<<24|Jn[1][bi[1]+0].value<<16|Jn[2][bi[2]+0].value)>>>0,Xi==0&&256>Jn[0][bi[0]+0].value&&(on.Qb=1,on.qb+=Jn[0][bi[0]+0].value<<8)),on.jc=!on.Qb&&6>lr,on.jc){var fu,$a=on;for(fu=0;fu<Uo;++fu){var wo=fu,So=$a.pd[wo],wd=$a.G[0][$a.H[0]+wo];256<=wd.value?(So.g=wd.g+256,So.value=wd.value):(So.g=0,So.value=0,wo>>=Tt(wd,8,So),wo>>=Tt($a.G[1][$a.H[1]+wo],16,So),wo>>=Tt($a.G[2][$a.H[2]+wo],0,So),Tt($a.G[3][$a.H[3]+wo],24,So))}}}ir.vc=Rn,ir.Wb=Kn,ir.Ya=Kr,ir.yc=or,Dt=1;break t}Dt=0}if(!(Q=Dt)){B.a=3;break e}if(0<ze){if(pe.ua=1<<ze,!X(pe.Wa,ze)){B.a=1,Q=0;break e}}else pe.ua=0;var Sd=B,Ll=ee,g0=ie,vc=Sd.s,wc=vc.xc;if(Sd.c=Ll,Sd.i=g0,vc.md=Ye(Ll,wc),vc.wc=wc==0?-1:(1<<wc)-1,D){B.xb=qo;break e}if((_e=i(ee*ie))==null){B.a=1,Q=0;break e}Q=(Q=sn(B,_e,0,ee,ie,ie,null))&&!oe.h;break e}return Q?(W!=null?W[0]=_e:(e(_e==null),e(D)),B.$=0,D||Un(pe)):Un(pe),Q}function Ns(y,A){var D=y.c*y.i,B=D+A+16*A;return e(y.c<=A),y.V=i(B),y.V==null?(y.Ta=null,y.Ua=0,y.a=1,0):(y.Ta=y.V,y.Ua=y.Ba+D+A,1)}function Hr(y,A){var D=y.C,B=A-D,W=y.V,Q=y.Ba+y.c*D;for(e(A<=y.l.o);0<B;){var ee=16<B?16:B,ie=y.l.ma,oe=y.l.width,pe=oe*ee,_e=ie.ca,ze=ie.tb+oe*D,fe=y.Ta,Ee=y.Ua;An(y,ee,W,Q),Pi(fe,Ee,_e,ze,pe),jt(ie,D,D+ee,_e,ze,oe),B-=ee,W+=ee*y.c,D+=ee}e(D==A),y.C=y.Ma=A}function Tr(){this.ub=this.yd=this.td=this.Rb=0}function Ci(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Za(){this.Fb=this.Bb=this.Cb=0,this.Zb=i(4),this.Lb=i(4)}function Ei(){this.Yb=(function(){var y=[];return(function A(D,B,W){for(var Q=W[B],ee=0;ee<Q&&(D.push(W.length>B+1?[]:0),!(W.length<B+1));ee++)A(D[ee],B+1,W)})(y,0,[3,11]),y})()}function Ds(){this.jb=i(3),this.Wc=l([4,8],Ei),this.Xc=l([4,17],Ei)}function pl(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new i(4),this.od=new i(4)}function ni(){this.ld=this.La=this.dd=this.tc=0}function ki(){this.Na=this.la=0}function gi(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Bo(){this.ad=i(384),this.Za=0,this.Ob=i(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function gl(){this.uc=this.M=this.Nb=0,this.wa=Array(new ni),this.Y=0,this.ya=Array(new Bo),this.aa=0,this.l=new la}function ml(){this.y=i(16),this.f=i(8),this.ea=i(8)}function tc(){this.cb=this.a=0,this.sc="",this.m=new L,this.Od=new Tr,this.Kc=new Ci,this.ed=new pl,this.Qa=new Za,this.Ic=this.$c=this.Aa=0,this.D=new gl,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=o(8,L),this.ia=0,this.pb=o(4,gi),this.Pa=new Ds,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new ml),this.Hd=0,this.rb=Array(new ki),this.sb=0,this.wa=Array(new ni),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Bo),this.L=this.aa=0,this.gd=l([4,2],ni),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function si(y,A){return 0>y?0:y>A?A:y}function la(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function ji(){var y=new tc;return y!=null&&(y.a=0,y.sc="OK",y.cb=0,y.Xb=0,Bi||(Bi=Ve)),y}function zn(y,A,D){return y.a==0&&(y.a=A,y.sc=D,y.cb=0),0}function te(y,A,D){return 3<=D&&y[A+0]==157&&y[A+1]==1&&y[A+2]==42}function Se(y,A){if(y==null)return 0;if(y.a=0,y.sc="OK",A==null)return zn(y,2,"null VP8Io passed to VP8GetHeaders()");var D=A.data,B=A.w,W=A.ha;if(4>W)return zn(y,7,"Truncated header.");var Q=D[B+0]|D[B+1]<<8|D[B+2]<<16,ee=y.Od;if(ee.Rb=!(1&Q),ee.td=Q>>1&7,ee.yd=Q>>4&1,ee.ub=Q>>5,3<ee.td)return zn(y,3,"Incorrect keyframe parameters.");if(!ee.yd)return zn(y,4,"Frame not displayable.");B+=3,W-=3;var ie=y.Kc;if(ee.Rb){if(7>W)return zn(y,7,"cannot parse picture header");if(!te(D,B,W))return zn(y,3,"Bad code word");ie.c=16383&(D[B+4]<<8|D[B+3]),ie.Td=D[B+4]>>6,ie.i=16383&(D[B+6]<<8|D[B+5]),ie.Ud=D[B+6]>>6,B+=7,W-=7,y.za=ie.c+15>>4,y.Ub=ie.i+15>>4,A.width=ie.c,A.height=ie.i,A.Da=0,A.j=0,A.v=0,A.va=A.width,A.o=A.height,A.da=0,A.ib=A.width,A.hb=A.height,A.U=A.width,A.T=A.height,r((Q=y.Pa).jb,0,255,Q.jb.length),e((Q=y.Qa)!=null),Q.Cb=0,Q.Bb=0,Q.Fb=1,r(Q.Zb,0,0,Q.Zb.length),r(Q.Lb,0,0,Q.Lb)}if(ee.ub>W)return zn(y,7,"bad partition length");K(Q=y.m,D,B,ee.ub),B+=ee.ub,W-=ee.ub,ee.Rb&&(ie.Ld=me(Q),ie.Kd=me(Q)),ie=y.Qa;var oe,pe=y.Pa;if(e(Q!=null),e(ie!=null),ie.Cb=me(Q),ie.Cb){if(ie.Bb=me(Q),me(Q)){for(ie.Fb=me(Q),oe=0;4>oe;++oe)ie.Zb[oe]=me(Q)?ce(Q,7):0;for(oe=0;4>oe;++oe)ie.Lb[oe]=me(Q)?ce(Q,6):0}if(ie.Bb)for(oe=0;3>oe;++oe)pe.jb[oe]=me(Q)?se(Q,8):255}else ie.Bb=0;if(Q.Ka)return zn(y,3,"cannot parse segment header");if((ie=y.ed).zd=me(Q),ie.Tb=se(Q,6),ie.wb=se(Q,3),ie.Pc=me(Q),ie.Pc&&me(Q)){for(pe=0;4>pe;++pe)me(Q)&&(ie.vd[pe]=ce(Q,6));for(pe=0;4>pe;++pe)me(Q)&&(ie.od[pe]=ce(Q,6))}if(y.L=ie.Tb==0?0:ie.zd?1:2,Q.Ka)return zn(y,3,"cannot parse filter header");var _e=W;if(W=oe=B,B=oe+_e,ie=_e,y.Xb=(1<<se(y.m,2))-1,_e<3*(pe=y.Xb))D=7;else{for(oe+=3*pe,ie-=3*pe,_e=0;_e<pe;++_e){var ze=D[W+0]|D[W+1]<<8|D[W+2]<<16;ze>ie&&(ze=ie),K(y.Jc[+_e],D,oe,ze),oe+=ze,ie-=ze,W+=3}K(y.Jc[+pe],D,oe,ie),D=oe<B?0:5}if(D!=0)return zn(y,D,"cannot parse partitions");for(D=se(oe=y.m,7),W=me(oe)?ce(oe,4):0,B=me(oe)?ce(oe,4):0,ie=me(oe)?ce(oe,4):0,pe=me(oe)?ce(oe,4):0,oe=me(oe)?ce(oe,4):0,_e=y.Qa,ze=0;4>ze;++ze){if(_e.Cb){var fe=_e.Zb[ze];_e.Fb||(fe+=D)}else{if(0<ze){y.pb[ze]=y.pb[0];continue}fe=D}var Ee=y.pb[ze];Ee.Sc[0]=Wi[si(fe+W,127)],Ee.Sc[1]=Yi[si(fe+0,127)],Ee.Eb[0]=2*Wi[si(fe+B,127)],Ee.Eb[1]=101581*Yi[si(fe+ie,127)]>>16,8>Ee.Eb[1]&&(Ee.Eb[1]=8),Ee.Qc[0]=Wi[si(fe+pe,117)],Ee.Qc[1]=Yi[si(fe+oe,127)],Ee.lc=fe+oe}if(!ee.Rb)return zn(y,4,"Not a key frame.");for(me(Q),ee=y.Pa,D=0;4>D;++D){for(W=0;8>W;++W)for(B=0;3>B;++B)for(ie=0;11>ie;++ie)pe=ve(Q,Cs[D][W][B][ie])?se(Q,8):l0[D][W][B][ie],ee.Wc[D][W].Yb[B][ie]=pe;for(W=0;17>W;++W)ee.Xc[D][W]=ee.Wc[D][In[W]]}return y.kc=me(Q),y.kc&&(y.Bd=se(Q,8)),y.cb=1}function Ve(y,A,D,B,W,Q,ee){var ie=A[W].Yb[D];for(D=0;16>W;++W){if(!ve(y,ie[D+0]))return W;for(;!ve(y,ie[D+1]);)if(ie=A[++W].Yb[0],D=0,W==16)return 16;var oe=A[W+1].Yb;if(ve(y,ie[D+2])){var pe=y,_e=0;if(ve(pe,(fe=ie)[(ze=D)+3]))if(ve(pe,fe[ze+6])){for(ie=0,ze=2*(_e=ve(pe,fe[ze+8]))+(fe=ve(pe,fe[ze+9+_e])),_e=0,fe=o0[ze];fe[ie];++ie)_e+=_e+ve(pe,fe[ie]);_e+=3+(8<<ze)}else ve(pe,fe[ze+7])?(_e=7+2*ve(pe,165),_e+=ve(pe,145)):_e=5+ve(pe,159);else _e=ve(pe,fe[ze+4])?3+ve(pe,fe[ze+5]):2;ie=oe[2]}else _e=1,ie=oe[1];oe=ee+Eh[W],0>(pe=y).b&&he(pe);var ze,fe=pe.b,Ee=(ze=pe.Ca>>1)-(pe.I>>fe)>>31;--pe.b,pe.Ca+=Ee,pe.Ca|=1,pe.I-=(ze+1&Ee)<<fe,Q[oe]=((_e^Ee)-Ee)*B[(0<W)+0]}return 16}function Ae(y){var A=y.rb[y.sb-1];A.la=0,A.Na=0,r(y.zc,0,0,y.zc.length),y.ja=0}function Ie(y,A,D,B,W){W=y[A+D+32*B]+(W>>3),y[A+D+32*B]=-256&W?0>W?0:255:W}function Ze(y,A,D,B,W,Q){Ie(y,A,0,D,B+W),Ie(y,A,1,D,B+Q),Ie(y,A,2,D,B-Q),Ie(y,A,3,D,B-W)}function Ct(y){return(20091*y>>16)+y}function Lt(y,A,D,B){var W,Q=0,ee=i(16);for(W=0;4>W;++W){var ie=y[A+0]+y[A+8],oe=y[A+0]-y[A+8],pe=(35468*y[A+4]>>16)-Ct(y[A+12]),_e=Ct(y[A+4])+(35468*y[A+12]>>16);ee[Q+0]=ie+_e,ee[Q+1]=oe+pe,ee[Q+2]=oe-pe,ee[Q+3]=ie-_e,Q+=4,A++}for(W=Q=0;4>W;++W)ie=(y=ee[Q+0]+4)+ee[Q+8],oe=y-ee[Q+8],pe=(35468*ee[Q+4]>>16)-Ct(ee[Q+12]),Ie(D,B,0,0,ie+(_e=Ct(ee[Q+4])+(35468*ee[Q+12]>>16))),Ie(D,B,1,0,oe+pe),Ie(D,B,2,0,oe-pe),Ie(D,B,3,0,ie-_e),Q++,B+=32}function fn(y,A,D,B){var W=y[A+0]+4,Q=35468*y[A+4]>>16,ee=Ct(y[A+4]),ie=35468*y[A+1]>>16;Ze(D,B,0,W+ee,y=Ct(y[A+1]),ie),Ze(D,B,1,W+Q,y,ie),Ze(D,B,2,W-Q,y,ie),Ze(D,B,3,W-ee,y,ie)}function Dn(y,A,D,B,W){Lt(y,A,D,B),W&&Lt(y,A+16,D,B+4)}function Ot(y,A,D,B){mo(y,A+0,D,B,1),mo(y,A+32,D,B+128,1)}function Ft(y,A,D,B){var W;for(y=y[A+0]+4,W=0;4>W;++W)for(A=0;4>A;++A)Ie(D,B,A,W,y)}function ms(y,A,D,B){y[A+0]&&Zn(y,A+0,D,B),y[A+16]&&Zn(y,A+16,D,B+4),y[A+32]&&Zn(y,A+32,D,B+128),y[A+48]&&Zn(y,A+48,D,B+128+4)}function bn(y,A,D,B){var W,Q=i(16);for(W=0;4>W;++W){var ee=y[A+0+W]+y[A+12+W],ie=y[A+4+W]+y[A+8+W],oe=y[A+4+W]-y[A+8+W],pe=y[A+0+W]-y[A+12+W];Q[0+W]=ee+ie,Q[8+W]=ee-ie,Q[4+W]=pe+oe,Q[12+W]=pe-oe}for(W=0;4>W;++W)ee=(y=Q[0+4*W]+3)+Q[3+4*W],ie=Q[1+4*W]+Q[2+4*W],oe=Q[1+4*W]-Q[2+4*W],pe=y-Q[3+4*W],D[B+0]=ee+ie>>3,D[B+16]=pe+oe>>3,D[B+32]=ee-ie>>3,D[B+48]=pe-oe>>3,B+=64}function us(y,A,D){var B,W=A-32,Q=Vr,ee=255-y[W-1];for(B=0;B<D;++B){var ie,oe=Q,pe=ee+y[A-1];for(ie=0;ie<D;++ie)y[A+ie]=oe[pe+y[W+ie]];A+=32}}function nr(y,A){us(y,A,4)}function ja(y,A){us(y,A,8)}function Oo(y,A){us(y,A,16)}function Kc(y,A){var D;for(D=0;16>D;++D)n(y,A+32*D,y,A-32,16)}function Ku(y,A){var D;for(D=16;0<D;--D)r(y,A,y[A-1],16),A+=32}function mi(y,A,D){var B;for(B=0;16>B;++B)r(A,D+32*B,y,16)}function ca(y,A){var D,B=16;for(D=0;16>D;++D)B+=y[A-1+32*D]+y[A+D-32];mi(B>>5,y,A)}function Qa(y,A){var D,B=8;for(D=0;16>D;++D)B+=y[A-1+32*D];mi(B>>4,y,A)}function xl(y,A){var D,B=8;for(D=0;16>D;++D)B+=y[A+D-32];mi(B>>4,y,A)}function Io(y,A){mi(128,y,A)}function un(y,A,D){return y+2*A+D+2>>2}function Xu(y,A){var D,B=A-32;for(B=new Uint8Array([un(y[B-1],y[B+0],y[B+1]),un(y[B+0],y[B+1],y[B+2]),un(y[B+1],y[B+2],y[B+3]),un(y[B+2],y[B+3],y[B+4])]),D=0;4>D;++D)n(y,A+32*D,B,0,B.length)}function Xc(y,A){var D=y[A-1],B=y[A-1+32],W=y[A-1+64],Q=y[A-1+96];Re(y,A+0,16843009*un(y[A-1-32],D,B)),Re(y,A+32,16843009*un(D,B,W)),Re(y,A+64,16843009*un(B,W,Q)),Re(y,A+96,16843009*un(W,Q,Q))}function Ju(y,A){var D,B=4;for(D=0;4>D;++D)B+=y[A+D-32]+y[A-1+32*D];for(B>>=3,D=0;4>D;++D)r(y,A+32*D,B,4)}function Ti(y,A){var D=y[A-1+0],B=y[A-1+32],W=y[A-1+64],Q=y[A-1-32],ee=y[A+0-32],ie=y[A+1-32],oe=y[A+2-32],pe=y[A+3-32];y[A+0+96]=un(B,W,y[A-1+96]),y[A+1+96]=y[A+0+64]=un(D,B,W),y[A+2+96]=y[A+1+64]=y[A+0+32]=un(Q,D,B),y[A+3+96]=y[A+2+64]=y[A+1+32]=y[A+0+0]=un(ee,Q,D),y[A+3+64]=y[A+2+32]=y[A+1+0]=un(ie,ee,Q),y[A+3+32]=y[A+2+0]=un(oe,ie,ee),y[A+3+0]=un(pe,oe,ie)}function Dr(y,A){var D=y[A+1-32],B=y[A+2-32],W=y[A+3-32],Q=y[A+4-32],ee=y[A+5-32],ie=y[A+6-32],oe=y[A+7-32];y[A+0+0]=un(y[A+0-32],D,B),y[A+1+0]=y[A+0+32]=un(D,B,W),y[A+2+0]=y[A+1+32]=y[A+0+64]=un(B,W,Q),y[A+3+0]=y[A+2+32]=y[A+1+64]=y[A+0+96]=un(W,Q,ee),y[A+3+32]=y[A+2+64]=y[A+1+96]=un(Q,ee,ie),y[A+3+64]=y[A+2+96]=un(ee,ie,oe),y[A+3+96]=un(ie,oe,oe)}function Jc(y,A){var D=y[A-1+0],B=y[A-1+32],W=y[A-1+64],Q=y[A-1-32],ee=y[A+0-32],ie=y[A+1-32],oe=y[A+2-32],pe=y[A+3-32];y[A+0+0]=y[A+1+64]=Q+ee+1>>1,y[A+1+0]=y[A+2+64]=ee+ie+1>>1,y[A+2+0]=y[A+3+64]=ie+oe+1>>1,y[A+3+0]=oe+pe+1>>1,y[A+0+96]=un(W,B,D),y[A+0+64]=un(B,D,Q),y[A+0+32]=y[A+1+96]=un(D,Q,ee),y[A+1+32]=y[A+2+96]=un(Q,ee,ie),y[A+2+32]=y[A+3+96]=un(ee,ie,oe),y[A+3+32]=un(ie,oe,pe)}function bl(y,A){var D=y[A+0-32],B=y[A+1-32],W=y[A+2-32],Q=y[A+3-32],ee=y[A+4-32],ie=y[A+5-32],oe=y[A+6-32],pe=y[A+7-32];y[A+0+0]=D+B+1>>1,y[A+1+0]=y[A+0+64]=B+W+1>>1,y[A+2+0]=y[A+1+64]=W+Q+1>>1,y[A+3+0]=y[A+2+64]=Q+ee+1>>1,y[A+0+32]=un(D,B,W),y[A+1+32]=y[A+0+96]=un(B,W,Q),y[A+2+32]=y[A+1+96]=un(W,Q,ee),y[A+3+32]=y[A+2+96]=un(Q,ee,ie),y[A+3+64]=un(ee,ie,oe),y[A+3+96]=un(ie,oe,pe)}function Di(y,A){var D=y[A-1+0],B=y[A-1+32],W=y[A-1+64],Q=y[A-1+96];y[A+0+0]=D+B+1>>1,y[A+2+0]=y[A+0+32]=B+W+1>>1,y[A+2+32]=y[A+0+64]=W+Q+1>>1,y[A+1+0]=un(D,B,W),y[A+3+0]=y[A+1+32]=un(B,W,Q),y[A+3+32]=y[A+1+64]=un(W,Q,Q),y[A+3+64]=y[A+2+64]=y[A+0+96]=y[A+1+96]=y[A+2+96]=y[A+3+96]=Q}function yl(y,A){var D=y[A-1+0],B=y[A-1+32],W=y[A-1+64],Q=y[A-1+96],ee=y[A-1-32],ie=y[A+0-32],oe=y[A+1-32],pe=y[A+2-32];y[A+0+0]=y[A+2+32]=D+ee+1>>1,y[A+0+32]=y[A+2+64]=B+D+1>>1,y[A+0+64]=y[A+2+96]=W+B+1>>1,y[A+0+96]=Q+W+1>>1,y[A+3+0]=un(ie,oe,pe),y[A+2+0]=un(ee,ie,oe),y[A+1+0]=y[A+3+32]=un(D,ee,ie),y[A+1+32]=y[A+3+64]=un(B,D,ee),y[A+1+64]=y[A+3+96]=un(W,B,D),y[A+1+96]=un(Q,W,B)}function Ta(y,A){var D;for(D=0;8>D;++D)n(y,A+32*D,y,A-32,8)}function Zu(y,A){var D;for(D=0;8>D;++D)r(y,A,y[A-1],8),A+=32}function Fi(y,A,D){var B;for(B=0;8>B;++B)r(A,D+32*B,y,8)}function nc(y,A){var D,B=8;for(D=0;8>D;++D)B+=y[A+D-32]+y[A-1+32*D];Fi(B>>4,y,A)}function sc(y,A){var D,B=4;for(D=0;8>D;++D)B+=y[A+D-32];Fi(B>>3,y,A)}function wr(y,A){var D,B=4;for(D=0;8>D;++D)B+=y[A-1+32*D];Fi(B>>3,y,A)}function Da(y,A){Fi(128,y,A)}function Ui(y,A,D){var B=y[A-D],W=y[A+0],Q=3*(W-B)+xo[1020+y[A-2*D]-y[A+D]],ee=au[112+(Q+4>>3)];y[A-D]=Vr[255+B+au[112+(Q+3>>3)]],y[A+0]=Vr[255+W-ee]}function eo(y,A,D,B){var W=y[A+0],Q=y[A+D];return Pr[255+y[A-2*D]-y[A-D]]>B||Pr[255+Q-W]>B}function rc(y,A,D,B){return 4*Pr[255+y[A-D]-y[A+0]]+Pr[255+y[A-2*D]-y[A+D]]<=B}function vl(y,A,D,B,W){var Q=y[A-3*D],ee=y[A-2*D],ie=y[A-D],oe=y[A+0],pe=y[A+D],_e=y[A+2*D],ze=y[A+3*D];return 4*Pr[255+ie-oe]+Pr[255+ee-pe]>B?0:Pr[255+y[A-4*D]-Q]<=W&&Pr[255+Q-ee]<=W&&Pr[255+ee-ie]<=W&&Pr[255+ze-_e]<=W&&Pr[255+_e-pe]<=W&&Pr[255+pe-oe]<=W}function to(y,A,D,B){var W=2*B+1;for(B=0;16>B;++B)rc(y,A+B,D,W)&&Ui(y,A+B,D)}function no(y,A,D,B){var W=2*B+1;for(B=0;16>B;++B)rc(y,A+B*D,1,W)&&Ui(y,A+B*D,1)}function wl(y,A,D,B){var W;for(W=3;0<W;--W)to(y,A+=4*D,D,B)}function Zc(y,A,D,B){var W;for(W=3;0<W;--W)no(y,A+=4,D,B)}function so(y,A,D,B,W,Q,ee,ie){for(Q=2*Q+1;0<W--;){if(vl(y,A,D,Q,ee))if(eo(y,A,D,ie))Ui(y,A,D);else{var oe=y,pe=A,_e=D,ze=oe[pe-2*_e],fe=oe[pe-_e],Ee=oe[pe+0],Be=oe[pe+_e],nt=oe[pe+2*_e],Ue=27*(ot=xo[1020+3*(Ee-fe)+xo[1020+ze-Be]])+63>>7,tt=18*ot+63>>7,ot=9*ot+63>>7;oe[pe-3*_e]=Vr[255+oe[pe-3*_e]+ot],oe[pe-2*_e]=Vr[255+ze+tt],oe[pe-_e]=Vr[255+fe+Ue],oe[pe+0]=Vr[255+Ee-Ue],oe[pe+_e]=Vr[255+Be-tt],oe[pe+2*_e]=Vr[255+nt-ot]}A+=B}}function ro(y,A,D,B,W,Q,ee,ie){for(Q=2*Q+1;0<W--;){if(vl(y,A,D,Q,ee))if(eo(y,A,D,ie))Ui(y,A,D);else{var oe=y,pe=A,_e=D,ze=oe[pe-_e],fe=oe[pe+0],Ee=oe[pe+_e],Be=au[112+(4+(nt=3*(fe-ze))>>3)],nt=au[112+(nt+3>>3)],Ue=Be+1>>1;oe[pe-2*_e]=Vr[255+oe[pe-2*_e]+Ue],oe[pe-_e]=Vr[255+ze+nt],oe[pe+0]=Vr[255+fe-Be],oe[pe+_e]=Vr[255+Ee-Ue]}A+=B}}function Qu(y,A,D,B,W,Q){so(y,A,D,1,16,B,W,Q)}function io(y,A,D,B,W,Q){so(y,A,1,D,16,B,W,Q)}function ed(y,A,D,B,W,Q){var ee;for(ee=3;0<ee;--ee)ro(y,A+=4*D,D,1,16,B,W,Q)}function j(y,A,D,B,W,Q){var ee;for(ee=3;0<ee;--ee)ro(y,A+=4,1,D,16,B,W,Q)}function V(y,A,D,B,W,Q,ee,ie){so(y,A,W,1,8,Q,ee,ie),so(D,B,W,1,8,Q,ee,ie)}function ge(y,A,D,B,W,Q,ee,ie){so(y,A,1,W,8,Q,ee,ie),so(D,B,1,W,8,Q,ee,ie)}function we(y,A,D,B,W,Q,ee,ie){ro(y,A+4*W,W,1,8,Q,ee,ie),ro(D,B+4*W,W,1,8,Q,ee,ie)}function De(y,A,D,B,W,Q,ee,ie){ro(y,A+4,1,W,8,Q,ee,ie),ro(D,B+4,1,W,8,Q,ee,ie)}function at(){this.ba=new Mt,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Yt,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function _t(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Vt(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Zt(){this.ua=0,this.Wa=new gt,this.vb=new gt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new le,this.yc=new J}function gn(){this.xb=this.a=0,this.l=new la,this.ca=new Mt,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new U,this.Pb=0,this.wd=new U,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Zt,this.ab=0,this.gc=o(4,Vt),this.Oc=0}function Nn(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new la,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Hn(y,A,D,B,W,Q,ee){for(y=y==null?0:y[A+0],A=0;A<ee;++A)W[Q+A]=y+D[B+A]&255,y=W[Q+A]}function Ls(y,A,D,B,W,Q,ee){var ie;if(y==null)Hn(null,null,D,B,W,Q,ee);else for(ie=0;ie<ee;++ie)W[Q+ie]=y[A+ie]+D[B+ie]&255}function Ws(y,A,D,B,W,Q,ee){if(y==null)Hn(null,null,D,B,W,Q,ee);else{var ie,oe=y[A+0],pe=oe,_e=oe;for(ie=0;ie<ee;++ie)pe=_e+(oe=y[A+ie])-pe,_e=D[B+ie]+(-256&pe?0>pe?0:255:pe)&255,pe=oe,W[Q+ie]=_e}}function xs(y,A,D,B){var W=A.width,Q=A.o;if(e(y!=null&&A!=null),0>D||0>=B||D+B>Q)return null;if(!y.Cc){if(y.ga==null){var ee;if(y.ga=new Nn,(ee=y.ga==null)||(ee=A.width*A.o,e(y.Gb.length==0),y.Gb=i(ee),y.Uc=0,y.Gb==null?ee=0:(y.mb=y.Gb,y.nb=y.Uc,y.rc=null,ee=1),ee=!ee),!ee){ee=y.ga;var ie=y.Fa,oe=y.P,pe=y.qc,_e=y.mb,ze=y.nb,fe=oe+1,Ee=pe-1,Be=ee.l;if(e(ie!=null&&_e!=null&&A!=null),bo[0]=null,bo[1]=Hn,bo[2]=Ls,bo[3]=Ws,ee.ca=_e,ee.tb=ze,ee.c=A.width,ee.i=A.height,e(0<ee.c&&0<ee.i),1>=pe)A=0;else if(ee.$a=3&ie[oe+0],ee.Z=ie[oe+0]>>2&3,ee.Lc=ie[oe+0]>>4&3,oe=ie[oe+0]>>6&3,0>ee.$a||1<ee.$a||4<=ee.Z||1<ee.Lc||oe)A=0;else if(Be.put=re,Be.ac=ut,Be.bc=Qe,Be.ma=ee,Be.width=A.width,Be.height=A.height,Be.Da=A.Da,Be.v=A.v,Be.va=A.va,Be.j=A.j,Be.o=A.o,ee.$a)e:{e(ee.$a==1),A=er();t:for(;;){if(A==null){A=0;break e}if(e(ee!=null),ee.mc=A,A.c=ee.c,A.i=ee.i,A.l=ee.l,A.l.ma=ee,A.l.width=ee.c,A.l.height=ee.i,A.a=0,ye(A.m,ie,fe,Ee),!tr(ee.c,ee.i,1,A,null)||(A.ab==1&&A.gc[0].hc==3&&wn(A.s)?(ee.ic=1,ie=A.c*A.i,A.Ta=null,A.Ua=0,A.V=i(ie),A.Ba=0,A.V==null?(A.a=1,A=0):A=1):(ee.ic=0,A=Ns(A,ee.c)),!A))break t;A=1;break e}ee.mc=null,A=0}else A=Ee>=ee.c*ee.i;ee=!A}if(ee)return null;y.ga.Lc!=1?y.Ga=0:B=Q-D}e(y.ga!=null),e(D+B<=Q);e:{if(A=(ie=y.ga).c,Q=ie.l.o,ie.$a==0){if(fe=y.rc,Ee=y.Vc,Be=y.Fa,oe=y.P+1+D*A,pe=y.mb,_e=y.nb+D*A,e(oe<=y.P+y.qc),ie.Z!=0)for(e(bo[ie.Z]!=null),ee=0;ee<B;++ee)bo[ie.Z](fe,Ee,Be,oe,pe,_e,A),fe=pe,Ee=_e,_e+=A,oe+=A;else for(ee=0;ee<B;++ee)n(pe,_e,Be,oe,A),fe=pe,Ee=_e,_e+=A,oe+=A;y.rc=fe,y.Vc=Ee}else{if(e(ie.mc!=null),A=D+B,e((ee=ie.mc)!=null),e(A<=ee.i),ee.C>=A)A=1;else if(ie.ic||ua(),ie.ic){ie=ee.V,fe=ee.Ba,Ee=ee.c;var nt=ee.i,Ue=(Be=1,oe=ee.$/Ee,pe=ee.$%Ee,_e=ee.m,ze=ee.s,ee.$),tt=Ee*nt,ot=Ee*A,Nt=ze.wc,yt=Ue<ot?Rt(ze,pe,oe):null;e(Ue<=tt),e(A<=nt),e(wn(ze));t:for(;;){for(;!_e.h&&Ue<ot;){if(pe&Nt||(yt=Rt(ze,pe,oe)),e(yt!=null),xe(_e),256>(nt=kt(yt.G[0],yt.H[0],_e)))ie[fe+Ue]=nt,++Ue,++pe>=Ee&&(pe=0,++oe<=A&&!(oe%16)&&dt(ee,oe));else{if(!(280>nt)){Be=0;break t}nt=Xe(nt-256,_e);var Kt,zt=kt(yt.G[4],yt.H[4],_e);if(xe(_e),!(Ue>=(zt=et(Ee,zt=Xe(zt,_e)))&&tt-Ue>=nt)){Be=0;break t}for(Kt=0;Kt<nt;++Kt)ie[fe+Ue+Kt]=ie[fe+Ue+Kt-zt];for(Ue+=nt,pe+=nt;pe>=Ee;)pe-=Ee,++oe<=A&&!(oe%16)&&dt(ee,oe);Ue<ot&&pe&Nt&&(yt=Rt(ze,pe,oe))}e(_e.h==ae(_e))}dt(ee,oe>A?A:oe);break t}!Be||_e.h&&Ue<tt?(Be=0,ee.a=_e.h?5:3):ee.$=Ue,A=Be}else A=sn(ee,ee.V,ee.Ba,ee.c,ee.i,A,Hr);if(!A){B=0;break e}}D+B>=Q&&(y.Cc=1),B=1}if(!B)return null;if(y.Cc&&((B=y.ga)!=null&&(B.mc=null),y.ga=null,0<y.Ga))return alert("todo:WebPDequantizeLevels"),null}return y.nb+D*W}function fr(y,A,D,B,W,Q){for(;0<W--;){var ee,ie=y,oe=A+(D?1:0),pe=y,_e=A+(D?0:3);for(ee=0;ee<B;++ee){var ze=pe[_e+4*ee];ze!=255&&(ze*=32897,ie[oe+4*ee+0]=ie[oe+4*ee+0]*ze>>23,ie[oe+4*ee+1]=ie[oe+4*ee+1]*ze>>23,ie[oe+4*ee+2]=ie[oe+4*ee+2]*ze>>23)}A+=Q}}function sr(y,A,D,B,W){for(;0<B--;){var Q;for(Q=0;Q<D;++Q){var ee=y[A+2*Q+0],ie=15&(pe=y[A+2*Q+1]),oe=4369*ie,pe=(240&pe|pe>>4)*oe>>16;y[A+2*Q+0]=(240&ee|ee>>4)*oe>>16&240|(15&ee|ee<<4)*oe>>16>>4&15,y[A+2*Q+1]=240&pe|ie}A+=W}}function Lr(y,A,D,B,W,Q,ee,ie){var oe,pe,_e=255;for(pe=0;pe<W;++pe){for(oe=0;oe<B;++oe){var ze=y[A+oe];Q[ee+4*oe]=ze,_e&=ze}A+=D,ee+=ie}return _e!=255}function ao(y,A,D,B,W){var Q;for(Q=0;Q<W;++Q)D[B+Q]=y[A+Q]>>8}function ua(){Nl=fr,$i=sr,su=Lr,Pi=ao}function oo(y,A,D){z[y]=function(B,W,Q,ee,ie,oe,pe,_e,ze,fe,Ee,Be,nt,Ue,tt,ot,Nt){var yt,Kt=Nt-1>>1,zt=ie[oe+0]|pe[_e+0]<<16,yn=ze[fe+0]|Ee[Be+0]<<16;e(B!=null);var Ht=3*zt+yn+131074>>2;for(A(B[W+0],255&Ht,Ht>>16,nt,Ue),Q!=null&&(Ht=3*yn+zt+131074>>2,A(Q[ee+0],255&Ht,Ht>>16,tt,ot)),yt=1;yt<=Kt;++yt){var Bn=ie[oe+yt]|pe[_e+yt]<<16,Es=ze[fe+yt]|Ee[Be+yt]<<16,Cn=zt+Bn+yn+Es+524296,$t=Cn+2*(Bn+yn)>>3;Ht=$t+zt>>1,zt=(Cn=Cn+2*(zt+Es)>>3)+Bn>>1,A(B[W+2*yt-1],255&Ht,Ht>>16,nt,Ue+(2*yt-1)*D),A(B[W+2*yt-0],255&zt,zt>>16,nt,Ue+(2*yt-0)*D),Q!=null&&(Ht=Cn+yn>>1,zt=$t+Es>>1,A(Q[ee+2*yt-1],255&Ht,Ht>>16,tt,ot+(2*yt-1)*D),A(Q[ee+2*yt+0],255&zt,zt>>16,tt,ot+(2*yt+0)*D)),zt=Bn,yn=Es}1&Nt||(Ht=3*zt+yn+131074>>2,A(B[W+Nt-1],255&Ht,Ht>>16,nt,Ue+(Nt-1)*D),Q!=null&&(Ht=3*yn+zt+131074>>2,A(Q[ee+Nt-1],255&Ht,Ht>>16,tt,ot+(Nt-1)*D)))}}function Qc(){Or[rd]=kl,Or[Wr]=gc,Or[id]=jh,Or[qi]=ud,Or[ou]=Ho,Or[hc]=Ua,Or[zo]=Go,Or[lu]=gc,Or[ad]=ud,Or[fc]=Ho,Or[od]=Ua}function ic(y){return y&-16384?0>y?0:255:y>>dd}function La(y,A){return ic((19077*y>>8)+(26149*A>>8)-14234)}function da(y,A,D){return ic((19077*y>>8)-(6419*A>>8)-(13320*D>>8)+8708)}function Sl(y,A){return ic((19077*y>>8)+(33050*A>>8)-17685)}function lo(y,A,D,B,W){B[W+0]=La(y,D),B[W+1]=da(y,A,D),B[W+2]=Sl(y,A)}function Sr(y,A,D,B,W){B[W+0]=Sl(y,A),B[W+1]=da(y,A,D),B[W+2]=La(y,D)}function Mo(y,A,D,B,W){var Q=da(y,A,D);A=Q<<3&224|Sl(y,A)>>3,B[W+0]=248&La(y,D)|Q>>5,B[W+1]=A}function Fo(y,A,D,B,W){var Q=240&Sl(y,A)|15;B[W+0]=240&La(y,D)|da(y,A,D)>>4,B[W+1]=Q}function ac(y,A,D,B,W){B[W+0]=255,lo(y,A,D,B,W+1)}function Ra(y,A,D,B,W){Sr(y,A,D,B,W),B[W+3]=255}function ri(y,A,D,B,W){lo(y,A,D,B,W),B[W+3]=255}function co(y,A,D){z[y]=function(B,W,Q,ee,ie,oe,pe,_e,ze){for(var fe=_e+(-2&ze)*D;_e!=fe;)A(B[W+0],Q[ee+0],ie[oe+0],pe,_e),A(B[W+1],Q[ee+0],ie[oe+0],pe,_e+D),W+=2,++ee,++oe,_e+=2*D;1&ze&&A(B[W+0],Q[ee+0],ie[oe+0],pe,_e)}}function oc(y,A,D){return D==0?y==0?A==0?6:5:A==0?4:0:D}function eu(y,A,D,B,W){switch(y>>>30){case 3:mo(A,D,B,W,0);break;case 2:Gr(A,D,B,W);break;case 1:Zn(A,D,B,W)}}function Li(y,A){var D,B,W=A.M,Q=A.Nb,ee=y.oc,ie=y.pc+40,oe=y.oc,pe=y.pc+584,_e=y.oc,ze=y.pc+600;for(D=0;16>D;++D)ee[ie+32*D-1]=129;for(D=0;8>D;++D)oe[pe+32*D-1]=129,_e[ze+32*D-1]=129;for(0<W?ee[ie-1-32]=oe[pe-1-32]=_e[ze-1-32]=129:(r(ee,ie-32-1,127,21),r(oe,pe-32-1,127,9),r(_e,ze-32-1,127,9)),B=0;B<y.za;++B){var fe=A.ya[A.aa+B];if(0<B){for(D=-1;16>D;++D)n(ee,ie+32*D-4,ee,ie+32*D+12,4);for(D=-1;8>D;++D)n(oe,pe+32*D-4,oe,pe+32*D+4,4),n(_e,ze+32*D-4,_e,ze+32*D+4,4)}var Ee=y.Gd,Be=y.Hd+B,nt=fe.ad,Ue=fe.Hc;if(0<W&&(n(ee,ie-32,Ee[Be].y,0,16),n(oe,pe-32,Ee[Be].f,0,8),n(_e,ze-32,Ee[Be].ea,0,8)),fe.Za){var tt=ee,ot=ie-32+16;for(0<W&&(B>=y.za-1?r(tt,ot,Ee[Be].y[15],4):n(tt,ot,Ee[Be+1].y,0,4)),D=0;4>D;D++)tt[ot+128+D]=tt[ot+256+D]=tt[ot+384+D]=tt[ot+0+D];for(D=0;16>D;++D,Ue<<=2)tt=ee,ot=ie+Xs[D],Fs[fe.Ob[D]](tt,ot),eu(Ue,nt,16*+D,tt,ot)}else if(tt=oc(B,W,fe.Ob[0]),ai[tt](ee,ie),Ue!=0)for(D=0;16>D;++D,Ue<<=2)eu(Ue,nt,16*+D,ee,ie+Xs[D]);for(D=fe.Gc,tt=oc(B,W,fe.Dd),ga[tt](oe,pe),ga[tt](_e,ze),Ue=nt,tt=oe,ot=pe,255&(fe=0|D)&&(170&fe?zi(Ue,256,tt,ot):Gn(Ue,256,tt,ot)),fe=_e,Ue=ze,255&(D>>=8)&&(170&D?zi(nt,320,fe,Ue):Gn(nt,320,fe,Ue)),W<y.Ub-1&&(n(Ee[Be].y,0,ee,ie+480,16),n(Ee[Be].f,0,oe,pe+224,8),n(Ee[Be].ea,0,_e,ze+224,8)),D=8*Q*y.B,Ee=y.sa,Be=y.ta+16*B+16*Q*y.R,nt=y.qa,fe=y.ra+8*B+D,Ue=y.Ha,tt=y.Ia+8*B+D,D=0;16>D;++D)n(Ee,Be+D*y.R,ee,ie+32*D,16);for(D=0;8>D;++D)n(nt,fe+D*y.B,oe,pe+32*D,8),n(Ue,tt+D*y.B,_e,ze+32*D,8)}}function ha(y,A,D,B,W,Q,ee,ie,oe){var pe=[0],_e=[0],ze=0,fe=oe!=null?oe.kd:0,Ee=oe??new _t;if(y==null||12>D)return 7;Ee.data=y,Ee.w=A,Ee.ha=D,A=[A],D=[D],Ee.gb=[Ee.gb];e:{var Be=A,nt=D,Ue=Ee.gb;if(e(y!=null),e(nt!=null),e(Ue!=null),Ue[0]=0,12<=nt[0]&&!t(y,Be[0],"RIFF")){if(t(y,Be[0]+8,"WEBP")){Ue=3;break e}var tt=ke(y,Be[0]+4);if(12>tt||4294967286<tt){Ue=3;break e}if(fe&&tt>nt[0]-8){Ue=7;break e}Ue[0]=tt,Be[0]+=12,nt[0]-=12}Ue=0}if(Ue!=0)return Ue;for(tt=0<Ee.gb[0],D=D[0];;){e:{var ot=y;nt=A,Ue=D;var Nt=pe,yt=_e,Kt=Be=[0];if((Ht=ze=[ze])[0]=0,8>Ue[0])Ue=7;else{if(!t(ot,nt[0],"VP8X")){if(ke(ot,nt[0]+4)!=10){Ue=3;break e}if(18>Ue[0]){Ue=7;break e}var zt=ke(ot,nt[0]+8),yn=1+Ge(ot,nt[0]+12);if(2147483648<=yn*(ot=1+Ge(ot,nt[0]+15))){Ue=3;break e}Kt!=null&&(Kt[0]=zt),Nt!=null&&(Nt[0]=yn),yt!=null&&(yt[0]=ot),nt[0]+=18,Ue[0]-=18,Ht[0]=1}Ue=0}}if(ze=ze[0],Be=Be[0],Ue!=0)return Ue;if(nt=!!(2&Be),!tt&&ze)return 3;if(Q!=null&&(Q[0]=!!(16&Be)),ee!=null&&(ee[0]=nt),ie!=null&&(ie[0]=0),ee=pe[0],Be=_e[0],ze&&nt&&oe==null){Ue=0;break}if(4>D){Ue=7;break}if(tt&&ze||!tt&&!ze&&!t(y,A[0],"ALPH")){D=[D],Ee.na=[Ee.na],Ee.P=[Ee.P],Ee.Sa=[Ee.Sa];e:{zt=y,Ue=A,tt=D;var Ht=Ee.gb;Nt=Ee.na,yt=Ee.P,Kt=Ee.Sa,yn=22,e(zt!=null),e(tt!=null),ot=Ue[0];var Bn=tt[0];for(e(Nt!=null),e(Kt!=null),Nt[0]=null,yt[0]=null,Kt[0]=0;;){if(Ue[0]=ot,tt[0]=Bn,8>Bn){Ue=7;break e}var Es=ke(zt,ot+4);if(4294967286<Es){Ue=3;break e}var Cn=8+Es+1&-2;if(yn+=Cn,0<Ht&&yn>Ht){Ue=3;break e}if(!t(zt,ot,"VP8 ")||!t(zt,ot,"VP8L")){Ue=0;break e}if(Bn[0]<Cn){Ue=7;break e}t(zt,ot,"ALPH")||(Nt[0]=zt,yt[0]=ot+8,Kt[0]=Es),ot+=Cn,Bn-=Cn}}if(D=D[0],Ee.na=Ee.na[0],Ee.P=Ee.P[0],Ee.Sa=Ee.Sa[0],Ue!=0)break}D=[D],Ee.Ja=[Ee.Ja],Ee.xa=[Ee.xa];e:if(Ht=y,Ue=A,tt=D,Nt=Ee.gb[0],yt=Ee.Ja,Kt=Ee.xa,zt=Ue[0],ot=!t(Ht,zt,"VP8 "),yn=!t(Ht,zt,"VP8L"),e(Ht!=null),e(tt!=null),e(yt!=null),e(Kt!=null),8>tt[0])Ue=7;else{if(ot||yn){if(Ht=ke(Ht,zt+4),12<=Nt&&Ht>Nt-12){Ue=3;break e}if(fe&&Ht>tt[0]-8){Ue=7;break e}yt[0]=Ht,Ue[0]+=8,tt[0]-=8,Kt[0]=yn}else Kt[0]=5<=tt[0]&&Ht[zt+0]==47&&!(Ht[zt+4]>>5),yt[0]=tt[0];Ue=0}if(D=D[0],Ee.Ja=Ee.Ja[0],Ee.xa=Ee.xa[0],A=A[0],Ue!=0)break;if(4294967286<Ee.Ja)return 3;if(ie==null||nt||(ie[0]=Ee.xa?2:1),ee=[ee],Be=[Be],Ee.xa){if(5>D){Ue=7;break}ie=ee,fe=Be,nt=Q,y==null||5>D?y=0:5<=D&&y[A+0]==47&&!(y[A+4]>>5)?(tt=[0],Ht=[0],Nt=[0],ye(yt=new U,y,A,D),mt(yt,tt,Ht,Nt)?(ie!=null&&(ie[0]=tt[0]),fe!=null&&(fe[0]=Ht[0]),nt!=null&&(nt[0]=Nt[0]),y=1):y=0):y=0}else{if(10>D){Ue=7;break}ie=Be,y==null||10>D||!te(y,A+3,D-3)?y=0:(fe=y[A+0]|y[A+1]<<8|y[A+2]<<16,nt=16383&(y[A+7]<<8|y[A+6]),y=16383&(y[A+9]<<8|y[A+8]),1&fe||3<(fe>>1&7)||!(fe>>4&1)||fe>>5>=Ee.Ja||!nt||!y?y=0:(ee&&(ee[0]=nt),ie&&(ie[0]=y),y=1))}if(!y||(ee=ee[0],Be=Be[0],ze&&(pe[0]!=ee||_e[0]!=Be)))return 3;oe!=null&&(oe[0]=Ee,oe.offset=A-oe.w,e(4294967286>A-oe.w),e(oe.offset==oe.ha-D));break}return Ue==0||Ue==7&&ze&&oe==null?(Q!=null&&(Q[0]|=Ee.na!=null&&0<Ee.na.length),B!=null&&(B[0]=ee),W!=null&&(W[0]=Be),0):Ue}function uo(y,A,D){var B=A.width,W=A.height,Q=0,ee=0,ie=B,oe=W;if(A.Da=y!=null&&0<y.Da,A.Da&&(ie=y.cd,oe=y.bd,Q=y.v,ee=y.j,11>D||(Q&=-2,ee&=-2),0>Q||0>ee||0>=ie||0>=oe||Q+ie>B||ee+oe>W))return 0;if(A.v=Q,A.j=ee,A.va=Q+ie,A.o=ee+oe,A.U=ie,A.T=oe,A.da=y!=null&&0<y.da,A.da){if(!bt(ie,oe,D=[y.ib],Q=[y.hb]))return 0;A.ib=D[0],A.hb=Q[0]}return A.ob=y!=null&&y.ob,A.Kb=y==null||!y.Sd,A.da&&(A.ob=A.ib<3*B/4&&A.hb<3*W/4,A.Kb=0),1}function tu(y){if(y==null)return 2;if(11>y.S){var A=y.f.RGBA;A.fb+=(y.height-1)*A.A,A.A=-A.A}else A=y.f.kb,y=y.height,A.O+=(y-1)*A.fa,A.fa=-A.fa,A.N+=(y-1>>1)*A.Ab,A.Ab=-A.Ab,A.W+=(y-1>>1)*A.Db,A.Db=-A.Db,A.F!=null&&(A.J+=(y-1)*A.lb,A.lb=-A.lb);return 0}function fa(y,A,D,B){if(B==null||0>=y||0>=A)return 2;if(D!=null){if(D.Da){var W=D.cd,Q=D.bd,ee=-2&D.v,ie=-2&D.j;if(0>ee||0>ie||0>=W||0>=Q||ee+W>y||ie+Q>A)return 2;y=W,A=Q}if(D.da){if(!bt(y,A,W=[D.ib],Q=[D.hb]))return 2;y=W[0],A=Q[0]}}B.width=y,B.height=A;e:{var oe=B.width,pe=B.height;if(y=B.S,0>=oe||0>=pe||!(y>=rd&&13>y))y=2;else{if(0>=B.Rd&&B.sd==null){ee=Q=W=A=0;var _e=(ie=oe*fd[y])*pe;if(11>y||(Q=(pe+1)/2*(A=(oe+1)/2),y==12&&(ee=(W=oe)*pe)),(pe=i(_e+2*Q+ee))==null){y=1;break e}B.sd=pe,11>y?((oe=B.f.RGBA).eb=pe,oe.fb=0,oe.A=ie,oe.size=_e):((oe=B.f.kb).y=pe,oe.O=0,oe.fa=ie,oe.Fd=_e,oe.f=pe,oe.N=0+_e,oe.Ab=A,oe.Cd=Q,oe.ea=pe,oe.W=0+_e+Q,oe.Db=A,oe.Ed=Q,y==12&&(oe.F=pe,oe.J=0+_e+2*Q),oe.Tc=ee,oe.lb=W)}if(A=1,W=B.S,Q=B.width,ee=B.height,W>=rd&&13>W)if(11>W)y=B.f.RGBA,A&=(ie=Math.abs(y.A))*(ee-1)+Q<=y.size,A&=ie>=Q*fd[W],A&=y.eb!=null;else{y=B.f.kb,ie=(Q+1)/2,_e=(ee+1)/2,oe=Math.abs(y.fa),pe=Math.abs(y.Ab);var ze=Math.abs(y.Db),fe=Math.abs(y.lb),Ee=fe*(ee-1)+Q;A&=oe*(ee-1)+Q<=y.Fd,A&=pe*(_e-1)+ie<=y.Cd,A=(A&=ze*(_e-1)+ie<=y.Ed)&oe>=Q&pe>=ie&ze>=ie,A&=y.y!=null,A&=y.f!=null,A&=y.ea!=null,W==12&&(A&=fe>=Q,A&=Ee<=y.Tc,A&=y.F!=null)}else A=0;y=A?0:2}}return y!=0||D!=null&&D.fd&&(y=tu(B)),y}var Uo=64,xi=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],ii=24,Pa=32,Ba=8,ho=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];vt("Predictor0","PredictorAdd0"),z.Predictor0=function(){return 4278190080},z.Predictor1=function(y){return y},z.Predictor2=function(y,A,D){return A[D+0]},z.Predictor3=function(y,A,D){return A[D+1]},z.Predictor4=function(y,A,D){return A[D-1]},z.Predictor5=function(y,A,D){return St(St(y,A[D+1]),A[D+0])},z.Predictor6=function(y,A,D){return St(y,A[D-1])},z.Predictor7=function(y,A,D){return St(y,A[D+0])},z.Predictor8=function(y,A,D){return St(A[D-1],A[D+0])},z.Predictor9=function(y,A,D){return St(A[D+0],A[D+1])},z.Predictor10=function(y,A,D){return St(St(y,A[D-1]),St(A[D+0],A[D+1]))},z.Predictor11=function(y,A,D){var B=A[D+0];return 0>=je(B>>24&255,y>>24&255,(A=A[D-1])>>24&255)+je(B>>16&255,y>>16&255,A>>16&255)+je(B>>8&255,y>>8&255,A>>8&255)+je(255&B,255&y,255&A)?B:y},z.Predictor12=function(y,A,D){var B=A[D+0];return(Pt((y>>24&255)+(B>>24&255)-((A=A[D-1])>>24&255))<<24|Pt((y>>16&255)+(B>>16&255)-(A>>16&255))<<16|Pt((y>>8&255)+(B>>8&255)-(A>>8&255))<<8|Pt((255&y)+(255&B)-(255&A)))>>>0},z.Predictor13=function(y,A,D){var B=A[D-1];return(Ut((y=St(y,A[D+0]))>>24&255,B>>24&255)<<24|Ut(y>>16&255,B>>16&255)<<16|Ut(y>>8&255,B>>8&255)<<8|Ut(255&y,255&B))>>>0};var lc=z.PredictorAdd0;z.PredictorAdd1=Me,vt("Predictor2","PredictorAdd2"),vt("Predictor3","PredictorAdd3"),vt("Predictor4","PredictorAdd4"),vt("Predictor5","PredictorAdd5"),vt("Predictor6","PredictorAdd6"),vt("Predictor7","PredictorAdd7"),vt("Predictor8","PredictorAdd8"),vt("Predictor9","PredictorAdd9"),vt("Predictor10","PredictorAdd10"),vt("Predictor11","PredictorAdd11"),vt("Predictor12","PredictorAdd12"),vt("Predictor13","PredictorAdd13");var cc=z.PredictorAdd2;Oe("ColorIndexInverseTransform","MapARGB","32b",function(y){return y>>8&255},function(y){return y}),Oe("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(y){return y},function(y){return y>>8&255});var Ys,td=z.ColorIndexInverseTransform,Oa=z.MapARGB,Ia=z.VP8LColorIndexInverseTransformAlpha,Rr=z.MapAlpha,fo=z.VP8LPredictorsAdd=[];fo.length=16,(z.VP8LPredictors=[]).length=16,(z.VP8LPredictorsAdd_C=[]).length=16,(z.VP8LPredictors_C=[]).length=16;var uc,dc,po,go,Ma,_l,Ri,mo,Gr,zi,Zn,Gn,bs,Ks,Fa,pa,Al,nu,Ah,r0,i0,a0,Nh,Ch,Nl,$i,su,Pi,Cl=i(511),nd=i(2041),ru=i(225),iu=i(767),sd=0,xo=nd,au=ru,Vr=iu,Pr=Cl,rd=0,Wr=1,id=2,qi=3,ou=4,hc=5,zo=6,lu=7,ad=8,fc=9,od=10,Hi=[2,3,7],pc=[3,3,11],El=[280,256,256,256,40],ld=[0,1,1,1,0],cu=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Gi=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Vi=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],$o=8,Wi=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Yi=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Bi=null,o0=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Eh=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],cd=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],l0=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Br=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Cs=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],In=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ai=[],Fs=[],ga=[],qo=1,kh=2,bo=[],Or=[];oo("UpsampleRgbLinePair",lo,3),oo("UpsampleBgrLinePair",Sr,3),oo("UpsampleRgbaLinePair",ri,4),oo("UpsampleBgraLinePair",Ra,4),oo("UpsampleArgbLinePair",ac,4),oo("UpsampleRgba4444LinePair",Fo,2),oo("UpsampleRgb565LinePair",Mo,2);var kl=z.UpsampleRgbLinePair,jh=z.UpsampleBgrLinePair,gc=z.UpsampleRgbaLinePair,ud=z.UpsampleBgraLinePair,Ho=z.UpsampleArgbLinePair,Ua=z.UpsampleRgba4444LinePair,Go=z.UpsampleRgb565LinePair,Ki=16,mc=1<<Ki-1,jl=-227,Vo=482,dd=6,Wo=0,Ir=i(256),hd=i(256),c0=i(256),am=i(256),om=i(Vo-jl),lm=i(Vo-jl);co("YuvToRgbRow",lo,3),co("YuvToBgrRow",Sr,3),co("YuvToRgbaRow",ri,4),co("YuvToBgraRow",Ra,4),co("YuvToArgbRow",ac,4),co("YuvToRgba4444Row",Fo,2),co("YuvToRgb565Row",Mo,2);var Xs=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],xc=[0,2,8],uu=[8,7,6,4,4,2,2,2,1,1,1,1],du=1;this.WebPDecodeRGBA=function(y,A,D,B,W){var Q=Wr,ee=new at,ie=new Mt;ee.ba=ie,ie.S=Q,ie.width=[ie.width],ie.height=[ie.height];var oe=ie.width,pe=ie.height,_e=new Bt;if(_e==null||y==null)var ze=2;else e(_e!=null),ze=ha(y,A,D,_e.width,_e.height,_e.Pd,_e.Qd,_e.format,null);if(ze!=0?oe=0:(oe!=null&&(oe[0]=_e.width[0]),pe!=null&&(pe[0]=_e.height[0]),oe=1),oe){ie.width=ie.width[0],ie.height=ie.height[0],B!=null&&(B[0]=ie.width),W!=null&&(W[0]=ie.height);e:{if(B=new la,(W=new _t).data=y,W.w=A,W.ha=D,W.kd=1,A=[0],e(W!=null),((y=ha(W.data,W.w,W.ha,null,null,null,A,null,W))==0||y==7)&&A[0]&&(y=4),(A=y)==0){if(e(ee!=null),B.data=W.data,B.w=W.w+W.offset,B.ha=W.ha-W.offset,B.put=re,B.ac=ut,B.bc=Qe,B.ma=ee,W.xa){if((y=er())==null){ee=1;break e}if((function(fe,Ee){var Be=[0],nt=[0],Ue=[0];t:for(;;){if(fe==null)return 0;if(Ee==null)return fe.a=2,0;if(fe.l=Ee,fe.a=0,ye(fe.m,Ee.data,Ee.w,Ee.ha),!mt(fe.m,Be,nt,Ue)){fe.a=3;break t}if(fe.xb=kh,Ee.width=Be[0],Ee.height=nt[0],!tr(Be[0],nt[0],1,fe,null))break t;return 1}return e(fe.a!=0),0})(y,B)){if(B=(A=fa(B.width,B.height,ee.Oa,ee.ba))==0){t:{B=y;n:for(;;){if(B==null){B=0;break t}if(e(B.s.yc!=null),e(B.s.Ya!=null),e(0<B.s.Wb),e((D=B.l)!=null),e((W=D.ma)!=null),B.xb!=0){if(B.ca=W.ba,B.tb=W.tb,e(B.ca!=null),!uo(W.Oa,D,qi)){B.a=2;break n}if(!Ns(B,D.width)||D.da)break n;if((D.da||pt(B.ca.S))&&ua(),11>B.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),B.ca.f.kb.F!=null&&ua()),B.Pb&&0<B.s.ua&&B.s.vb.X==null&&!X(B.s.vb,B.s.Wa.Xa)){B.a=1;break n}B.xb=0}if(!sn(B,B.V,B.Ba,B.c,B.i,D.o,Pn))break n;W.Dc=B.Ma,B=1;break t}e(B.a!=0),B=0}B=!B}B&&(A=y.a)}else A=y.a}else{if((y=new ji)==null){ee=1;break e}if(y.Fa=W.na,y.P=W.P,y.qc=W.Sa,Se(y,B)){if((A=fa(B.width,B.height,ee.Oa,ee.ba))==0){if(y.Aa=0,D=ee.Oa,e((W=y)!=null),D!=null){if(0<(oe=0>(oe=D.Md)?0:100<oe?255:255*oe/100)){for(pe=_e=0;4>pe;++pe)12>(ze=W.pb[pe]).lc&&(ze.ia=oe*uu[0>ze.lc?0:ze.lc]>>3),_e|=ze.ia;_e&&(alert("todo:VP8InitRandom"),W.ia=1)}W.Ga=D.Id,100<W.Ga?W.Ga=100:0>W.Ga&&(W.Ga=0)}(function(fe,Ee){if(fe==null)return 0;if(Ee==null)return zn(fe,2,"NULL VP8Io parameter in VP8Decode().");if(!fe.cb&&!Se(fe,Ee))return 0;if(e(fe.cb),Ee.ac==null||Ee.ac(Ee)){Ee.ob&&(fe.L=0);var Be=xc[fe.L];if(fe.L==2?(fe.yb=0,fe.zb=0):(fe.yb=Ee.v-Be>>4,fe.zb=Ee.j-Be>>4,0>fe.yb&&(fe.yb=0),0>fe.zb&&(fe.zb=0)),fe.Va=Ee.o+15+Be>>4,fe.Hb=Ee.va+15+Be>>4,fe.Hb>fe.za&&(fe.Hb=fe.za),fe.Va>fe.Ub&&(fe.Va=fe.Ub),0<fe.L){var nt=fe.ed;for(Be=0;4>Be;++Be){var Ue;if(fe.Qa.Cb){var tt=fe.Qa.Lb[Be];fe.Qa.Fb||(tt+=nt.Tb)}else tt=nt.Tb;for(Ue=0;1>=Ue;++Ue){var ot=fe.gd[Be][Ue],Nt=tt;if(nt.Pc&&(Nt+=nt.vd[0],Ue&&(Nt+=nt.od[0])),0<(Nt=0>Nt?0:63<Nt?63:Nt)){var yt=Nt;0<nt.wb&&(yt=4<nt.wb?yt>>2:yt>>1)>9-nt.wb&&(yt=9-nt.wb),1>yt&&(yt=1),ot.dd=yt,ot.tc=2*Nt+yt,ot.ld=40<=Nt?2:15<=Nt?1:0}else ot.tc=0;ot.La=Ue}}}Be=0}else zn(fe,6,"Frame setup failed"),Be=fe.a;if(Be=Be==0){if(Be){fe.$c=0,0<fe.Aa||(fe.Ic=du);t:{Be=fe.Ic,nt=4*(yt=fe.za);var Kt=32*yt,zt=yt+1,yn=0<fe.L?yt*(0<fe.Aa?2:1):0,Ht=(fe.Aa==2?2:1)*yt;if((ot=nt+832+(Ue=3*(16*Be+xc[fe.L])/2*Kt)+(tt=fe.Fa!=null&&0<fe.Fa.length?fe.Kc.c*fe.Kc.i:0))!=ot)Be=0;else{if(ot>fe.Vb){if(fe.Vb=0,fe.Ec=i(ot),fe.Fc=0,fe.Ec==null){Be=zn(fe,1,"no memory during frame initialization.");break t}fe.Vb=ot}ot=fe.Ec,Nt=fe.Fc,fe.Ac=ot,fe.Bc=Nt,Nt+=nt,fe.Gd=o(Kt,ml),fe.Hd=0,fe.rb=o(zt+1,ki),fe.sb=1,fe.wa=yn?o(yn,ni):null,fe.Y=0,fe.D.Nb=0,fe.D.wa=fe.wa,fe.D.Y=fe.Y,0<fe.Aa&&(fe.D.Y+=yt),e(!0),fe.oc=ot,fe.pc=Nt,Nt+=832,fe.ya=o(Ht,Bo),fe.aa=0,fe.D.ya=fe.ya,fe.D.aa=fe.aa,fe.Aa==2&&(fe.D.aa+=yt),fe.R=16*yt,fe.B=8*yt,yt=(Kt=xc[fe.L])*fe.R,Kt=Kt/2*fe.B,fe.sa=ot,fe.ta=Nt+yt,fe.qa=fe.sa,fe.ra=fe.ta+16*Be*fe.R+Kt,fe.Ha=fe.qa,fe.Ia=fe.ra+8*Be*fe.B+Kt,fe.$c=0,Nt+=Ue,fe.mb=tt?ot:null,fe.nb=tt?Nt:null,e(Nt+tt<=fe.Fc+fe.Vb),Ae(fe),r(fe.Ac,fe.Bc,0,nt),Be=1}}if(Be){if(Ee.ka=0,Ee.y=fe.sa,Ee.O=fe.ta,Ee.f=fe.qa,Ee.N=fe.ra,Ee.ea=fe.Ha,Ee.Vd=fe.Ia,Ee.fa=fe.R,Ee.Rc=fe.B,Ee.F=null,Ee.J=0,!sd){for(Be=-255;255>=Be;++Be)Cl[255+Be]=0>Be?-Be:Be;for(Be=-1020;1020>=Be;++Be)nd[1020+Be]=-128>Be?-128:127<Be?127:Be;for(Be=-112;112>=Be;++Be)ru[112+Be]=-16>Be?-16:15<Be?15:Be;for(Be=-255;510>=Be;++Be)iu[255+Be]=0>Be?0:255<Be?255:Be;sd=1}Ri=bn,mo=Dn,zi=Ot,Zn=Ft,Gn=ms,Gr=fn,bs=Qu,Ks=io,Fa=V,pa=ge,Al=ed,nu=j,Ah=we,r0=De,i0=to,a0=no,Nh=wl,Ch=Zc,Fs[0]=Ju,Fs[1]=nr,Fs[2]=Xu,Fs[3]=Xc,Fs[4]=Ti,Fs[5]=Jc,Fs[6]=Dr,Fs[7]=bl,Fs[8]=yl,Fs[9]=Di,ai[0]=ca,ai[1]=Oo,ai[2]=Kc,ai[3]=Ku,ai[4]=Qa,ai[5]=xl,ai[6]=Io,ga[0]=nc,ga[1]=ja,ga[2]=Ta,ga[3]=Zu,ga[4]=wr,ga[5]=sc,ga[6]=Da,Be=1}else Be=0}Be&&(Be=(function(Bn,Es){for(Bn.M=0;Bn.M<Bn.Va;++Bn.M){var Cn,$t=Bn.Jc[Bn.M&Bn.Xb],Dt=Bn.m,Rs=Bn;for(Cn=0;Cn<Rs.za;++Cn){var dn=Dt,jn=Rs,ns=jn.Ac,pr=jn.Bc+4*Cn,Mr=jn.zc,ys=jn.ya[jn.aa+Cn];if(jn.Qa.Bb?ys.$b=ve(dn,jn.Pa.jb[0])?2+ve(dn,jn.Pa.jb[2]):ve(dn,jn.Pa.jb[1]):ys.$b=0,jn.kc&&(ys.Ad=ve(dn,jn.Bd)),ys.Za=!ve(dn,145)+0,ys.Za){var rr=ys.Ob,Yr=0;for(jn=0;4>jn;++jn){var ir,Rn=Mr[0+jn];for(ir=0;4>ir;++ir){Rn=Br[ns[pr+ir]][Rn];for(var Kn=cd[ve(dn,Rn[0])];0<Kn;)Kn=cd[2*Kn+ve(dn,Rn[Kn])];Rn=-Kn,ns[pr+ir]=Rn}n(rr,Yr,ns,pr,4),Yr+=4,Mr[0+jn]=Rn}}else Rn=ve(dn,156)?ve(dn,128)?1:3:ve(dn,163)?2:0,ys.Ob[0]=Rn,r(ns,pr,Rn,4),r(Mr,0,Rn,4);ys.Dd=ve(dn,142)?ve(dn,114)?ve(dn,183)?1:3:2:0}if(Rs.m.Ka)return zn(Bn,7,"Premature end-of-partition0 encountered.");for(;Bn.ja<Bn.za;++Bn.ja){if(Rs=$t,dn=(Dt=Bn).rb[Dt.sb-1],ns=Dt.rb[Dt.sb+Dt.ja],Cn=Dt.ya[Dt.aa+Dt.ja],pr=Dt.kc?Cn.Ad:0)dn.la=ns.la=0,Cn.Za||(dn.Na=ns.Na=0),Cn.Hc=0,Cn.Gc=0,Cn.ia=0;else{var Ps,Qn;if(dn=ns,ns=Rs,pr=Dt.Pa.Xc,Mr=Dt.ya[Dt.aa+Dt.ja],ys=Dt.pb[Mr.$b],jn=Mr.ad,rr=0,Yr=Dt.rb[Dt.sb-1],Rn=ir=0,r(jn,rr,0,384),Mr.Za)var gr=0,Bs=pr[3];else{Kn=i(16);var Xn=dn.Na+Yr.Na;if(Xn=Bi(ns,pr[1],Xn,ys.Eb,0,Kn,0),dn.Na=Yr.Na=(0<Xn)+0,1<Xn)Ri(Kn,0,jn,rr);else{var Js=Kn[0]+3>>3;for(Kn=0;256>Kn;Kn+=16)jn[rr+Kn]=Js}gr=1,Bs=pr[0]}var ss=15&dn.la,ar=15&Yr.la;for(Kn=0;4>Kn;++Kn){var or=1&ar;for(Js=Qn=0;4>Js;++Js)ss=ss>>1|(or=(Xn=Bi(ns,Bs,Xn=or+(1&ss),ys.Sc,gr,jn,rr))>gr)<<7,Qn=Qn<<2|(3<Xn?3:1<Xn?2:jn[rr+0]!=0),rr+=16;ss>>=4,ar=ar>>1|or<<7,ir=(ir<<8|Qn)>>>0}for(Bs=ss,gr=ar>>4,Ps=0;4>Ps;Ps+=2){for(Qn=0,ss=dn.la>>4+Ps,ar=Yr.la>>4+Ps,Kn=0;2>Kn;++Kn){for(or=1&ar,Js=0;2>Js;++Js)Xn=or+(1&ss),ss=ss>>1|(or=0<(Xn=Bi(ns,pr[2],Xn,ys.Qc,0,jn,rr)))<<3,Qn=Qn<<2|(3<Xn?3:1<Xn?2:jn[rr+0]!=0),rr+=16;ss>>=2,ar=ar>>1|or<<5}Rn|=Qn<<4*Ps,Bs|=ss<<4<<Ps,gr|=(240&ar)<<Ps}dn.la=Bs,Yr.la=gr,Mr.Hc=ir,Mr.Gc=Rn,Mr.ia=43690&Rn?0:ys.ia,pr=!(ir|Rn)}if(0<Dt.L&&(Dt.wa[Dt.Y+Dt.ja]=Dt.gd[Cn.$b][Cn.Za],Dt.wa[Dt.Y+Dt.ja].La|=!pr),Rs.Ka)return zn(Bn,7,"Premature end-of-file encountered.")}if(Ae(Bn),Dt=Es,Rs=1,Cn=($t=Bn).D,dn=0<$t.L&&$t.M>=$t.zb&&$t.M<=$t.Va,$t.Aa==0)t:{if(Cn.M=$t.M,Cn.uc=dn,Li($t,Cn),Rs=1,Cn=(Qn=$t.D).Nb,dn=(Rn=xc[$t.L])*$t.R,ns=Rn/2*$t.B,Kn=16*Cn*$t.R,Js=8*Cn*$t.B,pr=$t.sa,Mr=$t.ta-dn+Kn,ys=$t.qa,jn=$t.ra-ns+Js,rr=$t.Ha,Yr=$t.Ia-ns+Js,ar=(ss=Qn.M)==0,ir=ss>=$t.Va-1,$t.Aa==2&&Li($t,Qn),Qn.uc)for(or=(Xn=$t).D.M,e(Xn.D.uc),Qn=Xn.yb;Qn<Xn.Hb;++Qn){gr=Qn,Bs=or;var hs=(Vn=(lr=Xn).D).Nb;Ps=lr.R;var Vn=Vn.wa[Vn.Y+gr],Kr=lr.sa,Us=lr.ta+16*hs*Ps+16*gr,rn=Vn.dd,on=Vn.tc;if(on!=0)if(e(3<=on),lr.L==1)0<gr&&a0(Kr,Us,Ps,on+4),Vn.La&&Ch(Kr,Us,Ps,on),0<Bs&&i0(Kr,Us,Ps,on+4),Vn.La&&Nh(Kr,Us,Ps,on);else{var Jn=lr.B,bi=lr.qa,Xi=lr.ra+8*hs*Jn+8*gr,oi=lr.Ha,lr=lr.Ia+8*hs*Jn+8*gr;hs=Vn.ld,0<gr&&(Ks(Kr,Us,Ps,on+4,rn,hs),pa(bi,Xi,oi,lr,Jn,on+4,rn,hs)),Vn.La&&(nu(Kr,Us,Ps,on,rn,hs),r0(bi,Xi,oi,lr,Jn,on,rn,hs)),0<Bs&&(bs(Kr,Us,Ps,on+4,rn,hs),Fa(bi,Xi,oi,lr,Jn,on+4,rn,hs)),Vn.La&&(Al(Kr,Us,Ps,on,rn,hs),Ah(bi,Xi,oi,lr,Jn,on,rn,hs))}}if($t.ia&&alert("todo:DitherRow"),Dt.put!=null){if(Qn=16*ss,ss=16*(ss+1),ar?(Dt.y=$t.sa,Dt.O=$t.ta+Kn,Dt.f=$t.qa,Dt.N=$t.ra+Js,Dt.ea=$t.Ha,Dt.W=$t.Ia+Js):(Qn-=Rn,Dt.y=pr,Dt.O=Mr,Dt.f=ys,Dt.N=jn,Dt.ea=rr,Dt.W=Yr),ir||(ss-=Rn),ss>Dt.o&&(ss=Dt.o),Dt.F=null,Dt.J=null,$t.Fa!=null&&0<$t.Fa.length&&Qn<ss&&(Dt.J=xs($t,Dt,Qn,ss-Qn),Dt.F=$t.mb,Dt.F==null&&Dt.F.length==0)){Rs=zn($t,3,"Could not decode alpha data.");break t}Qn<Dt.j&&(Rn=Dt.j-Qn,Qn=Dt.j,e(!(1&Rn)),Dt.O+=$t.R*Rn,Dt.N+=$t.B*(Rn>>1),Dt.W+=$t.B*(Rn>>1),Dt.F!=null&&(Dt.J+=Dt.width*Rn)),Qn<ss&&(Dt.O+=Dt.v,Dt.N+=Dt.v>>1,Dt.W+=Dt.v>>1,Dt.F!=null&&(Dt.J+=Dt.v),Dt.ka=Qn-Dt.j,Dt.U=Dt.va-Dt.v,Dt.T=ss-Qn,Rs=Dt.put(Dt))}Cn+1!=$t.Ic||ir||(n($t.sa,$t.ta-dn,pr,Mr+16*$t.R,dn),n($t.qa,$t.ra-ns,ys,jn+8*$t.B,ns),n($t.Ha,$t.Ia-ns,rr,Yr+8*$t.B,ns))}if(!Rs)return zn(Bn,6,"Output aborted.")}return 1})(fe,Ee)),Ee.bc!=null&&Ee.bc(Ee),Be&=1}return Be?(fe.cb=0,Be):0})(y,B)||(A=y.a)}}else A=y.a}A==0&&ee.Oa!=null&&ee.Oa.fd&&(A=tu(ee.ba))}ee=A}Q=ee!=0?null:11>Q?ie.f.RGBA.eb:ie.f.kb.y}else Q=null;return Q};var fd=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function h(z,G){for(var R="",q=0;q<4;q++)R+=String.fromCharCode(z[G++]);return R}function p(z,G){return z[G+0]|z[G+1]<<8}function g(z,G){return(z[G+0]|z[G+1]<<8|z[G+2]<<16)>>>0}function b(z,G){return(z[G+0]|z[G+1]<<8|z[G+2]<<16|z[G+3]<<24)>>>0}new d;var x=[0],w=[0],v=[],_=new d,N=s,E=(function(z,G){var R={},q=0,J=!1,Z=0,le=0;if(R.frames=[],!(function(L,U){for(var H=0;H<4;H++)if(L[U+H]!="RIFF".charCodeAt(H))return!0;return!1})(z,G)){for(b(z,G+=4),G+=8;G<z.length;){var K=h(z,G),se=b(z,G+=4);G+=4;var ce=se+(1&se);switch(K){case"VP8 ":case"VP8L":R.frames[q]===void 0&&(R.frames[q]={}),(M=R.frames[q]).src_off=J?le:G-8,M.src_size=Z+se+8,q++,J&&(J=!1,Z=0,le=0);break;case"VP8X":(M=R.header={}).feature_flags=z[G];var ye=G+4;M.canvas_width=1+g(z,ye),ye+=3,M.canvas_height=1+g(z,ye),ye+=3;break;case"ALPH":J=!0,Z=ce+8,le=G-8;break;case"ANIM":(M=R.header).bgcolor=b(z,G),ye=G+4,M.loop_count=p(z,ye),ye+=2;break;case"ANMF":var Ce,M;(M=R.frames[q]={}).offset_x=2*g(z,G),G+=3,M.offset_y=2*g(z,G),G+=3,M.width=1+g(z,G),G+=3,M.height=1+g(z,G),G+=3,M.duration=g(z,G),G+=3,Ce=z[G++],M.dispose=1&Ce,M.blend=Ce>>1&1}K!="ANMF"&&(G+=ce)}return R}})(N,0);E.response=N,E.rgbaoutput=!0,E.dataurl=!1;var k=E.header?E.header:null,T=E.frames?E.frames:null;if(k){k.loop_counter=k.loop_count,x=[k.canvas_height],w=[k.canvas_width];for(var P=0;P<T.length&&T[P].blend!=0;P++);}var O=T[0],F=_.WebPDecodeRGBA(N,O.src_off,O.src_size,w,x);O.rgba=F,O.imgwidth=w[0],O.imgheight=x[0];for(var $=0;$<w[0]*x[0]*4;$++)v[$]=F[$];return this.width=w,this.height=x,this.data=v,this}function I7(){var s,e=this.internal.__metadata__.metadata,t=unescape(encodeURIComponent(e));s=this.internal.__metadata__.rawXml?t:'<x:xmpmeta xmlns:x="adobe:ns:meta/"><rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceUri+'"><jspdf:metadata>'+t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")+"</jspdf:metadata></rdf:Description></rdf:RDF></x:xmpmeta>",this.internal.__metadata__.metadataObjectNumber=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+s.length+" >>"),this.internal.write("stream"),this.internal.write(s),this.internal.write("endstream"),this.internal.write("endobj")}function M7(){this.internal.__metadata__.metadataObjectNumber&&this.internal.write("/Metadata "+this.internal.__metadata__.metadataObjectNumber+" 0 R")}(function(s){var e,t,n,r,i,o,l,d,h,p=function(L){return L=L||{},this.isStrokeTransparent=L.isStrokeTransparent||!1,this.strokeOpacity=L.strokeOpacity||1,this.strokeStyle=L.strokeStyle||"#000000",this.fillStyle=L.fillStyle||"#000000",this.isFillTransparent=L.isFillTransparent||!1,this.fillOpacity=L.fillOpacity||1,this.font=L.font||"10px sans-serif",this.textBaseline=L.textBaseline||"alphabetic",this.textAlign=L.textAlign||"left",this.lineWidth=L.lineWidth||1,this.lineJoin=L.lineJoin||"miter",this.lineCap=L.lineCap||"butt",this.path=L.path||[],this.transform=L.transform!==void 0?L.transform.clone():new d,this.globalCompositeOperation=L.globalCompositeOperation||"normal",this.globalAlpha=L.globalAlpha||1,this.clip_path=L.clip_path||[],this.currentPoint=L.currentPoint||new o,this.miterLimit=L.miterLimit||10,this.lastPoint=L.lastPoint||new o,this.lineDashOffset=L.lineDashOffset||0,this.lineDash=L.lineDash||[],this.margin=L.margin||[0,0,0,0],this.prevPageLastElemOffset=L.prevPageLastElemOffset||0,this.ignoreClearRect=typeof L.ignoreClearRect!="boolean"||L.ignoreClearRect,this};s.events.push(["initialized",function(){this.context2d=new g(this),e=this.internal.f2,t=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,r=this.internal.getHorizontalCoordinate,i=this.internal.getVerticalCoordinate,o=this.internal.Point,l=this.internal.Rectangle,d=this.internal.Matrix,h=new p}]);var g=function(L){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var U=L;Object.defineProperty(this,"pdf",{get:function(){return U}});var H=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return H},set:function(X){H=!!X}});var ae=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return ae},set:function(X){ae=!!X}});var de=0;Object.defineProperty(this,"posX",{get:function(){return de},set:function(X){isNaN(X)||(de=X)}});var xe=0;Object.defineProperty(this,"posY",{get:function(){return xe},set:function(X){isNaN(X)||(xe=X)}}),Object.defineProperty(this,"margin",{get:function(){return h.margin},set:function(X){var Pe;typeof X=="number"?Pe=[X,X,X,X]:((Pe=new Array(4))[0]=X[0],Pe[1]=X.length>=2?X[1]:Pe[0],Pe[2]=X.length>=3?X[2]:Pe[0],Pe[3]=X.length>=4?X[3]:Pe[1]),h.margin=Pe}});var he=!1;Object.defineProperty(this,"autoPaging",{get:function(){return he},set:function(X){he=X}});var me=0;Object.defineProperty(this,"lastBreak",{get:function(){return me},set:function(X){me=X}});var ve=[];Object.defineProperty(this,"pageBreaks",{get:function(){return ve},set:function(X){ve=X}}),Object.defineProperty(this,"ctx",{get:function(){return h},set:function(X){X instanceof p&&(h=X)}}),Object.defineProperty(this,"path",{get:function(){return h.path},set:function(X){h.path=X}});var Re=[];Object.defineProperty(this,"ctxStack",{get:function(){return Re},set:function(X){Re=X}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(X){var Pe;Pe=b(X),this.ctx.fillStyle=Pe.style,this.ctx.isFillTransparent=Pe.a===0,this.ctx.fillOpacity=Pe.a,this.pdf.setFillColor(Pe.r,Pe.g,Pe.b,{a:Pe.a}),this.pdf.setTextColor(Pe.r,Pe.g,Pe.b,{a:Pe.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(X){var Pe=b(X);this.ctx.strokeStyle=Pe.style,this.ctx.isStrokeTransparent=Pe.a===0,this.ctx.strokeOpacity=Pe.a,Pe.a===0?this.pdf.setDrawColor(255,255,255):(Pe.a,this.pdf.setDrawColor(Pe.r,Pe.g,Pe.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(X){["butt","round","square"].indexOf(X)!==-1&&(this.ctx.lineCap=X,this.pdf.setLineCap(X))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(X){isNaN(X)||(this.ctx.lineWidth=X,this.pdf.setLineWidth(X))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(X){["bevel","round","miter"].indexOf(X)!==-1&&(this.ctx.lineJoin=X,this.pdf.setLineJoin(X))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(X){isNaN(X)||(this.ctx.miterLimit=X,this.pdf.setMiterLimit(X))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(X){this.ctx.textBaseline=X}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(X){["right","end","center","left","start"].indexOf(X)!==-1&&(this.ctx.textAlign=X)}});var Ke=null,Ge=null,ke=null;Object.defineProperty(this,"fontFaces",{get:function(){return ke},set:function(X){Ke=null,Ge=null,ke=X}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(X){var Pe;if(this.ctx.font=X,(Pe=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(X))!==null){var gt=Pe[1];Pe[2];var bt=Pe[3],Ye=Pe[4];Pe[5];var Et=Pe[6],vt=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Ye)[2];Ye=Math.floor(vt==="px"?parseFloat(Ye)*this.pdf.internal.scaleFactor:vt==="em"?parseFloat(Ye)*this.pdf.getFontSize():parseFloat(Ye)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Ye);var st=(function(Oe){var ct,ft,wt=[],it=Oe.trim();if(it==="")return u1;if(it in pS)return[pS[it]];for(;it!=="";){switch(ft=null,ct=(it=mS(it)).charAt(0)){case'"':case"'":ft=D7(it.substring(1),ct);break;default:ft=L7(it)}if(ft===null||(wt.push(ft[0]),(it=mS(ft[1]))!==""&&it.charAt(0)!==","))return u1;it=it.replace(/^,/,"")}return wt})(Et);if(this.fontFaces){var St=(function(Oe,ct){var ft=Oe.getFontList(),wt=JSON.stringify(ft);if(Ke===null||Ge!==wt){var it=(function(At){var We=[];return Object.keys(At).forEach(function(lt){At[lt].forEach(function(pt){var It=null;switch(pt){case"bold":It={family:lt,weight:"bold"};break;case"italic":It={family:lt,style:"italic"};break;case"bolditalic":It={family:lt,weight:"bold",style:"italic"};break;case"":case"normal":It={family:lt}}It!==null&&(It.ref={name:lt,style:pt},We.push(It))})}),We})(ft);Ke=(function(At){for(var We={},lt=0;lt<At.length;++lt){var pt=c1(At[lt]),It=pt.family,en=pt.stretch,Mt=pt.style,Bt=pt.weight;We[It]=We[It]||{},We[It][en]=We[It][en]||{},We[It][en][Mt]=We[It][en][Mt]||{},We[It][en][Mt][Bt]=pt}return We})(it.concat(ct)),Ge=wt}return Ke})(this.pdf,this.fontFaces),Pt=st.map(function(Oe){return{family:Oe,stretch:"normal",weight:bt,style:gt}}),Ut=(function(Oe,ct,ft){for(var wt=(ft=ft||{}).defaultFontFamily||"times",it=Object.assign({},T7,ft.genericFontFamilies||{}),At=null,We=null,lt=0;lt<ct.length;++lt)if(it[(At=c1(ct[lt])).family]&&(At.family=it[At.family]),Oe.hasOwnProperty(At.family)){We=Oe[At.family];break}if(!(We=We||Oe[wt]))throw new Error("Could not find a font-family for the rule '"+gS(At)+"' and default family '"+wt+"'.");if(We=(function(pt,It){if(It[pt])return It[pt];var en=sb[pt],Mt=en<=sb.normal?-1:1,Bt=fS(It,K4,en,Mt);if(!Bt)throw new Error("Could not find a matching font-stretch value for "+pt);return Bt})(At.stretch,We),We=(function(pt,It){if(It[pt])return It[pt];for(var en=Y4[pt],Mt=0;Mt<en.length;++Mt)if(It[en[Mt]])return It[en[Mt]];throw new Error("Could not find a matching font-style for "+pt)})(At.style,We),!(We=(function(pt,It){if(It[pt])return It[pt];if(pt===400&&It[500])return It[500];if(pt===500&&It[400])return It[400];var en=j7[pt],Mt=fS(It,X4,en,pt<400?-1:1);if(!Mt)throw new Error("Could not find a matching font-weight for value "+pt);return Mt})(At.weight,We)))throw new Error("Failed to resolve a font for the rule '"+gS(At)+"'.");return We})(St,Pt);this.pdf.setFont(Ut.ref.name,Ut.ref.style)}else{var je="";(bt==="bold"||parseInt(bt,10)>=700||gt==="bold")&&(je="bold"),gt==="italic"&&(je+="italic"),je.length===0&&(je="normal");for(var Me="",Fe={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},ue=0;ue<st.length;ue++){if(this.pdf.internal.getFont(st[ue],je,{noFallback:!0,disableWarning:!0})!==void 0){Me=st[ue];break}if(je==="bolditalic"&&this.pdf.internal.getFont(st[ue],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Me=st[ue],je="bold";else if(this.pdf.internal.getFont(st[ue],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Me=st[ue],je="normal";break}}if(Me===""){for(var Te=0;Te<st.length;Te++)if(Fe[st[Te]]){Me=Fe[st[Te]];break}}Me=Me===""?"Times":Me,this.pdf.setFont(Me,je)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(X){this.ctx.globalCompositeOperation=X}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(X){this.ctx.globalAlpha=X}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(X){this.ctx.lineDashOffset=X,M.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(X){this.ctx.lineDash=X,M.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(X){this.ctx.ignoreClearRect=!!X}})};g.prototype.setLineDash=function(L){this.lineDash=L},g.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},g.prototype.fill=function(){T.call(this,"fill",!1)},g.prototype.stroke=function(){T.call(this,"stroke",!1)},g.prototype.beginPath=function(){this.path=[{type:"begin"}]},g.prototype.moveTo=function(L,U){if(isNaN(L)||isNaN(U))throw js.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var H=this.ctx.transform.applyToPoint(new o(L,U));this.path.push({type:"mt",x:H.x,y:H.y}),this.ctx.lastPoint=new o(L,U)},g.prototype.closePath=function(){var L=new o(0,0),U=0;for(U=this.path.length-1;U!==-1;U--)if(this.path[U].type==="begin"&&gs(this.path[U+1])==="object"&&typeof this.path[U+1].x=="number"){L=new o(this.path[U+1].x,this.path[U+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new o(L.x,L.y)},g.prototype.lineTo=function(L,U){if(isNaN(L)||isNaN(U))throw js.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var H=this.ctx.transform.applyToPoint(new o(L,U));this.path.push({type:"lt",x:H.x,y:H.y}),this.ctx.lastPoint=new o(H.x,H.y)},g.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),T.call(this,null,!0)},g.prototype.quadraticCurveTo=function(L,U,H,ae){if(isNaN(H)||isNaN(ae)||isNaN(L)||isNaN(U))throw js.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var de=this.ctx.transform.applyToPoint(new o(H,ae)),xe=this.ctx.transform.applyToPoint(new o(L,U));this.path.push({type:"qct",x1:xe.x,y1:xe.y,x:de.x,y:de.y}),this.ctx.lastPoint=new o(de.x,de.y)},g.prototype.bezierCurveTo=function(L,U,H,ae,de,xe){if(isNaN(de)||isNaN(xe)||isNaN(L)||isNaN(U)||isNaN(H)||isNaN(ae))throw js.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var he=this.ctx.transform.applyToPoint(new o(de,xe)),me=this.ctx.transform.applyToPoint(new o(L,U)),ve=this.ctx.transform.applyToPoint(new o(H,ae));this.path.push({type:"bct",x1:me.x,y1:me.y,x2:ve.x,y2:ve.y,x:he.x,y:he.y}),this.ctx.lastPoint=new o(he.x,he.y)},g.prototype.arc=function(L,U,H,ae,de,xe){if(isNaN(L)||isNaN(U)||isNaN(H)||isNaN(ae)||isNaN(de))throw js.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(xe=!!xe,!this.ctx.transform.isIdentity){var he=this.ctx.transform.applyToPoint(new o(L,U));L=he.x,U=he.y;var me=this.ctx.transform.applyToPoint(new o(0,H)),ve=this.ctx.transform.applyToPoint(new o(0,0));H=Math.sqrt(Math.pow(me.x-ve.x,2)+Math.pow(me.y-ve.y,2))}Math.abs(de-ae)>=2*Math.PI&&(ae=0,de=2*Math.PI),this.path.push({type:"arc",x:L,y:U,radius:H,startAngle:ae,endAngle:de,counterclockwise:xe})},g.prototype.arcTo=function(L,U,H,ae,de){throw new Error("arcTo not implemented.")},g.prototype.rect=function(L,U,H,ae){if(isNaN(L)||isNaN(U)||isNaN(H)||isNaN(ae))throw js.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(L,U),this.lineTo(L+H,U),this.lineTo(L+H,U+ae),this.lineTo(L,U+ae),this.lineTo(L,U),this.lineTo(L+H,U),this.lineTo(L,U)},g.prototype.fillRect=function(L,U,H,ae){if(isNaN(L)||isNaN(U)||isNaN(H)||isNaN(ae))throw js.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!x.call(this)){var de={};this.lineCap!=="butt"&&(de.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(de.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(L,U,H,ae),this.fill(),de.hasOwnProperty("lineCap")&&(this.lineCap=de.lineCap),de.hasOwnProperty("lineJoin")&&(this.lineJoin=de.lineJoin)}},g.prototype.strokeRect=function(L,U,H,ae){if(isNaN(L)||isNaN(U)||isNaN(H)||isNaN(ae))throw js.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");w.call(this)||(this.beginPath(),this.rect(L,U,H,ae),this.stroke())},g.prototype.clearRect=function(L,U,H,ae){if(isNaN(L)||isNaN(U)||isNaN(H)||isNaN(ae))throw js.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(L,U,H,ae))},g.prototype.save=function(L){L=typeof L!="boolean"||L;for(var U=this.pdf.internal.getCurrentPageInfo().pageNumber,H=0;H<this.pdf.internal.getNumberOfPages();H++)this.pdf.setPage(H+1),this.pdf.internal.out("q");if(this.pdf.setPage(U),L){this.ctx.fontSize=this.pdf.internal.getFontSize();var ae=new p(this.ctx);this.ctxStack.push(this.ctx),this.ctx=ae}},g.prototype.restore=function(L){L=typeof L!="boolean"||L;for(var U=this.pdf.internal.getCurrentPageInfo().pageNumber,H=0;H<this.pdf.internal.getNumberOfPages();H++)this.pdf.setPage(H+1),this.pdf.internal.out("Q");this.pdf.setPage(U),L&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},g.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var b=function(L){var U,H,ae,de;if(L.isCanvasGradient===!0&&(L=L.getColor()),!L)return{r:0,g:0,b:0,a:0,style:L};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(L))U=0,H=0,ae=0,de=0;else{var xe=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(L);if(xe!==null)U=parseInt(xe[1]),H=parseInt(xe[2]),ae=parseInt(xe[3]),de=1;else if((xe=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(L))!==null)U=parseInt(xe[1]),H=parseInt(xe[2]),ae=parseInt(xe[3]),de=parseFloat(xe[4]);else{if(de=1,typeof L=="string"&&L.charAt(0)!=="#"){var he=new z4(L);L=he.ok?he.toHex():"#000000"}L.length===4?(U=L.substring(1,2),U+=U,H=L.substring(2,3),H+=H,ae=L.substring(3,4),ae+=ae):(U=L.substring(1,3),H=L.substring(3,5),ae=L.substring(5,7)),U=parseInt(U,16),H=parseInt(H,16),ae=parseInt(ae,16)}}return{r:U,g:H,b:ae,a:de,style:L}},x=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},w=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};g.prototype.fillText=function(L,U,H,ae){if(isNaN(U)||isNaN(H)||typeof L!="string")throw js.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(ae=isNaN(ae)?void 0:ae,!x.call(this)){var de=ce(this.ctx.transform.rotation),xe=this.ctx.transform.scaleX;q.call(this,{text:L,x:U,y:H,scale:xe,angle:de,align:this.textAlign,maxWidth:ae})}},g.prototype.strokeText=function(L,U,H,ae){if(isNaN(U)||isNaN(H)||typeof L!="string")throw js.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!w.call(this)){ae=isNaN(ae)?void 0:ae;var de=ce(this.ctx.transform.rotation),xe=this.ctx.transform.scaleX;q.call(this,{text:L,x:U,y:H,scale:xe,renderingMode:"stroke",angle:de,align:this.textAlign,maxWidth:ae})}},g.prototype.measureText=function(L){if(typeof L!="string")throw js.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var U=this.pdf,H=this.pdf.internal.scaleFactor,ae=U.internal.getFontSize(),de=U.getStringUnitWidth(L)*ae/U.internal.scaleFactor;return new function(xe){var he=(xe=xe||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return he}}),this}({width:de*=Math.round(96*H/72*1e4)/1e4})},g.prototype.scale=function(L,U){if(isNaN(L)||isNaN(U))throw js.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var H=new d(L,0,0,U,0,0);this.ctx.transform=this.ctx.transform.multiply(H)},g.prototype.rotate=function(L){if(isNaN(L))throw js.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var U=new d(Math.cos(L),Math.sin(L),-Math.sin(L),Math.cos(L),0,0);this.ctx.transform=this.ctx.transform.multiply(U)},g.prototype.translate=function(L,U){if(isNaN(L)||isNaN(U))throw js.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var H=new d(1,0,0,1,L,U);this.ctx.transform=this.ctx.transform.multiply(H)},g.prototype.transform=function(L,U,H,ae,de,xe){if(isNaN(L)||isNaN(U)||isNaN(H)||isNaN(ae)||isNaN(de)||isNaN(xe))throw js.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var he=new d(L,U,H,ae,de,xe);this.ctx.transform=this.ctx.transform.multiply(he)},g.prototype.setTransform=function(L,U,H,ae,de,xe){L=isNaN(L)?1:L,U=isNaN(U)?0:U,H=isNaN(H)?0:H,ae=isNaN(ae)?1:ae,de=isNaN(de)?0:de,xe=isNaN(xe)?0:xe,this.ctx.transform=new d(L,U,H,ae,de,xe)};var v=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};g.prototype.drawImage=function(L,U,H,ae,de,xe,he,me,ve){var Re=this.pdf.getImageProperties(L),Ke=1,Ge=1,ke=1,X=1;ae!==void 0&&me!==void 0&&(ke=me/ae,X=ve/de,Ke=Re.width/ae*me/ae,Ge=Re.height/de*ve/de),xe===void 0&&(xe=U,he=H,U=0,H=0),ae!==void 0&&me===void 0&&(me=ae,ve=de),ae===void 0&&me===void 0&&(me=Re.width,ve=Re.height);var Pe=this.ctx.transform.decompose(),gt=ce(Pe.rotate.shx),bt=new d,Ye=(bt=(bt=(bt=bt.multiply(Pe.translate)).multiply(Pe.skew)).multiply(Pe.scale)).applyToRectangle(new l(xe-U*ke,he-H*X,ae*Ke,de*Ge));if(this.autoPaging){for(var Et,vt=_.call(this,Ye),st=[],St=0;St<vt.length;St+=1)st.indexOf(vt[St])===-1&&st.push(vt[St]);k(st);for(var Pt=st[0],Ut=st[st.length-1],je=Pt;je<Ut+1;je++){this.pdf.setPage(je);var Me=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Fe=je===1?this.posY+this.margin[0]:this.margin[0],ue=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Te=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Oe=je===1?0:ue+(je-2)*Te;if(this.ctx.clip_path.length!==0){var ct=this.path;Et=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=E(Et,this.posX+this.margin[3],-Oe+Fe+this.ctx.prevPageLastElemOffset),P.call(this,"fill",!0),this.path=ct}var ft=JSON.parse(JSON.stringify(Ye));ft=E([ft],this.posX+this.margin[3],-Oe+Fe+this.ctx.prevPageLastElemOffset)[0];var wt=(je>Pt||je<Ut)&&v.call(this);wt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Me,Te,null).clip().discardPath()),this.pdf.addImage(L,"JPEG",ft.x,ft.y,ft.w,ft.h,null,null,gt),wt&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(L,"JPEG",Ye.x,Ye.y,Ye.w,Ye.h,null,null,gt)};var _=function(L,U,H){var ae=[];U=U||this.pdf.internal.pageSize.width,H=H||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var de=this.posY+this.ctx.prevPageLastElemOffset;switch(L.type){default:case"mt":case"lt":ae.push(Math.floor((L.y+de)/H)+1);break;case"arc":ae.push(Math.floor((L.y+de-L.radius)/H)+1),ae.push(Math.floor((L.y+de+L.radius)/H)+1);break;case"qct":var xe=ye(this.ctx.lastPoint.x,this.ctx.lastPoint.y,L.x1,L.y1,L.x,L.y);ae.push(Math.floor((xe.y+de)/H)+1),ae.push(Math.floor((xe.y+xe.h+de)/H)+1);break;case"bct":var he=Ce(this.ctx.lastPoint.x,this.ctx.lastPoint.y,L.x1,L.y1,L.x2,L.y2,L.x,L.y);ae.push(Math.floor((he.y+de)/H)+1),ae.push(Math.floor((he.y+he.h+de)/H)+1);break;case"rect":ae.push(Math.floor((L.y+de)/H)+1),ae.push(Math.floor((L.y+L.h+de)/H)+1)}for(var me=0;me<ae.length;me+=1)for(;this.pdf.internal.getNumberOfPages()<ae[me];)N.call(this);return ae},N=function(){var L=this.fillStyle,U=this.strokeStyle,H=this.font,ae=this.lineCap,de=this.lineWidth,xe=this.lineJoin;this.pdf.addPage(),this.fillStyle=L,this.strokeStyle=U,this.font=H,this.lineCap=ae,this.lineWidth=de,this.lineJoin=xe},E=function(L,U,H){for(var ae=0;ae<L.length;ae++)switch(L[ae].type){case"bct":L[ae].x2+=U,L[ae].y2+=H;case"qct":L[ae].x1+=U,L[ae].y1+=H;default:L[ae].x+=U,L[ae].y+=H}return L},k=function(L){return L.sort(function(U,H){return U-H})},T=function(L,U){var H=this.fillStyle,ae=this.strokeStyle,de=this.lineCap,xe=this.lineWidth,he=Math.abs(xe*this.ctx.transform.scaleX),me=this.lineJoin;if(this.autoPaging){for(var ve,Re,Ke=JSON.parse(JSON.stringify(this.path)),Ge=JSON.parse(JSON.stringify(this.path)),ke=[],X=0;X<Ge.length;X++)if(Ge[X].x!==void 0)for(var Pe=_.call(this,Ge[X]),gt=0;gt<Pe.length;gt+=1)ke.indexOf(Pe[gt])===-1&&ke.push(Pe[gt]);for(var bt=0;bt<ke.length;bt++)for(;this.pdf.internal.getNumberOfPages()<ke[bt];)N.call(this);k(ke);for(var Ye=ke[0],Et=ke[ke.length-1],vt=Ye;vt<Et+1;vt++){this.pdf.setPage(vt),this.fillStyle=H,this.strokeStyle=ae,this.lineCap=de,this.lineWidth=he,this.lineJoin=me;var st=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],St=vt===1?this.posY+this.margin[0]:this.margin[0],Pt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ut=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],je=vt===1?0:Pt+(vt-2)*Ut;if(this.ctx.clip_path.length!==0){var Me=this.path;ve=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=E(ve,this.posX+this.margin[3],-je+St+this.ctx.prevPageLastElemOffset),P.call(this,L,!0),this.path=Me}if(Re=JSON.parse(JSON.stringify(Ke)),this.path=E(Re,this.posX+this.margin[3],-je+St+this.ctx.prevPageLastElemOffset),U===!1||vt===0){var Fe=(vt>Ye||vt<Et)&&v.call(this);Fe&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],st,Ut,null).clip().discardPath()),P.call(this,L,U),Fe&&this.pdf.restoreGraphicsState()}this.lineWidth=xe}this.path=Ke}else this.lineWidth=he,P.call(this,L,U),this.lineWidth=xe},P=function(L,U){if((L!=="stroke"||U||!w.call(this))&&(L==="stroke"||U||!x.call(this))){for(var H,ae,de=[],xe=this.path,he=0;he<xe.length;he++){var me=xe[he];switch(me.type){case"begin":de.push({begin:!0});break;case"close":de.push({close:!0});break;case"mt":de.push({start:me,deltas:[],abs:[]});break;case"lt":var ve=de.length;if(xe[he-1]&&!isNaN(xe[he-1].x)&&(H=[me.x-xe[he-1].x,me.y-xe[he-1].y],ve>0)){for(;ve>=0;ve--)if(de[ve-1].close!==!0&&de[ve-1].begin!==!0){de[ve-1].deltas.push(H),de[ve-1].abs.push(me);break}}break;case"bct":H=[me.x1-xe[he-1].x,me.y1-xe[he-1].y,me.x2-xe[he-1].x,me.y2-xe[he-1].y,me.x-xe[he-1].x,me.y-xe[he-1].y],de[de.length-1].deltas.push(H);break;case"qct":var Re=xe[he-1].x+2/3*(me.x1-xe[he-1].x),Ke=xe[he-1].y+2/3*(me.y1-xe[he-1].y),Ge=me.x+2/3*(me.x1-me.x),ke=me.y+2/3*(me.y1-me.y),X=me.x,Pe=me.y;H=[Re-xe[he-1].x,Ke-xe[he-1].y,Ge-xe[he-1].x,ke-xe[he-1].y,X-xe[he-1].x,Pe-xe[he-1].y],de[de.length-1].deltas.push(H);break;case"arc":de.push({deltas:[],abs:[],arc:!0}),Array.isArray(de[de.length-1].abs)&&de[de.length-1].abs.push(me)}}ae=U?null:L==="stroke"?"stroke":"fill";for(var gt=!1,bt=0;bt<de.length;bt++)if(de[bt].arc)for(var Ye=de[bt].abs,Et=0;Et<Ye.length;Et++){var vt=Ye[Et];vt.type==="arc"?$.call(this,vt.x,vt.y,vt.radius,vt.startAngle,vt.endAngle,vt.counterclockwise,void 0,U,!gt):J.call(this,vt.x,vt.y),gt=!0}else if(de[bt].close===!0)this.pdf.internal.out("h"),gt=!1;else if(de[bt].begin!==!0){var st=de[bt].start.x,St=de[bt].start.y;Z.call(this,de[bt].deltas,st,St),gt=!0}ae&&z.call(this,ae),U&&G.call(this)}},O=function(L){var U=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,H=U*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return L-H;case"top":return L+U-H;case"hanging":return L+U-2*H;case"middle":return L+U/2-H;default:return L}},F=function(L){return L+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};g.prototype.createLinearGradient=function(){var L=function(){};return L.colorStops=[],L.addColorStop=function(U,H){this.colorStops.push([U,H])},L.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},L.isCanvasGradient=!0,L},g.prototype.createPattern=function(){return this.createLinearGradient()},g.prototype.createRadialGradient=function(){return this.createLinearGradient()};var $=function(L,U,H,ae,de,xe,he,me,ve){for(var Re=K.call(this,H,ae,de,xe),Ke=0;Ke<Re.length;Ke++){var Ge=Re[Ke];Ke===0&&(ve?R.call(this,Ge.x1+L,Ge.y1+U):J.call(this,Ge.x1+L,Ge.y1+U)),le.call(this,L,U,Ge.x2,Ge.y2,Ge.x3,Ge.y3,Ge.x4,Ge.y4)}me?G.call(this):z.call(this,he)},z=function(L){switch(L){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},G=function(){this.pdf.clip(),this.pdf.discardPath()},R=function(L,U){this.pdf.internal.out(t(L)+" "+n(U)+" m")},q=function(L){var U;switch(L.align){case"right":case"end":U="right";break;case"center":U="center";break;default:U="left"}var H,ae,de,xe=this.pdf.getTextDimensions(L.text),he=O.call(this,L.y),me=F.call(this,he)-xe.h,ve=this.ctx.transform.applyToPoint(new o(L.x,he));if(this.autoPaging){var Re=this.ctx.transform.decompose(),Ke=new d;Ke=(Ke=(Ke=Ke.multiply(Re.translate)).multiply(Re.skew)).multiply(Re.scale);for(var Ge=this.ctx.transform.applyToRectangle(new l(L.x,he,xe.w,xe.h)),ke=Ke.applyToRectangle(new l(L.x,me,xe.w,xe.h)),X=_.call(this,ke),Pe=[],gt=0;gt<X.length;gt+=1)Pe.indexOf(X[gt])===-1&&Pe.push(X[gt]);k(Pe);for(var bt=Pe[0],Ye=Pe[Pe.length-1],Et=bt;Et<Ye+1;Et++){this.pdf.setPage(Et);var vt=Et===1?this.posY+this.margin[0]:this.margin[0],st=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],St=this.pdf.internal.pageSize.height-this.margin[2],Pt=St-this.margin[0],Ut=this.pdf.internal.pageSize.width-this.margin[1],je=Ut-this.margin[3],Me=Et===1?0:st+(Et-2)*Pt;if(this.ctx.clip_path.length!==0){var Fe=this.path;H=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=E(H,this.posX+this.margin[3],-1*Me+vt),P.call(this,"fill",!0),this.path=Fe}var ue=E([JSON.parse(JSON.stringify(ke))],this.posX+this.margin[3],-Me+vt+this.ctx.prevPageLastElemOffset)[0];L.scale>=.01&&(ae=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ae*L.scale),de=this.lineWidth,this.lineWidth=de*L.scale);var Te=this.autoPaging!=="text";if(Te||ue.y+ue.h<=St){if(Te||ue.y>=vt&&ue.x<=Ut){var Oe=Te?L.text:this.pdf.splitTextToSize(L.text,L.maxWidth||Ut-ue.x)[0],ct=E([JSON.parse(JSON.stringify(Ge))],this.posX+this.margin[3],-Me+vt+this.ctx.prevPageLastElemOffset)[0],ft=Te&&(Et>bt||Et<Ye)&&v.call(this);ft&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],je,Pt,null).clip().discardPath()),this.pdf.text(Oe,ct.x,ct.y,{angle:L.angle,align:U,renderingMode:L.renderingMode}),ft&&this.pdf.restoreGraphicsState()}}else ue.y<St&&(this.ctx.prevPageLastElemOffset+=St-ue.y);L.scale>=.01&&(this.pdf.setFontSize(ae),this.lineWidth=de)}}else L.scale>=.01&&(ae=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ae*L.scale),de=this.lineWidth,this.lineWidth=de*L.scale),this.pdf.text(L.text,ve.x+this.posX,ve.y+this.posY,{angle:L.angle,align:U,renderingMode:L.renderingMode,maxWidth:L.maxWidth}),L.scale>=.01&&(this.pdf.setFontSize(ae),this.lineWidth=de)},J=function(L,U,H,ae){H=H||0,ae=ae||0,this.pdf.internal.out(t(L+H)+" "+n(U+ae)+" l")},Z=function(L,U,H){return this.pdf.lines(L,U,H,null,null)},le=function(L,U,H,ae,de,xe,he,me){this.pdf.internal.out([e(r(H+L)),e(i(ae+U)),e(r(de+L)),e(i(xe+U)),e(r(he+L)),e(i(me+U)),"c"].join(" "))},K=function(L,U,H,ae){for(var de=2*Math.PI,xe=Math.PI/2;U>H;)U-=de;var he=Math.abs(H-U);he<de&&ae&&(he=de-he);for(var me=[],ve=ae?-1:1,Re=U;he>1e-5;){var Ke=Re+ve*Math.min(he,xe);me.push(se.call(this,L,Re,Ke)),he-=Math.abs(Ke-Re),Re=Ke}return me},se=function(L,U,H){var ae=(H-U)/2,de=L*Math.cos(ae),xe=L*Math.sin(ae),he=de,me=-xe,ve=he*he+me*me,Re=ve+he*de+me*xe,Ke=4/3*(Math.sqrt(2*ve*Re)-Re)/(he*xe-me*de),Ge=he-Ke*me,ke=me+Ke*he,X=Ge,Pe=-ke,gt=ae+U,bt=Math.cos(gt),Ye=Math.sin(gt);return{x1:L*Math.cos(U),y1:L*Math.sin(U),x2:Ge*bt-ke*Ye,y2:Ge*Ye+ke*bt,x3:X*bt-Pe*Ye,y3:X*Ye+Pe*bt,x4:L*Math.cos(H),y4:L*Math.sin(H)}},ce=function(L){return 180*L/Math.PI},ye=function(L,U,H,ae,de,xe){var he=L+.5*(H-L),me=U+.5*(ae-U),ve=de+.5*(H-de),Re=xe+.5*(ae-xe),Ke=Math.min(L,de,he,ve),Ge=Math.max(L,de,he,ve),ke=Math.min(U,xe,me,Re),X=Math.max(U,xe,me,Re);return new l(Ke,ke,Ge-Ke,X-ke)},Ce=function(L,U,H,ae,de,xe,he,me){var ve,Re,Ke,Ge,ke,X,Pe,gt,bt,Ye,Et,vt,st,St,Pt=H-L,Ut=ae-U,je=de-H,Me=xe-ae,Fe=he-de,ue=me-xe;for(Re=0;Re<41;Re++)bt=(Pe=(Ke=L+(ve=Re/40)*Pt)+ve*((ke=H+ve*je)-Ke))+ve*(ke+ve*(de+ve*Fe-ke)-Pe),Ye=(gt=(Ge=U+ve*Ut)+ve*((X=ae+ve*Me)-Ge))+ve*(X+ve*(xe+ve*ue-X)-gt),Re==0?(Et=bt,vt=Ye,st=bt,St=Ye):(Et=Math.min(Et,bt),vt=Math.min(vt,Ye),st=Math.max(st,bt),St=Math.max(St,Ye));return new l(Math.round(Et),Math.round(vt),Math.round(st-Et),Math.round(St-vt))},M=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var L,U,H=(L=this.ctx.lineDash,U=this.ctx.lineDashOffset,JSON.stringify({lineDash:L,lineDashOffset:U}));this.prevLineDash!==H&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=H)}}})(nn.API),(function(s){var e=function(o){var l,d,h,p,g,b,x,w,v,_;for(d=[],h=0,p=(o+=l="\0\0\0\0".slice(o.length%4||4)).length;p>h;h+=4)(g=(o.charCodeAt(h)<<24)+(o.charCodeAt(h+1)<<16)+(o.charCodeAt(h+2)<<8)+o.charCodeAt(h+3))!==0?(b=(g=((g=((g=((g=(g-(_=g%85))/85)-(v=g%85))/85)-(w=g%85))/85)-(x=g%85))/85)%85,d.push(b+33,x+33,w+33,v+33,_+33)):d.push(122);return(function(N,E){for(var k=E;k>0;k--)N.pop()})(d,l.length),String.fromCharCode.apply(String,d)+"~>"},t=function(o){var l,d,h,p,g,b=String,x="length",w=255,v="charCodeAt",_="slice",N="replace";for(o[_](-2),o=o[_](0,-2)[N](/\s/g,"")[N]("z","!!!!!"),h=[],p=0,g=(o+=l="uuuuu"[_](o[x]%5||5))[x];g>p;p+=5)d=52200625*(o[v](p)-33)+614125*(o[v](p+1)-33)+7225*(o[v](p+2)-33)+85*(o[v](p+3)-33)+(o[v](p+4)-33),h.push(w&d>>24,w&d>>16,w&d>>8,w&d);return(function(E,k){for(var T=k;T>0;T--)E.pop()})(h,l[x]),b.fromCharCode.apply(b,h)},n=function(o){return o.split("").map(function(l){return("0"+l.charCodeAt().toString(16)).slice(-2)}).join("")+">"},r=function(o){var l=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),l.test(o)===!1)return"";for(var d="",h=0;h<o.length;h+=2)d+=String.fromCharCode("0x"+(o[h]+o[h+1]));return d},i=function(o){for(var l=new Uint8Array(o.length),d=o.length;d--;)l[d]=o.charCodeAt(d);return(l=X1(l)).reduce(function(h,p){return h+String.fromCharCode(p)},"")};s.processDataByFilters=function(o,l){var d=0,h=o||"",p=[];for(typeof(l=l||[])=="string"&&(l=[l]),d=0;d<l.length;d+=1)switch(l[d]){case"ASCII85Decode":case"/ASCII85Decode":h=t(h),p.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":h=e(h),p.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":h=r(h),p.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":h=n(h),p.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":h=i(h),p.push("/FlateDecode");break;default:throw new Error('The filter: "'+l[d]+'" is not implemented')}return{data:h,reverseChain:p.reverse().join(" ")}}})(nn.API),(function(s){s.loadFile=function(e,t,n){return(function(r,i,o){i=i!==!1,o=typeof o=="function"?o:function(){};var l=void 0;try{l=(function(d,h,p){var g=new XMLHttpRequest,b=0,x=function(w){var v=w.length,_=[],N=String.fromCharCode;for(b=0;b<v;b+=1)_.push(N(255&w.charCodeAt(b)));return _.join("")};if(g.open("GET",d,!h),g.overrideMimeType("text/plain; charset=x-user-defined"),h===!1&&(g.onload=function(){g.status===200?p(x(this.responseText)):p(void 0)}),g.send(null),h&&g.status===200)return x(g.responseText)})(r,i,o)}catch{}return l})(e,t,n)},s.allowFsRead=void 0,s.loadImageFile=s.loadFile})(nn.API),(function(s){function e(){return(vn.html2canvas?Promise.resolve(vn.html2canvas):Gx(()=>import("./html2canvas.esm-DXEQVQnt.js"),[])).catch(function(l){return Promise.reject(new Error("Could not load html2canvas: "+l))}).then(function(l){return l.default?l.default:l})}function t(){return(vn.DOMPurify?Promise.resolve(vn.DOMPurify):Gx(()=>import("./purify.es-Bzr520pe.js"),[])).catch(function(l){return Promise.reject(new Error("Could not load dompurify: "+l))}).then(function(l){return l.default?l.default:l})}var n=function(l){var d=gs(l);return d==="undefined"?"undefined":d==="string"||l instanceof String?"string":d==="number"||l instanceof Number?"number":d==="function"||l instanceof Function?"function":l&&l.constructor===Array?"array":l&&l.nodeType===1?"element":d==="object"?"object":"unknown"},r=function(l,d){var h=document.createElement(l);for(var p in d.className&&(h.className=d.className),d.innerHTML&&d.dompurify&&(h.innerHTML=d.dompurify.sanitize(d.innerHTML)),d.style)h.style[p]=d.style[p];return h},i=function l(d,h){for(var p=d.nodeType===3?document.createTextNode(d.nodeValue):d.cloneNode(!1),g=d.firstChild;g;g=g.nextSibling)h!==!0&&g.nodeType===1&&g.nodeName==="SCRIPT"||p.appendChild(l(g,h));return d.nodeType===1&&(d.nodeName==="CANVAS"?(p.width=d.width,p.height=d.height,p.getContext("2d").drawImage(d,0,0)):d.nodeName!=="TEXTAREA"&&d.nodeName!=="SELECT"||(p.value=d.value),p.addEventListener("load",function(){p.scrollTop=d.scrollTop,p.scrollLeft=d.scrollLeft},!0)),p},o=function l(d){var h=Object.assign(l.convert(Promise.resolve()),JSON.parse(JSON.stringify(l.template))),p=l.convert(Promise.resolve(),h);return(p=p.setProgress(1,l,1,[l])).set(d)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(l,d){return l.__proto__=d||o.prototype,l},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(l,d){return this.then(function(){switch(d=d||(function(h){switch(n(h)){case"string":return"string";case"element":return h.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(l),d){case"string":return this.then(t).then(function(h){return this.set({src:r("div",{innerHTML:l,dompurify:h})})});case"element":return this.set({src:l});case"canvas":return this.set({canvas:l});case"img":return this.set({img:l});default:return this.error("Unknown source type.")}})},o.prototype.to=function(l){switch(l){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var l={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},d=i(this.prop.src,this.opt.html2canvas.javascriptEnabled);d.tagName==="BODY"&&(l.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=r("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=r("div",{className:"html2pdf__container",style:l}),this.prop.container.appendChild(d),this.prop.container.firstChild.appendChild(r("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(d){var h=Object.assign({},this.opt.html2canvas);return delete h.onrendered,d(this.prop.container,h)}).then(function(d){(this.opt.html2canvas.onrendered||function(){})(d),this.prop.canvas=d,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(d){var h=this.opt.jsPDF,p=this.opt.fontFaces,g=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,b=Object.assign({async:!0,allowTaint:!0,scale:g,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete b.onrendered,h.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,h.context2d.posX=this.opt.x,h.context2d.posY=this.opt.y,h.context2d.margin=this.opt.margin,h.context2d.fontFaces=p,p)for(var x=0;x<p.length;++x){var w=p[x],v=w.src.find(function(_){return _.format==="truetype"});v&&h.addFont(v.url,w.ref.name,w.ref.style)}return b.windowHeight=b.windowHeight||0,b.windowHeight=b.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):b.windowHeight,h.context2d.save(!0),d(this.prop.container,b)}).then(function(d){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(d),this.prop.canvas=d,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var l=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=l})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(l,d,h){return(h=h||"pdf").toLowerCase()==="img"||h.toLowerCase()==="image"?this.outputImg(l,d):this.outputPdf(l,d)},o.prototype.outputPdf=function(l,d){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(l,d)})},o.prototype.outputImg=function(l){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(l){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+l+'" is not supported.'}})},o.prototype.save=function(l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(l?{filename:l}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(l){if(n(l)!=="object")return this;var d=Object.keys(l||{}).map(function(h){if(h in o.template.prop)return function(){this.prop[h]=l[h]};switch(h){case"margin":return this.setMargin.bind(this,l.margin);case"jsPDF":return function(){return this.opt.jsPDF=l.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,l.pageSize);default:return function(){this.opt[h]=l[h]}}},this);return this.then(function(){return this.thenList(d)})},o.prototype.get=function(l,d){return this.then(function(){var h=l in o.template.prop?this.prop[l]:this.opt[l];return d?d(h):h})},o.prototype.setMargin=function(l){return this.then(function(){switch(n(l)){case"number":l=[l,l,l,l];case"array":if(l.length===2&&(l=[l[0],l[1],l[0],l[1]]),l.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=l}).then(this.setPageSize)},o.prototype.setPageSize=function(l){function d(h,p){return Math.floor(h*p/72*96)}return this.then(function(){(l=l||nn.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(l.inner={width:l.width-this.opt.margin[1]-this.opt.margin[3],height:l.height-this.opt.margin[0]-this.opt.margin[2]},l.inner.px={width:d(l.inner.width,l.k),height:d(l.inner.height,l.k)},l.inner.ratio=l.inner.height/l.inner.width),this.prop.pageSize=l})},o.prototype.setProgress=function(l,d,h,p){return l!=null&&(this.progress.val=l),d!=null&&(this.progress.state=d),h!=null&&(this.progress.n=h),p!=null&&(this.progress.stack=p),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(l,d,h,p){return this.setProgress(l?this.progress.val+l:null,d||null,h?this.progress.n+h:null,p?this.progress.stack.concat(p):null)},o.prototype.then=function(l,d){var h=this;return this.thenCore(l,d,function(p,g){return h.updateProgress(null,null,1,[p]),Promise.prototype.then.call(this,function(b){return h.updateProgress(null,p),b}).then(p,g).then(function(b){return h.updateProgress(1),b})})},o.prototype.thenCore=function(l,d,h){h=h||Promise.prototype.then;var p=this;l&&(l=l.bind(p)),d&&(d=d.bind(p));var g=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?p:o.convert(Object.assign({},p),Promise.prototype),b=h.call(g,l,d);return o.convert(b,p.__proto__)},o.prototype.thenExternal=function(l,d){return Promise.prototype.then.call(this,l,d)},o.prototype.thenList=function(l){var d=this;return l.forEach(function(h){d=d.thenCore(h)}),d},o.prototype.catch=function(l){l&&(l=l.bind(this));var d=Promise.prototype.catch.call(this,l);return o.convert(d,this)},o.prototype.catchExternal=function(l){return Promise.prototype.catch.call(this,l)},o.prototype.error=function(l){return this.then(function(){throw new Error(l)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,nn.getPageSize=function(l,d,h){if(gs(l)==="object"){var p=l;l=p.orientation,d=p.unit||d,h=p.format||h}d=d||"mm",h=h||"a4",l=(""+(l||"P")).toLowerCase();var g,b=(""+h).toLowerCase(),x={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(d){case"pt":g=1;break;case"mm":g=72/25.4;break;case"cm":g=72/2.54;break;case"in":g=72;break;case"px":g=.75;break;case"pc":case"em":g=12;break;case"ex":g=6;break;default:throw"Invalid unit: "+d}var w,v=0,_=0;if(x.hasOwnProperty(b))v=x[b][1]/g,_=x[b][0]/g;else try{v=h[1],_=h[0]}catch{throw new Error("Invalid format: "+h)}if(l==="p"||l==="portrait")l="p",_>v&&(w=_,_=v,v=w);else{if(l!=="l"&&l!=="landscape")throw"Invalid orientation: "+l;l="l",v>_&&(w=_,_=v,v=w)}return{width:_,height:v,unit:d,k:g,orientation:l}},s.html=function(l,d){(d=d||{}).callback=d.callback||function(){},d.html2canvas=d.html2canvas||{},d.html2canvas.canvas=d.html2canvas.canvas||this.canvas,d.jsPDF=d.jsPDF||this,d.fontFaces=d.fontFaces?d.fontFaces.map(c1):null;var h=new o(d);return d.worker?h:h.from(l).doCallback()}})(nn.API),nn.API.addJS=function(s){var e,t,n=s;return this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(e+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+n+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){e!==void 0&&t!==void 0&&this.internal.out("/Names <</JavaScript "+e+" 0 R>>")}),this},(function(s){var e;s.events.push(["postPutResources",function(){var t=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var r=t.outline.render().split(/\r\n/),i=0;i<r.length;i++){var o=r[i],l=n.exec(o);if(l!=null){var d=l[1];t.internal.newObjectDeferredBegin(d,!1)}t.internal.write(o)}if(this.outline.createNamedDestinations){var h=this.internal.pages.length,p=[];for(i=0;i<h;i++){var g=t.internal.newObject();p.push(g);var b=t.internal.getPageInfo(i+1);t.internal.write("<< /D["+b.objId+" 0 R /XYZ null null null]>> endobj")}var x=t.internal.newObject();for(t.internal.write("<< /Names [ "),i=0;i<p.length;i++)t.internal.write("(page_"+(i+1)+")"+p[i]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+x+" 0 R"),t.internal.write(">>","endobj")}}]),s.events.push(["putCatalog",function(){var t=this;t.outline.root.children.length>0&&(t.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&t.internal.write("/Names "+e+" 0 R"))}]),s.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(n,r,i){var o={title:r,options:i,children:[]};return n==null&&(n=this.root),n.children.push(o),o},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(n){n.id=t.internal.newObjectDeferred();for(var r=0;r<n.children.length;r++)this.genIds_r(n.children[r])},t.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},t.outline.renderItems=function(n){for(var r=this.ctx.pdf.internal.getVerticalCoordinateString,i=0;i<n.children.length;i++){var o=n.children[i];this.objStart(o),this.line("/Title "+this.makeString(o.title)),this.line("/Parent "+this.makeRef(n)),i>0&&this.line("/Prev "+this.makeRef(n.children[i-1])),i<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[i+1])),o.children.length>0&&(this.line("/First "+this.makeRef(o.children[0])),this.line("/Last "+this.makeRef(o.children[o.children.length-1])));var l=this.count=this.count_r({count:0},o);if(l>0&&this.line("/Count "+l),o.options&&o.options.pageNumber){var d=t.internal.getPageInfo(o.options.pageNumber);this.line("/Dest ["+d.objId+" 0 R /XYZ 0 "+r(0)+" 0]")}this.objEnd()}for(var h=0;h<n.children.length;h++)this.renderItems(n.children[h])},t.outline.line=function(n){this.ctx.val+=n+`\r
`},t.outline.makeRef=function(n){return n.id+" 0 R"},t.outline.makeString=function(n){return"("+t.internal.pdfEscape(n)+")"},t.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(n,r){for(var i=0;i<r.children.length;i++)n.count++,this.count_r(n,r.children[i]);return n.count}}])})(nn.API),(function(s){var e=[192,193,194,195,196,197,198,199];s.processJPEG=function(t,n,r,i,o,l){var d,h=this.decode.DCT_DECODE,p=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=o||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,d=(function(g){for(var b,x=256*g.charCodeAt(4)+g.charCodeAt(5),w=g.length,v={width:0,height:0,numcomponents:1},_=4;_<w;_+=2){if(_+=x,e.indexOf(g.charCodeAt(_+1))!==-1){b=256*g.charCodeAt(_+5)+g.charCodeAt(_+6),v={width:256*g.charCodeAt(_+7)+g.charCodeAt(_+8),height:b,numcomponents:g.charCodeAt(_+9)};break}x=256*g.charCodeAt(_+2)+g.charCodeAt(_+3)}return v})(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t),d.numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}p={data:t,width:d.width,height:d.height,colorSpace:l,bitsPerComponent:8,filter:h,index:n,alias:r}}return p}})(nn.API),nn.API.processPNG=function(s,e,t,n){if(this.__addimage__.isArrayBuffer(s)&&(s=new Uint8Array(s)),this.__addimage__.isArrayBufferView(s)){var r,i=g7(s,{checkCrc:!0}),o=i.width,l=i.height,d=i.channels,h=i.palette,p=i.depth;r=h&&d===1?(function($){for(var z=$.width,G=$.height,R=$.data,q=$.palette,J=$.depth,Z=!1,le=[],K=[],se=void 0,ce=!1,ye=0,Ce=0;Ce<q.length;Ce++){var M=S5(q[Ce],4),L=M[0],U=M[1],H=M[2],ae=M[3];le.push(L,U,H),ae!=null&&(ae===0?(ye++,K.length<1&&K.push(Ce)):ae<255&&(ce=!0))}if(ce||ye>1){Z=!0,K=void 0;var de=z*G;se=new Uint8Array(de);for(var xe=new DataView(R.buffer),he=0;he<de;he++){var me=d1(xe,he,J),ve=S5(q[me],4)[3];se[he]=ve}}else ye===0&&(K=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:Z?8:void 0,colorBytes:R,alphaBytes:se,needSMask:Z,palette:le,mask:K}})(i):d===2||d===4?(function($){for(var z=$.data,G=$.width,R=$.height,q=$.channels,J=$.depth,Z=q===2?"DeviceGray":"DeviceRGB",le=q-1,K=G*R,se=le,ce=K*se,ye=1*K,Ce=Math.ceil(ce*J/8),M=Math.ceil(ye*J/8),L=new Uint8Array(Ce),U=new Uint8Array(M),H=new DataView(z.buffer),ae=new DataView(L.buffer),de=new DataView(U.buffer),xe=!1,he=0;he<K;he++){for(var me=he*q,ve=0;ve<se;ve++)NS(ae,d1(H,me+ve,J),he*se+ve,J);var Re=d1(H,me+se,J);Re<(1<<J)-1&&(xe=!0),NS(de,Re,1*he,J)}return{colorSpace:Z,colorsPerPixel:le,sMaskBitsPerComponent:xe?J:void 0,colorBytes:L,alphaBytes:U,needSMask:xe}})(i):(function($){var z=$.data,G=$.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:G,colorsPerPixel:G==="DeviceGray"?1:3,colorBytes:z instanceof Uint16Array?(function(R){for(var q=R.length,J=new Uint8Array(2*q),Z=new DataView(J.buffer,J.byteOffset,J.byteLength),le=0;le<q;le++)Z.setUint16(2*le,R[le],!1);return J})(z):z,needSMask:!1}})(i);var g,b,x,w=r,v=w.colorSpace,_=w.colorsPerPixel,N=w.sMaskBitsPerComponent,E=w.colorBytes,k=w.alphaBytes,T=w.needSMask,P=w.palette,O=w.mask,F=null;return n!==nn.API.image_compression.NONE&&typeof X1=="function"?(F=(function($){var z;switch($){case nn.API.image_compression.FAST:z=11;break;case nn.API.image_compression.MEDIUM:z=13;break;case nn.API.image_compression.SLOW:z=14;break;default:z=12}return z})(n),g=this.decode.FLATE_DECODE,b="/Predictor ".concat(F," /Colors ").concat(_," /BitsPerComponent ").concat(p," /Columns ").concat(o),s=vS(E,Math.ceil(o*_*p/8),_,p,n),T&&(x=vS(k,Math.ceil(o*N/8),1,N,n))):(g=void 0,b=void 0,s=E,T&&(x=k)),(this.__addimage__.isArrayBuffer(s)||this.__addimage__.isArrayBufferView(s))&&(s=this.__addimage__.arrayBufferToBinaryString(s)),(x&&this.__addimage__.isArrayBuffer(x)||this.__addimage__.isArrayBufferView(x))&&(x=this.__addimage__.arrayBufferToBinaryString(x)),{alias:t,data:s,index:e,filter:g,decodeParameters:b,transparency:O,palette:P,sMask:x,predictor:F,width:o,height:l,bitsPerComponent:p,sMaskBitsPerComponent:N,colorSpace:v}}},(function(s){s.processGIF89A=function(e,t,n,r){var i=new O7(e),o=i.width,l=i.height,d=[];i.decodeAndBlitFrameRGBA(0,d);var h={data:d,width:o,height:l},p=new h1(100).encode(h,100);return s.processJPEG.call(this,p,t,n,r)},s.processGIF87A=s.processGIF89A})(nn.API),No.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var s=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(s);for(var e=0;e<s;e++){var t=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:r,green:n,blue:t,quad:i}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},No.prototype.parseBGR=function(){this.pos=this.offset;var s="bit"+this.bitPP,e=this.width*this.height*4;if(e>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");this.data=new Uint8Array(e);try{this[s]()}catch(t){js.log("bit decode error:"+t)}},No.prototype.bit1=function(){var s,e=Math.ceil(this.width/8),t=e%4;for(s=this.height-1;s>=0;s--){for(var n=this.bottom_up?s:this.height-1-s,r=0;r<e;r++)for(var i=this.datav.getUint8(this.pos++,!0),o=n*this.width*4+8*r*4,l=0;l<8&&8*r+l<this.width;l++){var d=this.palette[i>>7-l&1];this.data[o+4*l]=d.blue,this.data[o+4*l+1]=d.green,this.data[o+4*l+2]=d.red,this.data[o+4*l+3]=255}t!==0&&(this.pos+=4-t)}},No.prototype.bit4=function(){for(var s=Math.ceil(this.width/2),e=s%4,t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,r=0;r<s;r++){var i=this.datav.getUint8(this.pos++,!0),o=n*this.width*4+2*r*4,l=i>>4,d=15&i,h=this.palette[l];if(this.data[o]=h.blue,this.data[o+1]=h.green,this.data[o+2]=h.red,this.data[o+3]=255,2*r+1>=this.width)break;h=this.palette[d],this.data[o+4]=h.blue,this.data[o+4+1]=h.green,this.data[o+4+2]=h.red,this.data[o+4+3]=255}e!==0&&(this.pos+=4-e)}},No.prototype.bit8=function(){for(var s=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),i=t*this.width*4+4*n;if(r<this.palette.length){var o=this.palette[r];this.data[i]=o.red,this.data[i+1]=o.green,this.data[i+2]=o.blue,this.data[i+3]=255}else this.data[i]=255,this.data[i+1]=255,this.data[i+2]=255,this.data[i+3]=255}s!==0&&(this.pos+=4-s)}},No.prototype.bit15=function(){for(var s=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var i=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(i&e)/e*255|0,l=(i>>5&e)/e*255|0,d=(i>>10&e)/e*255|0,h=i>>15?255:0,p=n*this.width*4+4*r;this.data[p]=d,this.data[p+1]=l,this.data[p+2]=o,this.data[p+3]=h}this.pos+=s}},No.prototype.bit16=function(){for(var s=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,i=0;i<this.width;i++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(o&e)/e*255|0,d=(o>>5&t)/t*255|0,h=(o>>11)/e*255|0,p=r*this.width*4+4*i;this.data[p]=h,this.data[p+1]=d,this.data[p+2]=l,this.data[p+3]=255}this.pos+=s}},No.prototype.bit24=function(){for(var s=this.height-1;s>=0;s--){for(var e=this.bottom_up?s:this.height-1-s,t=0;t<this.width;t++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*t;this.data[o]=i,this.data[o+1]=r,this.data[o+2]=n,this.data[o+3]=255}this.pos+=this.width%4}},No.prototype.bit32=function(){for(var s=this.height-1;s>=0;s--)for(var e=this.bottom_up?s:this.height-1-s,t=0;t<this.width;t++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),l=e*this.width*4+4*t;this.data[l]=i,this.data[l+1]=r,this.data[l+2]=n,this.data[l+3]=o}},No.prototype.getData=function(){return this.data},(function(s){s.processBMP=function(e,t,n,r){var i=new No(e,!1),o=i.width,l=i.height,d={data:i.getData(),width:o,height:l},h=new h1(100).encode(d,100);return s.processJPEG.call(this,h,t,n,r)}})(nn.API),ES.prototype.getData=function(){return this.data},(function(s){s.processWEBP=function(e,t,n,r){var i=new ES(e),o=i.width,l=i.height,d={data:i.getData(),width:o,height:l},h=new h1(100).encode(d,100);return s.processJPEG.call(this,h,t,n,r)}})(nn.API),nn.API.processRGBA=function(s,e,t){for(var n=s.data,r=n.length,i=new Uint8Array(r/4*3),o=new Uint8Array(r/4),l=0,d=0,h=0;h<r;h+=4){var p=n[h],g=n[h+1],b=n[h+2],x=n[h+3];i[l++]=p,i[l++]=g,i[l++]=b,o[d++]=x}var w=this.__addimage__.arrayBufferToBinaryString(i);return{alpha:this.__addimage__.arrayBufferToBinaryString(o),data:w,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:s.width,height:s.height}},nn.API.setLanguage=function(s){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[s]!==void 0&&(this.internal.languageSettings.languageCode=s,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Hd=nn.API,vp=Hd.getCharWidthsArray=function(s,e){var t,n,r=(e=e||{}).font||this.internal.getFont(),i=e.fontSize||this.internal.getFontSize(),o=e.charSpace||this.internal.getCharSpace(),l=e.widths?e.widths:r.metadata.Unicode.widths,d=l.fof?l.fof:1,h=e.kerning?e.kerning:r.metadata.Unicode.kerning,p=h.fof?h.fof:1,g=e.doKerning!==!1,b=0,x=s.length,w=0,v=l[0]||d,_=[];for(t=0;t<x;t++)n=s.charCodeAt(t),typeof r.metadata.widthOfString=="function"?_.push((r.metadata.widthOfGlyph(r.metadata.characterToGlyph(n))+o*(1e3/i)||0)/1e3):(b=g&&gs(h[n])==="object"&&!isNaN(parseInt(h[n][w],10))?h[n][w]/p:0,_.push((l[n]||v)/d+b)),w=n;return _},xS=Hd.getStringUnitWidth=function(s,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),n=e.font||this.internal.getFont(),r=e.charSpace||this.internal.getCharSpace();return Hd.processArabic&&(s=Hd.processArabic(s)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(s,t,r)/t:vp.apply(this,arguments).reduce(function(i,o){return i+o},0)},bS=function(s,e,t,n){for(var r=[],i=0,o=s.length,l=0;i!==o&&l+e[i]<t;)l+=e[i],i++;r.push(s.slice(0,i));var d=i;for(l=0;i!==o;)l+e[i]>n&&(r.push(s.slice(d,i)),l=0,d=i),l+=e[i],i++;return d!==i&&r.push(s.slice(d,i)),r},yS=function(s,e,t){t||(t={});var n,r,i,o,l,d,h,p=[],g=[p],b=t.textIndent||0,x=0,w=0,v=s.split(" "),_=vp.apply(this,[" ",t])[0];if(d=t.lineIndent===-1?v[0].length+2:t.lineIndent||0){var N=Array(d).join(" "),E=[];v.map(function(T){(T=T.split(/\s*\n/)).length>1?E=E.concat(T.map(function(P,O){return(O&&P.length?`
`:"")+P})):E.push(T[0])}),v=E,d=xS.apply(this,[N,t])}for(i=0,o=v.length;i<o;i++){var k=0;if(n=v[i],d&&n[0]==`
`&&(n=n.substr(1),k=1),b+x+(w=(r=vp.apply(this,[n,t])).reduce(function(T,P){return T+P},0))>e||k){if(w>e){for(l=bS.apply(this,[n,r,e-(b+x),e]),p.push(l.shift()),p=[l.pop()];l.length;)g.push([l.shift()]);w=r.slice(n.length-(p[0]?p[0].length:0)).reduce(function(T,P){return T+P},0)}else p=[n];g.push(p),b=w+d,x=_}else p.push(n),b+=x+w,x=_}return h=d?function(T,P){return(P?N:"")+T.join(" ")}:function(T){return T.join(" ")},g.map(h)},Hd.splitTextToSize=function(s,e,t){var n,r=(t=t||{}).fontSize||this.internal.getFontSize(),i=(function(p){if(p.widths&&p.kerning)return{widths:p.widths,kerning:p.kerning};var g=this.internal.getFont(p.fontName,p.fontStyle),b="Unicode";return g.metadata[b]?{widths:g.metadata[b].widths||{0:1},kerning:g.metadata[b].kerning||{}}:{font:g.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);n=Array.isArray(s)?s:String(s).split(/\r?\n/);var o=1*this.internal.scaleFactor*e/r;i.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/r:0,i.lineIndent=t.lineIndent;var l,d,h=[];for(l=0,d=n.length;l<d;l++)h=h.concat(yS.apply(this,[n[l],o,i]));return h},(function(s){s.__fontmetrics__=s.__fontmetrics__||{};for(var e="0123456789abcdef",t="klmnopqrstuvwxyz",n={},r={},i=0;i<16;i++)n[t[i]]=e[i],r[e[i]]=t[i];var o=function(b){return"0x"+parseInt(b,10).toString(16)},l=s.__fontmetrics__.compress=function(b){var x,w,v,_,N=["{"];for(var E in b){if(x=b[E],isNaN(parseInt(E,10))?w="'"+E+"'":(E=parseInt(E,10),w=(w=o(E).slice(2)).slice(0,-1)+r[w.slice(-1)]),typeof x=="number")x<0?(v=o(x).slice(3),_="-"):(v=o(x).slice(2),_=""),v=_+v.slice(0,-1)+r[v.slice(-1)];else{if(gs(x)!=="object")throw new Error("Don't know what to do with value type "+gs(x)+".");v=l(x)}N.push(w+v)}return N.push("}"),N.join("")},d=s.__fontmetrics__.uncompress=function(b){if(typeof b!="string")throw new Error("Invalid argument passed to uncompress.");for(var x,w,v,_,N={},E=1,k=N,T=[],P="",O="",F=b.length-1,$=1;$<F;$+=1)(_=b[$])=="'"?x?(v=x.join(""),x=void 0):x=[]:x?x.push(_):_=="{"?(T.push([k,v]),k={},v=void 0):_=="}"?((w=T.pop())[0][w[1]]=k,v=void 0,k=w[0]):_=="-"?E=-1:v===void 0?n.hasOwnProperty(_)?(P+=n[_],v=parseInt(P,16)*E,E=1,P=""):P+=_:n.hasOwnProperty(_)?(O+=n[_],k[v]=parseInt(O,16)*E,E=1,v=void 0,O=""):O+=_;return N},h={codePages:["WinAnsiEncoding"],WinAnsiEncoding:d("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},p={Unicode:{Courier:h,"Courier-Bold":h,"Courier-BoldOblique":h,"Courier-Oblique":h,Helvetica:h,"Helvetica-Bold":h,"Helvetica-BoldOblique":h,"Helvetica-Oblique":h,"Times-Roman":h,"Times-Bold":h,"Times-BoldItalic":h,"Times-Italic":h}},g={Unicode:{"Courier-Oblique":d("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":d("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":d("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:d("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":d("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":d("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:d("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:d("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":d("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:d("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":d("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":d("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":d("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":d("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};s.events.push(["addFont",function(b){var x=b.font,w=g.Unicode[x.postScriptName];w&&(x.metadata.Unicode={},x.metadata.Unicode.widths=w.widths,x.metadata.Unicode.kerning=w.kerning);var v=p.Unicode[x.postScriptName];v&&(x.metadata.Unicode.encoding=v,x.encoding=v.codePages[0])}])})(nn.API),(function(s){var e=function(t){for(var n=t.length,r=new Uint8Array(n),i=0;i<n;i++)r[i]=t.charCodeAt(i);return r};s.API.events.push(["addFont",function(t){var n=void 0,r=t.font,i=t.instance;if(!r.isStandardFont){if(i===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+r.postScriptName+"').");if(typeof(n=i.existsFileInVFS(r.postScriptName)===!1?i.loadFile(r.postScriptName):i.getFileFromVFS(r.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+r.postScriptName+"').");(function(o,l){l=/^\x00\x01\x00\x00/.test(l)?e(l):e(cg(l)),o.metadata=s.API.TTFFont.open(l),o.metadata.Unicode=o.metadata.Unicode||{encoding:{},kerning:{},widths:[]},o.metadata.glyIdsUsed=[0]})(r,n)}}])})(nn),nn.API.addSvgAsImage=function(s,e,t,n,r,i,o,l){if(isNaN(e)||isNaN(t))throw js.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(n)||isNaN(r))throw js.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var d=document.createElement("canvas");d.width=n,d.height=r;var h=d.getContext("2d");h.fillStyle="#fff",h.fillRect(0,0,d.width,d.height);var p={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},g=this;return(vn.canvg?Promise.resolve(vn.canvg):Gx(()=>import("./index.es-DiCTdf2l.js"),[])).catch(function(b){return Promise.reject(new Error("Could not load canvg: "+b))}).then(function(b){return b.default?b.default:b}).then(function(b){return b.fromString(h,s,p)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(b){return b.render(p)}).then(function(){g.addImage(d.toDataURL("image/jpeg",1),e,t,n,r,o,l)})},nn.API.putTotalPages=function(s){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(s,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(s,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var r=0;r<this.internal.pages[n].length;r++)this.internal.pages[n][r]=this.internal.pages[n][r].replace(e,t);return this},nn.API.viewerPreferences=function(s,e){var t;s=s||{},e=e||!1;var n,r,i,o={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(o),d=[],h=0,p=0,g=0;function b(w,v){var _,N=!1;for(_=0;_<w.length;_+=1)w[_]===v&&(N=!0);return N}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(o)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,s==="reset"||e===!0){var x=l.length;for(g=0;g<x;g+=1)t[l[g]].value=t[l[g]].defaultValue,t[l[g]].explicitSet=!1}if(gs(s)==="object"){for(r in s)if(i=s[r],b(l,r)&&i!==void 0){if(t[r].type==="boolean"&&typeof i=="boolean")t[r].value=i;else if(t[r].type==="name"&&b(t[r].valueSet,i))t[r].value=i;else if(t[r].type==="integer"&&Number.isInteger(i))t[r].value=i;else if(t[r].type==="array"){for(h=0;h<i.length;h+=1)if(n=!0,i[h].length===1&&typeof i[h][0]=="number")d.push(String(i[h]-1));else if(i[h].length>1){for(p=0;p<i[h].length;p+=1)typeof i[h][p]!="number"&&(n=!1);n===!0&&d.push([i[h][0]-1,i[h][1]-1].join(" "))}t[r].value="["+d.join(" ")+"]"}else t[r].value=t[r].defaultValue;t[r].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var w,v=[];for(w in t)t[w].explicitSet===!0&&(t[w].type==="name"?v.push("/"+w+" /"+t[w].value):v.push("/"+w+" "+t[w].value));v.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+v.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},nn.API.addMetadata=function(s,e){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:s,namespaceUri:e??"http://jspdf.default.namespaceuri/",rawXml:typeof e=="boolean"&&e},this.internal.events.subscribe("putCatalog",M7),this.internal.events.subscribe("postPutResources",I7)),this},(function(s){var e=s.API,t=e.pdfEscape16=function(i,o){for(var l,d=o.metadata.Unicode.widths,h=["","0","00","000","0000"],p=[""],g=0,b=i.length;g<b;++g){if(l=o.metadata.characterToGlyph(i.charCodeAt(g)),o.metadata.glyIdsUsed.push(l),o.metadata.toUnicode[l]=i.charCodeAt(g),d.indexOf(l)==-1&&(d.push(l),d.push([parseInt(o.metadata.widthOfGlyph(l),10)])),l=="0")return p.join("");l=l.toString(16),p.push(h[4-l.length],l)}return p.join("")},n=function(i){var o,l,d,h,p,g,b;for(p=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,d=[],g=0,b=(l=Object.keys(i).sort(function(x,w){return x-w})).length;g<b;g++)o=l[g],d.length>=100&&(p+=`
`+d.length+` beginbfchar
`+d.join(`
`)+`
endbfchar`,d=[]),i[o]!==void 0&&i[o]!==null&&typeof i[o].toString=="function"&&(h=("0000"+i[o].toString(16)).slice(-4),o=("0000"+(+o).toString(16)).slice(-4),d.push("<"+o+"><"+h+">"));return d.length&&(p+=`
`+d.length+` beginbfchar
`+d.join(`
`)+`
endbfchar
`),p+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(i){(function(o){var l=o.font,d=o.out,h=o.newObject,p=o.putStream;if(l.metadata instanceof s.API.TTFFont&&l.encoding==="Identity-H"){for(var g=l.metadata.Unicode.widths,b=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),x="",w=0;w<b.length;w++)x+=String.fromCharCode(b[w]);var v=h();p({data:x,addLength1:!0,objectId:v}),d("endobj");var _=h();p({data:n(l.metadata.toUnicode),addLength1:!0,objectId:_}),d("endobj");var N=h();d("<<"),d("/Type /FontDescriptor"),d("/FontName /"+Zd(l.fontName)),d("/FontFile2 "+v+" 0 R"),d("/FontBBox "+s.API.PDFObject.convert(l.metadata.bbox)),d("/Flags "+l.metadata.flags),d("/StemV "+l.metadata.stemV),d("/ItalicAngle "+l.metadata.italicAngle),d("/Ascent "+l.metadata.ascender),d("/Descent "+l.metadata.decender),d("/CapHeight "+l.metadata.capHeight),d(">>"),d("endobj");var E=h();d("<<"),d("/Type /Font"),d("/BaseFont /"+Zd(l.fontName)),d("/FontDescriptor "+N+" 0 R"),d("/W "+s.API.PDFObject.convert(g)),d("/CIDToGIDMap /Identity"),d("/DW 1000"),d("/Subtype /CIDFontType2"),d("/CIDSystemInfo"),d("<<"),d("/Supplement 0"),d("/Registry (Adobe)"),d("/Ordering ("+l.encoding+")"),d(">>"),d(">>"),d("endobj"),l.objectNumber=h(),d("<<"),d("/Type /Font"),d("/Subtype /Type0"),d("/ToUnicode "+_+" 0 R"),d("/BaseFont /"+Zd(l.fontName)),d("/Encoding /"+l.encoding),d("/DescendantFonts ["+E+" 0 R]"),d(">>"),d("endobj"),l.isAlreadyPutted=!0}})(i)}]),e.events.push(["putFont",function(i){(function(o){var l=o.font,d=o.out,h=o.newObject,p=o.putStream;if(l.metadata instanceof s.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var g=l.metadata.rawData,b="",x=0;x<g.length;x++)b+=String.fromCharCode(g[x]);var w=h();p({data:b,addLength1:!0,objectId:w}),d("endobj");var v=h();p({data:n(l.metadata.toUnicode),addLength1:!0,objectId:v}),d("endobj");var _=h();d("<<"),d("/Descent "+l.metadata.decender),d("/CapHeight "+l.metadata.capHeight),d("/StemV "+l.metadata.stemV),d("/Type /FontDescriptor"),d("/FontFile2 "+w+" 0 R"),d("/Flags 96"),d("/FontBBox "+s.API.PDFObject.convert(l.metadata.bbox)),d("/FontName /"+Zd(l.fontName)),d("/ItalicAngle "+l.metadata.italicAngle),d("/Ascent "+l.metadata.ascender),d(">>"),d("endobj"),l.objectNumber=h();for(var N=0;N<l.metadata.hmtx.widths.length;N++)l.metadata.hmtx.widths[N]=parseInt(l.metadata.hmtx.widths[N]*(1e3/l.metadata.head.unitsPerEm));d("<</Subtype/TrueType/Type/Font/ToUnicode "+v+" 0 R/BaseFont/"+Zd(l.fontName)+"/FontDescriptor "+_+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+s.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),d("endobj"),l.isAlreadyPutted=!0}})(i)}]);var r=function(i){var o,l=i.text||"",d=i.x,h=i.y,p=i.options||{},g=i.mutex||{},b=g.pdfEscape,x=g.activeFontKey,w=g.fonts,v=x,_="",N=0,E="",k=w[v].encoding;if(w[v].encoding!=="Identity-H")return{text:l,x:d,y:h,options:p,mutex:g};for(E=l,v=x,Array.isArray(l)&&(E=l[0]),N=0;N<E.length;N+=1)w[v].metadata.hasOwnProperty("cmap")&&(o=w[v].metadata.cmap.unicode.codeMap[E[N].charCodeAt(0)]),o||E[N].charCodeAt(0)<256&&w[v].metadata.hasOwnProperty("Unicode")?_+=E[N]:_+="";var T="";return parseInt(v.slice(1))<14||k==="WinAnsiEncoding"?T=b(_,v).split("").map(function(P){return P.charCodeAt(0).toString(16)}).join(""):k==="Identity-H"&&(T=t(_,w[v])),g.isHex=!0,{text:T,x:d,y:h,options:p,mutex:g}};e.events.push(["postProcessText",function(i){var o=i.text||"",l=[],d={text:o,x:i.x,y:i.y,options:i.options,mutex:i.mutex};if(Array.isArray(o)){var h=0;for(h=0;h<o.length;h+=1)Array.isArray(o[h])&&o[h].length===3?l.push([r(Object.assign({},d,{text:o[h][0]})).text,o[h][1],o[h][2]]):l.push(r(Object.assign({},d,{text:o[h]})).text);i.text=l}else i.text=r(Object.assign({},d,{text:o})).text}])})(nn),(function(s){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};s.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},s.addFileToVFS=function(t,n){return e.call(this),this.internal.vFS[t]=n,this},s.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}})(nn.API),(function(s){s.__bidiEngine__=s.prototype.__bidiEngine__=function(n){var r,i,o,l,d,h,p,g=e,b=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],x=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],w={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},v={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},_=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],N=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),E=!1,k=0;this.__bidiEngine__={};var T=function(R){var q=R.charCodeAt(),J=q>>8,Z=v[J];return Z!==void 0?g[256*Z+(255&q)]:J===252||J===253?"AL":N.test(J)?"L":J===8?"R":"N"},P=function(R){for(var q,J=0;J<R.length;J++){if((q=T(R.charAt(J)))==="L")return!1;if(q==="R")return!0}return!1},O=function(R,q,J,Z){var le,K,se,ce,ye=q[Z];switch(ye){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":E=!1;break;case"N":case"AN":break;case"EN":E&&(ye="AN");break;case"AL":E=!0,ye="R";break;case"WS":case"BN":ye="N";break;case"CS":Z<1||Z+1>=q.length||(le=J[Z-1])!=="EN"&&le!=="AN"||(K=q[Z+1])!=="EN"&&K!=="AN"?ye="N":E&&(K="AN"),ye=K===le?K:"N";break;case"ES":ye=(le=Z>0?J[Z-1]:"B")==="EN"&&Z+1<q.length&&q[Z+1]==="EN"?"EN":"N";break;case"ET":if(Z>0&&J[Z-1]==="EN"){ye="EN";break}if(E){ye="N";break}for(se=Z+1,ce=q.length;se<ce&&q[se]==="ET";)se++;ye=se<ce&&q[se]==="EN"?"EN":"N";break;case"NSM":if(o&&!l){for(ce=q.length,se=Z+1;se<ce&&q[se]==="NSM";)se++;if(se<ce){var Ce=R[Z],M=Ce>=1425&&Ce<=2303||Ce===64286;if(le=q[se],M&&(le==="R"||le==="AL")){ye="R";break}}}ye=Z<1||(le=q[Z-1])==="B"?"N":J[Z-1];break;case"B":E=!1,r=!0,ye=k;break;case"S":i=!0,ye="N"}return ye},F=function(R,q,J){var Z=R.split("");return J&&$(Z,J,{hiLevel:k}),Z.reverse(),q&&q.reverse(),Z.join("")},$=function(R,q,J){var Z,le,K,se,ce,ye=-1,Ce=R.length,M=0,L=[],U=k?x:b,H=[];for(E=!1,r=!1,i=!1,le=0;le<Ce;le++)H[le]=T(R[le]);for(K=0;K<Ce;K++){if(ce=M,L[K]=O(R,H,L,K),Z=240&(M=U[ce][w[L[K]]]),M&=15,q[K]=se=U[M][5],Z>0)if(Z===16){for(le=ye;le<K;le++)q[le]=1;ye=-1}else ye=-1;if(U[M][6])ye===-1&&(ye=K);else if(ye>-1){for(le=ye;le<K;le++)q[le]=se;ye=-1}H[K]==="B"&&(q[K]=0),J.hiLevel|=se}i&&(function(ae,de,xe){for(var he=0;he<xe;he++)if(ae[he]==="S"){de[he]=k;for(var me=he-1;me>=0&&ae[me]==="WS";me--)de[me]=k}})(H,q,Ce)},z=function(R,q,J,Z,le){if(!(le.hiLevel<R)){if(R===1&&k===1&&!r)return q.reverse(),void(J&&J.reverse());for(var K,se,ce,ye,Ce=q.length,M=0;M<Ce;){if(Z[M]>=R){for(ce=M+1;ce<Ce&&Z[ce]>=R;)ce++;for(ye=M,se=ce-1;ye<se;ye++,se--)K=q[ye],q[ye]=q[se],q[se]=K,J&&(K=J[ye],J[ye]=J[se],J[se]=K);M=ce}M++}}},G=function(R,q,J){var Z=R.split(""),le={hiLevel:k};return J||(J=[]),$(Z,J,le),(function(K,se,ce){if(ce.hiLevel!==0&&p)for(var ye,Ce=0;Ce<K.length;Ce++)se[Ce]===1&&(ye=_.indexOf(K[Ce]))>=0&&(K[Ce]=_[ye+1])})(Z,J,le),z(2,Z,q,J,le),z(1,Z,q,J,le),Z.join("")};return this.__bidiEngine__.doBidiReorder=function(R,q,J){if((function(le,K){if(K)for(var se=0;se<le.length;se++)K[se]=se;l===void 0&&(l=P(le)),h===void 0&&(h=P(le))})(R,q),o||!d||h)if(o&&d&&l^h)k=l?1:0,R=F(R,q,J);else if(!o&&d&&h)k=l?1:0,R=G(R,q,J),R=F(R,q);else if(!o||l||d||h){if(o&&!d&&l^h)R=F(R,q),l?(k=0,R=G(R,q,J)):(k=1,R=G(R,q,J),R=F(R,q));else if(o&&l&&!d&&h)k=1,R=G(R,q,J),R=F(R,q);else if(!o&&!d&&l^h){var Z=p;l?(k=1,R=G(R,q,J),k=0,p=!1,R=G(R,q,J),p=Z):(k=0,R=G(R,q,J),R=F(R,q),k=1,p=!1,R=G(R,q,J),p=Z,R=F(R,q))}}else k=0,R=G(R,q,J);else k=l?1:0,R=G(R,q,J);return R},this.__bidiEngine__.setOptions=function(R){R&&(o=R.isInputVisual,d=R.isOutputVisual,l=R.isInputRtl,h=R.isOutputRtl,p=R.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new s.__bidiEngine__({isInputVisual:!0});s.API.events.push(["postProcessText",function(n){var r=n.text;n.x,n.y;var i=n.options||{};n.mutex,i.lang;var o=[];if(i.isInputVisual=typeof i.isInputVisual!="boolean"||i.isInputVisual,t.setOptions(i),Object.prototype.toString.call(r)==="[object Array]"){var l=0;for(o=[],l=0;l<r.length;l+=1)Object.prototype.toString.call(r[l])==="[object Array]"?o.push([t.doBidiReorder(r[l][0]),r[l][1],r[l][2]]):o.push([t.doBidiReorder(r[l])]);n.text=o}else n.text=t.doBidiReorder(r);t.setOptions({isInputVisual:!0})}])})(nn),nn.API.TTFFont=(function(){function s(e){var t;if(this.rawData=e,t=this.contents=new Wc(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new Q7(this),this.registerTTF()}return s.open=function(e){return new s(e)},s.prototype.parse=function(){return this.directory=new F7(this.contents),this.head=new z7(this),this.name=new V7(this),this.cmap=new Z4(this),this.toUnicode={},this.hhea=new $7(this),this.maxp=new W7(this),this.hmtx=new Y7(this),this.post=new H7(this),this.os2=new q7(this),this.loca=new Z7(this),this.glyf=new K7(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},s.prototype.registerTTF=function(){var e,t,n,r,i;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var o,l,d,h;for(h=[],o=0,l=(d=this.bbox).length;o<l;o++)e=d[o],h.push(Math.round(e*this.scaleFactor));return h}).call(this),this.stemV=0,this.post.exists?(n=255&(r=this.post.italic_angle),32768&(t=r>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(i=this.familyClass)===1||i===2||i===3||i===4||i===5||i===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},s.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},s.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},s.prototype.widthOfString=function(e,t,n){var r,i,o,l;for(o=0,i=0,l=(e=""+e).length;0<=l?i<l:i>l;i=0<=l?++i:--i)r=e.charCodeAt(i),o+=this.widthOfGlyph(this.characterToGlyph(r))+n*(1e3/t)||0;return o*(t/1e3)},s.prototype.lineHeight=function(e,t){var n;return t==null&&(t=!1),n=t?this.lineGap:0,(this.ascender+n-this.decender)/1e3*e},s})();var Po,Wc=(function(){function s(e){this.data=e??[],this.pos=0,this.length=this.data.length}return s.prototype.readByte=function(){return this.data[this.pos++]},s.prototype.writeByte=function(e){return this.data[this.pos++]=e},s.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},s.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},s.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},s.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},s.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},s.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},s.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},s.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},s.prototype.readString=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)n[t]=String.fromCharCode(this.readByte());return n.join("")},s.prototype.writeString=function(e){var t,n,r;for(r=[],t=0,n=e.length;0<=n?t<n:t>n;t=0<=n?++t:--t)r.push(this.writeByte(e.charCodeAt(t)));return r},s.prototype.readShort=function(){return this.readInt16()},s.prototype.writeShort=function(e){return this.writeInt16(e)},s.prototype.readLongLong=function(){var e,t,n,r,i,o,l,d;return e=this.readByte(),t=this.readByte(),n=this.readByte(),r=this.readByte(),i=this.readByte(),o=this.readByte(),l=this.readByte(),d=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^n)+4294967296*(255^r)+16777216*(255^i)+65536*(255^o)+256*(255^l)+(255^d)+1):72057594037927940*e+281474976710656*t+1099511627776*n+4294967296*r+16777216*i+65536*o+256*l+d},s.prototype.writeLongLong=function(e){var t,n;return t=Math.floor(e/4294967296),n=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},s.prototype.readInt=function(){return this.readInt32()},s.prototype.writeInt=function(e){return this.writeInt32(e)},s.prototype.read=function(e){var t,n;for(t=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)t.push(this.readByte());return t},s.prototype.write=function(e){var t,n,r,i;for(i=[],n=0,r=e.length;n<r;n++)t=e[n],i.push(this.writeByte(t));return i},s})(),F7=(function(){var s;function e(t){var n,r,i;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},r=0,i=this.tableCount;0<=i?r<i:r>i;r=0<=i?++r:--r)n={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[n.tag]=n}return e.prototype.encode=function(t){var n,r,i,o,l,d,h,p,g,b,x,w,v;for(v in x=Object.keys(t).length,d=Math.log(2),g=16*Math.floor(Math.log(x)/d),o=Math.floor(g/d),p=16*x-g,(r=new Wc).writeInt(this.scalarType),r.writeShort(x),r.writeShort(g),r.writeShort(o),r.writeShort(p),i=16*x,h=r.pos+i,l=null,w=[],t)for(b=t[v],r.writeString(v),r.writeInt(s(b)),r.writeInt(h),r.writeInt(b.length),w=w.concat(b),v==="head"&&(l=h),h+=b.length;h%4;)w.push(0),h++;return r.write(w),n=2981146554-s(r.data),r.pos=l+8,r.writeUInt32(n),r.data},s=function(t){var n,r,i,o;for(t=Q4.call(t);t.length%4;)t.push(0);for(i=new Wc(t),r=0,n=0,o=t.length;n<o;n=n+=4)r+=i.readUInt32();return 4294967295&r},e})(),U7={}.hasOwnProperty,fl=function(s,e){for(var t in e)U7.call(e,t)&&(s[t]=e[t]);function n(){this.constructor=s}return n.prototype=e.prototype,s.prototype=new n,s.__super__=e.prototype,s};Po=(function(){function s(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return s.prototype.parse=function(){},s.prototype.encode=function(){},s.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},s})();var z7=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return fl(s,Po),s.prototype.tag="head",s.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},s.prototype.encode=function(e){var t;return(t=new Wc).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},s})(),kS=(function(){function s(e,t){var n,r,i,o,l,d,h,p,g,b,x,w,v,_,N,E,k;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),g=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(d=0;d<256;++d)this.codeMap[d]=e.readByte();break;case 4:for(x=e.readUInt16(),b=x/2,e.pos+=6,i=(function(){var T,P;for(P=[],d=T=0;0<=b?T<b:T>b;d=0<=b?++T:--T)P.push(e.readUInt16());return P})(),e.pos+=2,v=(function(){var T,P;for(P=[],d=T=0;0<=b?T<b:T>b;d=0<=b?++T:--T)P.push(e.readUInt16());return P})(),h=(function(){var T,P;for(P=[],d=T=0;0<=b?T<b:T>b;d=0<=b?++T:--T)P.push(e.readUInt16());return P})(),p=(function(){var T,P;for(P=[],d=T=0;0<=b?T<b:T>b;d=0<=b?++T:--T)P.push(e.readUInt16());return P})(),r=(this.length-e.pos+this.offset)/2,l=(function(){var T,P;for(P=[],d=T=0;0<=r?T<r:T>r;d=0<=r?++T:--T)P.push(e.readUInt16());return P})(),d=N=0,k=i.length;N<k;d=++N)for(_=i[d],n=E=w=v[d];w<=_?E<=_:E>=_;n=w<=_?++E:--E)p[d]===0?o=n+h[d]:(o=l[p[d]/2+(n-w)-(b-d)]||0)!==0&&(o+=h[d]),this.codeMap[n]=65535&o}e.pos=g}return s.encode=function(e,t){var n,r,i,o,l,d,h,p,g,b,x,w,v,_,N,E,k,T,P,O,F,$,z,G,R,q,J,Z,le,K,se,ce,ye,Ce,M,L,U,H,ae,de,xe,he,me,ve,Re,Ke;switch(Z=new Wc,o=Object.keys(e).sort(function(Ge,ke){return Ge-ke}),t){case"macroman":for(v=0,_=(function(){var Ge=[];for(w=0;w<256;++w)Ge.push(0);return Ge})(),E={0:0},i={},le=0,ye=o.length;le<ye;le++)E[me=e[r=o[le]]]==null&&(E[me]=++v),i[r]={old:e[r],new:E[e[r]]},_[r]=E[e[r]];return Z.writeUInt16(1),Z.writeUInt16(0),Z.writeUInt32(12),Z.writeUInt16(0),Z.writeUInt16(262),Z.writeUInt16(0),Z.write(_),{charMap:i,subtable:Z.data,maxGlyphID:v+1};case"unicode":for(q=[],g=[],k=0,E={},n={},N=h=null,K=0,Ce=o.length;K<Ce;K++)E[P=e[r=o[K]]]==null&&(E[P]=++k),n[r]={old:P,new:E[P]},l=E[P]-r,N!=null&&l===h||(N&&g.push(N),q.push(r),h=l),N=r;for(N&&g.push(N),g.push(65535),q.push(65535),G=2*(z=q.length),$=2*Math.pow(Math.log(z)/Math.LN2,2),b=Math.log($/2)/Math.LN2,F=2*z-$,d=[],O=[],x=[],w=se=0,M=q.length;se<M;w=++se){if(R=q[w],p=g[w],R===65535){d.push(0),O.push(0);break}if(R-(J=n[R].new)>=32768)for(d.push(0),O.push(2*(x.length+z-w)),r=ce=R;R<=p?ce<=p:ce>=p;r=R<=p?++ce:--ce)x.push(n[r].new);else d.push(J-R),O.push(0)}for(Z.writeUInt16(3),Z.writeUInt16(1),Z.writeUInt32(12),Z.writeUInt16(4),Z.writeUInt16(16+8*z+2*x.length),Z.writeUInt16(0),Z.writeUInt16(G),Z.writeUInt16($),Z.writeUInt16(b),Z.writeUInt16(F),xe=0,L=g.length;xe<L;xe++)r=g[xe],Z.writeUInt16(r);for(Z.writeUInt16(0),he=0,U=q.length;he<U;he++)r=q[he],Z.writeUInt16(r);for(ve=0,H=d.length;ve<H;ve++)l=d[ve],Z.writeUInt16(l);for(Re=0,ae=O.length;Re<ae;Re++)T=O[Re],Z.writeUInt16(T);for(Ke=0,de=x.length;Ke<de;Ke++)v=x[Ke],Z.writeUInt16(v);return{charMap:n,subtable:Z.data,maxGlyphID:k+1}}},s})(),Z4=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return fl(s,Po),s.prototype.tag="cmap",s.prototype.parse=function(e){var t,n,r;for(e.pos=this.offset,this.version=e.readUInt16(),r=e.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=r?n<r:n>r;n=0<=r?++n:--n)t=new kS(e,this.offset),this.tables.push(t),t.isUnicode&&this.unicode==null&&(this.unicode=t);return!0},s.encode=function(e,t){var n,r;return t==null&&(t="macroman"),n=kS.encode(e,t),(r=new Wc).writeUInt16(0),r.writeUInt16(1),n.table=r.data.concat(n.subtable),n},s})(),$7=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return fl(s,Po),s.prototype.tag="hhea",s.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},s})(),q7=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return fl(s,Po),s.prototype.tag="OS/2",s.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=(function(){var t,n;for(n=[],t=0;t<10;++t)n.push(e.readByte());return n})(),this.charRange=(function(){var t,n;for(n=[],t=0;t<4;++t)n.push(e.readInt());return n})(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=(function(){var t,n;for(n=[],t=0;t<2;t=++t)n.push(e.readInt());return n})(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},s})(),H7=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return fl(s,Po),s.prototype.tag="post",s.prototype.parse=function(e){var t,n,r;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var i;for(n=e.readUInt16(),this.glyphNameIndex=[],i=0;0<=n?i<n:i>n;i=0<=n?++i:--i)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],r=[];e.pos<this.offset+this.length;)t=e.readByte(),r.push(this.names.push(e.readString(t)));return r;case 151552:return n=e.readUInt16(),this.offsets=e.read(n);case 262144:return this.map=(function(){var o,l,d;for(d=[],i=o=0,l=this.file.maxp.numGlyphs;0<=l?o<l:o>l;i=0<=l?++o:--o)d.push(e.readUInt32());return d}).call(this)}},s})(),G7=function(s,e){this.raw=s,this.length=s.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},V7=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return fl(s,Po),s.prototype.tag="name",s.prototype.parse=function(e){var t,n,r,i,o,l,d,h,p,g,b;for(e.pos=this.offset,e.readShort(),t=e.readShort(),l=e.readShort(),n=[],i=0;0<=t?i<t:i>t;i=0<=t?++i:--i)n.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+l+e.readShort()});for(d={},i=p=0,g=n.length;p<g;i=++p)r=n[i],e.pos=r.offset,h=e.readString(r.length),o=new G7(h,r),d[b=r.nameID]==null&&(d[b]=[]),d[r.nameID].push(o);this.strings=d,this.copyright=d[0],this.fontFamily=d[1],this.fontSubfamily=d[2],this.uniqueSubfamily=d[3],this.fontName=d[4],this.version=d[5];try{this.postscriptName=d[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=d[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=d[7],this.manufacturer=d[8],this.designer=d[9],this.description=d[10],this.vendorUrl=d[11],this.designerUrl=d[12],this.license=d[13],this.licenseUrl=d[14],this.preferredFamily=d[15],this.preferredSubfamily=d[17],this.compatibleFull=d[18],this.sampleText=d[19]},s})(),W7=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return fl(s,Po),s.prototype.tag="maxp",s.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},s})(),Y7=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return fl(s,Po),s.prototype.tag="hmtx",s.prototype.parse=function(e){var t,n,r,i,o,l,d;for(e.pos=this.offset,this.metrics=[],t=0,l=this.file.hhea.numberOfMetrics;0<=l?t<l:t>l;t=0<=l?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(r=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var h,p;for(p=[],t=h=0;0<=r?h<r:h>r;t=0<=r?++h:--h)p.push(e.readInt16());return p})(),this.widths=(function(){var h,p,g,b;for(b=[],h=0,p=(g=this.metrics).length;h<p;h++)i=g[h],b.push(i.advance);return b}).call(this),n=this.widths[this.widths.length-1],d=[],t=o=0;0<=r?o<r:o>r;t=0<=r?++o:--o)d.push(this.widths.push(n));return d},s.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},s})(),Q4=[].slice,K7=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return fl(s,Po),s.prototype.tag="glyf",s.prototype.parse=function(){return this.cache={}},s.prototype.glyphFor=function(e){var t,n,r,i,o,l,d,h,p,g;return e in this.cache?this.cache[e]:(i=this.file.loca,t=this.file.contents,n=i.indexOf(e),(r=i.lengthOf(e))===0?this.cache[e]=null:(t.pos=this.offset+n,o=(l=new Wc(t.read(r))).readShort(),h=l.readShort(),g=l.readShort(),d=l.readShort(),p=l.readShort(),this.cache[e]=o===-1?new J7(l,h,g,d,p):new X7(l,o,h,g,d,p),this.cache[e]))},s.prototype.encode=function(e,t,n){var r,i,o,l,d;for(o=[],i=[],l=0,d=t.length;l<d;l++)r=e[t[l]],i.push(o.length),r&&(o=o.concat(r.encode(n)));return i.push(o.length),{table:o,offsets:i}},s})(),X7=(function(){function s(e,t,n,r,i,o){this.raw=e,this.numberOfContours=t,this.xMin=n,this.yMin=r,this.xMax=i,this.yMax=o,this.compound=!1}return s.prototype.encode=function(){return this.raw.data},s})(),J7=(function(){function s(e,t,n,r,i){var o,l;for(this.raw=e,this.xMin=t,this.yMin=n,this.xMax=r,this.yMax=i,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],o=this.raw;l=o.readShort(),this.glyphOffsets.push(o.pos),this.glyphIDs.push(o.readUInt16()),32&l;)o.pos+=1&l?4:2,128&l?o.pos+=8:64&l?o.pos+=4:8&l&&(o.pos+=2)}return s.prototype.encode=function(){var e,t,n;for(t=new Wc(Q4.call(this.raw.data)),e=0,n=this.glyphIDs.length;e<n;++e)t.pos=this.glyphOffsets[e];return t.data},s})(),Z7=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return fl(s,Po),s.prototype.tag="loca",s.prototype.parse=function(e){var t,n;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=t===0?(function(){var r,i;for(i=[],n=0,r=this.length;n<r;n+=2)i.push(2*e.readUInt16());return i}).call(this):(function(){var r,i;for(i=[],n=0,r=this.length;n<r;n+=4)i.push(e.readUInt32());return i}).call(this)},s.prototype.indexOf=function(e){return this.offsets[e]},s.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},s.prototype.encode=function(e,t){for(var n=new Uint32Array(this.offsets.length),r=0,i=0,o=0;o<n.length;++o)if(n[o]=r,i<t.length&&t[i]==o){++i,n[o]=r;var l=this.offsets[o],d=this.offsets[o+1]-l;d>0&&(r+=d)}for(var h=new Array(4*n.length),p=0;p<n.length;++p)h[4*p+3]=255&n[p],h[4*p+2]=(65280&n[p])>>8,h[4*p+1]=(16711680&n[p])>>16,h[4*p]=(4278190080&n[p])>>24;return h},s})(),Q7=(function(){function s(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return s.prototype.generateCmap=function(){var e,t,n,r,i;for(t in r=this.font.cmap.tables[0].codeMap,e={},i=this.subset)n=i[t],e[t]=r[n];return e},s.prototype.glyphsFor=function(e){var t,n,r,i,o,l,d;for(r={},o=0,l=e.length;o<l;o++)r[i=e[o]]=this.font.glyf.glyphFor(i);for(i in t=[],r)(n=r[i])!=null&&n.compound&&t.push.apply(t,n.glyphIDs);if(t.length>0)for(i in d=this.glyphsFor(t))n=d[i],r[i]=n;return r},s.prototype.encode=function(e,t){var n,r,i,o,l,d,h,p,g,b,x,w,v,_,N;for(r in n=Z4.encode(this.generateCmap(),"unicode"),o=this.glyphsFor(e),x={0:0},N=n.charMap)x[(d=N[r]).old]=d.new;for(w in b=n.maxGlyphID,o)w in x||(x[w]=b++);return p=(function(E){var k,T;for(k in T={},E)T[E[k]]=k;return T})(x),g=Object.keys(p).sort(function(E,k){return E-k}),v=(function(){var E,k,T;for(T=[],E=0,k=g.length;E<k;E++)l=g[E],T.push(p[l]);return T})(),i=this.font.glyf.encode(o,v,x),h=this.font.loca.encode(i.offsets,v),_={cmap:this.font.cmap.raw(),glyf:i.table,loca:h,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(_["OS/2"]=this.font.os2.raw()),this.font.directory.encode(_)},s})();nn.API.PDFObject=(function(){var s;function e(){}return s=function(t,n){return(Array(n+1).join("0")+t).slice(-n)},e.convert=function(t){var n,r,i,o;if(Array.isArray(t))return"["+(function(){var l,d,h;for(h=[],l=0,d=t.length;l<d;l++)n=t[l],h.push(e.convert(n));return h})().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t?.isString)return"("+t+")";if(t instanceof Date)return"(D:"+s(t.getUTCFullYear(),4)+s(t.getUTCMonth(),2)+s(t.getUTCDate(),2)+s(t.getUTCHours(),2)+s(t.getUTCMinutes(),2)+s(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(r in i=["<<"],t)o=t[r],i.push("/"+r+" "+e.convert(o));return i.push(">>"),i.join(`
`)}return""+t},e})();ch.workerSrc=rL;const eP=Y.forwardRef(({connection:s,isHost:e,sessionId:t,studentName:n,onEndLesson:r,showLessonTimer:i=!0},o)=>{const l=ka(),d=Y.useRef(null),h=Y.useRef(null),p=Y.useRef(null),g=Y.useRef(null),[b,x]=Y.useState(!1),[w,v]=Y.useState(!1),[_,N]=Y.useState(localStorage.getItem("davina_notes")||""),[E,k]=Y.useState(3600),[T,P]=Y.useState(!1),[O,F]=Y.useState(!1);Y.useEffect(()=>{s&&s.open&&F(!0)},[s]),Y.useEffect(()=>{let ut;return O&&(ut=setInterval(()=>{k(re=>(re<=0&&P(!0),re-1))},1e3)),()=>clearInterval(ut)},[O]),Y.useEffect(()=>{if(s)if(e){const re=setInterval(()=>{s.open&&s.send({type:"sync_timer",timeLeft:E,isRunning:O})},5e3);return()=>clearInterval(re)}else{const ut=re=>{re.type==="sync_timer"&&(Math.abs(re.timeLeft-E)>2&&k(re.timeLeft),re.isRunning!==O&&F(re.isRunning))};return s.on("data",ut),()=>s.off("data",ut)}},[s,e,E,O]);const $=()=>{if(!e)return;const ut=!O;F(ut),e&&s&&s.open&&s.send({type:"sync_timer",timeLeft:E,isRunning:ut})},z=()=>{r?r():window.confirm("Are you sure you want to end the lesson?")&&(s&&s.close(),l("/"))},G=ut=>{const re=Math.abs(ut),Qe=Math.floor(re/60),mt=re%60;return`${Qe}:${mt.toString().padStart(2,"0")}`};Y.useEffect(()=>{localStorage.setItem("davina_notes",_)},[_]);const{tool:R,setTool:q,color:J,setColor:Z,size:le,setSize:K,transform:se,setTransform:ce,zoomIn:ye,zoomOut:Ce,page:M,totalPages:L,nextPage:U,prevPage:H,addPage:ae,deletePage:de,clearCanvas:xe,getPageType:he,getDocContent:me,setDocContent:ve,undo:Re,redo:Ke,activeText:Ge,setActiveText:ke,finalizeText:X,events:Pe}=oL(d,h,s,t,n),[gt,bt]=Y.useState(!1),[Ye,Et]=Y.useState(""),vt=Y.useRef(null),st=he(M)==="document";Y.useEffect(()=>{if(!st)return;const ut=me(M);Et(ut);const re=setTimeout(()=>{vt.current&&(vt.current.innerHTML=ut||"")},0);return()=>clearTimeout(re)},[M,st]);const St=Y.useRef(null),Pt=(ut,re)=>{if(!vt.current)return;const Qe=vt.current;Qe.focus();const mt=document.getSelection();if(St.current&&St.current.range)try{mt.removeAllRanges(),mt.addRange(St.current.range)}catch{}if(ut==="backColor"&&re&&re!=="transparent"){try{document.execCommand("styleWithCSS",!1,!0)}catch{}document.execCommand("backColor",!1,re)}else ut==="foreColor"?document.execCommand("foreColor",!1,re):ut==="backColor"&&re==="transparent"&&document.execCommand("removeFormat",!1);try{ve(M,Qe.innerHTML)}catch{}},Ut=()=>{const ut=document.getSelection();if(!vt.current||!ut.rangeCount)return;const re=ut.getRangeAt(0);vt.current.contains(re.commonAncestorContainer)&&(St.current={range:re.cloneRange()})},je=()=>{if(L<=1)return;ue(M);const ut=Fe.current;for(let re=M;re<L;re++)ut[re]=ut[re+1]||[];delete ut[L],Fe.current={...ut},de(!0)},Me=Y.useRef(1),Fe=Y.useRef({}),ue=ut=>{const re=p.current;if(!re)return;const Qe=[];for(;re.firstChild;)Qe.push(re.removeChild(re.firstChild));Fe.current[ut]=Qe},Te=ut=>{const re=p.current;if(!re)return;const Qe=Fe.current[ut];Qe&&Qe.length&&Qe.forEach(mt=>re.appendChild(mt))};Y.useEffect(()=>{if(!p.current)return;const re=Me.current;re!==M&&(ue(re),Me.current=M,Te(M))},[M]),Y.useEffect(()=>{if(Ge){const ut=setTimeout(()=>g.current?.focus(),50);return()=>clearTimeout(ut)}},[Ge?.x,Ge?.y]);const Oe=()=>Math.random().toString(36).substr(2,9),ct=Y.useRef({});Y.useEffect(()=>{if(!s)return;const ut=mt=>{const{fileId:Xe,chunkIndex:et,totalChunks:kt,chunkData:Tt,metadata:Rt}=mt;ct.current[Xe]||(ct.current[Xe]={parts:new Array(kt),count:0,metadata:Rt});const An=ct.current[Xe];if(An.parts[et]=Tt,An.count++,An.count===kt){const Pn=An.parts.join("");if(delete ct.current[Xe],Rt.type==="pdf_page")re(Pn,Rt);else if(Rt.type==="sync_pdf_page"){const wn=Rt.pageNum!=null?parseInt(Rt.pageNum,10):1;Fe.current[wn]||(Fe.current[wn]=[]);const jt=document.createElement("img");jt.src=Pn,jt.style.position="absolute",jt.style.top=`${Rt.y||0}px`,jt.style.left="50px",jt.style.width=`${Rt.width||800}px`,jt.style.boxShadow="0 4px 6px -1px rgba(0,0,0,0.1)",jt.style.borderRadius="4px",Fe.current[wn].push(jt);const dt=p.current;if(dt){for(;dt.firstChild;)dt.removeChild(dt.firstChild);(Fe.current[M]||[]).forEach(sn=>dt.appendChild(sn))}}}},re=(mt,Xe)=>{try{if(p.current){const et=document.createElement("img");et.src=mt,et.style.position="absolute",et.style.top=`${Xe.y||0}px`,et.style.left="50px",et.style.width=`${Xe.width||800}px`,et.style.boxShadow="0 4px 6px -1px rgba(0,0,0,0.1)",et.style.borderRadius="4px",p.current.appendChild(et)}}catch(et){console.error("Error rendering remote PDF page:",et)}},Qe=mt=>{mt.type==="file_chunk"?ut(mt):mt.type==="clear_pdf"&&(p.current&&(p.current.innerHTML=""),Fe.current={})};return s.on("data",Qe),()=>s.off("data",Qe)},[s,M]);const ft=Y.useRef(null);Y.useEffect(()=>{if(!s||!e)return;const ut=async()=>{const Qe=Fe.current;for(const[mt,Xe]of Object.entries(Qe))if(!(!Array.isArray(Xe)||Xe.length===0))for(const et of Xe)try{let kt;et.tagName==="CANVAS"?kt=et.toDataURL("image/png"):et.tagName==="IMG"&&et.src&&(kt=et.src),kt&&s.open&&await wt("sync_pdf_page",kt,{pageNum:parseInt(mt,10),y:parseInt(et.style?.top,10)||0,width:et.width||et.offsetWidth||800,height:et.height||et.offsetHeight||600})}catch{}};ft.current=ut;const re=()=>setTimeout(ut,800);return s.open&&re(),s.on("open",re),()=>{s.off("open",re)}},[s,e]),Y.useEffect(()=>{if(!s||!e)return;const ut=re=>{re.type==="request_pdf_sync"&&ft.current&&setTimeout(ft.current,300)};return s.on("data",ut),()=>s.off("data",ut)},[s,e]),Y.useEffect(()=>{if(!s||e||!s.open)return;const ut=setTimeout(()=>{s.open&&s.send({type:"request_pdf_sync"})},1200);return()=>clearTimeout(ut)},[s,e,s?.open]);const wt=async(ut,re,Qe={})=>{if(!s||!s.open)return;const mt=Oe();JSON.stringify(re);const Xe=typeof re=="string"?re:JSON.stringify(re),et=16e3,kt=Math.ceil(Xe.length/et);for(let Tt=0;Tt<kt;Tt++){const Rt=Xe.slice(Tt*et,(Tt+1)*et);s.send({type:"file_chunk",fileId:mt,chunkIndex:Tt,totalChunks:kt,chunkData:Rt,metadata:{...Qe,type:ut}}),await new Promise(An=>setTimeout(An,5))}},it=async ut=>{const re=ut.target.files[0];if(!re)return;ue(Me.current),Me.current=M,s&&s.open&&s.send({type:"clear_pdf"});const Qe=new FileReader;Qe.onload=async mt=>{p.current&&(p.current.innerHTML='<div class="absolute top-10 left-10 text-brand-teal animate-pulse">Loading PDF...</div>');try{const Xe=await Z_(mt.target.result).promise;p.current&&(p.current.innerHTML="");let et=50,kt=0;const Tt=await Xe.getPage(1),Rt=Tt.getViewport({scale:1}),Pn=Math.max(800,window.innerWidth*.9)/Rt.width;Tt.cleanup();for(let wn=1;wn<=Xe.numPages;wn++){await new Promise(Un=>setTimeout(Un,10));const jt=await Xe.getPage(wn),dt=jt.getViewport({scale:Pn}),sn=document.createElement("canvas");if(sn.width=dt.width,sn.height=dt.height,sn.style.position="absolute",sn.style.left="50px",sn.style.top=`${et}px`,sn.style.boxShadow="0 4px 6px -1px rgba(0,0,0,0.1)",sn.style.borderRadius="4px",p.current.appendChild(sn),await jt.render({canvasContext:sn.getContext("2d"),viewport:dt}).promise,s&&s.open){const Un=sn.toDataURL("image/jpeg",.6);await wt("pdf_page",Un,{y:et,width:dt.width,height:dt.height})}et+=dt.height+40,kt=Math.max(kt,dt.width+100),jt.cleanup()}ce({x:0,y:0,scale:1}),p.current&&(p.current.style.display="")}catch(Xe){console.error("PDF Load Error",Xe),alert("Failed to load PDF. Please try another file.")}},Qe.readAsArrayBuffer(re)},At=()=>{if(!d.current)return;const ut=d.current,re=ut.width,Qe=ut.height,mt=p.current,Xe=mt&&mt.children&&mt.children.length>0?Array.from(mt.children):Fe.current[M]||[];let et=re,kt=Qe;Xe.forEach(dt=>{const sn=parseInt(String(dt.style?.left||50).replace(/px/g,""),10)||50,Un=parseInt(String(dt.style?.top||0).replace(/px/g,""),10)||0,er=dt.tagName==="CANVAS"?dt.width:dt.naturalWidth||dt.offsetWidth||800,tr=dt.tagName==="CANVAS"?dt.height:dt.naturalHeight||dt.offsetHeight||600;et=Math.max(et,sn+er),kt=Math.max(kt,Un+tr)});const Tt=Math.ceil(et)||re,Rt=Math.ceil(kt)||Qe,An=document.createElement("canvas");An.width=Tt,An.height=Rt;const Pn=An.getContext("2d");Pn.fillStyle="#ffffff",Pn.fillRect(0,0,Tt,Rt),Pn.drawImage(ut,0,0,re,Qe,0,0,re,Qe),Xe.forEach(dt=>{const sn=parseInt(String(dt.style?.left||50).replace(/px/g,""),10)||50,Un=parseInt(String(dt.style?.top||0).replace(/px/g,""),10)||0;if(!(sn+(dt.tagName==="CANVAS"?dt.width:dt.naturalWidth||800)<0||Un+(dt.tagName==="CANVAS"?dt.height:dt.naturalHeight||600)<0)){if(dt.tagName==="CANVAS")try{Pn.drawImage(dt,sn,Un,dt.width,dt.height)}catch{}else if(dt.tagName==="IMG"&&dt.complete){const er=dt.naturalWidth||dt.offsetWidth||800,tr=dt.naturalHeight||dt.offsetHeight||600;try{Pn.drawImage(dt,sn,Un,er,tr)}catch{}}}});const wn=An.toDataURL("image/png"),jt=new nn({orientation:Tt>Rt?"landscape":"portrait",unit:"px",format:[Tt,Rt]});jt.addImage(wn,"PNG",0,0,Tt,Rt),jt.save("davina-tutoring-notes.pdf")},We=()=>{if(!d.current)return Promise.resolve(null);const ut=d.current,re=ut.toDataURL("image/png"),Qe=new nn({orientation:"landscape",unit:"px",format:[ut.width,ut.height]});Qe.addImage(re,"PNG",0,0,ut.width,ut.height);const mt=Qe.output("datauristring"),Xe=mt&&mt.includes(",")?mt.split(",")[1]:null;return Promise.resolve(Xe)};Y.useImperativeHandle(o,()=>({getLessonPDFBase64:We}),[]);const[lt,pt]=Y.useState(!1),It=Y.useRef(null),en=Y.useRef([]),Mt=async()=>{try{const ut=d.current;if(!ut){alert("Canvas not ready. Please try again.");return}const re=ut.captureStream(30);try{const Xe=(await navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0];re.addTrack(Xe)}catch{console.log("Microphone access denied, recording without audio")}const Qe=new MediaRecorder(re,{mimeType:"video/webm;codecs=vp9"});It.current=Qe,en.current=[],Qe.ondataavailable=mt=>{mt.data.size>0&&en.current.push(mt.data)},Qe.onstop=()=>{const mt=new Blob(en.current,{type:"video/webm"}),Xe=URL.createObjectURL(mt),et=document.createElement("a");document.body.appendChild(et),et.style="display: none",et.href=Xe,et.download=`lesson-recording-${new Date().toISOString().slice(0,10)}.webm`,et.click(),window.URL.revokeObjectURL(Xe),pt(!1),re.getTracks().forEach(kt=>kt.stop())},Qe.start(),pt(!0)}catch(ut){console.error("Error starting recording:",ut),alert("Could not start recording. Please allow microphone access if prompted.")}},Bt=()=>{It.current&&It.current.state!=="inactive"&&It.current.stop()},Yt=Y.useRef(null),[On,an]=Y.useState(!1),As=ut=>{Yt.current&&(Yt.current.style.left=`${ut.clientX}px`,Yt.current.style.top=`${ut.clientY}px`)};return u.jsxs("div",{className:"flex h-screen w-screen overflow-hidden flex-col",children:[u.jsx("div",{ref:Yt,style:{position:"fixed",left:0,top:0,width:Math.max(20,le*se.scale),height:Math.max(20,le*se.scale),border:"3px solid black",backgroundColor:"rgba(255, 255, 255, 0.3)",borderRadius:"50%",transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:9999999,boxShadow:"0 0 4px white",display:On&&R!=="pan"?"block":"none"}}),u.jsxs("div",{className:"h-14 bg-purple-600 text-white flex items-center justify-between px-6 shadow-md z-30 shrink-0",children:[u.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[u.jsx(Au,{size:28,className:"text-white shrink-0"}),u.jsx("h1",{className:"text-xl font-bold tracking-wide shrink-0",children:"Davina's Tutoring"}),t&&u.jsxs("div",{className:"flex items-center gap-2 bg-white/15 rounded-lg px-3 py-1.5",children:[u.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-white/90",children:"Meeting ID"}),u.jsx("span",{className:"font-mono text-sm select-all",children:t})]}),u.jsx("span",{className:"text-white/80 text-sm",children:n&&n!=="Guest"?n:typeof window<"u"&&t?localStorage.getItem(`session_student_${t}`)||n||"Student":n||"Student"})]}),i&&u.jsxs("div",{className:`flex items-center gap-2 font-mono text-lg font-bold px-4 py-1.5 rounded-full shrink-0 ${T?"bg-red-500 animate-pulse":"bg-white/10"}`,children:[u.jsx(ei,{size:16}),u.jsxs("span",{children:[T?"+":"",G(E)]}),e&&u.jsx("button",{onClick:$,className:"ml-2 bg-white/20 hover:bg-white/40 p-1 rounded-full text-xs",title:O?"Pause Timer":"Start Timer",children:O?"":""}),T&&u.jsx("span",{className:"text-xs ml-1",children:"OVERTIME"})]}),u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsxs("button",{onClick:()=>v(!w),className:`flex items-center gap-2 px-3 py-1.5 rounded-full font-bold transition-all ${w?"bg-white text-purple-700":"hover:bg-purple-500"}`,children:[u.jsx(Na,{size:16}),u.jsx("span",{children:"Notes"})]}),u.jsxs("button",{onClick:()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>At(),100)})})},className:"flex items-center gap-2 px-3 py-1.5 rounded-full font-bold bg-white text-purple-700 hover:bg-purple-50 transition-all",title:"Download whiteboard as PDF (includes pen and text)",children:[u.jsx(o_,{size:16}),u.jsx("span",{children:"PDF"})]}),e&&u.jsxs("button",{onClick:lt?Bt:Mt,className:`flex items-center gap-2 px-3 py-1.5 rounded-full font-bold transition-all border ${lt?"bg-red-100 text-red-600 border-red-500 animate-pulse":"bg-white text-gray-700 hover:bg-gray-100 border-gray-300"}`,title:"Record Screen & Audio",children:[u.jsx("div",{className:`w-3 h-3 rounded-full ${lt?"bg-red-600":"bg-gray-400"}`}),u.jsx("span",{children:lt?"Recording...":"Record"})]}),!e&&u.jsxs("button",{onClick:()=>{window.confirm("Return to your dashboard?")&&l(`/student/${encodeURIComponent(n||"Guest")}`)},className:"flex items-center gap-2 bg-gray-800 text-white px-4 py-1.5 rounded-full font-bold hover:bg-gray-900 transition-all border border-gray-700 shadow-sm",children:[u.jsx(vb,{size:14}),u.jsx("span",{children:"Dashboard"})]}),e&&u.jsx("button",{onClick:z,className:"flex items-center gap-2 bg-red-600 text-white px-3 py-1.5 rounded-full font-bold hover:bg-red-700 transition-all border border-red-500",children:u.jsx("span",{children:"End Lesson"})})]})]}),u.jsx("div",{className:"h-12 bg-white border-b border-gray-200 flex items-center justify-between px-4 gap-4 z-[25] relative shrink-0",children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("button",{onClick:H,disabled:M===1,className:"w-8 h-8 flex items-center justify-center text-gray-500 hover:text-purple-600 disabled:opacity-30 rounded border border-gray-200 hover:border-purple-300",children:""}),u.jsxs("span",{className:"text-sm font-bold text-gray-700 min-w-[4rem] text-center",children:[M," / ",L]}),u.jsx("button",{onClick:U,disabled:M===L,className:"w-8 h-8 flex items-center justify-center text-gray-500 hover:text-purple-600 disabled:opacity-30 rounded border border-gray-200 hover:border-purple-300",children:""}),u.jsxs("div",{className:"relative",children:[u.jsx("button",{onClick:()=>bt(!gt),className:"px-3 py-1.5 text-sm font-bold text-teal-600 border-2 border-teal-500 rounded-lg hover:bg-teal-50",children:"+ Page"}),gt&&u.jsxs("div",{className:"absolute top-full left-0 mt-1 py-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 min-w-[140px]",children:[u.jsxs("button",{onClick:()=>{ae("whiteboard"),bt(!1)},className:"w-full px-3 py-2 text-left text-sm font-bold text-gray-800 hover:bg-teal-50 rounded-t-lg flex items-center gap-2",children:[u.jsx(Na,{size:14})," Whiteboard"]}),u.jsxs("button",{onClick:()=>{ae("document"),bt(!1)},className:"w-full px-3 py-2 text-left text-sm font-bold text-gray-800 hover:bg-teal-50 rounded-b-lg flex items-center gap-2",children:[u.jsx(Na,{size:14})," Document"]})]})]}),u.jsx("button",{onClick:je,disabled:L<=1,className:"px-3 py-1.5 text-sm font-bold text-red-500 border border-red-200 rounded-lg hover:bg-red-50 disabled:opacity-40",title:"Delete this page",children:"Delete page"})]})}),u.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[u.jsx(aL,{tool:R,setTool:q,color:J,setColor:Z,size:le,setSize:K,onUpload:it,onZoomIn:ye,onZoomOut:Ce,gridMode:b,setGridMode:x,page:M,totalPages:L,onPrevPage:H,onNextPage:U,onAddPage:()=>bt(!0),onDeletePage:je,onClear:xe,onUndo:Re,onRedo:Ke,isDocumentPage:st,onDocHighlight:ut=>Pt("backColor",ut),onDocTextColor:ut=>Pt("foreColor",ut),onDocHighlightPopoverOpen:Ut}),u.jsxs("div",{ref:h,className:`flex-1 relative overflow-hidden touch-none ${!st&&b?"bg-grid":""} ${!st&&R!=="pan"?"cursor-none":""}`,style:{backgroundColor:"#ffffff",...!st&&R==="pan"?{cursor:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Ccircle cx='12' cy='12' r='6' fill='%23000'/%3E%3C/svg%3E") 12 12, grab`}:{}},...st?{}:Pe,onMouseMove:st?void 0:ut=>{As(ut),Pe.onMouseMove&&Pe.onMouseMove(ut)},onMouseEnter:()=>an(!0),onMouseLeave:()=>an(!1),children:[st?u.jsx("div",{className:"absolute inset-0 overflow-auto bg-gray-300 pt-24 pb-24 px-4",children:u.jsx("div",{className:"flex flex-col items-center min-h-full min-w-full pt-12 pb-12",children:u.jsx("div",{className:"flex items-center justify-center min-h-full min-w-full",style:{transform:"scale(1.55)",transformOrigin:"center top"},children:u.jsx("div",{className:"w-[210mm] min-h-[297mm] bg-white shadow-xl rounded-sm flex flex-col flex-shrink-0",style:{boxShadow:"0 0 0 1px rgba(0,0,0,0.08), 0 4px 20px rgba(0,0,0,0.15)"},children:u.jsx("div",{className:"flex-1 flex flex-col p-12 pt-16",children:u.jsx("div",{ref:vt,className:"flex-1 w-full min-h-[200px] border-0 outline-none font-sans text-gray-800 text-base leading-relaxed focus:outline-none overflow-auto empty:before:content-[attr(data-placeholder)] empty:before:text-gray-400",contentEditable:!0,suppressContentEditableWarning:!0,"data-placeholder":"Type here  this page supports text colour and highlight.",style:{outline:"none"},onInput:ut=>{const re=ut.currentTarget.innerHTML;Et(re),ve(M,re)},onBlur:ut=>{const re=ut.currentTarget.innerHTML;Et(re),ve(M,re)}})})})})})}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{transform:`translate(${se.x}px, ${se.y}px) scale(${se.scale})`,transformOrigin:"0 0",position:"absolute",top:0,left:0,willChange:"transform"},children:[u.jsx("div",{ref:p,className:"absolute inset-0 pointer-events-none"}),u.jsx("canvas",{ref:d,className:"relative z-10 pointer-events-none",style:{background:"transparent"}}),Ge&&u.jsxs("div",{style:{position:"absolute",left:Ge.x,top:Ge.y,transform:"translate(0, -50%)",zIndex:999999},onMouseDown:ut=>{ut.stopPropagation()},children:[u.jsx("div",{className:"bg-purple-600 text-white text-[10px] px-1 rounded-t cursor-move flex items-center justify-center w-full select-none",onMouseDown:ut=>{ut.stopPropagation()},children:"Drag me"}),u.jsx("input",{ref:g,autoFocus:!0,value:Ge.text,onChange:ut=>ke({...Ge,text:ut.target.value}),onMouseDown:ut=>ut.stopPropagation(),onClick:ut=>ut.stopPropagation(),onKeyDown:ut=>{ut.key==="Enter"&&!ut.shiftKey&&(ut.preventDefault(),X()),ut.key==="Escape"&&ke(null)},style:{background:"white",border:"2px solid #9333ea",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",outline:"none",color:J,fontSize:`${Math.max(16,le*5)}px`,fontWeight:"bold",padding:"8px 12px",minWidth:"200px",borderRadius:"0 0 6px 6px"},className:"pointer-events-auto shadow-xl",placeholder:"Type & Enter..."})]})]}),u.jsxs("div",{className:"absolute bottom-4 left-4 bg-white/80 backdrop-blur px-3 py-1 rounded-full shadow text-xs font-mono text-gray-500 pointer-events-none select-none",children:[Math.round(se.scale*100),"%"]}),u.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-brand-navy/50 text-xs pointer-events-none select-none font-bold",children:"[Scroll] to Pan Vertical  [Ctrl+Scroll] to Zoom"})]}),w&&u.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center pointer-events-none",children:u.jsxs("div",{className:"w-[500px] h-[60vh] bg-white rounded-xl shadow-2xl border border-gray-200 flex flex-col pointer-events-auto animate-in zoom-in-95 duration-200",children:[u.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-purple-600 rounded-t-xl text-white",children:[u.jsxs("div",{className:"flex items-center gap-2 font-bold",children:[u.jsx(Na,{size:20}),u.jsx("h3",{children:"Session Notes"})]}),u.jsx("button",{onClick:()=>v(!1),className:"hover:bg-white/20 p-1 rounded text-white transition-colors",children:u.jsx(xh,{size:20})})]}),u.jsx("textarea",{className:"flex-1 p-5 resize-none outline-none text-base leading-relaxed text-gray-700",placeholder:"Type homework assignments, lesson goals, or notes here...",value:_,onChange:ut=>N(ut.target.value),autoFocus:!0}),u.jsx("div",{className:"p-3 bg-gray-50 text-xs text-center text-gray-400 border-t rounded-b-xl",children:"Notes are saved automatically to your browser"})]})})]})]})]})});class tP{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const t of this._parts)e.push(t);return nP(e).buffer}}function nP(s){let e=0;for(const r of s)e+=r.byteLength;const t=new Uint8Array(e);let n=0;for(const r of s){const i=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);t.set(i,n),n+=r.byteLength}return t}function eA(s){return new sP(s).unpack()}function tA(s){const e=new rP,t=e.pack(s);return t instanceof Promise?t.then(()=>e.getBuffer()):e.getBuffer()}class sP{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let t;if((t=e^160)<=15)return this.unpack_raw(t);if((t=e^176)<=15)return this.unpack_string(t);if((t=e^144)<=15)return this.unpack_array(t);if((t=e^128)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t}unpack_uint32(){const e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t}unpack_uint64(){const e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){const t=this.read(e);let n=0,r="",i,o;for(;n<e;)i=t[n],i<160?(o=i,n++):(i^192)<32?(o=(i&31)<<6|t[n+1]&63,n+=2):(i^224)<16?(o=(i&15)<<12|(t[n+1]&63)<<6|t[n+2]&63,n+=3):(o=(i&7)<<18|(t[n+1]&63)<<12|(t[n+2]&63)<<6|t[n+3]&63,n+=4),r+=String.fromCodePoint(o);return this.index+=e,r}unpack_array(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=this.unpack();return t}unpack_map(e){const t={};for(let n=0;n<e;n++){const r=this.unpack();t[r]=this.unpack()}return t}unpack_float(){const e=this.unpack_uint32(),t=e>>31,n=(e>>23&255)-127,r=e&8388607|8388608;return(t===0?1:-1)*r*2**(n-23)}unpack_double(){const e=this.unpack_uint32(),t=this.unpack_uint32(),n=e>>31,r=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(r-20)+t*2**(r-52);return(n===0?1:-1)*o}read(e){const t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")}}class rP{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const t=e.constructor;if(e instanceof Array){const n=this.pack_array(e);if(n instanceof Promise)return n.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const n=e;this.pack_bin(new Uint8Array(n.buffer,n.byteOffset,n.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(n=>{this.pack_bin(new Uint8Array(n)),this._bufferBuilder.flush()});if(t==Object||t.toString().startsWith("class")){const n=this.pack_object(e);if(n instanceof Promise)return n.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${t.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const t=this._textEncoder.encode(e),n=t.length;if(n<=15)this.pack_uint8(176+n);else if(n<=65535)this._bufferBuilder.append(216),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_array(e){const t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");const n=r=>{if(r<t){const i=this.pack(e[r]);return i instanceof Promise?i.then(()=>n(r+1)):n(r+1)}};return n(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let t=0;e<0&&(t=1,e=-e);const n=Math.floor(Math.log(e)/Math.LN2),r=e/2**n-1,i=Math.floor(r*2**52),o=2**32,l=t<<31|n+1023<<20|i/o&1048575,d=i%o;this._bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(d)}pack_object(e){const t=Object.keys(e),n=t.length;if(n<=15)this.pack_uint8(128+n);else if(n<=65535)this._bufferBuilder.append(222),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(n);else throw new Error("Invalid length");const r=i=>{if(i<t.length){const o=t[i];if(e.hasOwnProperty(o)){this.pack(o);const l=this.pack(e[o]);if(l instanceof Promise)return l.then(()=>r(i+1))}return r(i+1)}};return r(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const t=e&4294967295;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_uint64(e){const t=e/4294967296,n=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const t=Math.floor(e/4294967296),n=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}constructor(){this._bufferBuilder=new tP,this._textEncoder=new TextEncoder}}let nA=!0,sA=!0;function Nf(s,e,t){const n=s.match(e);return n&&n.length>=t&&parseFloat(n[t],10)}function Vu(s,e,t){if(!s.RTCPeerConnection)return;const n=s.RTCPeerConnection.prototype,r=n.addEventListener;n.addEventListener=function(o,l){if(o!==e)return r.apply(this,arguments);const d=h=>{const p=t(h);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,d),r.apply(this,[o,d])};const i=n.removeEventListener;n.removeEventListener=function(o,l){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(l))return i.apply(this,arguments);const d=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,d])},Object.defineProperty(n,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function iP(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(nA=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function aP(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(sA=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function rA(){if(typeof window=="object"){if(nA)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Gb(s,e){sA&&console.warn(s+" is deprecated, please use "+e+" instead.")}function oP(s){const e={browser:null,version:null};if(typeof s>"u"||!s.navigator||!s.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=s;if(t.userAgentData&&t.userAgentData.brands){const n=t.userAgentData.brands.find(r=>r.brand==="Chromium");if(n)return{browser:"chrome",version:parseInt(n.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Nf(t.userAgent,/Firefox\/(\d+)\./,1));else if(t.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Nf(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(s.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Nf(t.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype,e._safariVersion=Nf(t.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function jS(s){return Object.prototype.toString.call(s)==="[object Object]"}function iA(s){return jS(s)?Object.keys(s).reduce(function(e,t){const n=jS(s[t]),r=n?iA(s[t]):s[t],i=n&&!Object.keys(r).length;return r===void 0||i?e:Object.assign(e,{[t]:r})},{}):s}function rb(s,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(n=>{n.endsWith("Id")?rb(s,s.get(e[n]),t):n.endsWith("Ids")&&e[n].forEach(r=>{rb(s,s.get(r),t)})}))}function TS(s,e,t){const n=t?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const i=[];return s.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{s.forEach(l=>{l.type===n&&l.trackId===o.id&&rb(s,l,r)})}),r}const DS=rA;function aA(s,e){const t=s&&s.navigator;if(!t.mediaDevices)return;const n=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const d={};return Object.keys(l).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const p=typeof l[h]=="object"?l[h]:{ideal:l[h]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const g=function(b,x){return b?b+x.charAt(0).toUpperCase()+x.slice(1):x==="deviceId"?"sourceId":x};if(p.ideal!==void 0){d.optional=d.optional||[];let b={};typeof p.ideal=="number"?(b[g("min",h)]=p.ideal,d.optional.push(b),b={},b[g("max",h)]=p.ideal,d.optional.push(b)):(b[g("",h)]=p.ideal,d.optional.push(b))}p.exact!==void 0&&typeof p.exact!="number"?(d.mandatory=d.mandatory||{},d.mandatory[g("",h)]=p.exact):["min","max"].forEach(b=>{p[b]!==void 0&&(d.mandatory=d.mandatory||{},d.mandatory[g(b,h)]=p[b])})}),l.advanced&&(d.optional=(d.optional||[]).concat(l.advanced)),d},r=function(l,d){if(e.version>=61)return d(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const h=function(p,g,b){g in p&&!(b in p)&&(p[b]=p[g],delete p[g])};l=JSON.parse(JSON.stringify(l)),h(l.audio,"autoGainControl","googAutoGainControl"),h(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=n(l.audio)}if(l&&typeof l.video=="object"){let h=l.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const p=e.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!p)){delete l.video.facingMode;let g;if(h.exact==="environment"||h.ideal==="environment"?g=["back","rear"]:(h.exact==="user"||h.ideal==="user")&&(g=["front"]),g)return t.mediaDevices.enumerateDevices().then(b=>{b=b.filter(w=>w.kind==="videoinput");let x=b.find(w=>g.some(v=>w.label.toLowerCase().includes(v)));return!x&&b.length&&g.includes("back")&&(x=b[b.length-1]),x&&(l.video.deviceId=h.exact?{exact:x.deviceId}:{ideal:x.deviceId}),l.video=n(l.video),DS("chrome: "+JSON.stringify(l)),d(l)})}l.video=n(l.video)}return DS("chrome: "+JSON.stringify(l)),d(l)},i=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(l,d,h){r(l,p=>{t.webkitGetUserMedia(p,d,g=>{h&&h(i(g))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const l=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(d){return r(d,h=>l(h).then(p=>{if(h.audio&&!p.getAudioTracks().length||h.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(g=>{g.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(i(p))))}}}function oA(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function lA(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;s.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===r.track.id):i={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[n.stream],this.dispatchEvent(o)}),n.stream.getTracks().forEach(r=>{let i;s.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===r.id):i={track:r};const o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[n.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Vu(s,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function cA(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const e=function(r,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=r.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:r}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(l,d){let h=r.apply(this,arguments);return h||(h=e(this,l),this._senders.push(h)),h};const i=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(l){i.apply(this,arguments);const d=this._senders.indexOf(l);d!==-1&&this._senders.splice(d,1)}}const t=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],t.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const n=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{const l=this._senders.find(d=>d.track===o);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof s=="object"&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const e=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function uA(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const t=s.RTCPeerConnection.prototype.getSenders;t&&(s.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i});const n=s.RTCPeerConnection.prototype.addTrack;n&&(s.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),s.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>TS(o,i.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const t=s.RTCPeerConnection.prototype.getReceivers;t&&(s.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Vu(s,"track",n=>(n.receiver._pc=n.srcElement,n)),s.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>TS(i,r.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype&&"getStats"in s.RTCRtpReceiver.prototype))return;const e=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const n=arguments[0];let r,i,o;return this.getSenders().forEach(l=>{l.track===n&&(r?o=!0:r=l)}),this.getReceivers().forEach(l=>(l.track===n&&(i?o=!0:i=l),l.track===n)),o||r&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function dA(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(o,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const d=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(d)===-1&&this._shimmedLocalStreams[l.id].push(d):this._shimmedLocalStreams[l.id]=[l,d],d};const t=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(h=>{if(this.getSenders().find(g=>g.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();t.apply(this,arguments);const d=this.getSenders().filter(h=>l.indexOf(h)===-1);this._shimmedLocalStreams[o.id]=[o].concat(d)};const n=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],n.apply(this,arguments)};const r=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const d=this._shimmedLocalStreams[l].indexOf(o);d!==-1&&this._shimmedLocalStreams[l].splice(d,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),r.apply(this,arguments)}}function hA(s,e){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&e.version>=65)return dA(s);const t=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const p=t.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(g=>this._reverseStreams[g.id])};const n=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(g=>{if(this.getSenders().find(x=>x.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const g=new s.MediaStream(p.getTracks());this._streams[p.id]=g,this._reverseStreams[g.id]=p,p=g}n.apply(this,[p])};const r=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},s.RTCPeerConnection.prototype.addTrack=function(p,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(v=>v===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const w=this._streams[g.id];if(w)w.addTrack(p),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new s.MediaStream([p]);this._streams[g.id]=v,this._reverseStreams[v.id]=g,this.addStream(v)}return this.getSenders().find(v=>v.track===p)};function i(h,p){let g=p.sdp;return Object.keys(h._reverseStreams||[]).forEach(b=>{const x=h._reverseStreams[b],w=h._streams[x.id];g=g.replace(new RegExp(w.id,"g"),x.id)}),new RTCSessionDescription({type:p.type,sdp:g})}function o(h,p){let g=p.sdp;return Object.keys(h._reverseStreams||[]).forEach(b=>{const x=h._reverseStreams[b],w=h._streams[x.id];g=g.replace(new RegExp(x.id,"g"),w.id)}),new RTCSessionDescription({type:p.type,sdp:g})}["createOffer","createAnswer"].forEach(function(h){const p=s.RTCPeerConnection.prototype[h],g={[h](){const b=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[w=>{const v=i(this,w);b[0].apply(null,[v])},w=>{b[1]&&b[1].apply(null,w)},arguments[2]]):p.apply(this,arguments).then(w=>i(this,w))}};s.RTCPeerConnection.prototype[h]=g[h]});const l=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=o(this,arguments[0]),l.apply(this,arguments))};const d=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const h=d.get.apply(this);return h.type===""?h:i(this,h)}}),s.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(p._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let b;Object.keys(this._streams).forEach(x=>{this._streams[x].getTracks().find(v=>p.track===v)&&(b=this._streams[x])}),b&&(b.getTracks().length===1?this.removeStream(this._reverseStreams[b.id]):b.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ib(s,e){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=s.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new(t==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};s.RTCPeerConnection.prototype[t]=r[t]})}function fA(s,e){Vu(s,"negotiationneeded",t=>{const n=t.target;if(!((e.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")&&n.signalingState!=="stable"))return t})}const LS=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:fA,shimAddTrackRemoveTrack:hA,shimAddTrackRemoveTrackWithNative:dA,shimGetSendersWithDtmf:cA,shimGetUserMedia:aA,shimMediaStream:oA,shimOnTrack:lA,shimPeerConnection:ib,shimSenderReceiverGetStats:uA},Symbol.toStringTag,{value:"Module"}));function pA(s,e){const t=s&&s.navigator,n=s&&s.MediaStreamTrack;if(t.getUserMedia=function(r,i,o){Gb("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(r).then(i,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const r=function(o,l,d){l in o&&!(d in o)&&(o[d]=o[l],delete o[l])},i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},n&&n.prototype.getSettings){const o=n.prototype.getSettings;n.prototype.getSettings=function(){const l=o.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(n&&n.prototype.applyConstraints){const o=n.prototype.applyConstraints;n.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[l])}}}}function lP(s,e){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,s.navigator.mediaDevices.getUserMedia(n)})}function gA(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ab(s,e){if(typeof s!="object"||!(s.RTCPeerConnection||s.mozRTCPeerConnection))return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const i=s.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};s.RTCPeerConnection.prototype[r]=o[r]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[i,o,l]=arguments;return n.apply(this,[i||null]).then(d=>{if(e.version<53&&!o)try{d.forEach(h=>{h.type=t[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;d.forEach((p,g)=>{d.set(g,Object.assign({},p,{type:t[p.type]||p.type}))})}return d}).then(o,l)}}function mA(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const e=s.RTCPeerConnection.prototype.getSenders;e&&(s.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r});const t=s.RTCPeerConnection.prototype.addTrack;t&&(s.RTCPeerConnection.prototype.addTrack=function(){const r=t.apply(this,arguments);return r._pc=this,r}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function xA(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const e=s.RTCPeerConnection.prototype.getReceivers;e&&(s.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n}),Vu(s,"track",t=>(t.receiver._pc=t.srcElement,t)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function bA(s){!s.RTCPeerConnection||"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(t){Gb("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&t.getTracks().includes(n.track)&&this.removeTrack(n)})})}function yA(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function vA(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.addTransceiver;e&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(r){const{sender:o}=i,l=o.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=n,o.sendEncodings=n,this.setParametersPromises.push(o.setParameters(l).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function wA(s){if(!(typeof s=="object"&&s.RTCRtpSender))return;const e=s.RTCRtpSender.prototype.getParameters;e&&(s.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function SA(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function _A(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const RS=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:vA,shimCreateAnswer:_A,shimCreateOffer:SA,shimGetDisplayMedia:lP,shimGetParameters:wA,shimGetUserMedia:pA,shimOnTrack:gA,shimPeerConnection:ab,shimRTCDataChannel:yA,shimReceiverGetStats:xA,shimRemoveStream:bA,shimSenderGetStats:mA},Symbol.toStringTag,{value:"Module"}));function AA(s){if(!(typeof s!="object"||!s.RTCPeerConnection)){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const e=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>e.call(this,r,n)),n.getVideoTracks().forEach(r=>e.call(this,r,n))},s.RTCPeerConnection.prototype.addTrack=function(n,...r){return r&&r.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach(i=>{r.includes(i.track)&&this.removeTrack(i)})})}}function NA(s){if(!(typeof s!="object"||!s.RTCPeerConnection)&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const i=new Event("addstream");i.stream=r,this.dispatchEvent(i)})})}});const e=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,n.dispatchEvent(o)})}),e.apply(n,arguments)}}}function CA(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const e=s.RTCPeerConnection.prototype,t=e.createOffer,n=e.createAnswer,r=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(h,p){const g=arguments.length>=2?arguments[2]:arguments[0],b=t.apply(this,[g]);return p?(b.then(h,p),Promise.resolve()):b},e.createAnswer=function(h,p){const g=arguments.length>=2?arguments[2]:arguments[0],b=n.apply(this,[g]);return p?(b.then(h,p),Promise.resolve()):b};let l=function(d,h,p){const g=r.apply(this,[d]);return p?(g.then(h,p),Promise.resolve()):g};e.setLocalDescription=l,l=function(d,h,p){const g=i.apply(this,[d]);return p?(g.then(h,p),Promise.resolve()):g},e.setRemoteDescription=l,l=function(d,h,p){const g=o.apply(this,[d]);return p?(g.then(h,p),Promise.resolve()):g},e.addIceCandidate=l}function EA(s){const e=s&&s.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,n=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=r=>n(kA(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,r,i){e.mediaDevices.getUserMedia(n).then(r,i)}).bind(e))}function kA(s){return s&&s.video!==void 0?Object.assign({},s,{video:iA(s.video)}):s}function jA(s){if(!s.RTCPeerConnection)return;const e=s.RTCPeerConnection;s.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let o=0;o<n.iceServers.length;o++){let l=n.iceServers[o];l.urls===void 0&&l.url?(Gb("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,i.push(l)):i.push(n.iceServers[o])}n.iceServers=i}return new e(n,r)},s.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function TA(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function DA(s){const e=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio<"u"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof n.offerToReceiveVideo<"u"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function LA(s){typeof s!="object"||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}const PS=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:LA,shimCallbacksAPI:CA,shimConstraints:kA,shimCreateOfferLegacy:DA,shimGetUserMedia:EA,shimLocalStreamsAPI:AA,shimRTCIceServerUrls:jA,shimRemoteStreamsAPI:NA,shimTrackEventTransceiver:TA},Symbol.toStringTag,{value:"Module"}));var f1={exports:{}},BS;function cP(){return BS||(BS=1,(function(s){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(n=>n.trim())},e.splitSections=function(t){return t.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(t){const n=e.splitSections(t);return n&&n[0]},e.getMediaSections=function(t){const n=e.splitSections(t);return n.shift(),n},e.matchPrefix=function(t,n){return e.splitLines(t).filter(r=>r.indexOf(n)===0)},e.parseCandidate=function(t){let n;t.indexOf("a=candidate:")===0?n=t.substring(12).split(" "):n=t.substring(10).split(" ");const r={foundation:n[0],component:{1:"rtp",2:"rtcp"}[n[1]]||n[1],protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]};for(let i=8;i<n.length;i+=2)switch(n[i]){case"raddr":r.relatedAddress=n[i+1];break;case"rport":r.relatedPort=parseInt(n[i+1],10);break;case"tcptype":r.tcpType=n[i+1];break;case"ufrag":r.ufrag=n[i+1],r.usernameFragment=n[i+1];break;default:r[n[i]]===void 0&&(r[n[i]]=n[i+1]);break}return r},e.writeCandidate=function(t){const n=[];n.push(t.foundation);const r=t.component;r==="rtp"?n.push(1):r==="rtcp"?n.push(2):n.push(r),n.push(t.protocol.toUpperCase()),n.push(t.priority),n.push(t.address||t.ip),n.push(t.port);const i=t.type;return n.push("typ"),n.push(i),i!=="host"&&t.relatedAddress&&t.relatedPort&&(n.push("raddr"),n.push(t.relatedAddress),n.push("rport"),n.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(n.push("ufrag"),n.push(t.usernameFragment||t.ufrag)),"candidate:"+n.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let n=t.substring(9).split(" ");const r={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),r.name=n[0],r.clockRate=parseInt(n[1],10),r.channels=n.length===3?parseInt(n[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(t){let n=t.payloadType;t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType);const r=t.channels||t.numChannels||1;return"a=rtpmap:"+n+" "+t.name+"/"+t.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(t){const n=t.substring(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1],attributes:n.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const n={};let r;const i=t.substring(t.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)r=i[o].trim().split("="),n[r[0].trim()]=r[1];return n},e.writeFmtp=function(t){let n="",r=t.payloadType;if(t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const i=[];Object.keys(t.parameters).forEach(o=>{t.parameters[o]!==void 0?i.push(o+"="+t.parameters[o]):i.push(o)}),n+="a=fmtp:"+r+" "+i.join(";")+`\r
`}return n},e.parseRtcpFb=function(t){const n=t.substring(t.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},e.writeRtcpFb=function(t){let n="",r=t.payloadType;return t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(i=>{n+="a=rtcp-fb:"+r+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),n},e.parseSsrcMedia=function(t){const n=t.indexOf(" "),r={ssrc:parseInt(t.substring(7,n),10)},i=t.indexOf(":",n);return i>-1?(r.attribute=t.substring(n+1,i),r.value=t.substring(i+1)):r.attribute=t.substring(n+1),r},e.parseSsrcGroup=function(t){const n=t.substring(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(r=>parseInt(r,10))}},e.getMid=function(t){const n=e.matchPrefix(t,"a=mid:")[0];if(n)return n.substring(6)},e.parseFingerprint=function(t){const n=t.substring(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1].toUpperCase()}},e.getDtlsParameters=function(t,n){return{role:"auto",fingerprints:e.matchPrefix(t+n,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,n){let r="a=setup:"+n+`\r
`;return t.fingerprints.forEach(i=>{r+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),r},e.parseCryptoLine=function(t){const n=t.substring(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const n=t.substring(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,n){return e.matchPrefix(t+n,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,n){const r=e.matchPrefix(t+n,"a=ice-ufrag:")[0],i=e.matchPrefix(t+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(t){let n="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(n+=`a=ice-lite\r
`),n},e.parseRtpParameters=function(t){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(t)[0].split(" ");n.profile=i[2];for(let l=3;l<i.length;l++){const d=i[l],h=e.matchPrefix(t,"a=rtpmap:"+d+" ")[0];if(h){const p=e.parseRtpMap(h),g=e.matchPrefix(t,"a=fmtp:"+d+" ");switch(p.parameters=g.length?e.parseFmtp(g[0]):{},p.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+d+" ").map(e.parseRtcpFb),n.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(p.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(l=>{n.headerExtensions.push(e.parseExtmap(l))});const o=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return n.codecs.forEach(l=>{o.forEach(d=>{l.rtcpFeedback.find(p=>p.type===d.type&&p.parameter===d.parameter)||l.rtcpFeedback.push(d)})}),n},e.writeRtpDescription=function(t,n){let r="";r+="m="+t+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let i=0;return n.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(r+="a=maxptime:"+i+`\r
`),n.headerExtensions&&n.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(t){const n=[],r=e.parseRtpParameters(t),i=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(t,"a=ssrc:").map(b=>e.parseSsrcMedia(b)).filter(b=>b.attribute==="cname"),d=l.length>0&&l[0].ssrc;let h;const p=e.matchPrefix(t,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(w=>parseInt(w,10)));p.length>0&&p[0].length>1&&p[0][0]===d&&(h=p[0][1]),r.codecs.forEach(b=>{if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){let x={ssrc:d,codecPayloadType:parseInt(b.parameters.apt,10)};d&&h&&(x.rtx={ssrc:h}),n.push(x),i&&(x=JSON.parse(JSON.stringify(x)),x.fec={ssrc:d,mechanism:o?"red+ulpfec":"red"},n.push(x))}}),n.length===0&&d&&n.push({ssrc:d});let g=e.matchPrefix(t,"b=");return g.length&&(g[0].indexOf("b=TIAS:")===0?g=parseInt(g[0].substring(7),10):g[0].indexOf("b=AS:")===0?g=parseInt(g[0].substring(5),10)*1e3*.95-2e3*8:g=void 0,n.forEach(b=>{b.maxBitrate=g})),n},e.parseRtcpParameters=function(t){const n={},r=e.matchPrefix(t,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=e.matchPrefix(t,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=i.length===0;const o=e.matchPrefix(t,"a=rtcp-mux");return n.mux=o.length>0,n},e.writeRtcpParameters=function(t){let n="";return t.reducedSize&&(n+=`a=rtcp-rsize\r
`),t.mux&&(n+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(n+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),n},e.parseMsid=function(t){let n;const r=e.matchPrefix(t,"a=msid:");if(r.length===1)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=e.matchPrefix(t,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return n=i[0].value.split(" "),{stream:n[0],track:n[1]}},e.parseSctpDescription=function(t){const n=e.parseMLine(t),r=e.matchPrefix(t,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const l=e.matchPrefix(t,"a=sctpmap:");if(l.length>0){const d=l[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:i}}},e.writeSctpDescription=function(t,n){let r=[];return t.protocol!=="DTLS/SCTP"?r=["m="+t.kind+" 9 "+t.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:r=["m="+t.kind+" 9 "+t.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&r.push("a=max-message-size:"+n.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,n,r){let i;const o=n!==void 0?n:2;return t?i=t:i=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,n){const r=e.splitLines(t);for(let i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substring(2)}return n?e.getDirection(n):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const r=e.splitLines(t)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(t){const r=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const n=e.splitLines(t);for(let r=0;r<n.length;r++)if(n[r].length<2||n[r].charAt(1)!=="=")return!1;return!0},s.exports=e})(f1)),f1.exports}var RA=cP();const ph=Ig(RA),uP=Y3({__proto__:null,default:ph},[RA]);function pg(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const e=s.RTCIceCandidate;s.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substring(2)),n.candidate&&n.candidate.length){const r=new e(n),i=ph.parseCandidate(n.candidate);for(const o in i)o in r||Object.defineProperty(r,o,{value:i[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(n)},s.RTCIceCandidate.prototype=e.prototype,Vu(s,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new s.RTCIceCandidate(t.candidate),writable:"false"}),t))}function ob(s){!s.RTCIceCandidate||s.RTCIceCandidate&&"relayProtocol"in s.RTCIceCandidate.prototype||Vu(s,"icecandidate",e=>{if(e.candidate){const t=ph.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function gg(s,e){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(l){if(!l||!l.sdp)return!1;const d=ph.splitSections(l.sdp);return d.shift(),d.some(h=>{const p=ph.parseMLine(h);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},n=function(l){const d=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;const h=parseInt(d[1],10);return h!==h?-1:h},r=function(l){let d=65536;return e.browser==="firefox"&&(e.version<57?l===-1?d=16384:d=2147483637:e.version<60?d=e.version===57?65535:65536:d=2147483637),d},i=function(l,d){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const p=ph.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?h=parseInt(p[0].substring(19),10):e.browser==="firefox"&&d!==-1&&(h=2147483637),h},o=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:d}=this.getConfiguration();d==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const d=n(arguments[0]),h=r(d),p=i(arguments[0],d);let g;h===0&&p===0?g=Number.POSITIVE_INFINITY:h===0||p===0?g=Math.max(h,p):g=Math.min(h,p);const b={};Object.defineProperty(b,"maxMessageSize",{get(){return g}}),this._sctp=b}return o.apply(this,arguments)}}function mg(s){if(!(s.RTCPeerConnection&&"createDataChannel"in s.RTCPeerConnection.prototype))return;function e(n,r){const i=n.send;n.send=function(){const l=arguments[0],d=l.length||l.size||l.byteLength;if(n.readyState==="open"&&r.sctp&&d>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return i.apply(n,arguments)}}const t=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const r=t.apply(this,arguments);return e(r,this),r},Vu(s,"datachannel",n=>(e(n.channel,n.target),n))}function lb(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const e=s.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const n=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const i=r.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",r);i.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function cb(s,e){if(!s.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const t=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);s.RTCSessionDescription&&r instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return t.apply(this,arguments)}}function xg(s,e){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const t=s.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function bg(s,e){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const t=s.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(s.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return t.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?t.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>t.apply(this,[o]))})}const dP=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:cb,shimAddIceCandidateNullOrEmpty:xg,shimConnectionState:lb,shimMaxMessageSize:gg,shimParameterlessSetLocalDescription:bg,shimRTCIceCandidate:pg,shimRTCIceCandidateRelayProtocol:ob,shimSendThrowTypeError:mg},Symbol.toStringTag,{value:"Module"}));function hP({window:s}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const t=rA,n=oP(s),r={browserDetails:n,commonShim:dP,extractVersion:Nf,disableLog:iP,disableWarnings:aP,sdp:uP};switch(n.browser){case"chrome":if(!LS||!ib||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),r;if(n.version===null)return t("Chrome shim can not determine version, not shimming."),r;t("adapter.js shimming chrome."),r.browserShim=LS,xg(s,n),bg(s),aA(s,n),oA(s),ib(s,n),lA(s),hA(s,n),cA(s),uA(s),fA(s,n),pg(s),ob(s),lb(s),gg(s,n),mg(s),cb(s,n);break;case"firefox":if(!RS||!ab||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),r;t("adapter.js shimming firefox."),r.browserShim=RS,xg(s,n),bg(s),pA(s,n),ab(s,n),gA(s),bA(s),mA(s),xA(s),yA(s),vA(s),wA(s),SA(s),_A(s),pg(s),lb(s),gg(s,n),mg(s);break;case"safari":if(!PS||!e.shimSafari)return t("Safari shim is not included in this adapter release."),r;t("adapter.js shimming safari."),r.browserShim=PS,xg(s,n),bg(s),jA(s),DA(s),CA(s),AA(s),NA(s),TA(s),EA(s),LA(s),pg(s),ob(s),gg(s,n),mg(s),cb(s,n);break;default:t("Unsupported browser!");break}return r}const OS=hP({window:typeof window>"u"?void 0:window});function Wu(s,e,t,n){Object.defineProperty(s,e,{get:t,set:n,enumerable:!0,configurable:!0})}class PA{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const t=[],n=e.byteLength,r=Math.ceil(n/this.chunkedMTU);let i=0,o=0;for(;o<n;){const l=Math.min(n,o+this.chunkedMTU),d=e.slice(o,l),h={__peerData:this._dataCount,n:i,data:d,total:r};t.push(h),o=l,i++}return this._dataCount++,t}}}function fP(s){let e=0;for(const r of s)e+=r.byteLength;const t=new Uint8Array(e);let n=0;for(const r of s)t.set(r,n),n+=r.byteLength;return t}const p1=OS.default||OS,yf=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const s=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(s)?s==="chrome"?e>=this.minChromeVersion:s==="firefox"?e>=this.minFirefoxVersion:s==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return p1.browserDetails.browser}getVersion(){return p1.browserDetails.version||0}isUnifiedPlanSupported(){const s=this.getBrowser(),e=p1.browserDetails.version||0;if(s==="chrome"&&e<this.minChromeVersion)return!1;if(s==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t,n=!1;try{t=new RTCPeerConnection,t.addTransceiver("audio"),n=!0}catch{}finally{t&&t.close()}return n}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},pP=s=>!s||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(s),BA=()=>Math.random().toString(36).slice(2),IS={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class gP extends PA{noop(){}blobToArrayBuffer(e,t){const n=new FileReader;return n.onload=function(r){r.target&&t(r.target.result)},n.readAsArrayBuffer(e),n}binaryStringToArrayBuffer(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n)&255;return t.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=IS,this.browser=yf.getBrowser(),this.browserVersion=yf.getVersion(),this.pack=tA,this.unpack=eA,this.supports=(function(){const t={browser:yf.isBrowserSupported(),webRTC:yf.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;let n;try{n=new RTCPeerConnection(IS),t.audioVideo=!0;let r;try{r=n.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!r.ordered;try{r.binaryType="blob",t.binaryBlob=!yf.isIOS}catch{}}catch{}finally{r&&r.close()}}catch{}finally{n&&n.close()}return t})(),this.validateId=pP,this.randomToken=BA}}const ia=new gP,mP="PeerJS: ";class xP{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){const n=[mP,...t];for(const r in n)n[r]instanceof Error&&(n[r]="("+n[r].name+") "+n[r].message);e>=3?console.log(...n):e>=2?console.warn("WARNING",...n):e>=1&&console.error("ERROR",...n)}constructor(){this._logLevel=0}}var Jt=new xP,Vb={},bP=Object.prototype.hasOwnProperty,Mi="~";function Yf(){}Object.create&&(Yf.prototype=Object.create(null),new Yf().__proto__||(Mi=!1));function yP(s,e,t){this.fn=s,this.context=e,this.once=t||!1}function OA(s,e,t,n,r){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new yP(t,n||s,r),o=Mi?Mi+e:e;return s._events[o]?s._events[o].fn?s._events[o]=[s._events[o],i]:s._events[o].push(i):(s._events[o]=i,s._eventsCount++),s}function yg(s,e){--s._eventsCount===0?s._events=new Yf:delete s._events[e]}function Ni(){this._events=new Yf,this._eventsCount=0}Ni.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)bP.call(t,n)&&e.push(Mi?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Ni.prototype.listeners=function(e){var t=Mi?Mi+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,o=new Array(i);r<i;r++)o[r]=n[r].fn;return o};Ni.prototype.listenerCount=function(e){var t=Mi?Mi+e:e,n=this._events[t];return n?n.fn?1:n.length:0};Ni.prototype.emit=function(e,t,n,r,i,o){var l=Mi?Mi+e:e;if(!this._events[l])return!1;var d=this._events[l],h=arguments.length,p,g;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),h){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,r),!0;case 5:return d.fn.call(d.context,t,n,r,i),!0;case 6:return d.fn.call(d.context,t,n,r,i,o),!0}for(g=1,p=new Array(h-1);g<h;g++)p[g-1]=arguments[g];d.fn.apply(d.context,p)}else{var b=d.length,x;for(g=0;g<b;g++)switch(d[g].once&&this.removeListener(e,d[g].fn,void 0,!0),h){case 1:d[g].fn.call(d[g].context);break;case 2:d[g].fn.call(d[g].context,t);break;case 3:d[g].fn.call(d[g].context,t,n);break;case 4:d[g].fn.call(d[g].context,t,n,r);break;default:if(!p)for(x=1,p=new Array(h-1);x<h;x++)p[x-1]=arguments[x];d[g].fn.apply(d[g].context,p)}}return!0};Ni.prototype.on=function(e,t,n){return OA(this,e,t,n,!1)};Ni.prototype.once=function(e,t,n){return OA(this,e,t,n,!0)};Ni.prototype.removeListener=function(e,t,n,r){var i=Mi?Mi+e:e;if(!this._events[i])return this;if(!t)return yg(this,i),this;var o=this._events[i];if(o.fn)o.fn===t&&(!r||o.once)&&(!n||o.context===n)&&yg(this,i);else{for(var l=0,d=[],h=o.length;l<h;l++)(o[l].fn!==t||r&&!o[l].once||n&&o[l].context!==n)&&d.push(o[l]);d.length?this._events[i]=d.length===1?d[0]:d:yg(this,i)}return this};Ni.prototype.removeAllListeners=function(e){var t;return e?(t=Mi?Mi+e:e,this._events[t]&&yg(this,t)):(this._events=new Yf,this._eventsCount=0),this};Ni.prototype.off=Ni.prototype.removeListener;Ni.prototype.addListener=Ni.prototype.on;Ni.prefixed=Mi;Ni.EventEmitter=Ni;Vb=Ni;var Yu={};Wu(Yu,"ConnectionType",()=>qc);Wu(Yu,"PeerErrorType",()=>jr);Wu(Yu,"BaseConnectionErrorType",()=>ub);Wu(Yu,"DataConnectionErrorType",()=>Wb);Wu(Yu,"SerializationType",()=>im);Wu(Yu,"SocketEventType",()=>$c);Wu(Yu,"ServerMessageType",()=>Ai);var qc=(function(s){return s.Data="data",s.Media="media",s})({}),jr=(function(s){return s.BrowserIncompatible="browser-incompatible",s.Disconnected="disconnected",s.InvalidID="invalid-id",s.InvalidKey="invalid-key",s.Network="network",s.PeerUnavailable="peer-unavailable",s.SslUnavailable="ssl-unavailable",s.ServerError="server-error",s.SocketError="socket-error",s.SocketClosed="socket-closed",s.UnavailableID="unavailable-id",s.WebRTC="webrtc",s})({}),ub=(function(s){return s.NegotiationFailed="negotiation-failed",s.ConnectionClosed="connection-closed",s})({}),Wb=(function(s){return s.NotOpenYet="not-open-yet",s.MessageToBig="message-too-big",s})({}),im=(function(s){return s.Binary="binary",s.BinaryUTF8="binary-utf8",s.JSON="json",s.None="raw",s})({}),$c=(function(s){return s.Message="message",s.Disconnected="disconnected",s.Error="error",s.Close="close",s})({}),Ai=(function(s){return s.Heartbeat="HEARTBEAT",s.Candidate="CANDIDATE",s.Offer="OFFER",s.Answer="ANSWER",s.Open="OPEN",s.Error="ERROR",s.IdTaken="ID-TAKEN",s.InvalidKey="INVALID-KEY",s.Leave="LEAVE",s.Expire="EXPIRE",s})({});const IA="1.5.5";class vP extends Vb.EventEmitter{constructor(e,t,n,r,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const l=e?"wss://":"ws://";this._baseUrl=l+t+":"+n+r+"peerjs?key="+i}start(e,t){this._id=e;const n=`${this._baseUrl}&id=${e}&token=${t}`;this._socket||!this._disconnected||(this._socket=new WebSocket(n+"&version="+IA),this._disconnected=!1,this._socket.onmessage=r=>{let i;try{i=JSON.parse(r.data),Jt.log("Server message received:",i)}catch{Jt.log("Invalid server message",r.data);return}this.emit($c.Message,i)},this._socket.onclose=r=>{this._disconnected||(Jt.log("Socket closed.",r),this._cleanup(),this._disconnected=!0,this.emit($c.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),Jt.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){Jt.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:Ai.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const t of e)this.send(t)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit($c.Error,"Invalid message");return}if(!this._wsOpen())return;const t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class MA{constructor(e){this.connection=e}startConnection(e){const t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===qc.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){const n=this.connection,r={ordered:!!e.reliable},i=t.createDataChannel(n.label,r);n._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){Jt.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const t=this.connection.peer,n=this.connection.connectionId,r=this.connection.type,i=this.connection.provider;Jt.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(Jt.log(`Received ICE candidates for ${t}:`,o.candidate),i.socket.send({type:Ai.Candidate,payload:{candidate:o.candidate,type:r,connectionId:n},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":Jt.log("iceConnectionState is failed, closing connections to "+t),this.connection.emitError(ub.NegotiationFailed,"Negotiation of connection to "+t+" failed."),this.connection.close();break;case"closed":Jt.log("iceConnectionState is closed, closing connections to "+t),this.connection.emitError(ub.ConnectionClosed,"Connection to "+t+" closed."),this.connection.close();break;case"disconnected":Jt.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},Jt.log("Listening for data channel"),e.ondatachannel=o=>{Jt.log("Received data channel");const l=o.channel;i.getConnection(t,n)._initializeDataChannel(l)},Jt.log("Listening for remote stream"),e.ontrack=o=>{Jt.log("Received remote stream");const l=o.streams[0],d=i.getConnection(t,n);if(d.type===qc.Media){const h=d;this._addStreamToMediaConnection(l,h)}}}cleanup(){Jt.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const t=e.signalingState!=="closed";let n=!1;const r=this.connection.dataChannel;r&&(n=!!r.readyState&&r.readyState!=="closed"),(t||n)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const n=await e.createOffer(this.connection.options.constraints);Jt.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp);try{await e.setLocalDescription(n),Jt.log("Set localDescription:",n,`for:${this.connection.peer}`);let r={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===qc.Data){const i=this.connection;r={...r,label:i.label,reliable:i.reliable,serialization:i.serialization}}t.socket.send({type:Ai.Offer,payload:r,dst:this.connection.peer})}catch(r){r!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(jr.WebRTC,r),Jt.log("Failed to setLocalDescription, ",r))}}catch(n){t.emitError(jr.WebRTC,n),Jt.log("Failed to createOffer, ",n)}}async _makeAnswer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const n=await e.createAnswer();Jt.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp);try{await e.setLocalDescription(n),Jt.log("Set localDescription:",n,`for:${this.connection.peer}`),t.socket.send({type:Ai.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(r){t.emitError(jr.WebRTC,r),Jt.log("Failed to setLocalDescription, ",r)}}catch(n){t.emitError(jr.WebRTC,n),Jt.log("Failed to create answer, ",n)}}async handleSDP(e,t){t=new RTCSessionDescription(t);const n=this.connection.peerConnection,r=this.connection.provider;Jt.log("Setting remote description",t);const i=this;try{await n.setRemoteDescription(t),Jt.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){r.emitError(jr.WebRTC,o),Jt.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){Jt.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),Jt.log(`Added ICE candidate for:${this.connection.peer}`)}catch(t){this.connection.provider.emitError(jr.WebRTC,t),Jt.log("Failed to handleCandidate, ",t)}}_addTracksToConnection(e,t){if(Jt.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return Jt.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(n=>{t.addTrack(n,e)})}_addStreamToMediaConnection(e,t){Jt.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}}class FA extends Vb.EventEmitter{emitError(e,t){Jt.error("Error:",t),this.emit("error",new wP(`${e}`,t))}}class wP extends Error{constructor(e,t){typeof t=="string"?super(t):(super(),Object.assign(this,t)),this.type=e}}class UA extends FA{get open(){return this._open}constructor(e,t,n){super(),this.peer=e,this.provider=t,this.options=n,this._open=!1,this.metadata=n.metadata}}class Pg extends UA{static#e=this.ID_PREFIX="mc_";get type(){return qc.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,t,n){super(e,t,n),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||Pg.ID_PREFIX+ia.randomToken(),this._negotiator=new MA(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Jt.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{Jt.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){Jt.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const t=e.type,n=e.payload;switch(e.type){case Ai.Answer:this._negotiator.handleSDP(t,n.sdp),this._open=!0;break;case Ai.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:Jt.warn(`Unrecognized message type:${t} from peer:${this.peer}`);break}}answer(e,t={}){if(this._localStream){Jt.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const n=this.provider._getMessages(this.connectionId);for(const r of n)this.handleMessage(r);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class SP{constructor(e){this._options=e}_buildRequest(e){const t=this._options.secure?"https":"http",{host:n,port:r,path:i,key:o}=this._options,l=new URL(`${t}://${n}:${r}${i}${o}/${e}`);return l.searchParams.set("ts",`${Date.now()}${Math.random()}`),l.searchParams.set("version",IA),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){Jt.error("Error retrieving ID",e);let t="";throw this._options.path==="/"&&this._options.host!==ia.CLOUD_HOST&&(t=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+t)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let t="";throw this._options.host===ia.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw Jt.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}class Bg extends UA{static#e=this.ID_PREFIX="dc_";static#t=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return qc.Data}constructor(e,t,n){super(e,t,n),this.connectionId=this.options.connectionId||Bg.ID_PREFIX+BA(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new MA(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Jt.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=t=>{Jt.log(`DC#${this.connectionId} dc onmessage:`,t.data)},this.dataChannel.onclose=()=>{Jt.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,t=!1){if(!this.open){this.emitError(Wb.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,t)}async handleMessage(e){const t=e.payload;switch(e.type){case Ai.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case Ai.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:Jt.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}}class Yb extends Bg{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",t=>this._handleDataMessage(t))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>Bg.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(t){return Jt.error(`DC#:${this.connectionId} Error when sending:`,t),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class g1 extends Yb{close(e){super.close(e),this._chunkedData={}}constructor(e,t,n){super(e,t,n),this.chunker=new PA,this.serialization=im.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const t=eA(e),n=t.__peerData;if(n){if(n.type==="close"){this.close();return}this._handleChunk(t);return}this.emit("data",t)}_handleChunk(e){const t=e.__peerData,n=this._chunkedData[t]||{data:[],count:0,total:e.total};if(n.data[e.n]=new Uint8Array(e.data),n.count++,this._chunkedData[t]=n,n.total===n.count){delete this._chunkedData[t];const r=fP(n.data);this._handleDataMessage({data:r})}}_send(e,t){const n=tA(e);if(n instanceof Promise)return this._send_blob(n);if(!t&&n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}async _send_blob(e){const t=await e;if(t.byteLength>this.chunker.chunkedMTU){this._sendChunks(t);return}this._bufferedSend(t)}_sendChunks(e){const t=this.chunker.chunk(e);Jt.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`);for(const n of t)this.send(n,!0)}}class _P extends Yb{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=im.None}}class AP extends Yb{_handleDataMessage({data:e}){const t=this.parse(this.decoder.decode(e)),n=t.__peerData;if(n&&n.type==="close"){this.close();return}this.emit("data",t)}_send(e,t){const n=this.encoder.encode(this.stringify(e));if(n.byteLength>=ia.chunkedMTU){this.emitError(Wb.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(n)}constructor(...e){super(...e),this.serialization=im.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class Kb extends FA{static#e=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[t,n]of this._connections)e[t]=n;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,t){super(),this._serializers={raw:_P,json:AP,binary:g1,"binary-utf8":g1,default:g1},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let n;if(e&&e.constructor==Object?t=e:e&&(n=e.toString()),t={debug:0,host:ia.CLOUD_HOST,port:ia.CLOUD_PORT,path:"/",key:Kb.DEFAULT_KEY,token:ia.randomToken(),config:ia.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...t},this._options=t,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==ia.CLOUD_HOST?this._options.secure=ia.isSecure():this._options.host==ia.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&Jt.setLogFunction(this._options.logFunction),Jt.logLevel=this._options.debug||0,this._api=new SP(t),this._socket=this._createServerConnection(),!ia.supports.audioVideo&&!ia.supports.data){this._delayedAbort(jr.BrowserIncompatible,"The current browser does not support WebRTC");return}if(n&&!ia.validateId(n)){this._delayedAbort(jr.InvalidID,`ID "${n}" is invalid`);return}n?this._initialize(n):this._api.retrieveId().then(r=>this._initialize(r)).catch(r=>this._abort(jr.ServerError,r))}_createServerConnection(){const e=new vP(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on($c.Message,t=>{this._handleMessage(t)}),e.on($c.Error,t=>{this._abort(jr.SocketError,t)}),e.on($c.Disconnected,()=>{this.disconnected||(this.emitError(jr.Network,"Lost connection to server."),this.disconnect())}),e.on($c.Close,()=>{this.disconnected||this._abort(jr.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const t=e.type,n=e.payload,r=e.src;switch(t){case Ai.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Ai.Error:this._abort(jr.ServerError,n.msg);break;case Ai.IdTaken:this._abort(jr.UnavailableID,`ID "${this.id}" is taken`);break;case Ai.InvalidKey:this._abort(jr.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case Ai.Leave:Jt.log(`Received leave message from ${r}`),this._cleanupPeer(r),this._connections.delete(r);break;case Ai.Expire:this.emitError(jr.PeerUnavailable,`Could not connect to peer ${r}`);break;case Ai.Offer:{const i=n.connectionId;let o=this.getConnection(r,i);if(o&&(o.close(),Jt.warn(`Offer received for existing Connection ID:${i}`)),n.type===qc.Media){const d=new Pg(r,this,{connectionId:i,_payload:n,metadata:n.metadata});o=d,this._addConnection(r,o),this.emit("call",d)}else if(n.type===qc.Data){const d=new this._serializers[n.serialization](r,this,{connectionId:i,_payload:n,metadata:n.metadata,label:n.label,serialization:n.serialization,reliable:n.reliable});o=d,this._addConnection(r,o),this.emit("connection",d)}else{Jt.warn(`Received malformed connection type:${n.type}`);return}const l=this._getMessages(i);for(const d of l)o.handleMessage(d);break}default:{if(!n){Jt.warn(`You received a malformed message from ${r} of type ${t}`);return}const i=n.connectionId,o=this.getConnection(r,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):Jt.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){const t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:"default",...t},this.disconnected){Jt.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(jr.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const n=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,n),n}call(e,t,n={}){if(this.disconnected){Jt.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(jr.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!t){Jt.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const r=new Pg(e,this,{...n,_stream:t});return this._addConnection(e,r),r}_addConnection(e,t){Jt.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){const t=this._connections.get(e.peer);if(t){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){const n=this._connections.get(e);if(!n)return null;for(const r of n)if(r.connectionId===t)return r;return null}_delayedAbort(e,t){setTimeout(()=>{this._abort(e,t)},0)}_abort(e,t){Jt.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(Jt.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const t=this._connections.get(e);if(t)for(const n of t)n.close()}disconnect(){if(this.disconnected)return;const e=this.id;Jt.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)Jt.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Jt.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=t=>{}){this._api.listAllPeers().then(t=>e(t)).catch(t=>this._abort(jr.ServerError,t))}}var NP=Kb;const CP=({onConnection:s,isStudent:e,isHost:t,roomId:n})=>{const[r,i]=Y.useState(""),[o,l]=Y.useState(""),[d,h]=Y.useState(null),[p,g]=Y.useState(!0),[b,x]=Y.useState(!0),[w,v]=Y.useState(""),_=Y.useRef(null),N=Y.useRef(null),E=Y.useRef(null),k=Y.useRef(null),T=Y.useRef([]),P=Y.useRef(null),O=ke=>ke?ke.replace(/[^a-zA-Z0-9-_]/g,"-"):void 0;Y.useEffect(()=>{if(!n)return;E.current&&E.current.destroy();const ke=e?void 0:O(n),X=new NP(ke,{debug:2,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}]}});return E.current=X,X.on("error",Pe=>{if(console.error("Peer error:",Pe),Pe.type==="peer-unavailable"){console.log("Peer unavailable (expected during connection/refresh), retrying...");return}v(`Connection Error: ${Pe.type} - ${Pe.message}`)}),X.on("open",Pe=>{console.log("My Peer ID:",Pe),i(Pe),e&&l(O(n))}),X.on("connection",Pe=>{console.log("Incoming data connection established"),P.current=Pe,Pe.on("open",()=>{s&&s(Pe)}),Pe.on("data",gt=>{gt&&gt.type==="screenShareStarted"?Re("remote"):gt&&gt.type==="screenShareStopped"&&Re(null),window.externalDraw&&window.externalDraw(gt)})}),navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(Pe=>{h(Pe),k.current=Pe,_.current&&(_.current.srcObject=Pe),X.on("call",gt=>{console.log("Receiving call..."),gt.answer(Pe),T.current.push(gt),gt.on("stream",bt=>{console.log("Received remote stream"),N.current&&(N.current.srcObject=bt)}),gt.on("close",()=>{T.current=T.current.filter(bt=>bt!==gt)})})}).catch(Pe=>{console.warn("Failed to get local stream, falling back to dummy stream",Pe),v(`Camera not found (${Pe.message}). Using dummy video for testing.`);const gt=document.createElement("canvas");gt.width=640,gt.height=480;const bt=gt.getContext("2d"),Ye=()=>{bt.fillStyle="#1e1e2e",bt.fillRect(0,0,gt.width,gt.height);const Ut=Date.now()/1e3,je=gt.width/2+Math.cos(Ut)*100,Me=gt.height/2+Math.sin(Ut)*100;bt.beginPath(),bt.arc(je,Me,50,0,Math.PI*2),bt.fillStyle="#a855f7",bt.fill(),bt.fillStyle="white",bt.font="40px Arial",bt.fillText(window.location.hash?"Student (No Cam)":"Teacher (No Cam)",50,100),requestAnimationFrame(Ye)};Ye();const Et=gt.captureStream(30),vt=new(window.AudioContext||window.webkitAudioContext),st=vt.createOscillator(),St=st.connect(vt.createMediaStreamDestination());st.start();const Pt=St.stream.getAudioTracks()[0];Et.addTrack(Pt),h(Et),k.current=Et,_.current&&(_.current.srcObject=Et),X.on("call",Ut=>{console.log("Receiving call (dummy)..."),Ut.answer(Et),Ut.on("stream",je=>{N.current&&(N.current.srcObject=je)})})}),()=>{E.current&&E.current.destroy()}},[n,e]),Y.useEffect(()=>{let ke;return d&&o&&E.current&&!E.current.disconnected&&(console.log("Stream ready, auto-connecting to",o),F(o),e&&(ke=setInterval(()=>{(!P.current||!P.current.open)&&(console.log("Retrying connection to teacher..."),F(o))},5e3))),()=>{ke&&clearInterval(ke)}},[d,o]);const F=ke=>{if(!k.current||!E.current){console.warn("Cannot connect: Stream or Peer not ready");return}console.log("Calling peer:",ke);const X=E.current.call(ke,k.current);T.current.push(X),X.on("stream",gt=>{console.log("Received remote stream from outgoing call"),N.current&&(N.current.srcObject=gt)}),X.on("close",()=>{T.current=T.current.filter(gt=>gt!==X)});const Pe=E.current.connect(ke);P.current=Pe,Pe.on("open",()=>{s&&s(Pe)}),Pe.on("data",gt=>{gt&&gt.type==="screenShareStarted"?Re("remote"):gt&&gt.type==="screenShareStopped"&&Re(null),window.externalDraw&&window.externalDraw(gt)})},$=()=>{d&&(d.getAudioTracks()[0].enabled=!p,g(!p))},z=()=>{d&&(d.getVideoTracks()[0].enabled=!b,x(!b))},[G,R]=Y.useState(!1),[q,J]=Y.useState(!1),Z=()=>{const ke=`${window.location.origin}/session/${n}`;navigator.clipboard.writeText(ke),J(!0),setTimeout(()=>J(!1),2e3)},le=async()=>{v("");try{const ke=await navigator.mediaDevices.enumerateDevices();console.log("Available Devices:",ke);const X=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});h(X),k.current=X,_.current&&(_.current.srcObject=X),E.current}catch(ke){console.error("Retry failed",ke),v(`Retry Failed: ${ke.message}`)}},[K,se]=Y.useState([]);Y.useEffect(()=>{navigator.mediaDevices.enumerateDevices().then(ke=>{se(ke.filter(X=>X.kind==="videoinput"))})},[w]);const[ce,ye]=Y.useState(!0),[Ce,M]=Y.useState(!0),[L,U]=Y.useState(!1),H=Y.useRef(null),ae=async()=>{if(L){H.current&&H.current.getTracks().forEach(ke=>ke.stop()),U(!1),Re(null),de({type:"screenShareStopped"});try{const ke=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});xe(ke)}catch(ke){console.error("Failed to revert to camera",ke)}}else try{const ke=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});H.current=ke,U(!0),Re("local"),de({type:"screenShareStarted"}),ke.getVideoTracks()[0].onended=()=>{U(!1),Re(null),de({type:"screenShareStopped"}),navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(xe)},xe(ke)}catch(ke){console.error("Error sharing screen:",ke),alert("Failed to share screen.")}},de=ke=>{P.current&&P.current.open&&P.current.send(ke)},xe=ke=>{k.current,h(ke),k.current=ke,_.current&&(_.current.srcObject=ke);const X=ke.getVideoTracks()[0];T.current.forEach(Pe=>{if(Pe.peerConnection){const bt=Pe.peerConnection.getSenders().find(Ye=>Ye.track&&Ye.track.kind==="video");bt&&X&&bt.replaceTrack(X)}})};Y.useEffect(()=>(window.addEventListener("toggleScreenShare",ae),()=>window.removeEventListener("toggleScreenShare",ae)),[L,d]);const[he,me]=Y.useState(256),[ve,Re]=Y.useState(null),[Ke,Ge]=Y.useState(!1);return Y.useEffect(()=>{const ke=Pe=>{if(!Ke)return;const gt=-Pe.movementX;me(bt=>Math.max(160,Math.min(800,bt+gt)))},X=()=>Ge(!1);return Ke&&(window.addEventListener("mousemove",ke),window.addEventListener("mouseup",X)),()=>{window.removeEventListener("mousemove",ke),window.removeEventListener("mouseup",X)}},[Ke]),Y.useEffect(()=>{const ke=X=>{X.key==="Escape"&&Re(null)};return window.addEventListener("keydown",ke),()=>window.removeEventListener("keydown",ke)},[]),u.jsxs("div",{className:"absolute top-20 right-4 flex flex-col gap-4 z-40 pointer-events-auto",children:[w&&u.jsxs("div",{className:"bg-red-500/90 text-white p-4 rounded-xl shadow-lg max-w-xs backdrop-blur-sm border border-white/20 animate-in slide-in-from-right",children:[u.jsx("p",{className:"font-bold text-sm",children:" Error"}),u.jsx("p",{className:"text-xs mt-1 mb-2",children:w}),u.jsxs("div",{className:"bg-black/20 p-2 rounded mb-2",children:[u.jsx("p",{className:"text-[10px] opacity-75 uppercase font-bold",children:"Detected Cameras:"}),K.length>0?u.jsx("ul",{className:"list-disc pl-4",children:K.map((ke,X)=>u.jsx("li",{className:"text-[10px]",children:ke.label||`Camera ${X+1} (Label hidden)`},X))}):u.jsx("p",{className:"text-[10px] italic",children:"No cameras detected by browser."})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>v(""),className:"text-xs bg-white/20 hover:bg-white/30 px-2 py-1 rounded transition-colors",children:"Dismiss"}),u.jsx("button",{onClick:le,className:"text-xs bg-white text-red-600 font-bold px-2 py-1 rounded transition-colors",children:"Try Again"})]})]}),!e&&u.jsxs("button",{onClick:()=>R(!0),className:"bg-purple-600 hover:bg-purple-700 text-white py-3 px-6 rounded-xl shadow-lg font-bold text-lg animate-pulse hover:animate-none transition-all border-2 border-white/20 flex items-center gap-2 mb-2",children:["Invite Student ",u.jsx(kx,{size:20})]}),G&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:u.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden animate-in fade-in zoom-in duration-200",children:[u.jsxs("div",{className:"bg-purple-600 p-6 text-white text-center",children:[u.jsx("h3",{className:"text-2xl font-bold mb-1",children:"Invite Student"}),u.jsx("p",{className:"text-purple-100 text-sm",children:"Share this link to start the session"})]}),u.jsxs("div",{className:"p-6 space-y-4",children:[u.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-200 flex items-center gap-3",children:[u.jsx("span",{className:"bg-white p-2 rounded-lg shadow-sm",children:""}),u.jsx("input",{readOnly:!0,value:`${window.location.origin}/session/${n}`,className:"bg-transparent border-none focus:ring-0 text-gray-600 text-sm flex-1 font-mono w-full overflow-hidden text-ellipsis"})]}),u.jsx("button",{onClick:Z,className:`w-full py-3 rounded-xl font-bold text-lg transition-all flex items-center justify-center gap-2 ${q?"bg-green-500 text-white":"bg-purple-600 text-white hover:bg-purple-700"}`,children:q?u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"text-xl",children:""})," Link Copied!"]}):u.jsxs(u.Fragment,{children:[u.jsx(kx,{size:20})," Copy"]})}),u.jsx("button",{onClick:()=>{R(!1),J(!1)},className:"w-full py-3 text-gray-400 font-bold hover:text-gray-600 transition-colors",children:"Close"})]})]})}),u.jsxs("div",{className:"flex flex-col gap-4 bg-white/10 backdrop-blur-md p-4 rounded-2xl border border-white/20 shadow-2xl relative group/vids",children:[u.jsx("div",{onMouseDown:ke=>{ke.preventDefault(),Ge(!0)},className:"absolute -bottom-2 -left-2 w-8 h-8 bg-purple-600 rounded-lg cursor-nesw-resize z-[60] flex items-center justify-center opacity-70 hover:opacity-100 transition-opacity hover:scale-110 shadow-xl border-2 border-white/40 group-hover/vids:opacity-100",style:{cursor:"nesw-resize"},children:u.jsx("div",{className:"w-4 h-4 border-b-2 border-l-2 border-white rotate-0 mb-1 ml-1 opacity-80"})}),u.jsxs("div",{className:"relative group bg-black rounded-lg overflow-hidden shadow-inner border border-gray-600 transition-all duration-300",style:{width:`${he}px`,aspectRatio:"16/9"},children:[u.jsx("video",{ref:_,autoPlay:!0,muted:!0,className:`w-full h-full object-cover ${!b&&"hidden"}`}),!b&&u.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/50 bg-brand-navy",children:"Camera Off"}),u.jsx("div",{className:"absolute bottom-2 left-2 text-white/50 text-xs bg-black/50 px-2 rounded",children:e?"Student (You)":"Teacher (You)"}),u.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-100 transition-opacity flex items-center justify-center gap-3",children:[u.jsx("button",{onClick:$,className:`p-2.5 rounded-full ${p?"bg-white text-brand-navy":"bg-red-500 text-white"} hover:scale-110 transition-transform`,title:p?"Mute":"Unmute",children:p?u.jsx(N6,{size:16}):u.jsx(_6,{size:16})}),u.jsx("button",{onClick:z,className:`p-2.5 rounded-full ${b?"bg-white text-brand-navy":"bg-red-500 text-white"} hover:scale-110 transition-transform`,title:b?"Stop Video":"Start Video",children:b?u.jsx(dl,{size:16}):u.jsx(l_,{size:16})}),u.jsx("button",{onClick:()=>Re("local"),className:"p-2.5 rounded-full bg-purple-600 text-white hover:scale-110 transition-transform",title:"Enlarge to Full Page",children:u.jsx(kx,{size:16,className:"rotate-45"})})]})]}),u.jsxs("div",{className:"relative group bg-black rounded-lg overflow-hidden shadow-inner border border-gray-600 transition-all duration-300",style:{width:`${he}px`,aspectRatio:"16/9"},children:[u.jsx("video",{ref:N,autoPlay:!0,className:`w-full h-full object-cover ${!Ce&&"hidden"}`}),!Ce&&u.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/50 bg-brand-navy",children:"Video Hidden"}),u.jsx("div",{className:"absolute bottom-2 left-2 text-white/50 text-xs bg-black/50 px-2 rounded",children:e?"Teacher":"Student"}),u.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-4",children:u.jsxs("button",{onClick:()=>Re("remote"),className:"p-3 rounded-full bg-purple-600 text-white hover:scale-110 shadow-lg border-2 border-white/20 flex items-center gap-2 font-bold px-4",title:"Enlarge for better view",children:[u.jsx(dl,{size:18})," Enlarge"]})})]})]}),ve&&u.jsxs("div",{className:"fixed inset-0 bg-gray-900/95 z-[200] flex flex-col p-4 animate-in fade-in duration-300",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4 px-4 bg-gray-800 p-4 rounded-xl",children:[u.jsxs("h3",{className:"text-white font-bold text-xl flex items-center gap-3",children:[u.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),ve==="local"?"Your Shared Screen":e?"Teacher's Presentation":"Student's Shared Screen"]}),u.jsxs("button",{onClick:()=>Re(null),className:"bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-full transition-all flex items-center gap-2 shadow-lg font-bold",children:[u.jsx("span",{children:"CLOSE VIEW"}),u.jsx("span",{className:"text-xl leading-none",children:""})]})]}),u.jsxs("div",{className:"flex-1 rounded-3xl overflow-hidden border-2 border-white/10 shadow-2xl bg-black flex items-center justify-center relative",children:[u.jsx("video",{ref:ke=>{ke&&(ke.srcObject=ve==="local"?d:N.current?.srcObject)},autoPlay:!0,muted:ve==="local",className:"w-full h-full object-contain"}),u.jsx("div",{className:"absolute top-6 left-6 bg-black/50 backdrop-blur-md px-4 py-2 rounded-full border border-white/20 text-white/80 text-sm font-bold flex items-center gap-2",children:"Live Projection Mode"})]}),u.jsx("div",{className:"h-16 flex items-center justify-center text-white/30 text-sm tracking-widest font-bold",children:"CLICK 'CLOSE VIEW' TO RETURN TO WHITEBOARD"})]})]})},EP=({connection:s,isStudent:e})=>{const[t,n]=Y.useState(!1),[r,i]=Y.useState(!1),[o,l]=Y.useState([]),[d,h]=Y.useState(""),p=Y.useRef(null),[g,b]=Y.useState(!1),x=()=>{p.current?.scrollIntoView({behavior:"smooth"})};Y.useEffect(()=>{x()},[o,t]),Y.useEffect(()=>{if(!s)return;const v=_=>{if(_&&_.type==="chat"){const N=_.sender||(e?"Teacher":"Student");l(E=>[...E,{sender:N,text:_.message,time:new Date}]),t||b(!0)}};return s.on("data",v),()=>{s.off("data",v)}},[s,t]);const w=v=>{if(v.preventDefault(),!d.trim())return;const _=e?"Student":"Davina",N={sender:_,text:d,time:new Date};l(E=>[...E,N]),s&&s.open&&s.send({type:"chat",message:d,sender:_}),h("")};return u.jsxs("div",{className:"absolute bottom-4 right-4 z-50 flex flex-col items-end pointer-events-auto",children:[!t&&u.jsx("button",{onClick:()=>{n(!0),b(!1)},className:`p-4 rounded-full shadow-2xl transition-all transform hover:scale-110 ${g?"bg-red-500 animate-bounce":"bg-purple-700"} text-white border-2 border-white`,title:"Open Chat",children:u.jsx(Hc,{size:28})}),t&&u.jsxs("div",{className:"bg-white w-80 h-96 rounded-2xl shadow-2xl flex flex-col overflow-hidden border-2 border-gray-200 animate-in slide-in-from-bottom-10 fade-in duration-200",children:[u.jsxs("div",{className:"bg-slate-900 p-3 flex justify-between items-center text-white shadow-md z-10",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Hc,{size:18,className:"text-purple-400"}),u.jsx("span",{className:"font-bold text-sm",children:"Chat"})]}),u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx("button",{onClick:()=>n(!1),className:"hover:bg-white/20 p-1.5 rounded transition-colors",title:"Minimize",children:u.jsx(E6,{size:18})}),u.jsx("button",{onClick:()=>n(!1),className:"hover:bg-red-500 p-1.5 rounded transition-colors",title:"Close",children:u.jsx(xh,{size:18})})]})]}),u.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-slate-50",children:[o.length===0&&u.jsxs("div",{className:"text-center text-gray-400 text-sm mt-10",children:[u.jsx("p",{children:"No messages yet."}),u.jsx("p",{className:"text-xs mt-1",children:"Chat is ready!"})]}),o.map((v,_)=>u.jsxs("div",{className:`flex flex-col ${v.sender===(e?"Student":"Teacher")?"items-end":"items-start"}`,children:[u.jsx("div",{className:`max-w-[85%] px-3 py-2 rounded-xl text-sm shadow-sm ${v.sender===(e?"Student":"Teacher")?"bg-purple-600 text-white rounded-br-none":"bg-white text-gray-800 border border-gray-200 rounded-bl-none"}`,children:v.text}),u.jsxs("span",{className:"text-[10px] text-gray-400 mt-1 px-1",children:[v.sender,"  ",v.time.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]},_)),u.jsx("div",{ref:p})]}),u.jsxs("form",{onSubmit:w,className:"p-3 bg-white border-t border-gray-100 flex gap-2",children:[u.jsx("input",{type:"text",value:d,onChange:v=>h(v.target.value),placeholder:"Type a message...",className:"flex-1 bg-gray-100 text-gray-800 rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 border border-transparent focus:border-purple-300"}),u.jsx("button",{type:"submit",disabled:!d.trim(),className:"p-2 bg-purple-600 text-white rounded-full hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u.jsx(U6,{size:16})})]})]})]})},kP=()=>{const{roomId:s}=gb(),[e]=n_(),t=ka(),n=Y.useRef(null),r=localStorage.getItem("tutor_authenticated")==="true",i=e.get("host")==="true"||r,o=e.get("student"),l=e.get("type")||"lesson",d=!i,h=s&&typeof window<"u"?localStorage.getItem(`session_student_${s}`):null,p=o||h||"Guest";if(Y.useEffect(()=>{d&&o&&s&&localStorage.setItem(`session_student_${s}`,o)},[d,o,s]),d&&!o&&!h)return u.jsx(JS,{to:`/student-login?join=${s}`,replace:!0});const[g,b]=Y.useState(null),[x,w]=Y.useState(!1),[v,_]=Y.useState(!1),[N,E]=Y.useState(!1),[k,T]=Y.useState(300),[P,O]=Y.useState(""),[F,$]=Y.useState(""),[z,G]=Y.useState(""),[R,q]=Y.useState(""),[J,Z]=Y.useState(""),[le,K]=Y.useState(l==="consultation"?0:30),[se,ce]=Y.useState(l==="consultation"?"N/A":"Due"),[ye,Ce]=Y.useState(l==="consultation"||i),[M,L]=Y.useState(!1),[U,H]=Y.useState(!0);Y.useEffect(()=>{const me=JSON.parse(localStorage.getItem("tutor_bookings"))||[],ve=me.find(X=>X.id===s||X.id===e.get("bookingId"));if(ve&&(ve.type==="pack"||ve.recurringId&&(()=>{const X=me.filter(Pe=>Pe.recurringId===ve.recurringId&&Pe.status!=="cancelled").sort((Pe,gt)=>new Date(Pe.date+"T"+Pe.time)-new Date(gt.date+"T"+gt.time));return X.length===10&&X[0]&&(X[0].paymentStatus||"").toLowerCase()==="paid"})()),H(!0),l==="consultation"||i)return;const Re=JSON.parse(localStorage.getItem("tutor_session_history"))||[],Ke=new Date;Ke.setDate(Ke.getDate()-7),[...me,...Re].some(X=>{const Pe=new Date(X.date);return(X.student===p||X.studentName===p)&&X.paymentStatus==="Due"&&Pe<Ke})&&L(!0),ve&&(ve.paymentStatus==="Paid"||ve.paymentStatus==="Due (Exception)"||ve.paymentStatus==="In bundle")?(Ce(!0),ve.paymentStatus==="Due (Exception)"&&ce("Due (Exception)")):Ce(!1)},[s,l,i,e,p]),Y.useEffect(()=>{if(e.get("payment_success")==="true"||e.get("session_id")){ce("Paid"),Ce(!0),L(!1);const me=JSON.parse(localStorage.getItem("tutor_bookings"))||[],ve=s||e.get("bookingId"),Ke=me.find(ke=>ke.id===ve)?.recurringId,Ge=me.map(ke=>ke.id===ve||Ke&&ke.recurringId===Ke?{...ke,paymentStatus:"Paid"}:ke);localStorage.setItem("tutor_bookings",JSON.stringify(Ge)),window.dispatchEvent(new Event("storage")),alert("Payment received!  Check your email for confirmation from Stripe."),window.history.replaceState({},"",window.location.pathname)}},[e,s]);const ae=()=>{_(!0)};Y.useEffect(()=>{if(!g||i)return;const me=ve=>{ve?.type==="lesson_ended"&&E(!0)};return g.on("data",me),()=>{g.off?.("data",me)}},[g,i]),Y.useEffect(()=>{if(!N||i)return;const me=setInterval(()=>{T(ve=>ve<=1?(window.location.pathname.includes("/session/")&&(window.location.href=`/student-dashboard?student=${encodeURIComponent(p)}`),0):ve-1)},1e3);return()=>clearInterval(me)},[N,i,p]);const de=()=>{if(window.confirm(`Request Exception: strictly valid for this session only.

By clicking OK, you agree to make the payment immediately after the lesson.`)){const ve=(JSON.parse(localStorage.getItem("tutor_bookings"))||[]).map(Re=>Re.id===s||Re.id===e.get("bookingId")?{...Re,paymentStatus:"Due (Exception)"}:Re);localStorage.setItem("tutor_bookings",JSON.stringify(ve)),window.dispatchEvent(new Event("storage")),Ce(!0),ce("Due (Exception)")}},xe=async me=>{me.preventDefault();let ve=null;try{ve=await n.current?.getLessonPDFBase64?.()??null}catch{}const Re=`${F} ${z?"| To Improve: "+z:""} ${R?"| Focus: "+R:""}`.trim(),Ke={id:Date.now().toString(),date:new Date().toISOString(),endTime:new Date().toISOString(),studentName:p,studentId:e.get("studentId")||p.toLowerCase().replace(/\s+/g,"_"),subject:P,topic:P,feedback:Re,feedback_well:F,feedback_improve:z,feedback_focus:R,next_steps:J,nextSteps:J,cost:le,paymentStatus:se,type:l,duration:"60",...ve&&{lessonPdfBase64:ve}},Ge=JSON.parse(localStorage.getItem("tutor_session_history"))||[];Ge.push(Ke),localStorage.setItem("tutor_session_history",JSON.stringify(Ge));const X=(JSON.parse(localStorage.getItem("tutor_bookings"))||[]).filter(Pe=>Pe.id!==s);localStorage.setItem("tutor_bookings",JSON.stringify(X)),window.dispatchEvent(new Event("storage")),g&&g.close(),i?(localStorage.setItem("teacher_dashboard_unlocked","true"),window.location.href="/teacher"):window.location.href=`/student-dashboard?student=${encodeURIComponent(p)}`};return u.jsxs("div",{className:"relative w-screen h-screen overflow-hidden bg-brand-light",children:[ye?u.jsxs(u.Fragment,{children:[d&&N?u.jsx("div",{className:"fixed inset-0 z-[300] bg-purple-900/95 flex flex-col items-center justify-center p-6 text-center",children:u.jsxs("div",{className:"bg-white p-10 rounded-3xl shadow-2xl max-w-md w-full",children:[u.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Lesson ended by teacher"}),u.jsxs("p",{className:"text-gray-600 mb-4",children:["You will be redirected to your dashboard in ",Math.floor(k/60),":",(k%60).toString().padStart(2,"0"),"."]}),u.jsx("p",{className:"text-sm text-gray-500",children:"You can also leave now using the link below."}),u.jsx("button",{type:"button",onClick:()=>{window.location.href=`/student-dashboard?student=${encodeURIComponent(p)}`},className:"mt-6 py-3 px-6 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700",children:"Go to dashboard now"})]})}):null,d&&!N&&(!g||!g.open)?u.jsx("div",{className:"fixed inset-0 z-[200] bg-purple-900/95 flex items-center justify-center p-6",children:u.jsxs("div",{className:"bg-white p-10 rounded-3xl shadow-2xl max-w-md w-full text-center animate-pulse",children:[u.jsx("div",{className:"w-16 h-16 rounded-full bg-purple-100 flex items-center justify-center mx-auto mb-6",children:u.jsx("span",{className:"text-2xl",children:""})}),u.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Waiting for teacher to join"}),u.jsx("p",{className:"text-gray-500",children:"You will enter the lesson automatically when the teacher is in the meeting."}),u.jsxs("p",{className:"text-sm text-gray-400 mt-4 font-mono",children:["Meeting ID: ",s]})]})}):null,u.jsx(eP,{ref:n,connection:g,isHost:i,sessionId:s,studentName:p,onEndLesson:ae,showLessonTimer:U}),u.jsx(CP,{roomId:s,isStudent:d,isHost:i,onConnection:b}),u.jsx(EP,{connection:g,isStudent:d})]}):u.jsx("div",{className:"fixed inset-0 z-[200] bg-gray-900 flex items-center justify-center p-6 text-center",children:u.jsxs("div",{className:"bg-white p-10 rounded-3xl shadow-2xl max-w-md w-full animate-in zoom-in-95",children:[u.jsx("div",{className:`w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 ${M?"bg-red-100 text-red-600":"bg-orange-100 text-orange-600"}`,children:M?u.jsx(To,{size:40}):u.jsx(v1,{size:40})}),u.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:M?"Outstanding Payments":"Payment Due"}),u.jsx("p",{className:"text-gray-500 mb-8",children:M?"You have outstanding payments from previous weeks. Please clear your balance to continue.":"Please verify payment for this session to enter the classroom."}),u.jsxs("div",{className:"space-y-4",children:[u.jsx("a",{href:"https://buy.stripe.com/test_528e_demo",className:"block w-full py-4 bg-teal-500 hover:bg-teal-600 text-white rounded-xl font-bold shadow-lg transition-all",children:"Pay Now (30)"}),!M&&u.jsx("button",{onClick:de,className:"block w-full py-3 text-purple-600 bg-purple-50 hover:bg-purple-100 rounded-xl font-bold transition-colors",children:"request Exception (Pay Later)"}),u.jsx("button",{onClick:()=>t(-1),className:"block w-full py-3 text-gray-500 font-bold hover:text-gray-700 transition-colors",children:"Go Back"})]}),u.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-100 flex items-center justify-center gap-2 text-xs text-gray-400",children:[u.jsx(Ru,{size:14})," Secure Payment via Stripe"]})]})}),v&&u.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[110] flex items-center justify-center p-4",children:u.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-2xl max-w-md w-full animate-in zoom-in-95",children:[u.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"End Lesson?"}),u.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to end the lesson? You'll be asked to provide feedback next."}),u.jsxs("div",{className:"flex gap-3",children:[u.jsx("button",{onClick:()=>_(!1),className:"flex-1 py-3 text-gray-600 font-bold hover:bg-gray-50 rounded-xl transition-all",children:"Cancel"}),u.jsx("button",{onClick:()=>{if(g?.open)try{g.send({type:"lesson_ended"})}catch{}_(!1),w(!0)},className:"flex-1 py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700 shadow-md transition-all",children:"End Lesson"})]})]})}),x&&u.jsx("div",{className:"fixed inset-0 bg-black/50 z-[100] flex items-center justify-center backdrop-blur-sm",children:u.jsxs("div",{className:"bg-white p-8 rounded-3xl shadow-2xl max-w-lg w-full m-4 animate-in zoom-in-95",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Lesson Summary & Invoice"}),u.jsxs("form",{onSubmit:xe,className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Topics Covered"}),u.jsx("input",{required:!0,type:"text",value:P,onChange:me=>O(me.target.value),className:"w-full px-4 py-2 rounded-xl border border-gray-200 bg-gray-50 focus:border-purple-500 outline-none",placeholder:"e.g. Algebra Basics"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"What went well?"}),u.jsx("textarea",{required:!0,value:F,onChange:me=>$(me.target.value),className:"w-full px-4 py-2 rounded-xl border border-gray-200 bg-gray-50 focus:border-green-500 outline-none h-24 text-sm",placeholder:"Great focus today..."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Improvements?"}),u.jsx("textarea",{required:!0,value:z,onChange:me=>G(me.target.value),className:"w-full px-4 py-2 rounded-xl border border-gray-200 bg-gray-50 focus:border-amber-500 outline-none h-24 text-sm",placeholder:"Practice more..."})]})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Focus"}),u.jsx("textarea",{value:R,onChange:me=>q(me.target.value),className:"w-full px-4 py-2 rounded-xl border border-gray-200 bg-gray-50 focus:border-blue-500 outline-none h-24 text-sm",placeholder:"Key topics focused on..."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Homework/Next Steps"}),u.jsx("textarea",{value:J,onChange:me=>Z(me.target.value),className:"w-full px-4 py-2 rounded-xl border border-gray-200 bg-gray-50 focus:border-purple-500 outline-none h-24 text-sm",placeholder:"E.g. Focus on quadratic equations"})]})]}),u.jsx("button",{type:"submit",className:"w-full py-4 bg-purple-600 text-white rounded-xl font-bold shadow-lg hover:bg-purple-700 mt-6",children:"Save Lesson Summary"}),u.jsx("button",{type:"button",onClick:()=>{if(i&&s){try{const me=localStorage.getItem("tutor_pending_feedback")||"[]",ve=JSON.parse(me);ve.push({roomId:s,studentName:p,date:new Date().toISOString()}),localStorage.setItem("tutor_pending_feedback",JSON.stringify(ve))}catch{}localStorage.setItem("teacher_dashboard_unlocked","true"),window.location.href="/teacher"}else window.location.href=`/student-dashboard?student=${encodeURIComponent(p)}`},className:"w-full py-3 text-gray-500 hover:text-gray-700 font-bold text-sm mt-2 transition-colors",children:"Skip for now"})]})]})})]})},jP=()=>{const s=ka();return u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-teal-50 py-12 px-4",children:u.jsxs("div",{className:"max-w-4xl mx-auto bg-white rounded-3xl shadow-xl p-8 md:p-12",children:[u.jsxs("button",{onClick:()=>s("/"),className:"flex items-center gap-2 text-purple-600 hover:text-purple-700 font-bold mb-8 transition-colors",children:[u.jsx(mh,{size:20})," Back to Home"]}),u.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[u.jsx(Ru,{size:48,className:"text-purple-600"}),u.jsxs("div",{children:[u.jsx("h1",{className:"text-4xl font-bold text-gray-900",children:"Privacy Policy"}),u.jsx("p",{className:"text-gray-500",children:"Last updated: February 2026"})]})]}),u.jsxs("div",{className:"prose prose-lg max-w-none space-y-8",children:[u.jsxs("section",{children:[u.jsxs("p",{className:"text-gray-700 leading-relaxed",children:["At ",u.jsx("strong",{children:"Davina's Tutoring Platform"}),", your privacy is paramount. This policy explains what data I collect, why I collect it, how long I keep it, and your rights under the ",u.jsx("strong",{children:"UK GDPR and Data Protection Act 2018"}),"."]}),u.jsx("p",{className:"text-gray-700 leading-relaxed",children:"As a sole trader, I (Davina) am the data controller. For any questions or requests, please contact me at:"}),u.jsxs("div",{className:"bg-purple-50 border-l-4 border-purple-600 p-4 rounded-r-xl mt-4",children:[u.jsxs("div",{className:"flex items-center gap-2 text-purple-900 font-bold",children:[u.jsx(Sg,{size:20}),"privacy@davinastutoring.co.uk"]}),u.jsx("p",{className:"text-sm text-purple-700 mt-1",children:"Response time: Within 7 working days"})]})]}),u.jsxs("section",{children:[u.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3 border-b-2 border-purple-200 pb-3",children:[u.jsx("span",{className:"text-3xl",children:""})," What Data I Collect"]}),u.jsxs("div",{className:"space-y-4 mt-4",children:[u.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[u.jsx("h3",{className:"font-bold text-gray-800 mb-2",children:"Personal Information"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Name:"})," To identify you and personalize your dashboard"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Email address:"})," For booking confirmations, lesson reminders, and PIN recovery"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Account PIN:"})," Securely hashed (encrypted) for dashboard access"]})]})]}),u.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[u.jsx("h3",{className:"font-bold text-gray-800 mb-2",children:"Educational Data"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Session notes:"})," Topics covered, progress updates, homework assignments"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Session history:"})," Dates, times, subjects of past lessons"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Subject/Grade level:"})," To tailor teaching approach"]})]})]}),u.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[u.jsx("h3",{className:"font-bold text-gray-800 mb-2",children:"Payment Information"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Payment tokens:"})," Encrypted references from Plaid (Open Banking) or Stripe"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Transaction records:"})," Amount, date, payment status (for invoicing and HMRC compliance)"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Note:"})," I never see or store your bank account details or card numbers"]})]})]}),u.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[u.jsx("h3",{className:"font-bold text-gray-800 mb-2",children:"Technical Data"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"IP address:"})," Logged for security and audit purposes (6-month retention)"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Browser/device info:"})," For technical support and compatibility"]})]})]})]})]}),u.jsxs("section",{children:[u.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3 border-b-2 border-purple-200 pb-3",children:[u.jsx("span",{className:"text-3xl",children:""})," Why I Collect This Data"]}),u.jsxs("div",{className:"mt-4 space-y-3",children:[u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-xl",children:""}),u.jsxs("div",{children:[u.jsx("strong",{className:"text-gray-800",children:"Providing tutoring services:"}),u.jsx("p",{className:"text-gray-600",children:"To schedule lessons, track progress, and personalize teaching"})]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-xl",children:""}),u.jsxs("div",{children:[u.jsx("strong",{className:"text-gray-800",children:"Payment processing:"}),u.jsx("p",{className:"text-gray-600",children:"To handle secure payments and generate invoices"})]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-xl",children:""}),u.jsxs("div",{children:[u.jsx("strong",{className:"text-gray-800",children:"Legal compliance:"}),u.jsx("p",{className:"text-gray-600",children:"HMRC requires 7-year retention of financial records"})]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-xl",children:""}),u.jsxs("div",{children:[u.jsx("strong",{className:"text-gray-800",children:"Security:"}),u.jsx("p",{className:"text-gray-600",children:"Audit logging protects against unauthorized access"})]})]})]})]}),u.jsxs("section",{children:[u.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3 border-b-2 border-purple-200 pb-3",children:[u.jsx(ei,{size:32,className:"text-purple-600"})," Data Retention Periods"]}),u.jsx("div",{className:"mt-4 overflow-x-auto",children:u.jsxs("table",{className:"w-full border-collapse",children:[u.jsx("thead",{className:"bg-purple-100",children:u.jsxs("tr",{children:[u.jsx("th",{className:"border border-purple-200 px-4 py-3 text-left font-bold text-gray-800",children:"Data Type"}),u.jsx("th",{className:"border border-purple-200 px-4 py-3 text-left font-bold text-gray-800",children:"Retention Period"}),u.jsx("th",{className:"border border-purple-200 px-4 py-3 text-left font-bold text-gray-800",children:"Reason"})]})}),u.jsxs("tbody",{className:"text-gray-700",children:[u.jsxs("tr",{className:"hover:bg-purple-50",children:[u.jsx("td",{className:"border border-gray-200 px-4 py-3",children:"Student contact details (name, email, PIN)"}),u.jsx("td",{className:"border border-gray-200 px-4 py-3 font-semibold text-purple-700",children:"1 year after last session"}),u.jsx("td",{className:"border border-gray-200 px-4 py-3",children:"Allows re-booking while respecting inactivity"})]}),u.jsxs("tr",{className:"hover:bg-purple-50",children:[u.jsx("td",{className:"border border-gray-200 px-4 py-3",children:"Session notes & progress reports"}),u.jsx("td",{className:"border border-gray-200 px-4 py-3 font-semibold text-purple-700",children:"3 years after course completion"}),u.jsx("td",{className:"border border-gray-200 px-4 py-3",children:"Reference for future students; dispute resolution"})]}),u.jsxs("tr",{className:"hover:bg-purple-50",children:[u.jsx("td",{className:"border border-gray-200 px-4 py-3",children:"Payment records & tokens"}),u.jsx("td",{className:"border border-gray-200 px-4 py-3 font-semibold text-purple-700",children:"7 years"}),u.jsx("td",{className:"border border-gray-200 px-4 py-3 font-bold text-red-700",children:"HMRC legal requirement"})]}),u.jsxs("tr",{className:"hover:bg-purple-50",children:[u.jsx("td",{className:"border border-gray-200 px-4 py-3",children:"Consultation inquiries (no booking made)"}),u.jsx("td",{className:"border border-gray-200 px-4 py-3 font-semibold text-purple-700",children:"6 months"}),u.jsx("td",{className:"border border-gray-200 px-4 py-3",children:"Follow-up opportunity; then deleted"})]}),u.jsxs("tr",{className:"hover:bg-purple-50",children:[u.jsx("td",{className:"border border-gray-200 px-4 py-3",children:"Audit logs (IP, access records)"}),u.jsx("td",{className:"border border-gray-200 px-4 py-3 font-semibold text-purple-700",children:"6 months"}),u.jsx("td",{className:"border border-gray-200 px-4 py-3",children:"Security monitoring; GDPR accountability"})]})]})]})}),u.jsxs("p",{className:"text-sm text-gray-600 mt-4",children:[u.jsx("strong",{children:"Automatic deletion:"})," Data is permanently erased from all systems (including backups) once retention periods expire."]})]}),u.jsxs("section",{children:[u.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3 border-b-2 border-purple-200 pb-3",children:[u.jsx("span",{className:"text-3xl",children:""})," Your Rights Under GDPR"]}),u.jsxs("div",{className:"mt-4 space-y-4",children:[u.jsx("div",{className:"bg-teal-50 border-l-4 border-teal-600 p-4 rounded-r-xl",children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx(o_,{size:24,className:"text-teal-700 mt-1 flex-shrink-0"}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-bold text-teal-900",children:"Right to Access (Article 15)"}),u.jsx("p",{className:"text-teal-800 text-sm mt-1",children:`You can download all your data anytime from your dashboard via the "Download My Data" button. You'll receive a JSON file with all information I hold about you.`})]})]})}),u.jsx("div",{className:"bg-red-50 border-l-4 border-red-600 p-4 rounded-r-xl",children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx(Kl,{size:24,className:"text-red-700 mt-1 flex-shrink-0"}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-bold text-red-900",children:'Right to Erasure / "Right to be Forgotten" (Article 17)'}),u.jsxs("p",{className:"text-red-800 text-sm mt-1",children:["You can request deletion of your account and all associated data at any time by emailing",u.jsx("strong",{children:" privacy@davinastutoring.co.uk"}),". I will verify your identity (name + email + PIN) and permanently delete your data within ",u.jsx("strong",{children:"30 days"}),"."]}),u.jsx("p",{className:"text-red-800 text-sm mt-2 font-semibold",children:"Exception: Payment records must be retained for 7 years (HMRC legal requirement)."})]})]})}),u.jsx("div",{className:"bg-purple-50 border-l-4 border-purple-600 p-4 rounded-r-xl",children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-2xl mt-1 flex-shrink-0",children:""}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-bold text-purple-900",children:"Right to Rectification (Article 16)"}),u.jsx("p",{className:"text-purple-800 text-sm mt-1",children:"You can update your name or email anytime from your dashboard settings. For session note corrections, email me with details."})]})]})}),u.jsx("div",{className:"bg-gray-50 border-l-4 border-gray-600 p-4 rounded-r-xl",children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-2xl mt-1 flex-shrink-0",children:""}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-bold text-gray-900",children:"Right to Data Portability (Article 20)"}),u.jsx("p",{className:"text-gray-800 text-sm mt-1",children:'The "Download My Data" feature provides your data in machine-readable JSON format, which you can import to another tutoring platform.'})]})]})}),u.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-600 p-4 rounded-r-xl",children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-2xl mt-1 flex-shrink-0",children:""}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-bold text-yellow-900",children:"Right to Lodge a Complaint (Article 77)"}),u.jsxs("p",{className:"text-yellow-800 text-sm mt-1",children:["If you're unhappy with how I've handled your data, you can complain to the",u.jsx("strong",{children:" Information Commissioner's Office (ICO)"}),":"]}),u.jsxs("ul",{className:"text-yellow-800 text-sm mt-2 space-y-1",children:[u.jsxs("li",{children:[" Website: ",u.jsx("a",{href:"https://ico.org.uk/make-a-complaint/",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"ico.org.uk/make-a-complaint"})]}),u.jsx("li",{children:" Phone: 0303 123 1113"})]})]})]})})]})]}),u.jsxs("section",{children:[u.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3 border-b-2 border-purple-200 pb-3",children:[u.jsx(Kl,{size:32,className:"text-red-600"})," How to Request Data Deletion"]}),u.jsxs("div",{className:"mt-4 bg-red-50 border-2 border-red-200 rounded-xl p-6",children:[u.jsx("h3",{className:"font-bold text-red-900 text-lg mb-4",children:"Step-by-Step Process:"}),u.jsxs("ol",{className:"space-y-3",children:[u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0",children:"1"}),u.jsxs("div",{className:"text-gray-800",children:[u.jsx("strong",{children:"Email me at:"})," ",u.jsx("span",{className:"text-red-700 font-mono",children:"privacy@davinastutoring.co.uk"}),u.jsx("p",{className:"text-sm text-gray-600 mt-1",children:'Subject line: "Data Deletion Request"'})]})]}),u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0",children:"2"}),u.jsxs("div",{className:"text-gray-800",children:[u.jsx("strong",{children:"Include:"})," Your full name, registered email, and account PIN",u.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This verifies your identity"})]})]}),u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0",children:"3"}),u.jsxs("div",{className:"text-gray-800",children:[u.jsx("strong",{children:"I will verify"})," your details within 7 working days"]})]}),u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0",children:"4"}),u.jsxs("div",{className:"text-gray-800",children:[u.jsx("strong",{children:"Permanent deletion"})," from all systems (including backups) within 30 days"]})]}),u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0",children:"5"}),u.jsxs("div",{className:"text-gray-800",children:[u.jsx("strong",{children:"You receive"})," a confirmation email once deletion is complete"]})]})]}),u.jsx("p",{className:"text-sm text-red-800 mt-4 font-semibold",children:" Payment records will be anonymized (name/email removed) but kept for 7 years per HMRC requirements."})]})]}),u.jsxs("section",{children:[u.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3 border-b-2 border-purple-200 pb-3",children:[u.jsx(Ru,{size:32,className:"text-purple-600"})," How I Protect Your Data"]}),u.jsxs("div",{className:"mt-4 space-y-3 text-gray-700",children:[u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-xl",children:""}),u.jsxs("p",{children:[u.jsx("strong",{children:"Encryption:"})," PINs are hashed (not stored in plain text), payment tokens are encrypted at rest"]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-xl",children:""}),u.jsxs("p",{children:[u.jsx("strong",{children:"HTTPS:"})," All data transmitted over secure SSL/TLS connections"]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-xl",children:""}),u.jsxs("p",{children:[u.jsx("strong",{children:"Access Control:"})," Only I (Davina, sole operator) have access. I use strong passwords + 2FA on all accounts"]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-xl",children:""}),u.jsxs("p",{children:[u.jsx("strong",{children:"Audit Logging:"})," All data access is logged for 6 months to detect unauthorized access"]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-xl",children:""}),u.jsxs("p",{children:[u.jsx("strong",{children:"Device Security:"})," My work laptop has full-disk encryption (FileVault/BitLocker) and up-to-date antivirus"]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-xl",children:""}),u.jsxs("p",{children:[u.jsx("strong",{children:"GDPR-Compliant Hosting:"})," Data stored on EU servers (Supabase/Netlify) compliant with UK GDPR"]})]})]})]}),u.jsxs("section",{children:[u.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3 border-b-2 border-purple-200 pb-3",children:[u.jsx("span",{className:"text-3xl",children:""})," Third-Party Services"]}),u.jsx("p",{className:"text-gray-700 mt-4",children:"I use the following trusted providers (all GDPR-compliant):"}),u.jsxs("ul",{className:"mt-3 space-y-2",children:[u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx("strong",{className:"text-purple-700 min-w-[120px]",children:"Plaid:"}),u.jsx("span",{className:"text-gray-700",children:"Secure Open Banking payments (they only handle bank authorization, not storage)"})]}),u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx("strong",{className:"text-purple-700 min-w-[120px]",children:"Stripe:"}),u.jsx("span",{className:"text-gray-700",children:"Card payment processing (they store encrypted payment methods, I only receive transaction confirmations)"})]}),u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx("strong",{className:"text-purple-700 min-w-[120px]",children:"Supabase:"}),u.jsx("span",{className:"text-gray-700",children:"Database hosting (EU servers, encrypted backups)"})]}),u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx("strong",{className:"text-purple-700 min-w-[120px]",children:"Netlify:"}),u.jsx("span",{className:"text-gray-700",children:"Website hosting with automatic HTTPS"})]})]}),u.jsxs("p",{className:"text-sm text-gray-600 mt-4",children:["I ",u.jsx("strong",{children:"never"})," sell or share your data with marketers or advertisers."]})]}),u.jsxs("section",{children:[u.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3 border-b-2 border-purple-200 pb-3",children:[u.jsx("span",{className:"text-3xl",children:""})," Policy Updates"]}),u.jsxs("p",{className:"text-gray-700 mt-4",children:["This policy is reviewed annually (next review: ",u.jsx("strong",{children:"February 2027"}),") or whenever data practices change. If significant changes occur, I will notify all active students via email."]}),u.jsxs("p",{className:"text-gray-700 mt-2",children:["Last updated: ",u.jsx("strong",{children:"February 9, 2026"})]})]}),u.jsxs("section",{className:"bg-gradient-to-r from-purple-100 to-teal-100 border-2 border-purple-300 rounded-xl p-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Questions or Concerns?"}),u.jsx("p",{className:"text-gray-800 mb-4",children:"If you have any questions about this policy or how your data is handled, please don't hesitate to contact me:"}),u.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-md",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[u.jsx(Sg,{size:24,className:"text-purple-600"}),u.jsx("strong",{className:"text-gray-900",children:"Email:"}),u.jsx("a",{href:"mailto:privacy@davinastutoring.co.uk",className:"text-purple-600 hover:underline font-mono",children:"privacy@davinastutoring.co.uk"})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(ei,{size:24,className:"text-teal-600"}),u.jsx("strong",{className:"text-gray-900",children:"Response Time:"}),u.jsx("span",{className:"text-gray-700",children:"Within 7 working days"})]})]})]})]}),u.jsx("div",{className:"mt-12 text-center",children:u.jsxs("button",{onClick:()=>s("/"),className:"bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-xl font-bold shadow-lg transition-all inline-flex items-center gap-2",children:[u.jsx(mh,{size:20})," Back to Home"]})})]})})},TP=()=>{const s=ka();return u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-teal-50 py-12 px-4",children:u.jsxs("div",{className:"max-w-4xl mx-auto bg-white rounded-3xl shadow-xl p-8 md:p-12",children:[u.jsxs("button",{onClick:()=>s("/"),className:"flex items-center gap-2 text-purple-600 hover:text-purple-700 font-bold mb-8 transition-colors",children:[u.jsx(mh,{size:20})," Back to Home"]}),u.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[u.jsx(M6,{size:48,className:"text-purple-600"}),u.jsxs("div",{children:[u.jsx("h1",{className:"text-4xl font-bold text-gray-900",children:"Terms of Service"}),u.jsx("p",{className:"text-gray-500",children:"Last updated: February 2026"})]})]}),u.jsxs("div",{className:"prose prose-lg max-w-none space-y-8",children:[u.jsxs("section",{children:[u.jsxs("p",{className:"text-gray-700 leading-relaxed",children:["Welcome to ",u.jsx("strong",{children:"Davina's Tutoring Platform"}),". By booking a lesson or using this platform, you agree to these Terms of Service. Please read them carefully before booking."]}),u.jsx("div",{className:"bg-purple-50 border-l-4 border-purple-600 p-4 rounded-r-xl mt-4",children:u.jsxs("p",{className:"text-sm text-purple-800",children:[u.jsx("strong",{children:"Important:"})," If you are booking on behalf of a student under 16 years of age, you confirm that you are their parent or legal guardian and consent to the processing of their personal data as described in our ",u.jsx("a",{href:"/privacy",className:"underline hover:text-purple-900",children:"Privacy Policy"}),"."]})})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"1. Service Description"}),u.jsx("p",{className:"text-gray-700 mt-4",children:"Davina's Tutoring Platform provides:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-2 mt-3",children:[u.jsx("li",{children:"Online 1-on-1 tutoring sessions via video call"}),u.jsx("li",{children:"Subjects including Maths, English, Science, and other academic areas"}),u.jsx("li",{children:"Personalized lesson planning and progress tracking"}),u.jsx("li",{children:"Digital whiteboard and screen sharing tools"}),u.jsx("li",{children:"Session notes and homework assignments"})]}),u.jsxs("p",{className:"text-gray-700 mt-4",children:[u.jsx("strong",{children:"Tutor:"})," All lessons are delivered by Davina, a qualified tutor with an Enhanced DBS check."]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"2. Age Requirements & Parental Consent"}),u.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-600 p-4 rounded-r-xl mt-4",children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx(To,{className:"text-yellow-700 flex-shrink-0 mt-1",size:24}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-bold text-yellow-900 mb-2",children:"Data Protection Requirements (UK GDPR)"}),u.jsxs("ul",{className:"text-yellow-800 text-sm space-y-1",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Students aged 16 and over:"})," Can book and consent independently"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Students aged 13-15:"})," Require parental/guardian consent"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Students under 13:"})," Not eligible for this service"]})]})]})]})}),u.jsx("p",{className:"text-gray-700 mt-4",children:"When booking a lesson for a student under 16, you (the parent/guardian) must:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1 mt-2",children:[u.jsx("li",{children:"Provide accurate contact information"}),u.jsx("li",{children:"Consent to data processing as outlined in our Privacy Policy"}),u.jsx("li",{children:"Be responsible for payment and account management"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"3. Booking & Scheduling"}),u.jsx("h3",{className:"font-bold text-gray-800 mt-4 text-xl",children:"3.1 Free Consultation"}),u.jsxs("p",{className:"text-gray-700 mt-2",children:["All new students receive a ",u.jsx("strong",{children:"free 30-minute consultation"})," to discuss goals, assess needs, and plan lessons. This is non-binding."]}),u.jsx("h3",{className:"font-bold text-gray-800 mt-6 text-xl",children:"3.2 Paid Lessons"}),u.jsx("p",{className:"text-gray-700 mt-2",children:"After the consultation, lessons can be booked as:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1 mt-2",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Single sessions:"})," 30 per hour"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"10-session blocks:"})," 280 (28/session - save 20)"]})]}),u.jsx("h3",{className:"font-bold text-gray-800 mt-6 text-xl",children:"3.3 Rescheduling"}),u.jsxs("p",{className:"text-gray-700 mt-2",children:["You may reschedule a lesson with at least ",u.jsx("strong",{children:"24 hours' notice"})," at no charge. Reschedule requests can be made via:"]}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1 mt-2",children:[u.jsx("li",{children:"Your student dashboard"}),u.jsx("li",{children:"Email to the tutor"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"4. Cancellation & Refund Policy"}),u.jsxs("div",{className:"bg-red-50 border-l-4 border-red-600 p-4 rounded-r-xl mt-4",children:[u.jsx("h3",{className:"font-bold text-red-900 mb-2",children:"14-Day Cooling-Off Period (Distance Selling Regulations)"}),u.jsxs("p",{className:"text-red-800 text-sm",children:["As this is an online service, you have the right to cancel within ",u.jsx("strong",{children:"14 days"})," of your first payment and receive a full refund, ",u.jsx("strong",{children:"unless"})," you have already attended paid sessions (in which case only unused sessions are refunded)."]})]}),u.jsx("h3",{className:"font-bold text-gray-800 mt-6 text-xl",children:"4.1 Cancellation by Student/Parent"}),u.jsxs("ul",{className:"text-gray-700 space-y-3 mt-3",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"24+ hours before lesson:"})," Full credit to reschedule or refund (minus processing fees)"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Less than 24 hours before lesson:"})," No refund (lesson is forfeited)"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Block bookings:"})," Unused sessions can be refunded on a pro-rata basis (28/session) if cancelled with 7+ days' notice"]})]}),u.jsx("h3",{className:"font-bold text-gray-800 mt-6 text-xl",children:"4.2 Cancellation by Tutor"}),u.jsx("p",{className:"text-gray-700 mt-2",children:"If I (Davina) need to cancel a lesson due to illness or emergency, you will be offered:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1 mt-2",children:[u.jsx("li",{children:"A full refund, or"}),u.jsx("li",{children:"A rescheduled session at your convenience"})]}),u.jsx("h3",{className:"font-bold text-gray-800 mt-6 text-xl",children:"4.3 No-Shows"}),u.jsx("p",{className:"text-gray-700 mt-2",children:"If a student does not join a scheduled lesson within 15 minutes, the session is considered a no-show and the payment is forfeited."})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"5. Payment Terms"}),u.jsxs("p",{className:"text-gray-700 mt-4",children:[u.jsx("strong",{children:"Payment Methods:"})," We accept payments via Stripe (card payments) and Plaid (Open Banking)."]}),u.jsx("p",{className:"text-gray-700 mt-2",children:u.jsx("strong",{children:"When Payment is Due:"})}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1 mt-2",children:[u.jsx("li",{children:"Single sessions: Payment due before lesson begins"}),u.jsx("li",{children:"Block bookings: Full payment upfront or payment plan available (contact for details)"})]}),u.jsxs("p",{className:"text-gray-700 mt-4",children:[u.jsx("strong",{children:"Late Payments:"})," Access to lessons and session materials will be suspended until payment is received."]}),u.jsxs("p",{className:"text-gray-700 mt-4",children:[u.jsx("strong",{children:"Receipts:"})," You will receive an email receipt after each payment, which serves as your invoice for tax purposes."]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"6. Student Conduct & Expectations"}),u.jsx("p",{className:"text-gray-700 mt-4",children:"To maintain a productive learning environment, students must:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-2 mt-3",children:[u.jsx("li",{children:"Join sessions on time with a working camera and microphone"}),u.jsx("li",{children:"Treat the tutor with respect"}),u.jsx("li",{children:"Complete assigned homework and prepare for lessons"}),u.jsx("li",{children:"Not share session recordings or materials without permission"})]}),u.jsxs("p",{className:"text-gray-700 mt-4",children:[u.jsx("strong",{children:"Termination of Service:"})," I reserve the right to terminate the tutoring relationship immediately without refund if a student engages in abusive, disruptive, or inappropriate behavior."]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"7. Intellectual Property"}),u.jsx("p",{className:"text-gray-700 mt-4",children:"All lesson materials, notes, worksheets, and content provided during sessions remain my intellectual property. Students may use these materials for personal study only and may not:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1 mt-2",children:[u.jsx("li",{children:"Reproduce or distribute materials commercially"}),u.jsx("li",{children:"Share materials with non-enrolled students"}),u.jsx("li",{children:"Claim authorship of provided content"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"8. Limitation of Liability"}),u.jsx("div",{className:"bg-gray-50 border-l-4 border-gray-600 p-4 rounded-r-xl mt-4",children:u.jsx("p",{className:"text-gray-800 text-sm",children:"While I strive to provide high-quality tutoring, I cannot guarantee specific academic outcomes (e.g., exam grades, university admission). Tutoring is one component of a student's education, and results depend on multiple factors including student effort, school instruction, and external circumstances."})}),u.jsxs("p",{className:"text-gray-700 mt-4",children:[u.jsx("strong",{children:"Technical Issues:"})," I am not liable for service interruptions caused by internet outages, platform failures, or other technical issues beyond my control. Lessons affected by technical problems will be rescheduled at no additional charge."]}),u.jsxs("p",{className:"text-gray-700 mt-4",children:[u.jsx("strong",{children:"Maximum Liability:"})," My total liability for any claim arising from these Terms is limited to the amount you paid for the specific lesson(s) in question."]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"9. Privacy & Data Protection"}),u.jsxs("p",{className:"text-gray-700 mt-4",children:["Your privacy is important. Please review our ",u.jsx("a",{href:"/privacy",className:"text-purple-600 hover:underline",children:"Privacy Policy"})," and ",u.jsx("a",{href:"/cookie-policy",className:"text-purple-600 hover:underline",children:"Cookie Policy"})," to understand how we collect, use, and protect your data."]}),u.jsx("p",{className:"text-gray-700 mt-4",children:"Key points:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1 mt-2",children:[u.jsx("li",{children:"We comply with UK GDPR and Data Protection Act 2018"}),u.jsx("li",{children:"You can access, update, or delete your data at any time"}),u.jsx("li",{children:"Payment records are retained for 7 years (HMRC requirement)"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"10. Dispute Resolution & Complaints"}),u.jsx("p",{className:"text-gray-700 mt-4",children:"If you have a complaint or concern, please contact me first:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1 mt-2",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Email:"})," ",u.jsx("a",{href:"mailto:privacy@davinastutoring.co.uk",className:"text-purple-600 hover:underline",children:"privacy@davinastutoring.co.uk"})]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Response Time:"})," Within 7 working days"]})]}),u.jsxs("p",{className:"text-gray-700 mt-4",children:["I am committed to resolving issues amicably. If we cannot reach an agreement, disputes may be escalated to the ",u.jsx("a",{href:"https://www.ombudsman.org.uk/",target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:underline",children:"Ombudsman Services"})," or small claims court."]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"11. Governing Law"}),u.jsxs("p",{className:"text-gray-700 mt-4",children:["These Terms are governed by the laws of ",u.jsx("strong",{children:"England and Wales"}),". Any legal disputes will be subject to the exclusive jurisdiction of the courts of England and Wales."]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"12. Changes to These Terms"}),u.jsx("p",{className:"text-gray-700 mt-4",children:'I may update these Terms from time to time. Changes will be posted on this page with an updated "Last updated" date. Significant changes will be communicated via email to active students.'}),u.jsx("p",{className:"text-gray-700 mt-4",children:"Continued use of the platform after changes constitutes acceptance of the updated Terms."})]}),u.jsxs("section",{className:"bg-gradient-to-r from-purple-100 to-teal-100 border-2 border-purple-300 rounded-xl p-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Questions About These Terms?"}),u.jsx("p",{className:"text-gray-800 mb-4",children:"If you have any questions about these Terms of Service, please contact:"}),u.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-md",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[u.jsx(Sg,{size:24,className:"text-purple-600"}),u.jsx("strong",{className:"text-gray-900",children:"Email:"}),u.jsx("a",{href:"mailto:privacy@davinastutoring.co.uk",className:"text-purple-600 hover:underline font-mono",children:"privacy@davinastutoring.co.uk"})]}),u.jsxs("p",{className:"text-gray-700 mt-2",children:[u.jsx("strong",{children:"Response Time:"})," Within 7 working days"]})]})]}),u.jsxs("section",{className:"bg-purple-50 border-2 border-purple-600 rounded-xl p-6",children:[u.jsx("h3",{className:"font-bold text-purple-900 text-lg mb-3",children:"By Using This Platform, You Agree:"}),u.jsxs("ul",{className:"text-purple-800 space-y-2",children:[u.jsx("li",{children:" You have read and understood these Terms of Service"}),u.jsx("li",{children:" You are 16+ or have parental/guardian consent if aged 13-15"}),u.jsx("li",{children:" You agree to the cancellation and payment policies"}),u.jsx("li",{children:" You accept the limitation of liability"})]})]})]}),u.jsx("div",{className:"mt-12 text-center",children:u.jsxs("button",{onClick:()=>s("/"),className:"bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-xl font-bold shadow-lg transition-all inline-flex items-center gap-2",children:[u.jsx(mh,{size:20})," Back to Home"]})})]})})},DP=()=>{const s=ka();return u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-teal-50 py-12 px-4",children:u.jsxs("div",{className:"max-w-4xl mx-auto bg-white rounded-3xl shadow-xl p-8 md:p-12",children:[u.jsxs("button",{onClick:()=>s("/"),className:"flex items-center gap-2 text-purple-600 hover:text-purple-700 font-bold mb-8 transition-colors",children:[u.jsx(mh,{size:20})," Back to Home"]}),u.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[u.jsx(y1,{size:48,className:"text-purple-600"}),u.jsxs("div",{children:[u.jsx("h1",{className:"text-4xl font-bold text-gray-900",children:"Cookie Policy"}),u.jsx("p",{className:"text-gray-500",children:"Last updated: February 2026"})]})]}),u.jsxs("div",{className:"prose prose-lg max-w-none space-y-8",children:[u.jsx("section",{children:u.jsxs("p",{className:"text-gray-700 leading-relaxed",children:["This Cookie Policy explains how ",u.jsx("strong",{children:"Davina's Tutoring Platform"})," uses browser storage technologies to provide our online tutoring services. We are committed to transparency about the data we store and your rights under UK GDPR and PECR regulations."]})}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:'What Are "Cookies" and Local Storage?'}),u.jsxs("p",{className:"text-gray-700 mt-4",children:["While we don't use traditional cookies, we use ",u.jsx("strong",{children:"browser local storage"}),"  a similar technology that stores data directly in your browser. This allows us to:"]}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-2 mt-3",children:[u.jsx("li",{children:"Keep you logged in to your student dashboard"}),u.jsx("li",{children:"Remember your lesson bookings and payment history"}),u.jsx("li",{children:"Save your preferences and session data"}),u.jsx("li",{children:"Provide a seamless experience across browsing sessions"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"What Data We Store"}),u.jsxs("div",{className:"mt-4 space-y-4",children:[u.jsxs("div",{className:"bg-purple-50 border-l-4 border-purple-600 p-4 rounded-r-xl",children:[u.jsx("h3",{className:"font-bold text-purple-900 mb-2",children:"Essential Storage (Required for Service)"}),u.jsxs("ul",{className:"text-purple-800 text-sm space-y-1",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Student Account Data:"})," Your name, email, encrypted PIN"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Booking Information:"})," Lesson dates, times, subjects, payment status"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Payment Records:"})," Transaction IDs, amounts, receipts (no card details)"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Session History:"})," Past lessons, notes, progress tracking"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Consent Preference:"})," Your cookie consent choice"]})]}),u.jsxs("p",{className:"text-xs text-purple-700 mt-3",children:[u.jsx("strong",{children:"Legal Basis:"})," Contractual necessity (GDPR Article 6(1)(b))  we need this data to provide tutoring services."]})]}),u.jsxs("div",{className:"bg-gray-50 border-l-4 border-gray-400 p-4 rounded-r-xl",children:[u.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:"We Do NOT Use:"}),u.jsxs("ul",{className:"text-gray-700 text-sm space-y-1",children:[u.jsx("li",{children:" Advertising or tracking cookies"}),u.jsx("li",{children:" Social media cookies"}),u.jsx("li",{children:" Third-party analytics cookies (e.g., Google Analytics)"}),u.jsx("li",{children:" Any non-essential cookies"})]})]})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"How Long We Keep This Data"}),u.jsx("p",{className:"text-gray-700 mt-4",children:"Data stored in your browser remains until:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-2 mt-3",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"You clear your browser data"})," (manually or via browser settings)"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"You delete your account"})," via your dashboard settings"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"You request deletion"})," by emailing privacy@davinastutoring.co.uk"]})]}),u.jsxs("p",{className:"text-gray-700 mt-4",children:["Additionally, we maintain server-side backups according to the retention periods in our ",u.jsx("a",{href:"/privacy",className:"text-purple-600 hover:underline",children:"Privacy Policy"}),":"]}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1 mt-2",children:[u.jsx("li",{children:"Student contact details: 1 year after last session"}),u.jsx("li",{children:"Session notes: 3 years after course completion"}),u.jsx("li",{children:"Payment records: 7 years (HMRC legal requirement)"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"How to Manage Your Stored Data"}),u.jsx("h3",{className:"font-bold text-gray-800 mt-4 text-xl",children:"Option 1: Dashboard Settings"}),u.jsx("p",{className:"text-gray-700 mt-2",children:"From your student dashboard, you can:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1 mt-2",children:[u.jsx("li",{children:"Download all your data (GDPR right to access)"}),u.jsx("li",{children:"Update your information"}),u.jsx("li",{children:"Request account deletion"})]}),u.jsx("h3",{className:"font-bold text-gray-800 mt-6 text-xl",children:"Option 2: Browser Settings"}),u.jsx("p",{className:"text-gray-700 mt-2",children:"You can clear local storage via your browser settings:"}),u.jsx("div",{className:"bg-gray-50 rounded-xl p-4 mt-3",children:u.jsxs("div",{className:"space-y-3 text-sm",children:[u.jsxs("div",{children:[u.jsx("strong",{className:"text-gray-900",children:"Chrome:"}),u.jsx("p",{className:"text-gray-600",children:"Settings  Privacy and security  Clear browsing data  Cookies and other site data"})]}),u.jsxs("div",{children:[u.jsx("strong",{className:"text-gray-900",children:"Firefox:"}),u.jsx("p",{className:"text-gray-600",children:"Settings  Privacy & Security  Cookies and Site Data  Clear Data"})]}),u.jsxs("div",{children:[u.jsx("strong",{className:"text-gray-900",children:"Safari:"}),u.jsx("p",{className:"text-gray-600",children:"Preferences  Privacy  Manage Website Data  Remove All"})]})]})}),u.jsx("p",{className:"text-sm text-red-700 mt-3 font-semibold",children:" Warning: Clearing browser data will log you out and remove all saved lesson/payment information from this device."}),u.jsx("h3",{className:"font-bold text-gray-800 mt-6 text-xl",children:"Option 3: Email Request"}),u.jsxs("p",{className:"text-gray-700 mt-2",children:["Email ",u.jsx("a",{href:"mailto:privacy@davinastutoring.co.uk",className:"text-purple-600 hover:underline",children:"privacy@davinastutoring.co.uk"})," to request complete data deletion across all systems."]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"Your Rights"}),u.jsx("p",{className:"text-gray-700 mt-4",children:"Under UK GDPR, you have the right to:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-2 mt-3",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Withdraw consent:"})," You can reject cookies at any time (though this limits platform functionality)"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Access your data:"})," Download everything we store via your dashboard"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Rectify data:"})," Update incorrect information"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Erase data:"})," Request deletion (subject to legal retention requirements)"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Port data:"})," Export your data in machine-readable format"]})]}),u.jsxs("p",{className:"text-gray-700 mt-4",children:["For full details, see our ",u.jsx("a",{href:"/privacy",className:"text-purple-600 hover:underline",children:"Privacy Policy"}),"."]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 border-b-2 border-purple-200 pb-3",children:"Changes to This Policy"}),u.jsx("p",{className:"text-gray-700 mt-4",children:'We may update this Cookie Policy from time to time. Any changes will be posted on this page with an updated "Last updated" date. Significant changes will be communicated via email to active students.'})]}),u.jsxs("section",{className:"bg-gradient-to-r from-purple-100 to-teal-100 border-2 border-purple-300 rounded-xl p-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Questions?"}),u.jsx("p",{className:"text-gray-800 mb-4",children:"If you have any questions about this Cookie Policy or how your data is stored, please contact:"}),u.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-md",children:[u.jsxs("p",{className:"text-gray-900",children:[u.jsx("strong",{children:"Email:"})," ",u.jsx("a",{href:"mailto:privacy@davinastutoring.co.uk",className:"text-purple-600 hover:underline font-mono",children:"privacy@davinastutoring.co.uk"})]}),u.jsxs("p",{className:"text-gray-700 mt-2",children:[u.jsx("strong",{children:"Response Time:"})," Within 7 working days"]})]})]})]}),u.jsx("div",{className:"mt-12 text-center",children:u.jsxs("button",{onClick:()=>s("/"),className:"bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-xl font-bold shadow-lg transition-all inline-flex items-center gap-2",children:[u.jsx(mh,{size:20})," Back to Home"]})})]})})},LP=()=>{const[s,e]=Y.useState(!1),[t,n]=Y.useState(!1);Y.useEffect(()=>{sessionStorage.getItem("cookieConsent")||setTimeout(()=>e(!0),2e3)},[]);const r=()=>{sessionStorage.setItem("cookieConsent","accepted"),localStorage.setItem("cookieConsentPreference","accepted"),e(!1),window.dispatchEvent(new Event("cookieConsentGranted"))},i=()=>{sessionStorage.setItem("cookieConsent","rejected"),localStorage.setItem("cookieConsentPreference","rejected"),e(!1);const o=["cookieConsentPreference"];Object.keys(localStorage).forEach(l=>{o.includes(l)||localStorage.removeItem(l)}),alert("You have rejected cookies. Please note that the tutoring platform requires local storage to function. You will have limited access to features.")};return s?u.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-[9999] p-4 animate-in slide-in-from-bottom-8 duration-500",children:u.jsx("div",{className:"max-w-6xl mx-auto bg-white rounded-2xl shadow-2xl border-2 border-purple-200",children:t?u.jsxs("div",{className:"p-4 sm:p-6",children:[u.jsxs("div",{className:"flex items-start justify-between mb-4",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"bg-purple-100 p-2 rounded-lg",children:u.jsx(y1,{className:"text-purple-600",size:24})}),u.jsx("h3",{className:"font-bold text-gray-900",children:"Cookie & Data Storage"})]}),u.jsx("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:u.jsx(a_,{size:20})})]}),u.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-4 max-h-48 overflow-y-auto text-sm",children:[u.jsxs("p",{className:"text-gray-700 mb-3",children:["By clicking ",u.jsx("strong",{children:'"Accept"'}),", you consent to our use of local storage to:"]}),u.jsxs("ul",{className:"space-y-2 text-gray-700",children:[u.jsxs("li",{className:"flex items-start gap-2",children:[u.jsx(Is,{size:16,className:"text-green-600 mt-0.5 flex-shrink-0"}),"Save your student account and login details"]}),u.jsxs("li",{className:"flex items-start gap-2",children:[u.jsx(Is,{size:16,className:"text-green-600 mt-0.5 flex-shrink-0"}),"Store your lesson bookings and payment history"]}),u.jsxs("li",{className:"flex items-start gap-2",children:[u.jsx(Is,{size:16,className:"text-green-600 mt-0.5 flex-shrink-0"}),"Remember your preferences and session data"]})]}),u.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:["We don't use tracking cookies or sell your data. See our"," ",u.jsx(Cf,{to:"/privacy",className:"text-purple-600 hover:underline",children:"Privacy Policy"}),","," ",u.jsx(Cf,{to:"/cookie-policy",className:"text-purple-600 hover:underline",children:"Cookie Policy"}),", and"," ",u.jsx(Cf,{to:"/terms",className:"text-purple-600 hover:underline",children:"Terms of Service"}),"."]})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 text-sm font-bold text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all",children:"Reject"}),u.jsxs("button",{onClick:r,className:"flex-1 px-6 py-2 text-sm font-bold text-white bg-purple-600 hover:bg-purple-700 rounded-lg shadow-md transition-all flex items-center justify-center gap-2",children:[u.jsx(Is,{size:16}),"Accept & Continue"]})]})]}):u.jsx("div",{className:"p-4 sm:p-6",children:u.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[u.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[u.jsx("div",{className:"bg-purple-100 p-2 rounded-lg flex-shrink-0",children:u.jsx(y1,{className:"text-purple-600",size:24})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"font-bold text-gray-900 text-sm sm:text-base mb-1",children:"We use cookies to enhance your experience"}),u.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:["We store your account, bookings, and session data locally. No tracking or third-party sharing.",u.jsx("button",{onClick:()=>n(!0),className:"text-purple-600 hover:underline ml-1 font-semibold",children:"Learn more"})]})]})]}),u.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[u.jsx("button",{onClick:i,className:"flex-1 sm:flex-none px-4 py-2 text-sm font-bold text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all",children:"Reject"}),u.jsxs("button",{onClick:r,className:"flex-1 sm:flex-none px-6 py-2 text-sm font-bold text-white bg-purple-600 hover:bg-purple-700 rounded-lg shadow-md transition-all flex items-center justify-center gap-2",children:[u.jsx(Is,{size:16}),"Accept"]})]})]})})})}):null};function RP(){return u.jsxs(kC,{children:[u.jsx(LP,{}),u.jsxs(sC,{children:[u.jsx(Wa,{path:"/",element:u.jsx(tT,{})}),u.jsx(Wa,{path:"/teacher",element:u.jsx(sT,{})}),u.jsx(Wa,{path:"/student-login",element:u.jsx(rT,{})}),u.jsx(Wa,{path:"/student/:studentName",element:u.jsx(zw,{})}),u.jsx(Wa,{path:"/student-dashboard",element:u.jsx(zw,{})}),u.jsx(Wa,{path:"/parent/:parentEmail",element:u.jsx(iT,{})}),u.jsx(Wa,{path:"/session/:roomId",element:u.jsx(kP,{})}),u.jsx(Wa,{path:"/privacy",element:u.jsx(jP,{})}),u.jsx(Wa,{path:"/terms",element:u.jsx(TP,{})}),u.jsx(Wa,{path:"/cookie-policy",element:u.jsx(DP,{})}),u.jsx(Wa,{path:"*",element:u.jsx(JS,{to:"/",replace:!0})})]})]})}class PP extends ra.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t}),console.error("Uncaught error:",e,t)}render(){return this.state.hasError?u.jsxs("div",{className:"p-10 text-red-600 font-mono",children:[u.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Something went wrong."}),u.jsxs("details",{className:"whitespace-pre-wrap bg-gray-100 p-4 rounded border border-red-200",children:[this.state.error&&this.state.error.toString(),u.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),u.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Reload Page"})]}):this.props.children}}aN.createRoot(document.getElementById("root")).render(u.jsx(ra.StrictMode,{children:u.jsx(PP,{children:u.jsx(RP,{})})}));export{gs as _,bx as c,Ig as g};
